# **iOS**@[**Swift**](https://developer.apple.com/swift/)<font color=red>é¶åœºé¡¹ç›®</font>è“çš®ä¹¦ğŸ“˜


<p align="left">
  <a><img src="https://img.shields.io/badge/Swift-red" alt="Swift"/></a>
  <a><img src="https://img.shields.io/badge/Xcode-15.4-blue" alt="Xcode"/></a>
  <a><img src="https://img.shields.io/badge/iOS-17.5+-critical" alt="iOS"/></a>
  <a><img src="https://img.shields.io/badge/pod-1.15.2-brightgreen" alt="CocoaPods"/></a>
  <a><img src="https://img.shields.io/github/actions/workflow/status/295060456/JobsSwiftBaseConfigDemo/ci.yml?branch=main" alt="Build Status"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo"><img src="https://img.shields.io/github/license/295060456/JobsSwiftBaseConfigDemo?style=flat&color=success" alt="License"/></a>
  <a><img src="https://img.shields.io/github/languages/top/295060456/JobsSwiftBaseConfigDemo?color=blueviolet" alt="Top Language"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo/stargazers"><img src="https://img.shields.io/github/stars/295060456/JobsSwiftBaseConfigDemo?style=flat-square&color=yellow" alt="Stars"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo/network"><img src="https://img.shields.io/github/forks/295060456/JobsSwiftBaseConfigDemo?style=flat-square&color=blue" alt="Forks"/></a>
  <a><img src="https://img.shields.io/github/issues/295060456/JobsSwiftBaseConfigDemo?color=important" alt="Issues"/></a>
  <a><img src="https://img.shields.io/github/last-commit/295060456/JobsSwiftBaseConfigDemo?color=ff69b4" alt="Last Commit"/></a>
  <a><img src="https://img.shields.io/github/languages/code-size/295060456/JobsSwiftBaseConfigDemo" alt="Code Size"/></a>
</p>

![Jobså€¾æƒ…å¥‰çŒ®](https://picsum.photos/1500/400 "Jobså‡ºå“ï¼Œå¿…å±ç²¾å“")

[toc]

å½“å‰æ€»è¡Œæ•°ï¼š

## ğŸ”¥ <font id=å‰è¨€>å‰è¨€</font>

> æ¸©é¦¨æç¤ºğŸ””ï¼šæœ¬æ–‡è¾ƒé•¿ï¼Œéœ€è¦â¬ä¸‹è½½åˆ°æœ¬åœ°ä»¥åï¼Œæ–¹èƒ½å®Œæ•´é˜…è¯»ã€‚æ¨èé˜…è¯»å™¨ğŸ‘‰[**Typora**](https://typora.io/)

* **å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨**
* **ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæ‰èƒ½çœ‹å¾—æ›´è¿œ**
* **é¢å‘ä¿¡ä»°ç¼–ç¨‹**
* [**ğŸ‘‰ç‚¹æˆ‘æŸ¥çœ‹è¿è¡Œæ•ˆæœ**](https://appetize.io/app/b_6jlimn7ue5vnmc4zq36aqam4jm)

## ä¸€ã€ğŸ¯ é¡¹ç›®ç™½çš®ä¹¦ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ç¨‹åºå‘˜æ˜¯ä¸€ä¸ªé«˜æ¶ˆè€—çš„èŒä¸šï¼Œé™¤äº†æ—¥å¸¸åŸºæœ¬çš„ä¸šåŠ¡å¼€å‘ä»¥å¤–ï¼Œæ–°äº‹ç‰©çš„ä¸æ–­æ¶Œç°ä¹Ÿéœ€è¦æŒç»­æ€§çš„å­¦ä¹ ï¼Œæ‰€ä»¥æ˜¯ä¸€ä»¶éå¸¸æ¶ˆè€—ç²¾åŠ›çš„äº‹ï¼›è€Œä¸”ç”±äºé•¿æœŸçš„é«˜å‹ã€é«˜æƒ…ç»ªã€ç†¬å¤œï¼Œ**ä¼šæ‰“ä¹±äººä½“å†…æ­£å¸¸çš„å†…åˆ†æ³ŒèŠ‚å¥**ï¼Œå¤§æ¦‚ç‡ä¹Ÿä¼šé€æ¸çš„å¼•å‘å„ç§èŒä¸šç–¾ç—…ã€‚ä¸šå†…æ™®éè®¤ä¸ºç¨‹åºå‘˜çš„**é»„é‡‘å¹´é¾„åœ¨25ï½35å‘¨å²**ã€‚é‚£ä¹ˆï¼Œè¿˜æ˜¯å¸Œæœ›ï¼Œåœ¨æˆ‘ä»¬ï¼ˆäº¦æˆ–è€…æ˜¯æš‚æ—¶æ€§çš„ï¼‰ç¦»å¼€è¿™ä¸ªè¡Œä¸šçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºè‡ªå·±æˆ–è€…åäººï¼Œç•™ä¸‹ç‚¹ä»€ä¹ˆï¼Œç®—æ˜¯è¿™ä¹ˆå¤šå¹´çš„ä¸€ä¸ªå·¥ä½œæ€»ç»“ã€‚æ­¤å¤–ï¼Œèƒ½æœ€å¤§åŒ–çš„è¾…åŠ©äººï¼Œå¸®åŠ©å…¶åœ¨æçŸ­çš„æ—¶é—´å†…å»ï¼š<u>å›å¿†/ä¸Šæ‰‹/å­¦ä¹ /å®éªŒ</u>è¿™ä¸ªç¼–ç¨‹è¯­è¨€ä¸‹çš„å·¥ç¨‹é¡¹ç›®ã€‚æ‰€ä»¥ï¼Œæ­¤é¡¹ç›®å°±ä¸€å®šæ˜¯è¦ç»“åˆå•†ä¸šéœ€æ±‚å»åŠ¡å®æ‹“å±•ï¼Œè§£å†³å½“å‰ç—›ç‚¹ã€‚

* å“æ§æ ‡å‡†ï¼ˆåªèƒ½ä¸¥æ ¼çš„ä¿è¯ç¼–è¯‘å™¨æ­£å¸¸ï¼Œè€Œä¸èƒ½å®Œå…¨ä¿è¯è¿è¡Œæ—¶çš„ä¸å‡ºé”™ï¼‰
  * ä¸€å®šè¦ä¿è¯è¿™ä¸ªå·¥ç¨‹çš„æˆåŠŸç¼–è¯‘é€šè¿‡ï¼Œæ–¹ä¾¿ä»¥åé¡¹ç›®ç›´æ¥è¿›è¡Œå¼•ç”¨ï¼Œä¹ƒè‡³å¼€æ–°ç‰ˆæœ¬
  * <font color=blue>**ç¤ºä¾‹Demoå¯èƒ½å› ä¸ºç›¸å…³Apiçš„å‡çº§ï¼Œæ²¡æœ‰åŠæ—¶çš„è¦†ç›–å¤„ç†ï¼Œå¯èƒ½ä¼šå‡ºç°é—ªé€€ã€‚ä¿®å¤å³å¯**</font>
* è‡ªæ­¤ä»¥åï¼Œæ‰€æœ‰æ–°å¼€çš„é¡¹ç›®éƒ½å¯ä»¥æ ¹æ®è¿™ä¸ª**æ ¹é¡¹ç›®**æ¥è¿›è¡Œç»Ÿä¸€çš„è°ƒé…å’Œä½¿ç”¨
  * å°†å®ƒä½œä¸ºæ‰€æœ‰é¡¹ç›®çš„æ¯ç‰ˆå’ŒåŸºç±»ï¼Œæœ€å¤§é™åº¦çš„åšåˆ°å…¨å±€çš„ç»Ÿä¸€
  * æ—¥ç§¯æœˆç´¯çš„è®°å½•ä¸€äº›å¹³æ—¶ç”Ÿäº§ç”Ÿæ´»ä¸­èŒå‘çš„ä¸€äº›ä¼˜ç§€çš„æƒ³æ³•ã€çµå…‰ä¸€ç°çš„åˆ›æ„ã€‚åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼š<u>è¯­æ³•ç³–çš„å°è£…</u>ã€<u>æ–¹æ³•çš„è°ƒç”¨</u>ï¼Œ<u>ç¬¬ä¸‰æ–¹çš„é€‰ç”¨</u>ã€ä»¥åŠä¸€äº›å¿ƒå¾—ä½“ä¼š
* ä½œä¸ºæŸäº›ä»£ç **å®è·µé¶åœº**ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„
  * ä¸ºæˆ‘ä»¬å¿«é€Ÿä¸”ç¨³å®šçš„å¤ç°ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œä½œä¸ºä»£ç å®éªŒå®¤ğŸ§ªï¼Œè€Œæ­å»ºçš„ä¸€ä¸ªå¹³å°
* ä½œä¸ºä»£ç ç¬”è®°ï¼Œè®°å½•ä¸€äº›å¸¸ç”¨çš„ä»£ç ï¼Œæ–¹ä¾¿æŸ¥é˜…
  * ä¸»è¦å½¢å¼æ˜¯å¯ä»¥è¿è¡Œçš„ä»£ç  + æ–‡å­—æ€§å™è¿° + å›¾æ–‡æ··ç¼–è®²è§£
  * ä½œä¸ºå­¦ä¹ çš„èµ„æ–™ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£åˆ°ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†ï¼Œå¤§å¹…**é™ä½å­¦ä¹ æˆæœ¬**
  * ä½œä¸ºå…¶ä»–é¡¹ç›®çš„å‚è€ƒï¼Œå¯ä»¥å¿«é€Ÿçš„äº†è§£åˆ°é¡¹ç›®çš„æ¶æ„ï¼Œä»£ç è§„èŒƒï¼Œä»¥åŠä¸€äº›è®¾è®¡æ¨¡å¼
  * è¿™ä¹ˆä¸€äº›ä¼˜ç§€çš„æˆæœï¼Œå…¶æ¥æºä¸ä»…ä»…æ˜¯æ¥è‡ªäºä½œè€…æœ¬èº«çš„æŒç»­ä»˜å‡ºä¸ç§¯ç´¯ã€‚æ›´æ˜¯è¿™ä¸ªé¢†åŸŸå¤§å®¶åº­ä¸­å„è·¯ä¼˜ç§€ä½œè€…çš„æ™ºæ…§ç»“æ™¶

## äºŒã€ğŸ‘¥ é¡¹ç›®é…ç½®æ”¯æŒ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€ç³»ç»Ÿç¯å¢ƒé…ç½® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* Appleç”µè„‘çš„èŠ¯ç‰‡åˆ†ä¸º**`intelèŠ¯ç‰‡`**å’Œ**`Mç³»åˆ—è‡ªç ”èŠ¯ç‰‡`**ã€‚åº•å±‚åŒºåˆ«åœ¨äºæŒ‡ä»¤é›†çš„ä¸åŒã€‚ä½†æ˜¯Appleåœæ­¢äº†å¯¹**`intelèŠ¯ç‰‡`**æœºå‹çš„æ”¯æŒï¼Œæ— æ³•æ›´æ–°MacOSåˆ°æœ€æ–°ï¼Œé—´æ¥çš„å¯¼è‡´æ— æ³•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„Xcodeã€‚è½¯ä»¶å¼€å‘ç›¸å…³çš„SDKå…¶å®ä¹Ÿå¯¹MacOSçš„ç³»ç»Ÿç¯å¢ƒä»¥åŠXcodeç‰ˆæœ¬æœ‰å…³è”å½±å“ã€‚å³ï¼šå³ä¾¿æ˜¯éƒ½æ˜¯ä½¿ç”¨ç»Ÿä¸€ç‰ˆæœ¬çš„[**Swift**](https://developer.apple.com/swift/)ä¹Ÿå¯èƒ½å¯¼è‡´æŸäº›APIæŠ¥é”™ï¼ˆæ‰¾ä¸åˆ°ï¼‰

* å¦‚æœAppleå¼€å‘è€…è´¦å·ï¼Œæ–°åŠ å…¥äº†è®¾å¤‡ï¼Œéœ€è¦åœ¨æœ¬åœ°çš„xcodeé‡Œé¢æ›´æ–°**å¼€å‘æè¿°æ–‡ä»¶**ã€‚å¦åˆ™æ‰“å‡ºçš„`*.ipa`åŒ…ï¼Œæ²¡æœ‰åŠæ³•åœ¨æ–°åŠ å…¥çš„è®¾å¤‡é‡Œé¢å®‰è£…

  <table style="width:100%; table-layout:fixed;">
    <tr>
      <td><img src="./assets/image-20251003094132519.png" style="width:80%; height:auto;"></td>
      <td><img src="./assets/image-20251003094412609.png" style="width:100%; height:auto;"></td>
    </tr>
  </table>


* è¿™ä¸ªç‰ˆæœ¬æ˜¯ã€ŒXcode å½“å‰è‡ªå¸¦ [**Swift**](https://developer.apple.com/swift/) å·¥å…·é“¾ã€çš„ç‰ˆæœ¬ï¼Œä¸ä¸€å®šä¸é¡¹ç›® **Build Settings** ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ï¼ˆé¡¹ç›®å¯é€‰æ‹©æ—§ç‰ˆç¼–è¯‘ï¼‰ã€‚

  ```shell
  âœ  ~ xcrun swift --version
  swift-driver version: 1.127.14.1 Apple Swift version 6.2 (swiftlang-6.2.0.19.9 clang-1700.3.19.1)
  Target: arm64-apple-macosx26.0
  ```

* æ‰¾åˆ°`Swift Language Version`

  ![image-20250929113942861](./assets/image-20250929113942861.png)

* æŸ¥é¡¹ç›®é‡Œçš„é…ç½®ï¼šå¦‚æœé¡¹ç›®æœ‰å¤šä¸ª targetï¼Œæ¯ä¸ª target å¯èƒ½å®šä¹‰ä¸åŒçš„ `SWIFT_VERSION`ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰å¤šè¡Œè¾“å‡ºï¼š

  ```shell
  âœ  MyApp git:(developer) âœ— grep SWIFT_VERSION MyApp.xcodeproj/project.pbxproj
  				SWIFT_VERSION = 5.0;
  				SWIFT_VERSION = 5.0;
  ```

  >```
  >YourProject.xcodeproj/
  > â””â”€â”€ project.pbxproj   âœ… å®é™…é…ç½®æ–‡ä»¶
  >```

* **Mac OS 15** ä»¥åï¼Œè‹¹æœé‡‡å–äº†æ›´åŠ ä¸¥æ ¼çš„æƒé™å†™å…¥æœºåˆ¶ã€‚[**Swift**](https://developer.apple.com/swift/)é¡¹ç›®å¦‚æœè¦åˆ©ç”¨[**`Cocoapods`**](https://cocoapods.org/)æ¥é›†æˆç¬¬ä¸‰æ–¹ï¼Œå°±éœ€è¦åœ¨**xcode**é‡Œé¢åšå¦‚ä¸‹è®¾ç½®ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ï¼š

  * <font size=5  color=red>åœ¨`xcode`é‡Œé¢è®¾ç½®ä¼˜å…ˆçº§æœ€é«˜</font>

    `TARGETS`->`Build Settings`->`ENABLE_USER_SCRIPT_SANDBOXING`-><font color=red>`NO`</font>

    ![image-20250616173410872](./assets/image-20250616173410872.png)
  
  * æˆ–è€…ï¼Œåœ¨ `Podfile` é‡Œé…ç½®
  
    ```ruby
    pods_project = installer.pods_project
    pods_project.targets.each do |t|
      t.build_configurations.each do |config|
        config.build_settings['ENABLE_USER_SCRIPT_SANDBOXING'] = 'NO'
        config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      end
    end
    ```
  
  * æˆ–è€…ï¼Œ[**è„šæœ¬å¤„ç†**](./ã€MacOSã€‘âš™ï¸åŒå‡»ç¦ç”¨æ²™ç›’ä¿è¯Cocoapodsæ„å»ºæµç¨‹.command)
  
    ```shell
    #!/bin/zsh
    
    print_green()  { echo "\033[0;32m$1\033[0m"; }
    print_red()    { echo "\033[0;31m$1\033[0m"; }
    print_yellow() { echo "\033[0;33m$1\033[0m"; }
    
    print_green "ğŸ› ï¸ è„šæœ¬åŠŸèƒ½ï¼š"
    echo "1ï¸âƒ£ è‡ªåŠ¨è¯†åˆ« Flutter æˆ–åŸç”Ÿ iOS å·¥ç¨‹"
    echo "2ï¸âƒ£ è‡ªåŠ¨å®šä½ Xcode å·¥ç¨‹ï¼ˆ.xcodeprojï¼‰æ–‡ä»¶"
    echo "3ï¸âƒ£ ä¿®æ”¹ ENABLE_USER_SCRIPT_SANDBOXING = NOï¼Œé˜²æ­¢ CocoaPods æ„å»ºå¤±è´¥"
    echo ""
    
    SCRIPT_DIR=$(cd "$(dirname "$0")"; pwd)
    XCODEPROJ=""
    
    # å°è¯•è‡ªåŠ¨è¯†åˆ« Flutter / iOS å·¥ç¨‹è·¯å¾„
    if [[ -d "$SCRIPT_DIR/ios" && -d "$SCRIPT_DIR/lib" ]]; then
      print_green "ğŸ“¦ æ£€æµ‹åˆ° Flutter å·¥ç¨‹ï¼Œè¿›å…¥ ios å­ç›®å½•æŸ¥æ‰¾ Xcode å·¥ç¨‹..."
      PROJECT_DIR="$SCRIPT_DIR/ios"
    else
      print_green "ğŸ“± å°è¯•åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾åŸç”Ÿ iOS å·¥ç¨‹..."
      PROJECT_DIR="$SCRIPT_DIR"
    fi
    
    # è‡ªåŠ¨å¯»æ‰¾ .xcodeproj
    XCODEPROJ=$(find "$PROJECT_DIR" -maxdepth 1 -name "*.xcodeproj" | head -n 1)
    
    # å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±è®©ç”¨æˆ·æ‰‹åŠ¨æ‹–å…¥
    if [[ -z "$XCODEPROJ" ]]; then
      print_red "âŒ æœªè‡ªåŠ¨æ‰¾åˆ° .xcodeproj æ–‡ä»¶"
      echo ""
      read "?ğŸ‘‰ è¯·æ‰‹åŠ¨æ‹–å…¥ä½ çš„ .xcodeproj å·¥ç¨‹æ–‡ä»¶ï¼Œç„¶åæŒ‰å›è½¦ï¼š" XCODEPROJ
      XCODEPROJ=${XCODEPROJ%\"}
      XCODEPROJ=${XCODEPROJ#\"}
    fi
    
    # æ ¡éªŒè·¯å¾„æœ‰æ•ˆæ€§
    PBXPROJ_PATH="$XCODEPROJ/project.pbxproj"
    if [[ ! -f "$PBXPROJ_PATH" ]]; then
      print_red "âŒ æ‰¾ä¸åˆ° project.pbxproj æ–‡ä»¶ï¼Œè¯·ç¡®è®¤è·¯å¾„æ­£ç¡®"
      exit 1
    fi
    
    print_yellow "ğŸ“‚ ç›®æ ‡å·¥ç¨‹ï¼š$XCODEPROJ"
    print_green  "ğŸ” æ­£åœ¨æŸ¥æ‰¾ ENABLE_USER_SCRIPT_SANDBOXING è®¾ç½®..."
    
    # âœ… è‹¥å·²å­˜åœ¨ï¼Œåˆ™æ›¿æ¢ä¸º NO
    grep -q "ENABLE_USER_SCRIPT_SANDBOXING" "$PBXPROJ_PATH"
    if [[ $? -eq 0 ]]; then
      print_green "âœ… å·²æ‰¾åˆ° ENABLE_USER_SCRIPT_SANDBOXINGï¼Œæ­£åœ¨æ›¿æ¢ä¸º NO..."
      sed -i '' 's/ENABLE_USER_SCRIPT_SANDBOXING = YES;/ENABLE_USER_SCRIPT_SANDBOXING = NO;/g' "$PBXPROJ_PATH"
      sed -i '' 's/ENABLE_USER_SCRIPT_SANDBOXING = YES/ENABLE_USER_SCRIPT_SANDBOXING = NO/g' "$PBXPROJ_PATH"
    else
      print_green "â• æœªæ˜¾å¼è®¾ç½®ï¼Œæ·»åŠ  ENABLE_USER_SCRIPT_SANDBOXING = NO åˆ°æ‰€æœ‰ buildSettings..."
      sed -i '' '/buildSettings = {/a\
    \        ENABLE_USER_SCRIPT_SANDBOXING = NO;
    ' "$PBXPROJ_PATH"
    fi
    
    print_green "ğŸ‰ ä¿®æ”¹å®Œæˆï¼å·²å°† ENABLE_USER_SCRIPT_SANDBOXING è®¾ç½®ä¸º NO"
    ```
  

### 2ã€å¼€å‘å‘¨è¾¹æ”¯æŒ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**JobsDocs**](https://github.com/295060456/JobsDocs)

  * [**ä¸­å›½å…¬æ°‘èº«ä»½è¯æ ¡éªŒè§„åˆ™**](https://github.com/295060456/JobsDocs/blob/main/ä¸­å›½å…¬æ°‘èº«ä»½è¯æ ¡éªŒè§„åˆ™.md/ä¸­å›½å…¬æ°‘èº«ä»½è¯æ ¡éªŒè§„åˆ™.md)
  * [**iOSé¡¹ç›®å¤šç¯å¢ƒé…ç½®**](https://github.com/295060456/JobsDocs/blob/main/iOSç›¸å…³çš„æ–‡æ¡£å’Œèµ„æ–™.md/iOSé¡¹ç›®å¤šç¯å¢ƒé…ç½®.md/iOSé¡¹ç›®å¤šç¯å¢ƒé…ç½®.md)

* [**è¿‡æœŸçš„æ¨¡æ‹Ÿå™¨é…ä»¶**](https://github.com/295060456/Xcode_Sys_lib)

* [**åˆ¶ä½œ(å‘å¸ƒ)Podsç»„ä»¶**](https://github.com/JobsKits/JobsDocs/blob/main/åˆ¶ä½œ(å‘å¸ƒ)Podsç»„ä»¶.md/åˆ¶ä½œ(å‘å¸ƒ)Podsç»„ä»¶.md)

* [**CocoaPods**](https://cocoapods.org/)

* [**MacOSé…ç½®ä¸ªäººçƒ­ç‚¹ğŸ›œ**](https://github.com/295060456/JobsDocs/blob/main/MacOSé…ç½®ä¸ªäººçƒ­ç‚¹ğŸ›œ.md/MacOSé…ç½®ä¸ªäººçƒ­ç‚¹ğŸ›œ.md)

* [**Swift Package Dependenceä½¿ç”¨æŒ‡å—ğŸ§­**](https://github.com/295060456/JobsDocs/tree/main/Swift Package Dependenceä½¿ç”¨æŒ‡å—/Swift Package Dependenceä½¿ç”¨æŒ‡å—.md)

* [**Xcodeæ–‡ä»¶æ¨¡ç‰ˆçš„é…ç½®å’Œä½¿ç”¨**](https://github.com/295060456/xctemplate)

* [**è‹¹æœå¼€å‘è€…è´¦æˆ·ç»­è´¹**](https://account.apple.com/account/manage/section/payment)

* [**åœ¨çº¿æ¼”ç¤º**](https://appetize.io) ğŸ‘‰ ä¸Šä¼ ä½ çš„ï¼ˆæ”¯æŒiOS/Androidï¼‰åŒ…ï¼Œå°±èƒ½åœ¨çº¿è¿è¡Œã€æ¼”ç¤ºã€è°ƒè¯•ã€è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè¿˜èƒ½åµŒåˆ°ç½‘é¡µæˆ–å†…éƒ¨ç³»ç»Ÿé‡Œç»™å®¢æœ/é”€å”®/åŸ¹è®­/QA ç”¨

* [**é…ç½®SourceTreeè„šæœ¬**](https://github.com/295060456/SourceTree.sh)

* [**ä»£ç å—**](https://github.com/295060456/JobsCodeSnippets)

* [**åˆ©ç”¨quicktypeè‡ªåŠ¨å»ºç«‹æ•°æ®æ¨¡å‹**](https://github.com/JobsKits/JobsDocs/blob/main/åˆ©ç”¨quicktypeè‡ªåŠ¨å»ºç«‹æ•°æ®æ¨¡å‹.md/åˆ©ç”¨quicktypeè‡ªåŠ¨å»ºç«‹æ•°æ®æ¨¡å‹.md)

* [**å›¾ç‰‡å ä½ç¬¦**](https://picsum.photos/)

* [**snipaste**](https://www.snipaste.com/)ï¼šæˆªå›¾å·¥å…·

* [**Sip**](https://sipapp.io/)ï¼šå–è‰²å™¨

* [**å¸®å°å¿™@è…¾è®¯QQæµè§ˆå™¨åœ¨çº¿å·¥å…·ç®±**](https://tool.browser.qq.com/)

* [**Macç ´è§£è½¯ä»¶**](https://mac.macxz.com/)

* [**æ³¢æµ‹**](https://www.boce.com/)

* [**å‘é™„è¿‘è®¾å¤‡åˆ†äº«æ–‡ä»¶**](https://localsend.org/download)

* [**uuwallet@è™šæ‹Ÿå¡**](https://www.uuwallet.com/)

* [<font id=UIç•Œé¢è°ƒè¯•å·¥å…·>**UIç•Œé¢è°ƒè¯•å·¥å…·**</font>](https://lookin.work/)ï¼ˆå¿…é¡»æ˜¯æœ‰çº¿è¿æ¥ï¼Œå¹¶ä¸”**`Lookin.app`**è¦å…ˆäºé¡¹ç›®æ–‡ä»¶å¯åŠ¨ï¼‰

  > ```ruby
  > pod 'LookinServer', :subspecs => ['Swift'], :configurations => ['Debug']
  > ```

* [**Fastlane**](https://fastlane.tools/)ï¼šè‡ªåŠ¨åŒ–å·¥å…·é›†

  > ä¸€ä¸ªå¼€æºçš„ **ç§»åŠ¨åº”ç”¨ï¼ˆiOS / Androidï¼‰è‡ªåŠ¨åŒ–å·¥å…·é›†**ï¼Œç›®çš„æ˜¯æŠŠé‚£äº›ç¹çã€é‡å¤ã€å®¹æ˜“å‡ºé”™çš„ App æ„å»º / ç­¾å / å‘å¸ƒ / æµ‹è¯• / ä¸Šæ¶ ç­‰æµç¨‹ï¼Œå˜æˆ<u>å†™ä¸€ä¸ªè„šæœ¬ã€ä¸€é”®æ‰§è¡Œ</u>çš„å·¥ä½œã€‚

* [**SwiftLint**](https://github.com/realm/SwiftLint)ï¼š[**Swift**](https://developer.apple.com/swift/) ä»£ç é™æ€æ£€æŸ¥å·¥å…·ã€‚ **è‡ªåŠ¨åˆ†æ Swift æºä»£ç ï¼Œå¸®åŠ©ä¿æŒç»Ÿä¸€ã€è§„èŒƒã€å¯ç»´æŠ¤çš„ä»£ç é£æ ¼**ã€‚

  > åŸæœ¬è¦é å›¢é˜Ÿ Code Review å»å‘ç°çš„ç»†èŠ‚ï¼Œ[**SwiftLint**](https://github.com/realm/SwiftLint) éƒ½èƒ½è‡ªåŠ¨æ‰«å‡ºæ¥ âš¡ï¸

  ```shell
  âœ  ~ brew install swiftlint
  ```

  * `.swiftlint.yml` æ¨¡æ¿

    ```yml
    # =========================================
    # SwiftLint é…ç½®æ–‡ä»¶ï¼ˆæ ‡å‡†æ¨¡æ¿ï¼Œå«ä¸­æ–‡æ³¨é‡Šï¼‰
    # æ”¾åˆ°ä»“åº“æ ¹ç›®å½•ï¼Œä¸ .gitignore åŒçº§
    # =========================================
    
    # Swift ç‰ˆæœ¬ï¼ˆæœ‰åŠ©äºè§„åˆ™è§£æï¼›ä¸å†™ä¹Ÿèƒ½è·‘ï¼‰
    swift_version: 5.9
    
    # é€‰æ‹©ä½¿ç”¨å“ªç§æŠ¥å‘Šå™¨ï¼š
    # - xcodeï¼ˆé»˜è®¤ï¼Œè­¦å‘Šå‡ºç°åœ¨ Xcode Issues é¢æ¿ï¼‰
    # - json / markdown / emoji ç­‰
    reporter: xcode
    
    # éœ€è¦æ‰«æçš„è·¯å¾„ï¼ˆç›¸å¯¹ä»“åº“æ ¹ï¼›ä¸å¡«åˆ™æ‰«æå…¨ä»“åº“ï¼‰
    # ä¸€èˆ¬åˆ—å‡ºä½ çš„ App æºç æ ¹ç›®å½•ï¼Œé¿å…æ‰« Pods
    included:
      - JobsSwiftBaseConfigDemo
    
    # éœ€è¦å¿½ç•¥çš„è·¯å¾„ï¼ˆä¼˜å…ˆçº§é«˜äº includedï¼‰
    excluded:
      - Pods
      - Carthage
      - .build
      - DerivedData
      - Generated
      - Scripts
      - fastlane
      - **/*.generated.swift  # å¿½ç•¥ä»£ç ç”Ÿæˆäº§ç‰©
    
    # å…³é—­çš„è§„åˆ™ï¼ˆå›¢é˜Ÿå…±è¯†ä¸‹â€œä¸æƒ³çœ‹â€çš„æç¤ºï¼‰
    disabled_rules:
      - trailing_whitespace           # è¡Œå°¾ç©ºæ ¼
      - file_header                   # æ–‡ä»¶å¤´æ³¨é‡Š
      - redundant_objc_available      # é‡å¤çš„ @available æç¤ºï¼ˆå¸¸ä¸ #available æ··ç”¨è§¦å‘ï¼‰
      - nesting                       # å…è®¸è¾ƒæ·±çš„ç±»å‹/è¯­å¥åµŒå¥—
      - todo                          # å…è®¸ TODO/FIXME ç•™å­˜
      # - force_cast                  # å¦‚ä½ ä»éœ€å¼ºè½¬å¯ä»¥å…³æ‰ï¼Œä½†æ›´æ¨èä¿ç•™
      # - force_try                   # å¦‚ä½ ä»éœ€ try! å¯ä»¥å…³æ‰
    
    # é€‰æ‹©æ€§å¼€å¯çš„â€œå¯é€‰è§„åˆ™â€ï¼ˆopt-inï¼Œä¸é»˜è®¤å¼€å¯ï¼‰
    # è¿™äº›é€šå¸¸æ›´ä¸¥æ ¼/æ›´ä¸»è§‚ï¼›æŒ‰éœ€å–èˆ
    opt_in_rules:
      - empty_count                   # å»ºè®®ç”¨ isEmpty è€Œä¸æ˜¯ .count == 0
      - operator_usage_whitespace     # è¿ç®—ç¬¦ä¸¤è¾¹ç©ºæ ¼
      - closure_spacing               # é—­åŒ…å†…éƒ¨ç©ºæ ¼
      - explicit_init                 # ç¦æ­¢å†—ä½™çš„ .init è°ƒç”¨
      - vertical_parameter_alignment_on_call # è°ƒç”¨å¯¹é½
      - discouraged_optional_boolean  # ä¸æ¨è Optional<Bool>
    
    # -------------------- åŸºç¡€é˜ˆå€¼ç±»è§„åˆ™ --------------------
    # æ¯è¡Œæœ€å¤§é•¿åº¦ï¼ˆè¶…è¿‡ warning ç»™é»„ï¼Œè¶…è¿‡ error ç»™çº¢ï¼‰
    line_length:
      warning: 160
      error: 200
      ignores_urls: true
      ignores_function_declarations: true
      ignores_comments: true
      ignores_interpolated_strings: true
    
    # å•æ–‡ä»¶æœ€å¤§è¡Œæ•°
    file_length:
      warning: 600
      error: 1200
    
    # ç±»å‹ï¼ˆclass/struct/enumï¼‰ä½“ç§¯é™åˆ¶
    type_body_length:
      warning: 300
      error: 600
    
    # å‡½æ•°ä½“ç§¯é™åˆ¶ï¼ˆé€»è¾‘å¤ªå¤šéœ€è¦æ‹†åˆ†ï¼‰
    function_body_length:
      warning: 60
      error: 120
    
    # åœˆå¤æ‚åº¦ï¼ˆåˆ†æ”¯è¿‡å¤šå»ºè®®æ‹†è§£ï¼‰
    cyclomatic_complexity:
      warning: 12
      error: 20
      ignores_case_statements: true
    
    # å‚æ•°è¿‡å¤šï¼ˆå¯ä»¥æ¨åŠ¨é‡æ„æˆ–å¯¹è±¡å°è£…ï¼‰
    function_parameter_count:
      warning: 6
      error: 8
    
    # åµŒå¥—æ·±åº¦ï¼ˆif/for/switch/ç±»å‹åµŒå¥—ï¼‰
    # å·²åœ¨ disabled_rules é‡Œå…³äº† nestingï¼Œå°±æ— éœ€æ­¤é¡¹ï¼›å¦‚è¦å¯ç”¨å¯æ”¾å¼€ï¼š
    # nesting:
    #   type_level: 2
    #   statement_level: 5
    
    # -------------------- å‘½åè§„èŒƒ --------------------
    # æ ‡è¯†ç¬¦å‘½åé•¿åº¦ï¼ˆå˜é‡/å¸¸é‡/å‚æ•°ï¼‰
    identifier_name:
      min_length: 2
      max_length: 50
      allowed_symbols: ["_"]          # å…è®¸ä¸‹åˆ’çº¿
      excluded:                       # ä»¥ä¸‹çŸ­åä¸è­¦å‘Š
        - id
        - x
        - y
        - i
        - j
        - w
        - h
        - rx
    
    # ç±»å‹å‘½åï¼ˆç±»/ç»“æ„ä½“/æšä¸¾/åè®®ï¼‰
    type_name:
      min_length: 2
      max_length: 60
      excluded:
        - T
        - U
        - V
    
    # æšä¸¾ case å‘½åï¼ˆå¦‚éœ€å…è®¸å¤§å†™æˆ–ç‰¹æ®Šå‰ç¼€å¯åœ¨æ­¤é…ç½®ï¼‰
    enum_case_associated_values_count:
      warning: 5
      error: 8
    
    # -------------------- é£æ ¼/å¯è¯»æ€§ --------------------
    # ç©ºè¡Œæ•°é‡ï¼ˆå¯é¿å…è¿‡å¤šç©ºè¡Œï¼‰
    vertical_whitespace:
      max_empty_lines: 2
    
    trailing_newline: warning          # æ–‡ä»¶æœ«å°¾éœ€è¦æ¢è¡Œ
    
    # å¯¼å…¥é¡ºåºï¼ˆæŒ‰å­—æ¯æ’åºï¼ŒåŒç±»åˆå¹¶ï¼‰
    # å¦‚ä½ ä½¿ç”¨ Swift 5.9+ çš„ import å­æ¨¡å—åˆ†ç»„ï¼Œå¯æŒ‰éœ€å…³é—­
    sorted_imports: true
    
    # æ˜ç¡®çš„è®¿é—®æ§åˆ¶ï¼ˆpublic/internal/privateï¼‰å¯é€‰å¯ç”¨
    # explicit_acl: warning
    
    # æ˜ç¡® selfï¼ˆä»…åœ¨é—­åŒ…ä¸­æˆ–æ­§ä¹‰æ—¶è¦æ±‚ selfï¼‰
    # explicit_self: warning
    
    # -------------------- åˆ†æå™¨è§„åˆ™ï¼ˆéœ€ä½¿ç”¨ Swift è¯­ä¹‰ä¿¡æ¯ï¼Œè¾ƒæ…¢ï¼‰ --------------------
    # analyzer_rules é€‚åˆ CI æˆ–æœ¬åœ°å…¨é‡æ£€æŸ¥ï¼Œèƒ½å‘ç°æ›´å¤æ‚é—®é¢˜
    analyzer_rules:
      - unused_declaration            # æœªä½¿ç”¨çš„å£°æ˜ï¼ˆå˜é‡/å‡½æ•°/ç±»å‹ï¼‰
      - unused_import                 # æœªä½¿ç”¨çš„ import
    
    # -------------------- è‡ªå®šä¹‰è§„åˆ™ï¼ˆå¯ç”¨æ­£åˆ™è‡ªå®šå›¢é˜Ÿé£æ ¼ï¼‰ --------------------
    # ä¾‹å¦‚ï¼šç¦æ­¢ printï¼Œç»Ÿä¸€ç”¨è‡ªå®¶æ—¥å¿—å·¥å…·
    custom_rules:
      no_print:
        included: ".*\\.swift"
        name: "Avoid print"
        regex: "\\bprint\\s*\\("
        message: "è¯·ä½¿ç”¨æ—¥å¿—å·¥å…·ï¼ˆå¦‚ JobsLog / os_logï¼‰ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨ printã€‚"
        severity: warning
    
      no_todo_merge:
        name: "No TODO in merge"
        regex: "(TODO|FIXME)"
        match_kinds:
          - comment
        severity: warning
    
    # -------------------- è§„åˆ™ä¸¥é‡çº§åˆ«ç»Ÿä¸€æå‡/é™ä½ï¼ˆå¯é€‰ï¼‰ --------------------
    # è‡ªå®šä¹‰ severity çš„é›†ä¸­è°ƒæ•´ï¼ˆéœ€è¦æ—¶å†å¼€ï¼‰
    # severity_configuration:
    #   warning: error
    
    # =========================================
    # ä½¿ç”¨æç¤ºï¼š
    # - è¿è¡Œï¼šswiftlint            # ä»…æ£€æŸ¥
    # - è‡ªåŠ¨ä¿®å¤ï¼šswiftlint autocorrect
    # - æŒ‡å®šæ–‡ä»¶ï¼šswiftlint lint --path path/to/File.swift
    # - åœ¨ Xcode Build Phases æ·»åŠ  Run Scriptï¼šswiftlint
    # =========================================
    ```

  * å·¥ä½œåŸç†ï¼ˆåº•å±‚é€»è¾‘ï¼‰

    * [**SwiftLint**](https://github.com/realm/SwiftLint) è¯»å–ä½ çš„é¡¹ç›®æºç 
    * æ ¹æ® `.swiftlint.yml` é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„è§„åˆ™é›†
    * ä½¿ç”¨ **SwiftSyntax / SourceKit** åˆ†æ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰
    * æ£€æŸ¥æ¯æ¡è§„åˆ™å¯¹åº”çš„æ¨¡å¼
    * æŠŠè¿åè§„åˆ™çš„åœ°æ–¹ä»¥ <u>**warning / error**</u> å½¢å¼è¾“å‡ºåˆ°æ§åˆ¶å°æˆ– Xcode

  * åŠŸèƒ½

    | åŠŸèƒ½            | è¯´æ˜                                                       |
    | --------------- | ---------------------------------------------------------- |
    | ğŸ” ä»£ç é£æ ¼æ£€æµ‹  | è‡ªåŠ¨æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆ Swift å®˜æ–¹æ¨èæˆ–è‡ªå®šä¹‰è§„èŒƒ            |
    | ğŸš« é”™è¯¯/è­¦å‘Šæç¤º | åœ¨ Xcodeã€ç»ˆç«¯æ˜¾ç¤ºé»„è‰²/çº¢è‰²æç¤º                            |
    | ğŸ§  è‡ªåŠ¨ä¿®å¤      | å¯è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†ç®€å•é—®é¢˜ï¼ˆå¦‚ç©ºæ ¼ã€ç¼©è¿›ã€ç©ºè¡Œï¼‰               |
    | ğŸ§© å¯é…ç½®è§„åˆ™    | é€šè¿‡ `.swiftlint.yml` è‡ªå®šä¹‰è§„åˆ™ã€å¿½ç•¥ç›®å½•ã€æ’é™¤ç‰¹ä¾‹       |
    | ğŸ§± CI é›†æˆ       | èƒ½åµŒå…¥åˆ° Xcode Buildã€Fastlaneã€GitHub Actions ä¸­          |
    | ğŸ”• å±€éƒ¨ç¦ç”¨      | é€šè¿‡æ³¨é‡Šä¸´æ—¶å…³é—­è§„åˆ™ï¼Œå¦‚ï¼š`// swiftlint:disable rule_name` |

### 3ã€ç¬¬ä¸‰æ–¹ä»£ç ç®¡ç†å·¥å…·çš„é…ç½® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Podfile**

  ```ruby
  # Uncomment the next line to define a global platform for your project
  # â¤ï¸TARGETS->Build Settings->ENABLE_USER_SCRIPT_SANDBOXING->NOâ¤ï¸
  platform :ios, '13.0'   # â¤ï¸ é¡¶å±‚ç›´æ¥è®¾ 13.0ï¼Œå’Œ post_install ä¿æŒä¸€è‡´
  
  ## é€šè¿‡ Bundler è¿è¡Œ CocoaPods å‘½ä»¤
  ## bundle exec pod update
  #begin
  #  require 'bundler/setup'
  #  Bundler.setup(:default)
  #  puts 'Bundler setup completed'
  #  require 'cocoapods-downloader'
  #  puts 'cocoapods-downloader plugin loaded'
  #rescue LoadError => e
  #  puts 'cocoapods-downloader plugin could not be loaded'
  #  puts e.message
  #end
  #puts 'Podfile is being loaded...'
  # åŠ é€Ÿ CocoaPods ä¾èµ–ä¸‹è½½çš„å·¥å…· https://github.com/CocoaPods/cocoapods-downloader
  # ä½¿ç”¨å‰æï¼šgem install cocoapods-downloader
  #plugin 'cocoapods-downloader', {
  #  'https://github.com/CocoaPods/Specs.git' => [
  #    'https://mirrors.aliyun.com/pods/specs.git',
  #    'https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git',
  #    'https://mirrors.cloud.tencent.com/CocoaPods/Specs.git',
  #    'https://mirrors.ustc.edu.cn/CocoaPods/Specs.git'
  #  ]
  #}
  
  #plugin 'cocoapods-repo-update'
  
  ## æŒ‡æ˜ä¾èµ–åº“çš„æ¥æºåœ°å€
  #source 'https://cdn.cocoapods.org/'
  #source 'https://github.com/CocoaPods/Specs.git'# ä½¿ç”¨å®˜æ–¹é»˜è®¤åœ°å€ï¼ˆé»˜è®¤ï¼‰
  #source 'https://github.com/Artsy/Specs.git'# ä½¿ç”¨å…¶ä»–æ¥æºåœ°å€
  
  # éœ€è¦ç‰¹åˆ«è¯´æ˜çš„ï¼šåœ¨ post_install æ—¶ï¼Œä¸ºäº†ä¸€äº›ç‰ˆæœ¬çš„å…¼å®¹ï¼Œéœ€è¦éå†æ‰€æœ‰ targetï¼Œè°ƒæ•´ä¸€éƒ¨åˆ†åº“çš„ç‰ˆæœ¬ï¼›ä½†æ˜¯å¦‚æœå¼€å¯äº† generate_multiple_pod_projects çš„è¯ï¼Œç”±äºé¡¹ç›®ç»“æ„çš„å˜åŒ–ï¼Œinstaller.pod_targets å°±æ²¡åŠæ³•è·å¾—æ‰€æœ‰ pods å¼•å…¥çš„ target äº†
  install! 'cocoapods',# install! åªèµ°ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨åªä»¥æœ€åä¸€ä¸ªæ ‡å‡†æ‰§è¡Œ
    :deterministic_uuids => false,
    # â¤ï¸ æš‚æ—¶å…³æ‰ generate_multiple_pod_projectsï¼Œé¿å… SnapKit ç­‰ Swift-only åº“ slice å¼‚å¸¸
    # :generate_multiple_pod_projects => true,
    :disable_input_output_paths => true
  
  inhibit_all_warnings!
  # ç”¨äºæŒ‡å®šä½ çš„ Pod é¡¹ç›®åº”ä½¿ç”¨é™æ€åº“è€Œä¸æ˜¯åŠ¨æ€åº“ã€‚
  # è¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äºè§£å†³æŸäº›ä¸åŠ¨æ€åº“ç›¸å…³çš„å…¼å®¹æ€§å’Œæ€§èƒ½é—®é¢˜ã€‚
  use_frameworks! :linkage => :static
  
  # å…¨å±€ modular headersï¼ˆå’Œ use_frameworks! ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼‰
  #use_modular_headers!
  
  # å‡ ä¹æ¯ä¸ªAppéƒ½ä¼šç”¨åˆ°çš„
  def swiftAppCommon
    pod 'IQKeyboardManager'
    pod 'Alamofire', '~> 5.9'      # â¤ï¸ æ˜¾å¼æŒ‡å®šæ–°ç‰ˆæœ¬
    pod 'Moya', :modular_headers => true
    pod 'SDWebImage'
    pod 'GKNavigationBarSwift'
    pod 'ReactiveSwift', '~> 6.7'  # â¤ï¸ æ–°ç‰ˆæœ¬æ”¯æŒ arm64 æ¨¡æ‹Ÿå™¨
    pod 'lottie-ios'
    pod 'SnapKit', '~> 5.7'        # â¤ï¸ æ–°ç‰ˆæœ¬æ”¯æŒ arm64 æ¨¡æ‹Ÿå™¨
    pod 'JXSegmentedView'
    pod "HTMLReader"
    pod 'KakaJSON'
    pod 'RxSwift'                  # æ ¸å¿ƒ
    pod 'RxCocoa'                  # UI ç»‘å®šï¼šUIKitã€AppKit çš„æ‰©å±•
    pod 'RxRelay'                  # å®‰å…¨æ›¿ä»£ Variableï¼Œå¸¸ç”¨äº ViewModel
    pod 'NSObject+Rx'
  end
  
  # è°ƒè¯•æ¡†æ¶
  def debugPods
  # pod 'Bugly'
  # pod 'DoraemonKit'
  # pod 'CocoaDebug'
  # pod 'FLEX'
  # pod 'JJException'
  # pod 'FBRetainCycleDetector'
    #pod 'LookinServer', :configurations => ['Debug']
  end
  
  # åŸºç¡€çš„å…¬å…±é…ç½®
  def cocoPodsConfig
    target 'JobsSwiftBaseConfigDemoTests' do
      inherit! :search_paths
    end
    target 'JobsSwiftBaseConfigDemoUITests' do
      inherit! :search_paths
    end
  
    pre_install do |installer|
      # åšä¸€äº›å®‰è£…ä¹‹å‰çš„æ›´æ”¹
    end
  
    post_install do |installer|
      require 'open3'
      is_apple_silicon = `uname -m`.strip == 'arm64'
  
      installer.pods_project.targets.each do |target|
        puts "!!!! #{target.name}"
        target.build_configurations.each do |config|
          config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.0'
          config.build_settings['CODE_SIGNING_ALLOWED'] = 'NO'
          config.build_settings['CODE_SIGNING_REQUIRED'] = 'NO'
          # âœ… åªæœ‰ Apple Silicon æ¨¡æ‹Ÿå™¨ä¸‹æ‰æ’é™¤ arm64
          # â—ï¸æ”¹ä¸ºï¼šä¸æ’é™¤ï¼ˆåˆ é™¤å¯èƒ½è¢«å…¶ä»–åœ°æ–¹å†™å…¥çš„æ’é™¤é¡¹ï¼‰ï¼Œä¿è¯ç”Ÿæˆ arm64-apple-ios-simulator slice
          if is_apple_silicon
            config.build_settings.delete('EXCLUDED_ARCHS[sdk=iphonesimulator*]')  # â¤ï¸ å…³é”®ä¿®æ”¹
          end
        end
      end
  
      installer.pods_project.build_configurations.each do |config|
        config.build_settings['ONLY_ACTIVE_ARCH'] = 'NO'
        # â—ï¸åŒç†ï¼šä¸æ’é™¤ arm64 æ¨¡æ‹Ÿå™¨
        if is_apple_silicon
          config.build_settings.delete('EXCLUDED_ARCHS[sdk=iphonesimulator*]')    # â¤ï¸ å…³é”®ä¿®æ”¹
        end
      end
    end
  end
  
  # â¤ï¸æ–°å·¥ç¨‹éœ€è¦ä¿®æ”¹è¿™é‡Œâ¤ï¸
  target 'JobsSwiftBaseConfigDemo' do
    debugPods
    swiftAppCommon
    cocoPodsConfig
  end
  ```

* <font color=red id=SPM>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager

  <div style="text-align: center;">
    <img src="./assets/image-20250616173604040.png" alt="image-1" style="width:30%; display:inline-block; vertical-align: top;" />
    <img src="./assets/image-20250616174404275.png" alt="image-2" style="width:65%; display:inline-block; vertical-align: top;" />
  </div>

### 4ã€ä¸€äº›é€‚ç”¨äº[Swift](https://developer.apple.com/swift/)çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆæŒç»­æ›´æ–°...ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 4.1ã€[**DeviceKit**](https://github.com/devicekit/DeviceKit) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 4.2ã€[**HandyJSON**](https://github.com/alibaba/HandyJSON) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ã€é˜¿é‡Œå·´å·´å¼€å‘
>
> 2ã€ **[Swift](https://developer.apple.com/swift/) çš„ JSON ä¸æ¨¡å‹æ˜ å°„åº“**
>
> 3ã€**ç®€åŒ– [Swift](https://developer.apple.com/swift/)  ä¸ JSON æ•°æ®ä¹‹é—´çš„åºåˆ—åŒ– / ååºåˆ—åŒ–è¿‡ç¨‹**ï¼Œé¿å…ä¼ ç»Ÿæ–¹å¼ä¸‹å¤§é‡æ‰‹å†™ `Codable`ã€`init(from:)` æˆ–è€… `Mappable` çš„æ¨¡æ¿åŒ–ä»£ç 
>
> 4ã€[**Swift**](https://developer.apple.com/swift/).[**Codable**](https://developer.apple.com/documentation/swift/codable) ğŸ†š [**HandyJSON**](https://github.com/alibaba/HandyJSON)
>
> â€‹	4.1ã€**Codable** æ˜¯è‹¹æœå®˜æ–¹çš„ï¼Œç±»å‹å®‰å…¨ï¼Œä½†éœ€è¦å†™ `CodingKeys`ï¼Œä»£ç é‡è¾ƒå¤§ã€‚é€‚åˆ **ä¸¥æ ¼çš„æ•°æ®ç»“æ„ã€ç¼–è¯‘æœŸå®‰å…¨** çš„é¡¹ç›®ã€‚
>
> â€‹	4.2ã€**HandyJSON** ååŠ¨æ€æ˜ å°„ï¼Œæ›´â€œè‡ªåŠ¨åŒ–â€ï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œä½†ç±»å‹å®‰å…¨æ€§ç¨å·®ï¼ˆè¿è¡ŒæœŸåšè§£æï¼‰ã€‚é€‚åˆ **å¿«é€Ÿå¼€å‘ / éœ€æ±‚å˜åŠ¨å¤§çš„åœºæ™¯**ã€‚
* åŸºæœ¬ç”¨æ³•

  *  **JSON** â†”ï¸ æ¨¡å‹

    å®šä¹‰æ¨¡å‹

    ```swift
    import HandyJSON
    
    struct User: HandyJSON {
        var id: Int?
        var name: String?
        var age: Int?
    }
    ```

    JSON â†’ æ¨¡å‹

    ```swift
    let json = "{\"id\":123, \"name\":\"Jobs\", \"age\":18}"
    if let user = User.deserialize(from: json) {
        print(user.name ?? "")  // è¾“å‡º "Jobs"
    }
    ```

    æ¨¡å‹ â†’ JSON

    ```swift
    let user = User(id: 123, name: "Jobs", age: 18)
    let jsonString = user.toJSONString()
    print(jsonString ?? "")
    ```
    
  * æšä¸¾ + `HandyJSONEnum`ï¼š [**HandyJSON**](https://github.com/alibaba/HandyJSON) å¯¹ **æšä¸¾åºåˆ—åŒ– / ååºåˆ—åŒ–** çš„æ”¯æŒ

    ```swift
    /**
     è®©æšä¸¾ï¼ˆå¿…é¡»æ˜¯ åŸå§‹å€¼æšä¸¾ï¼Œæ¯”å¦‚ Int æˆ– Stringï¼‰å¯ä»¥ç›´æ¥å’Œ JSON ä¸­çš„åŸå§‹å€¼äº’è½¬ã€‚
     ä¾‹å¦‚ JSON è¿”å› "status": 2ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ° JXLoginStatus.normal_loginã€‚
     åè¿‡æ¥ï¼Œæšä¸¾è½¬ JSON æ—¶ä¼šè‡ªåŠ¨è¾“å‡ºåŸå§‹å€¼ã€‚
     */
    enum JXLoginStatus: Int, HandyJSONEnum {
        case didnot_login = 1
        case normal_login = 2
    }
    ```

#### 4.3ã€[**SnapKit**](https://github.com/SnapKit/SnapKit) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

  * å®‰è£…
  
    * [**Cocoapods**](https://cocoapods.org/)
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'SnapKit'
      ```
    
    * [<font color=red>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager](#SPM)
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/SnapKit/SnapKit
      ```
    
  * å¯¼å…¥
  
    ```swift
    import SnapKit
    ```
  
  * è°ƒç”¨
    
    * åˆ›å»ºè§†å›¾å¹¶æ·»åŠ çº¦æŸ
    
      > å…ˆåŠ åç”¨
      >
      > ```swift
      > let box = UIView()
      > box.backgroundColor = .red
      > view.addSubview(box)
      > 
      > box.snp.makeConstraints { make in
      >     make.center.equalToSuperview()    // å±…ä¸­
      >     make.width.height.equalTo(100)    // å®½é«˜ = 100
      > }
      > ```
    
    * å¸¸ç”¨çº¦æŸå†™æ³•
    
      * ç›¸å¯¹çˆ¶è§†å›¾
    
        ```swift
        make.top.equalToSuperview().offset(20)      // è·ç¦»çˆ¶è§†å›¾é¡¶éƒ¨ 20
        make.left.equalToSuperview().offset(15)     // å·¦è¾¹è· 15
        make.right.equalToSuperview().inset(15)     // å³è¾¹è· 15ï¼ˆinset = -offsetï¼‰
        make.bottom.equalToSuperview().offset(-20)  // åº•è¾¹è· 20
        ```
    
      * ç›¸å¯¹å…¶å®ƒè§†å›¾
    
        ```swift
        make.top.equalTo(titleLabel.snp.bottom).offset(10)  // è·ç¦» titleLabel åº•éƒ¨ 10
        make.left.equalTo(icon.snp.right).offset(8)         // è·ç¦» icon å³è¾¹ 8
        ```
    
      * å›ºå®šå¤§å°
    
        ```swift
        make.width.equalTo(120)
        make.height.equalTo(50)
        ```
    
      * å®½é«˜æ¯”
    
        ```swift
        make.width.equalTo(view.snp.height).multipliedBy(0.5) // å®½ = é«˜ * 0.5
        ```
    
      * å±…ä¸­
    
        ```swift
        make.center.equalToSuperview()     // å®Œå…¨å±…ä¸­
        make.centerX.equalToSuperview()    // æ¨ªå‘å±…ä¸­
        make.centerY.equalToSuperview()    // çºµå‘å±…ä¸­
        ```
    
      * æ›´æ–°çº¦æŸï¼ˆ`updateConstraints`ï¼‰

        > é€‚åˆè¦ä¿®æ”¹éƒ¨åˆ†çº¦æŸçš„æƒ…å†µ

        ```swift
        box.snp.updateConstraints { make in
            make.width.equalTo(200)   // åŸæ¥100 â†’ æ›´æ–°ä¸º200
        }
        ```

      * é‡æ–°è®¾ç½®çº¦æŸï¼ˆ`remakeConstraints`ï¼‰

        > ä¼šå…ˆç§»é™¤æ—§çº¦æŸï¼Œå†é‡æ–°æ·»åŠ 

        ```swift
        box.snp.remakeConstraints { make in
            make.center.equalToSuperview()
            make.size.equalTo(CGSize(width: 50, height: 50))
        }
        ```
      
      * é«˜çº§ç”¨æ³•@ä¼˜å…ˆçº§

        ```swift
        make.width.lessThanOrEqualTo(300).priority(.high)
        ```

      * é«˜çº§ç”¨æ³•@SafeArea

        ```swift
        make.top.equalTo(view.safeAreaLayoutGuide.snp.top).offset(10)
        ```

      * é«˜çº§ç”¨æ³•@é“¾å¼å¤šæ¡ä»¶

        ```swift
        make.edges.equalToSuperview().inset(UIEdgeInsets(top: 10, left: 15, bottom: 20, right: 15))
        ```

#### 4.4ã€[**Alamofire**](https://github.com/Alamofire/Alamofire) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **Alamofire** æ˜¯ Swift ç¤¾åŒºæœ€æµè¡Œçš„ **ç½‘ç»œè¯·æ±‚åº“**ï¼ŒåŸºäº **URLSession** å°è£…ï¼Œç®€åŒ–äº† HTTP è¯·æ±‚ã€å“åº”å¤„ç†ã€JSON è§£æã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç­‰æ“ä½œã€‚
>  å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š
>
> - è¯­æ³•ç®€æ´ï¼Œé“¾å¼è°ƒç”¨
> - å†…ç½® JSON/Plist å‚æ•°ç¼–ç ä¸è§£æ
> - æ”¯æŒä¸Šä¼ /ä¸‹è½½ï¼ˆå«è¿›åº¦å›è°ƒï¼‰
> - æ”¯æŒè®¤è¯ï¼ˆBasic Authã€OAuth Bearer Token ç­‰ï¼‰
> - é›†æˆäº†ç½‘ç»œè¯·æ±‚é˜Ÿåˆ—ã€å“åº”åºåˆ—åŒ–ã€é”™è¯¯å¤„ç†ç­‰å¸¸è§åŠŸèƒ½
>
> åœ¨ iOS å¼€å‘ä¸­ï¼Œå®ƒç›¸å½“äº Objective-C æ—¶ä»£çš„ **AFNetworking** çš„ Swift æ›¿ä»£ã€‚

* å®‰è£…
  
    * [**Cocoapods**](https://cocoapods.org/)
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'Alamofire'
      ```
    
    * [<font color=red>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager](#SPM)
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/Alamofire/Alamofire.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import Alamofire
  ```
  
* è°ƒç”¨
  
    * GET è¯·æ±‚
    
      ```swift
      import Alamofire
      
      AF.request("https://api.example.com/users").response { response in
          debugPrint(response)
      }
      ```
    
    * GET + JSON è§£æ
    
      ```swift
      AF.request("https://api.example.com/users")
          .responseJSON { response in
              switch response.result {
              case .success(let value):
                  print("è¿”å› JSON: \(value)")
              case .failure(let error):
                  print("è¯·æ±‚å¤±è´¥: \(error)")
              }
          }
      ```
    
    * POST è¯·æ±‚ï¼ˆå¸¦å‚æ•°ï¼‰
    
      ```swift
      let params: [String: Any] = [
          "username": "jobs",
          "password": "123456"
      ]
      
      AF.request("https://api.example.com/login",
                 method: .post,
                 parameters: params,
                 encoding: JSONEncoding.default)
          .responseJSON { response in
              print(response)
          }
      ```
    
    * æ–‡ä»¶ä¸Šä¼ 
    
      ```swift
      AF.upload(multipartFormData: { formData in
          formData.append(Data("jobs".utf8), withName: "username")
          formData.append(URL(fileURLWithPath: "/path/to/file.png"), withName: "file")
      }, to: "https://api.example.com/upload")
      .responseJSON { response in
          print(response)
      }
      ```
    
    * æ–‡ä»¶ä¸‹è½½
    
      ```swift
      let destination: DownloadRequest.Destination = { _, _ in
          let documentsURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)[0]
          let fileURL = documentsURL.appendingPathComponent("file.zip")
      
          return (fileURL, [.removePreviousFile, .createIntermediateDirectories])
      }
      
      AF.download("https://example.com/file.zip", to: destination)
          .downloadProgress { progress in
              print("ä¸‹è½½è¿›åº¦: \(progress.fractionCompleted)")
          }
          .response { response in
              print("ä¸‹è½½å®Œæˆ: \(response.fileURL)")
          }
      
      ```
    
    * å…¨å±€é…ç½®ï¼ˆæ¯”å¦‚ç»Ÿä¸€ Headerã€è¶…æ—¶è®¾ç½®ï¼‰
    
      ```swift
      let configuration = URLSessionConfiguration.default
      configuration.timeoutIntervalForRequest = 30
      
      let session = Session(configuration: configuration)
      
      session.request("https://api.example.com/data").responseJSON { response in
          print(response)
      }
      ```
    
    * é“¾å¼è°ƒç”¨
    
      ```swift
      AF.request("https://api.example.com/user")
          .validate(statusCode: 200..<300)
          .responseDecodable(of: User.self) { response in
              switch response.result {
              case .success(let user):
                  print("ç”¨æˆ·æ•°æ®: \(user)")
              case .failure(let error):
                  print("é”™è¯¯: \(error)")
              }
          }

#### 4.5ã€[**Moya**](https://github.com/Moya/Moya) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> - **å®šä½**ï¼š[**Moya**](https://github.com/Moya/Moya) æ˜¯ä¸€ä¸ª **ç½‘ç»œæŠ½è±¡å±‚**ï¼ˆNetworking Abstraction Layerï¼‰ã€‚
> - **åº•å±‚**ï¼šå®ƒåŸºäº [**Alamofire**](https://github.com/Alamofire/Alamofire) å®ç°è¯·æ±‚å‘é€ï¼Œä½†å¯¹ä¸šåŠ¡å¼€å‘è€…å±è”½äº†ç¹ççš„é…ç½®ã€‚
> - **æ ¸å¿ƒæ€æƒ³**ï¼šç”¨ **æšä¸¾ï¼ˆenumï¼‰+ åè®®ï¼ˆTargetTypeï¼‰** æ¥å®šä¹‰æ¥å£ã€‚
>
> è¿™æ ·åšçš„å¥½å¤„ï¼š
>
> 1. **æ¥å£é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰ API è·¯å¾„ã€å‚æ•°ã€è¯·æ±‚æ–¹å¼å†™åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ¸…æ™°å¯ç»´æŠ¤ã€‚
> 2. **é¿å…é­”æ³•å­—ç¬¦ä¸²**ï¼šä¸éœ€è¦åœ¨ä»£ç é‡Œåˆ°å¤„æ‹¼æ¥ URLã€HTTP æ–¹æ³•ã€‚
> 3. **æ›´é€‚åˆå¤šäººåä½œ**ï¼šè§„èŒƒåŒ– API å±‚ï¼Œé™ä½å‡ºé”™ç‡ã€‚

* å®‰è£…
  
    * [**Cocoapods**](https://cocoapods.org/)
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'Moya'
      ```
    
    * [<font color=red>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager](#SPM)
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/Moya/Moya.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import Moya
  ```

* è°ƒç”¨

  * å®šä¹‰ API æšä¸¾

    ```swift
    enum MyService {
        case getUser(id: Int)
        case createUser(name: String, age: Int)
    }
    
    // éµå¾ª TargetType åè®®
    extension MyService: TargetType {
        var baseURL: URL { URL(string: "https://api.example.com")! }
    
        var path: String {
            switch self {
            case .getUser(let id):
                return "/user/\(id)"
            case .createUser:
                return "/user"
            }
        }
    
        var method: Moya.Method {
            switch self {
            case .getUser:
                return .get
            case .createUser:
                return .post
            }
        }
    
        var task: Task {
            switch self {
            case .getUser:
                return .requestPlain
            case .createUser(let name, let age):
                return .requestParameters(parameters: ["name": name, "age": age],
                                          encoding: JSONEncoding.default)
            }
        }
    
        var headers: [String: String]? {
            ["Content-Type": "application/json"]
        }
    }
    ```

  * åˆ›å»º Provider

    ```swift
    let provider = MoyaProvider<MyService>()
    ```

  * å‘é€è¯·æ±‚

    ```swift
    // GET
    provider.request(.getUser(id: 1)) { result in
        switch result {
        case .success(let response):
            print("è¿”å›: \(response.data)")
        case .failure(let error):
            print("é”™è¯¯: \(error)")
        }
    }
    
    // POST
    provider.request(.createUser(name: "Jobs", age: 18)) { result in
        switch result {
        case .success(let response):
            print("åˆ›å»ºæˆåŠŸ: \(response.data)")
        case .failure(let error):
            print("å¤±è´¥: \(error)")
        }
    }
    ```

  * æ’ä»¶æœºåˆ¶ï¼ˆå¯ä»¥æ‹¦æˆªè¯·æ±‚/å“åº”ï¼Œä¾‹å¦‚ç»Ÿä¸€æ‰“å°æ—¥å¿—ã€æ·»åŠ  tokenï¼‰

    ```swift
    final class NetworkLogger: PluginType {
        func willSend(_ request: RequestType, target: TargetType) {
            print("â¡ï¸ è¯·æ±‚: \(request.request?.url?.absoluteString ?? "")")
        }
    
        func didReceive(_ result: Result<Response, MoyaError>, target: TargetType) {
            print("â¬…ï¸ å“åº”: \(result)")
        }
    }
    
    let provider = MoyaProvider<MyService>(plugins: [NetworkLogger()])
    ```

  * å“åº”æ¨¡å‹è§£æ

    ```swift
    provider.request(.getUser(id: 1)) { result in
        switch result {
        case .success(let response):
            do {
                let user = try JSONDecoder().decode(User.self, from: response.data)
                print("ç”¨æˆ·: \(user)")
            } catch {
                print("è§£æå¤±è´¥: \(error)")
            }
        case .failure(let error):
            print("è¯·æ±‚é”™è¯¯: \(error)")
        }
    }
    ```

  * **Stubï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰**ï¼šé€‚åˆå†™å•å…ƒæµ‹è¯•æˆ–æœ¬åœ°å¼€å‘

    ```swift
    let stubProvider = MoyaProvider<MyService>(stubClosure: MoyaProvider.immediatelyStub)
    stubProvider.request(.getUser(id: 1)) { result in
        print(result)
    }
    ```

#### 4.6ã€[**ESPullToRefresh**](https://github.com/eggswift/pull-to-refresh?tab=readme-ov-file) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ¯” [**MJRefresh**](https://github.com/CoderMJLee/MJRefresh) æ›´ç°ä»£çš„ [**Swift**](https://developer.apple.com/swift/) å†™æ³•ï¼Œæ”¯æŒè‡ªå®šä¹‰åŠ¨ç”»ã€‚

```swift
import ESPullToRefresh

tableView.es.addPullToRefresh {
    print("ä¸‹æ‹‰åˆ·æ–°")
    DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
        self.tableView.es.stopPullToRefresh()
    }
}

tableView.es.addInfiniteScrolling {
    print("ä¸Šæ‹‰åŠ è½½")
    DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
        self.tableView.es.stopLoadingMore()
    }
}
```

#### 4.7ã€[**RxSwift**](https://github.com/ReactiveX/RxSwift) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **æœ€å°ä¾èµ–**ï¼šåªç”¨ `RxSwift`ã€‚
>
> **MVVM å¼€å‘**ï¼šé€šå¸¸ `RxSwift + RxCocoa + RxRelay` ä¸€èµ·ç”¨ã€‚
>
> âœ… **ä¼˜ç‚¹**
>
> - ç»Ÿä¸€äº‹ä»¶æµï¼ˆUIã€ç½‘ç»œã€é€šçŸ¥ã€å®šæ—¶å™¨ç­‰ï¼‰
> - ä»£ç å£°æ˜å¼ï¼Œå¯è¯»æ€§å¥½
> - å¤©ç„¶é€‚åˆ MVVM æ¶æ„
>
> âš ï¸ **ç¼ºç‚¹**
>
> - å­¦ä¹ æ›²çº¿é™¡å³­ï¼ˆæ“ä½œç¬¦å¤šï¼‰
> - è°ƒè¯•ä¸ç›´è§‚ï¼ˆéœ€è¦ä¹ æƒ¯äº‹ä»¶æµæ€ç»´ï¼‰
> - ä¸æ³¨æ„é‡Šæ”¾å¯èƒ½å¯¼è‡´ **å†…å­˜æ³„æ¼**

* å®‰è£…
  
    * [**Cocoapods**](https://cocoapods.org/)
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      # æ ¸å¿ƒåº“
      pod 'RxSwift'                  # æ ¸å¿ƒ
      pod 'RxCocoa'                  # UI ç»‘å®šï¼šUIKitã€AppKit çš„æ‰©å±•
      pod 'RxRelay'                  # å®‰å…¨æ›¿ä»£ Variableï¼Œå¸¸ç”¨äº ViewModel
      ```
    
    * [<font color=red>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager](#SPM)
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/ReactiveX/RxSwift.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import RxSwift    // æ ¸å¿ƒ Observable / Observer / Disposable
  import RxCocoa    // UI æ§ä»¶ç»‘å®šï¼ˆå¦‚ textField.rx.textã€button.rx.tapï¼‰
  import RxRelay    // BehaviorRelay / PublishRelay
  ```
  
* è°ƒç”¨
  
    > **æŒ‰é’®**ï¼š`tap.throttle + withLatestFrom(æœ€æ–°è¾“å…¥)`
  >
  > **è¾“å…¥**ï¼š`debounce + distinctUntilChanged + filter`
  >
  > **UI ç»‘å®š**ï¼šå°½é‡ç”¨ `Driver/Signal`ï¼ˆä¸»çº¿ç¨‹ã€æ—  errorã€å…±äº«ï¼‰
  >
  > **ç›‘å¬**ï¼š`NotificationCenter.default.rx.notification(name[, object])`
  >
  > **è§£æ**ï¼š`compactMap` å®‰å…¨å– `userInfo`
  >
  > **æ€§èƒ½**ï¼š`debounce/throttle/distinctUntilChanged/share(replay:)`
  >
  > **é‡Šæ”¾**ï¼š`disposed(by: bag)` å³å¯ï¼Œæ— éœ€ `removeObserver`
  
  * æŒ‰é’®é˜²è¿ç‚¹ï¼ˆèŠ‚æµï¼‰
  
    ```swift
    loginBtn.rx.tap
        .throttle(.milliseconds(500), scheduler: MainScheduler.instance) // 500ms å†…åªè®¤ç¬¬ä¸€æ¬¡
        .withLatestFrom(Observable.combineLatest(vm.username, vm.password)) // ç‚¹ä¸€ä¸‹å¸¦æœ€æ–°è¾“å…¥
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * è¾“å…¥æ¡†å®æ—¶æ ¡éªŒï¼ˆé•¿åº¦/é‚®ç®±ç­‰ï¼‰
  
    ```swift
    let usernameValid = usernameTF.rx.text.orEmpty
        .map { $0.count >= 3 }
        .distinctUntilChanged()
        .share(replay: 1)
    
    let passwordValid = passwordTF.rx.text.orEmpty
        .map { $0.count >= 6 }
        .distinctUntilChanged()
        .share(replay: 1)
    
    // é‚®ç®±ç¤ºä¾‹ï¼ˆå¯é€‰ï¼‰
    let emailValid = usernameTF.rx.text.orEmpty
        .map { text in
            let pattern = #"^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$"#
            return text.range(of: pattern, options: [.regularExpression, .caseInsensitive]) != nil
        }
        .share(replay: 1)
    ```
  
  * å¯ç”¨æŒ‰é’® + è§†è§‰æ€
  
    ```swift
    Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .bind(to: loginBtn.rx.isEnabled)
        .disposed(by: bag)
    
    Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .map { $0 ? 1.0 : 0.5 }
        .bind(to: loginBtn.rx.alpha)
        .disposed(by: bag)
    ```
  
  * æœç´¢è¾“å…¥ï¼šå»æŠ– + å»é‡ + éç©º
  
    ```swift
    let searchText = searchTF.rx.text.orEmpty
        .debounce(.milliseconds(300), scheduler: MainScheduler.instance) // åœæ­¢è¾“å…¥300mså†å‘
        .distinctUntilChanged()
        .filter { !$0.isEmpty } // è¿‡æ»¤ç©ºä¸²
        .share(replay: 1)
    
    searchText
        .subscribe(onNext: { query in
            // fire search(query)
        })
        .disposed(by: bag)
    ```
  
  * é™åˆ¶æœ€å¤§é•¿åº¦ï¼ˆå›å†™ UIï¼‰
  
    ```swift
    let limitedPwd = passwordTF.rx.text.orEmpty
        .map { String($0.prefix(20)) } // æœ€å¤š 20 ä½
        .share(replay: 1)
    
    limitedPwd
        .bind(to: passwordTF.rx.text)
        .disposed(by: bag)
    ```
  
  * Return é”®è¡Œä¸ºï¼ˆä¸‹ä¸€æ­¥ / æäº¤ï¼‰
  
    ```swift
    // ç”¨æˆ·åå›è½¦ -> ç„¦ç‚¹ç§»åˆ°å¯†ç 
    usernameTF.rx.controlEvent(.editingDidEndOnExit)
        .subscribe(onNext: { [weak self] in self?.passwordTF.becomeFirstResponder() })
        .disposed(by: bag)
    
    // å¯†ç å›è½¦ -> è§¦å‘ç™»å½•ï¼ˆå¸¦æœ€æ–°è¾“å…¥ï¼‰
    passwordTF.rx.controlEvent(.editingDidEndOnExit)
        .withLatestFrom(Observable.combineLatest(vm.username, vm.password))
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * ç”¨ Driver åš UI ç»‘å®šï¼ˆæ¨èï¼‰
  
    ```swift
    let canLogin = Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .asDriver(onErrorJustReturn: false)
    
    canLogin
        .drive(loginBtn.rx.isEnabled)
        .disposed(by: bag)
    
    canLogin
        .map { $0 ? 1.0 : 0.5 }
        .drive(loginBtn.rx.alpha)
        .disposed(by: bag)
    ```
  
  * å®æˆ˜æœ€å°ç»„åˆï¼ˆæŒ‰é’®ç‚¹å‡» + æœ€æ–°å€¼ + èŠ‚æµï¼‰
  
    ```swift
    let creds = Observable.combineLatest(usernameTF.rx.text.orEmpty,
                                         passwordTF.rx.text.orEmpty) { ($0, $1) }
        .share(replay: 1)
    
    loginBtn.rx.tap
        .throttle(.milliseconds(500), scheduler: MainScheduler.instance)
        .withLatestFrom(creds)
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * ç›‘å¬ç³»ç»Ÿé€šçŸ¥ï¼ˆNotificationCenter â†’ Rxï¼‰
  
    ```swift
    import RxSwift
    import RxCocoa
    
    let bag = DisposeBag()
    
    NotificationCenter.default.rx.notification(UIApplication.didBecomeActiveNotification)
        .subscribe(onNext: { _ in
            print("app å›åˆ°å‰å°")
        })
        .disposed(by: bag)
    ```
  
  * ç›‘å¬ + å– `userInfo`ï¼ˆå®‰å…¨è§£åŒ…ï¼‰
  
    ```swift
    extension Notification.Name {
        static let loginStateChanged = Notification.Name("loginStateChanged")
    }
    
    // ç›‘å¬
    NotificationCenter.default.rx.notification(.loginStateChanged)
        .compactMap { $0.userInfo?["isLogin"] as? Bool }
        .distinctUntilChanged()
        .subscribe(onNext: { isLogin in
            print("ç™»å½•æ€ï¼š\(isLogin)")
        })
        .disposed(by: bag)
    
    // å‘é€
    NotificationCenter.default.post(name: .loginStateChanged, object: nil, userInfo: ["isLogin": true])
    ```
  
  * é”®ç›˜é€šçŸ¥ï¼šæ‹¿é«˜åº¦ & åŠ¨ç”»æ—¶é•¿ï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰
  
    ```swift
    let willChange = NotificationCenter.default.rx.notification(UIResponder.keyboardWillChangeFrameNotification)
    
    let keyboardInfo = willChange
        .compactMap { note -> (height: CGFloat, duration: TimeInterval) in
            let endFrame = (note.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] as? NSValue)?.cgRectValue ?? .zero
            let duration = (note.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] as? NSNumber)?.doubleValue ?? 0.25
            return (height: endFrame.height, duration: duration)
        }
        .share(replay: 1)
    
    keyboardInfo
        .subscribe(onNext: { info in
            // è°ƒæ•´åº•éƒ¨çº¦æŸ / contentInset
            // self.bottomConstraint.constant = info.height
            // UIView.animate(withDuration: info.duration) { self.view.layoutIfNeeded() }
        })
        .disposed(by: bag)
    ```
  
  * æ­é… `Driver`ï¼ˆä¸»çº¿ç¨‹ã€æ—  errorï¼Œç”¨äºé©±åŠ¨ UIï¼‰
  
    ```swift
    let becameActiveDriver: Driver<Void> =
        NotificationCenter.default.rx.notification(UIApplication.didBecomeActiveNotification)
            .map { _ in () }
            .asDriver(onErrorDriveWith: .empty())
    
    becameActiveDriver
        .drive(onNext: { print("åˆ·æ–° UI") })
        .disposed(by: bag)
    ```
  
  * è¿‡æ»¤æŒ‡å®šå¯¹è±¡çš„é€šçŸ¥ï¼ˆ`object:`ï¼‰
  
    ```swift
    let object = someObject
    
    NotificationCenter.default.rx.notification(.someName, object: object)
        .subscribe(onNext: { _ in print("åªå“åº”è¿™ä¸ª object çš„é€šçŸ¥") })
        .disposed(by: bag)
    ```
  
  * throttle / debounceï¼ˆé€šçŸ¥é£æš´å»æŠ–ï¼‰
  
    ```swift
    NotificationCenter.default.rx.notification(.NSManagedObjectContextDidSave)
        .debounce(.milliseconds(300), scheduler: MainScheduler.instance)
        .subscribe(onNext: { _ in
            // åˆå¹¶çŸ­æ—¶é—´å†…çš„å¤šæ¬¡å˜æ›´
        })
        .disposed(by: bag)
    ```
  
  * ç”Ÿå‘½å‘¨æœŸé€šçŸ¥ï¼ˆå¸¸ç”¨æ¸…å•ï¼‰
  
    ```swift
    NotificationCenter.default.rx.notification(UIApplication.willEnterForegroundNotification)
    NotificationCenter.default.rx.notification(UIApplication.didEnterBackgroundNotification)
    NotificationCenter.default.rx.notification(UIApplication.didReceiveMemoryWarningNotification)
    ```
  
  * é€šçŸ¥æ›´é€‚åˆ**è·¨æ¨¡å—/ç³»ç»Ÿçº§å¹¿æ’­**ï¼›æ¨¡å—å†…é€šä¿¡ä¼˜å…ˆ `Relay/Subject`ã€‚
  
    > **åŒæ¨¡å—/åŒå±‚å†…**ä¼ æ’­äº‹ä»¶ï¼šç”¨ `PublishRelay` / `BehaviorRelay` æ¯”é€šçŸ¥æ›´ç±»å‹å®‰å…¨ã€å¯æµ‹è¯•ã€‚
  
    ```swift
    let evt = PublishRelay<Void>()
    evt.accept(())          // å‘é€
    evt.asSignal()          // ç»™ UI ç»‘å®š
    ```
  

#### 4.8ã€æ³¨å…¥è°ƒè¯• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* åŒæ—¶æ”¯æŒ [**Swift**](https://developer.apple.com/swift/), **Objc**& **C++ **çš„ä»£ç çƒ­é‡è½½å·¥å…·ï¼
  * [**InjectionIII**](https://github.com/johnno1962/InjectionIII)
  * [**InjectionNext**](https://github.com/johnno1962/InjectionNext)
* [**UIç•Œé¢è°ƒè¯•å·¥å…·**](#UIç•Œé¢è°ƒè¯•å·¥å…·)

### 5ã€ğŸ’¥<font id=Info.plist>ç«åŠ›å…¨å¼€é…ç½®`Info.plist`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>

    <key>UIApplicationSceneManifest</key>
    <dict>
        <key>UIApplicationSupportsMultipleScenes</key>
        <false/>
        <key>UISceneConfigurations</key>
        <dict>
            <key>UIWindowSceneSessionRoleApplication</key>
            <array>
                <dict>
                    <key>UISceneConfigurationName</key>
                    <string>Default Configuration</string>
                    <key>UISceneDelegateClassName</key>
                    <string>$(PRODUCT_MODULE_NAME).SceneDelegate</string>
                    <key>UISceneStoryboardFile</key>
                    <string>Main</string>
                </dict>
            </array>
        </dict>
    </dict>

    <key>NSAppTransportSecurity</key>
    <dict>
      <!-- ATS é…ç½®ï¼šä»…æ”¾å¼€ WebView å†…å®¹çš„ä»»æ„åŠ è½½ï¼Œå…¶ä»–ç½‘ç»œè¯·æ±‚ä»å— ATS çº¦æŸ -->
      <key>NSAllowsArbitraryLoadsInWebContent</key>
      <true/>
    </dict>

    <!-- é€‚é… iOS 16+ çš„ UI å…¼å®¹å¼€å…³ï¼Œä¸æ˜¯éšç§æƒé™ -->
    <key>UIDesignRequiresCompatibility</key>
    <true/>

    <!-- ====== ç›¸æœº / éº¦å…‹é£ / ç›¸å†Œ ====== -->

    <!-- ç›¸æœºæƒé™ï¼šç”¨äºæ‹ç…§ã€æ‰«ç ã€è§†é¢‘å½•åˆ¶ç­‰éœ€è¦è°ƒç”¨æ‘„åƒå¤´çš„åœºæ™¯ -->
    <key>NSCameraUsageDescription</key>
    <string>NSCameraUsageDescription</string>

    <!-- éº¦å…‹é£æƒé™ï¼šç”¨äºå½•éŸ³ã€è§†é¢‘é€šè¯ã€è¯­éŸ³æ¶ˆæ¯ç­‰éœ€è¦é‡‡é›†å£°éŸ³çš„åœºæ™¯ -->
    <key>NSMicrophoneUsageDescription</key>
    <string>NSMicrophoneUsageDescription</string>

    <!-- ç›¸å†Œè¯»å–æƒé™ï¼šä»ç³»ç»Ÿç›¸å†Œä¸­é€‰æ‹©ã€è¯»å–ç…§ç‰‡æˆ–è§†é¢‘ -->
    <key>NSPhotoLibraryUsageDescription</key>
    <string>NSPhotoLibraryUsageDescription</string>

    <!-- ç›¸å†Œå†™å…¥æƒé™ï¼šå°†æ‹æ‘„æˆ–ç¼–è¾‘åçš„å›¾ç‰‡/è§†é¢‘ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ -->
    <key>NSPhotoLibraryAddUsageDescription</key>
    <string>NSPhotoLibraryAddUsageDescription</string>

    <!-- ====== å®šä½ï¼ˆä½¿ç”¨æœŸé—´ / å§‹ç»ˆ / ä¸´æ—¶ç²¾ç¡®ï¼‰ ====== -->

    <!-- ä»…â€œä½¿ç”¨æœŸé—´â€å®šä½ï¼šApp åœ¨å‰å°ä½¿ç”¨æ—¶è®¿é—®ä½ç½®ä¿¡æ¯ï¼ˆå¸¸è§å¯¼èˆªã€é™„è¿‘æœåŠ¡ï¼‰ -->
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>NSLocationWhenInUseUsageDescription</string>

    <!-- å§‹ç»ˆ + ä½¿ç”¨æœŸé—´å®šä½ï¼šå‰å° + åå°éƒ½å¯è®¿é—®ä½ç½®ä¿¡æ¯ï¼ˆæŒç»­å¯¼èˆªã€åœ°ç†å›´æ ï¼‰ -->
    <key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
    <string>NSLocationAlwaysAndWhenInUseUsageDescription</string>

    <!-- æ—§ç³»ç»Ÿå…¼å®¹çš„â€œå§‹ç»ˆå®šä½â€æè¿°ï¼Œå’Œä¸Šé¢çš„é”®é…åˆä½¿ç”¨ -->
    <key>NSLocationAlwaysUsageDescription</key>
    <string>NSLocationAlwaysUsageDescription</string>

    <!-- iOS 14+ ä¸´æ—¶â€œç²¾ç¡®å®šä½â€ç”¨é€”å£°æ˜ï¼Œéœ€è¦è¯¦ç»†è¯´æ˜æ¯ä¸ªç”¨é€”åœºæ™¯ -->

    <!-- ç²¾ç¡®å¯¼èˆªï¼šæ¯”å¦‚é©¾è½¦/æ­¥è¡Œå¯¼èˆªæ—¶éœ€è¦é«˜ç²¾åº¦å®šä½ -->
    <key>NSLocationTemporaryUsageDescriptionDictionary</key>
    <dict>
        <key>NavigationPrecise</key>
        <string>NavigationPrecise</string>

        <!-- é™„è¿‘æœç´¢ï¼šæŸ¥æ‰¾å‘¨è¾¹æœåŠ¡ã€è®¾å¤‡ã€é—¨åº—ç­‰ -->
        <key>NearbySearch</key>
        <string>NearbySearch</string>

        <!-- AR é”šç‚¹ï¼šåœ¨å¢å¼ºç°å®åœºæ™¯ä¸­è¿›è¡Œç²¾ç¡®å®šä½å’Œæ”¾ç½®é”šç‚¹ -->
        <key>ARAnchors</key>
        <string>ARAnchors</string>
    </dict>

    <!-- ====== è“ç‰™ï¼ˆæ—§/æ–°ï¼‰ ====== -->

    <!-- å§‹ç»ˆè“ç‰™æƒé™ï¼šApp åœ¨å‰å°æˆ–åå°éƒ½å¯ä¸è“ç‰™è®¾å¤‡äº¤äº’ -->
    <key>NSBluetoothAlwaysUsageDescription</key>
    <string>NSBluetoothAlwaysUsageDescription</string>

    <!-- æ—§é”®ï¼šè“ç‰™å¤–è®¾æƒé™ï¼Œç”¨äºå‘ç°/è¿æ¥/é€šä¿¡é™„è¿‘çš„è“ç‰™è®¾å¤‡ -->
    <key>NSBluetoothPeripheralUsageDescription</key>
    <string>NSBluetoothPeripheralUsageDescription</string>

    <!-- ====== é€šè®¯å½• / æ—¥å† / æé†’äº‹é¡¹ ====== -->

    <!-- é€šè®¯å½•æƒé™ï¼šè¯»å–è”ç³»äººç”¨äºé€‰æ‹©è”ç³»äººã€è‡ªåŠ¨å¡«å……ç­‰ -->
    <key>NSContactsUsageDescription</key>
    <string>NSContactsUsageDescription</string>

    <!-- æ—¥å†åŸºç¡€æƒé™ï¼šè¯»å–/å†™å…¥æ—¥å†äº‹ä»¶ï¼ˆæ—§é”®ï¼Œå…¼å®¹æ€§ç”¨é€”ï¼‰ -->
    <key>NSCalendarsUsageDescription</key>
    <string>NSCalendarsUsageDescription</string>

    <!-- iOS 17+ æ—¥å†â€œå®Œå…¨è®¿é—®â€ï¼šå¯è¯»ã€å¯å†™ã€å¯ä¿®æ”¹æ‰€æœ‰æ—¥å†äº‹ä»¶ -->
    <key>NSCalendarsFullAccessUsageDescription</key>
    <string>NSCalendarsFullAccessUsageDescription</string>

    <!-- iOS 17+ æ—¥å†â€œä»…å†™å…¥â€ï¼šåªèƒ½å¾€æ—¥å†é‡Œæ·»åŠ äº‹ä»¶ï¼Œä¸èƒ½è¯»å–å·²æœ‰äº‹ä»¶ -->
    <key>NSCalendarsWriteOnlyAccessUsageDescription</key>
    <string>NSCalendarsWriteOnlyAccessUsageDescription</string>

    <!-- æé†’äº‹é¡¹åŸºç¡€æƒé™ï¼šè¯»å–/åˆ›å»ºæé†’ï¼ˆæ—§é”®ï¼Œå…¼å®¹æ€§ç”¨é€”ï¼‰ -->
    <key>NSRemindersUsageDescription</key>
    <string>NSRemindersUsageDescription</string>

    <!-- iOS 17+ æé†’äº‹é¡¹â€œå®Œå…¨è®¿é—®â€ï¼šè¯»ã€å†™ã€æ”¹æ‰€æœ‰å¾…åŠ/æé†’ -->
    <key>NSRemindersFullAccessUsageDescription</key>
    <string>NSRemindersFullAccessUsageDescription</string>

    <!-- iOS 17+ æé†’äº‹é¡¹â€œä»…å†™å…¥â€ï¼šåªèƒ½æ·»åŠ æ–°çš„å¾…åŠï¼Œä¸è¯»å–å·²æœ‰è®°å½• -->
    <key>NSRemindersWriteOnlyAccessUsageDescription</key>
    <string>NSRemindersWriteOnlyAccessUsageDescription</string>

    <!-- ====== å¥åº· / è¿åŠ¨ä¸å¥èº«ï¼ˆHealthKitï¼‰ ====== -->

    <!-- å¥åº·æ•°æ®è¯»å–æƒé™ï¼šä» HealthKit è¯»å–å¥åº·/ä½“å¾/è¿åŠ¨æ•°æ® -->
    <key>NSHealthShareUsageDescription</key>
    <string>NSHealthShareUsageDescription</string>

    <!-- å¥åº·æ•°æ®å†™å…¥æƒé™ï¼šå‘ HealthKit å†™å…¥è¿åŠ¨è®°å½•ã€å¥åº·æŒ‡æ ‡ç­‰ -->
    <key>NSHealthUpdateUsageDescription</key>
    <string>NSHealthUpdateUsageDescription</string>

    <!-- ä¸´åºŠå¥åº·æ¡£æ¡ˆè¯»å–ï¼šè®¿é—®åŒ»é™¢/è¯Šæ‰€ç­‰æ¥æºçš„ä¸´åºŠå¥åº·è®°å½• -->
    <key>NSHealthClinicalHealthRecordsShareUsageDescription</key>
    <string>NSHealthClinicalHealthRecordsShareUsageDescription</string>

    <!-- è¿åŠ¨ä¸å¥èº«æƒé™ï¼šè®¿é—®åŠ é€Ÿåº¦è®¡ã€æ­¥æ•°ç­‰è¿åŠ¨æ•°æ® -->
    <key>NSMotionUsageDescription</key>
    <string>NSMotionUsageDescription</string>

    <!-- ====== è¯­éŸ³ / Siri / Face ID ====== -->

    <!-- è¯­éŸ³è¯†åˆ«æƒé™ï¼šå°†è¯­éŸ³å®æ—¶è½¬æˆæ–‡å­—ï¼ˆéå½•éŸ³æœ¬èº«ï¼‰ -->
    <key>NSSpeechRecognitionUsageDescription</key>
    <string>NSSpeechRecognitionUsageDescription</string>

    <!-- Siri æƒé™ï¼šä½¿ç”¨ Siri æ‰§è¡Œè¯­éŸ³æŒ‡ä»¤ã€å¿«æ·æŒ‡ä»¤ -->
    <key>NSSiriUsageDescription</key>
    <string>NSSiriUsageDescription</string>

    <!-- Face ID æƒé™ï¼šç”¨é¢å®¹è¯†åˆ«è¿›è¡Œç™»å½•ã€æ”¯ä»˜æˆ–æ•æ„Ÿæ“ä½œéªŒè¯ -->
    <key>NSFaceIDUsageDescription</key>
    <string>NSFaceIDUsageDescription</string>

    <!-- ====== å®¶åº­(HomeKit) / æœ¬åœ°ç½‘ç»œ / Bonjour ====== -->

    <!-- HomeKit æƒé™ï¼šæ§åˆ¶å’Œç®¡ç†æ™ºèƒ½å®¶å±…è®¾å¤‡ï¼ˆç¯ã€é—¨é”ç­‰ï¼‰ -->
    <key>NSHomeKitUsageDescription</key>
    <string>NSHomeKitUsageDescription</string>

    <!-- æœ¬åœ°ç½‘ç»œæƒé™ï¼šåœ¨å±€åŸŸç½‘ä¸­å‘ç°å¹¶è¿æ¥å…¶å®ƒè®¾å¤‡æˆ–æœåŠ¡ -->
    <key>NSLocalNetworkUsageDescription</key>
    <string>NSLocalNetworkUsageDescription</string>

    <!-- Bonjour æœåŠ¡åˆ—è¡¨ï¼šå£°æ˜éœ€è¦å‘ç°çš„å±€åŸŸç½‘æœåŠ¡ç±»å‹ -->
    <key>NSBonjourServices</key>
    <array>
        <!-- æŒ‰éœ€æ·»åŠ ä½ çœŸå®ä½¿ç”¨çš„æœåŠ¡ç±»å‹ï¼›ä¸‹é¢æ˜¯ç¤ºä¾‹ -->
        <string>_http._tcp.</string>
        <string>_airplay._tcp.</string>
        <string>_yourservice._tcp.</string>
    </array>

    <!-- ====== NFC ====== -->

    <!-- NFC æƒé™ï¼šè¯»å– NFC æ ‡ç­¾æˆ–ä¸æ”¯æŒ NFC çš„è®¾å¤‡äº¤äº’ -->
    <key>NFCReaderUsageDescription</key>
    <string>NFCReaderUsageDescription</string>

    <!-- ====== Apple Music / åª’ä½“åº“ ====== -->

    <!-- åª’ä½“åº“æƒé™ï¼šè®¿é—®ç³»ç»ŸéŸ³ä¹åº“ï¼Œè¯»å–/æ’­æ”¾éŸ³ä¹ -->
    <key>NSAppleMusicUsageDescription</key>
    <string>NSAppleMusicUsageDescription</string>

    <!-- ====== å¹¿å‘Šè·Ÿè¸ªï¼ˆATTï¼‰ ====== -->

    <!-- App Tracking æƒé™ï¼šç”¨äºè·¨ App / ç½‘ç«™çš„å¹¿å‘Šå½’å› ä¸ä¸ªæ€§åŒ–æ¨è -->
    <key>NSUserTrackingUsageDescription</key>
    <string>NSUserTrackingUsageDescription</string>

    <!-- ====== Nearby Interactionï¼ˆU1/è¶…å®½å¸¦ï¼‰ ====== -->

    <!-- è¿‘è·ç¦»äº¤äº’æƒé™ï¼šåˆ©ç”¨ UWB/è¶…å®½å¸¦è¿›è¡Œè¶…è¿‘è·ç¦»å®šä½ä¸è®¾å¤‡ååŒ -->
    <key>NSNearbyInteractionUsageDescription</key>
    <string>NSNearbyInteractionUsageDescription</string>

    <!-- ====== TV Providerï¼ˆè§†é¢‘è®¢é˜…è´¦æˆ·ï¼‰ ====== -->

    <!-- ç”µè§†ä¾›åº”å•†è´¦æˆ·æƒé™ï¼šéªŒè¯ç”¨æˆ·è®¢é˜…ï¼Œç”¨äºæ’­æ”¾ä»˜è´¹é¢‘é“/è§†é¢‘ -->
    <key>NSVideoSubscriberAccountUsageDescription</key>
    <string>NSVideoSubscriberAccountUsageDescription</string>

    <!-- ====== å…³é”®æé†’ï¼ˆCritical Alertsï¼Œéœ€è¦ç‰¹æƒèƒ½åŠ›ï¼‰ ====== -->

    <!-- å…³é”®æé†’æƒé™ï¼šåœ¨é™éŸ³/å‹¿æ‰°æ¨¡å¼ä¸‹ä»å¯å‘å‡ºé«˜ä¼˜å…ˆçº§é€šçŸ¥ -->
    <key>NSCriticalAlertsUsageDescription</key>
    <string>NSCriticalAlertsUsageDescription</string>

    <!-- ====== ä¸“æ³¨çŠ¶æ€å…±äº«ï¼ˆFocus Statusï¼‰ ====== -->

    <!-- è¯»å–ä¸“æ³¨çŠ¶æ€ï¼šæ ¹æ®å½“å‰ä¸“æ³¨æ¨¡å¼è°ƒæ•´é€šçŸ¥/æ¶ˆæ¯çš„å‘é€æ—¶æœº -->
    <key>NSFocusStatusUsageDescription</key>
    <string>NSFocusStatusUsageDescription</string>

    <!-- ====== æš´éœ²é€šçŸ¥ï¼ˆExposure Notificationï¼Œéœ€è¦ç‰¹æƒèƒ½åŠ›ï¼‰ ====== -->

    <!-- æš´éœ²é€šçŸ¥æƒé™ï¼šç”¨äºç–«æƒ…ç­‰åœºæ™¯ä¸‹çš„æ¥è§¦é£é™©æé†’ï¼ˆéœ€å®˜æ–¹æˆæƒï¼‰ -->
    <key>NSExposureNotificationUsageDescription</key>
    <string>NSExposureNotificationUsageDescription</string>

</dict>
</plist>
```

```swift
/* 
  InfoPlist.strings (English)
  JobsSwiftBaseConfigDemo

  Created by Jobs on 11/17/25.
  
*/

/* ====== Camera / Microphone / Photo Library ====== */
"NSCameraUsageDescription" = "This app requires access to the camera to take photos and record videos.";
"NSMicrophoneUsageDescription" = "This app requires access to the microphone to record audio and videos.";
"NSPhotoLibraryUsageDescription" = "This app requires access to your photo library to select and read your photos and videos.";
"NSPhotoLibraryAddUsageDescription" = "This app requires permission to save photos and videos to your photo library.";

/* ====== Location (When In Use / Always / Temporary Precise) ====== */
"NSLocationWhenInUseUsageDescription" = "To provide location-based services, this app needs access to your location while you are using it.";
"NSLocationAlwaysAndWhenInUseUsageDescription" = "To support continuous location features (navigation, geofencing, etc.), this app needs access to your location in the foreground and background.";
"NSLocationAlwaysUsageDescription" = "This app needs access to your location in the foreground and background to provide full location services.";

/* iOS 14+ temporary precise location reasons */
"NavigationPrecise" = "Used for precise navigation and route planning.";
"NearbySearch" = "Used to find nearby services and devices.";
"ARAnchors" = "Used for precise positioning and anchors in augmented reality experiences.";

/* ====== Bluetooth ====== */
"NSBluetoothAlwaysUsageDescription" = "This app needs Bluetooth access to connect to and manage nearby devices.";
"NSBluetoothPeripheralUsageDescription" = "This app needs Bluetooth access to discover, connect to, and communicate with nearby devices.";

/* ====== Contacts / Calendars / Reminders ====== */
"NSContactsUsageDescription" = "This app needs access to your contacts to select people or autofill their information.";

"NSCalendarsUsageDescription" = "This app needs access to your calendars to read and write your events.";
"NSCalendarsFullAccessUsageDescription" = "This app needs full access to your calendars to read, create, and edit your events.";
"NSCalendarsWriteOnlyAccessUsageDescription" = "This app needs permission to add events to your calendars (write-only, without reading existing events).";

"NSRemindersUsageDescription" = "This app needs access to your reminders to read and create tasks.";
"NSRemindersFullAccessUsageDescription" = "This app needs full access to your reminders to read, create, and edit tasks.";
"NSRemindersWriteOnlyAccessUsageDescription" = "This app needs permission to add tasks to your reminders (write-only, without reading existing tasks).";

/* ====== Health / Motion & Fitness ====== */
"NSHealthShareUsageDescription" = "This app needs to read your health data to provide health-related features and analysis.";
"NSHealthUpdateUsageDescription" = "This app needs to write health data to log your activities and vital signs.";
"NSHealthClinicalHealthRecordsShareUsageDescription" = "This app needs to read your clinical health records to provide related services and suggestions.";
"NSMotionUsageDescription" = "This app needs access to motion and fitness data (accelerometer, step count, etc.) to track and analyze your activity.";

/* ====== Speech / Siri / Face ID ====== */
"NSSpeechRecognitionUsageDescription" = "This app needs speech recognition to convert your voice into text.";
"NSSiriUsageDescription" = "This app uses Siri to perform voice commands and shortcuts.";
"NSFaceIDUsageDescription" = "This app uses Face ID to quickly and securely verify your identity.";

/* ====== HomeKit / Local Network / Bonjour ====== */
"NSHomeKitUsageDescription" = "This app needs access to your home data to control and manage your HomeKit devices.";
"NSLocalNetworkUsageDescription" = "This app needs access to your local network to discover and connect to devices or services on your LAN.";

/* ====== NFC ====== */
"NFCReaderUsageDescription" = "This app needs to use NFC to read and interact with supported nearby tags and devices.";

/* ====== Apple Music / Media Library ====== */
"NSAppleMusicUsageDescription" = "This app needs access to your media library to read and play your music.";

/* ====== App Tracking Transparency (ATT) ====== */
"NSUserTrackingUsageDescription" = "To provide more personalized content and ads, this app requests permission to track your activity; your privacy will not be misused.";

/* ====== Nearby Interaction ====== */
"NSNearbyInteractionUsageDescription" = "This app needs Nearby Interaction to enable ultra-short-range positioning and device interactions.";

/* ====== TV Provider (Video Subscriber Account) ====== */
"NSVideoSubscriberAccountUsageDescription" = "This app needs access to your TV provider account to verify your subscription and play content.";

/* ====== Critical Alerts ====== */
"NSCriticalAlertsUsageDescription" = "This app needs to send critical alerts so important events can be notified even in Silent or Do Not Disturb mode.";

/* ====== Focus Status ====== */
"NSFocusStatusUsageDescription" = "This app needs to read your Focus status so it can send notifications and messages at appropriate times.";

/* ====== Exposure Notification ====== */
"NSExposureNotificationUsageDescription" = "This app needs Exposure Notifications to alert you to possible contact risks (enabled only where authorized).";
```

```swift
/* 
  InfoPlist.strings (Chinese, Simplified)
  JobsSwiftBaseConfigDemo

  Created by Jobs on 11/17/25.
  
*/

/* ====== ç›¸æœº / éº¦å…‹é£ / ç›¸å†Œ ====== */
"NSCameraUsageDescription" = "éœ€è¦è®¿é—®ç›¸æœºç”¨äºæ‹æ‘„ç…§ç‰‡æˆ–è§†é¢‘ã€‚";
"NSMicrophoneUsageDescription" = "éœ€è¦è®¿é—®éº¦å…‹é£ç”¨äºå½•éŸ³æˆ–è§†é¢‘å½•åˆ¶ã€‚";
"NSPhotoLibraryUsageDescription" = "éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å’Œè¯»å–æ‚¨çš„ç…§ç‰‡ä¸è§†é¢‘ã€‚";
"NSPhotoLibraryAddUsageDescription" = "éœ€è¦å†™å…¥ç›¸å†Œä»¥ä¿å­˜æ‚¨æ‹æ‘„æˆ–ç¼–è¾‘çš„å›¾ç‰‡/è§†é¢‘ã€‚";

/* ====== å®šä½ï¼ˆä½¿ç”¨æœŸé—´ / å§‹ç»ˆ / ä¸´æ—¶ç²¾ç¡®ï¼‰ ====== */
"NSLocationWhenInUseUsageDescription" = "ä¸ºæä¾›ä¸ä½ç½®ç›¸å…³çš„æœåŠ¡ï¼Œéœ€è¦åœ¨æ‚¨ä½¿ç”¨ App æœŸé—´è®¿é—®ä½ç½®ä¿¡æ¯ã€‚";
"NSLocationAlwaysAndWhenInUseUsageDescription" = "ä¸ºå®ç°æŒç»­å®šä½ï¼ˆå¯¼èˆª/åœ°ç†å›´æ ç­‰ï¼‰ï¼Œéœ€è¦åœ¨å‰å°ä¸åå°è®¿é—®ä½ç½®ä¿¡æ¯ã€‚";
"NSLocationAlwaysUsageDescription" = "éœ€è¦åœ¨å‰å°ä¸åå°è®¿é—®ä½ç½®ä¿¡æ¯ä»¥æä¾›å®Œæ•´å®šä½æœåŠ¡ã€‚";

/* iOS 14+ ä¸´æ—¶â€œç²¾ç¡®å®šä½â€ç”¨é€”å£°æ˜ */
"NavigationPrecise" = "ç”¨äºç²¾ç¡®å¯¼èˆªä¸è·¯çº¿è§„åˆ’ã€‚";
"NearbySearch" = "ç”¨äºæŸ¥æ‰¾é™„è¿‘çš„æœåŠ¡ä¸è®¾å¤‡ã€‚";
"ARAnchors" = "ç”¨äºå¢å¼ºç°å®åœºæ™¯çš„ç²¾ç¡®å®šä½ä¸é”šç‚¹ã€‚";

/* ====== è“ç‰™ï¼ˆæ—§/æ–°ï¼‰ ====== */
"NSBluetoothAlwaysUsageDescription" = "éœ€è¦ä½¿ç”¨è“ç‰™ä»¥è¿æ¥æˆ–ç®¡ç†é™„è¿‘çš„è®¾å¤‡ã€‚";
"NSBluetoothPeripheralUsageDescription" = "éœ€è¦ä½¿ç”¨è“ç‰™ä»¥å‘ç°ã€è¿æ¥æˆ–ä¸å‘¨è¾¹è®¾å¤‡é€šä¿¡ã€‚";

/* ====== é€šè®¯å½• / æ—¥å† / æé†’äº‹é¡¹ ====== */
"NSContactsUsageDescription" = "éœ€è¦è®¿é—®é€šè®¯å½•ä»¥é€‰æ‹©è”ç³»äººæˆ–è‡ªåŠ¨å¡«å……ä¿¡æ¯ã€‚";

"NSCalendarsUsageDescription" = "éœ€è¦è®¿é—®æ—¥å†ä»¥è¯»å–æˆ–å†™å…¥æ‚¨çš„æ—¥ç¨‹ã€‚";
"NSCalendarsFullAccessUsageDescription" = "éœ€è¦å®Œæ•´è®¿é—®æ‚¨çš„æ—¥å†ä»¥è¯»å–ã€åˆ›å»ºä¸ä¿®æ”¹æ—¥ç¨‹ã€‚";
"NSCalendarsWriteOnlyAccessUsageDescription" = "éœ€è¦å‘æ‚¨çš„æ—¥å†æ·»åŠ äº‹ä»¶ï¼ˆä»…å†™å…¥ï¼Œä¸è¯»å–å·²æœ‰äº‹ä»¶ï¼‰ã€‚";

"NSRemindersUsageDescription" = "éœ€è¦è®¿é—®æé†’äº‹é¡¹ä»¥è¯»å–æˆ–åˆ›å»ºå¾…åŠã€‚";
"NSRemindersFullAccessUsageDescription" = "éœ€è¦å®Œæ•´è®¿é—®æé†’äº‹é¡¹ä»¥è¯»å–ã€åˆ›å»ºä¸ä¿®æ”¹å¾…åŠã€‚";
"NSRemindersWriteOnlyAccessUsageDescription" = "éœ€è¦å‘æé†’äº‹é¡¹æ·»åŠ å¾…åŠï¼ˆä»…å†™å…¥ï¼Œä¸è¯»å–å·²æœ‰å¾…åŠï¼‰ã€‚";

/* ====== å¥åº· / è¿åŠ¨ä¸å¥èº« ====== */
"NSHealthShareUsageDescription" = "éœ€è¦è¯»å–å¥åº·æ•°æ®ä»¥æä¾›å¥åº·ç›¸å…³åŠŸèƒ½ä¸åˆ†æã€‚";
"NSHealthUpdateUsageDescription" = "éœ€è¦å†™å…¥å¥åº·æ•°æ®ä»¥è®°å½•æ‚¨çš„è¿åŠ¨æˆ–ä½“å¾ã€‚";
"NSHealthClinicalHealthRecordsShareUsageDescription" = "éœ€è¦è¯»å–æ‚¨çš„ä¸´åºŠå¥åº·è®°å½•ä»¥æä¾›ç›¸å…³æœåŠ¡ä¸å»ºè®®ã€‚";
"NSMotionUsageDescription" = "éœ€è¦è®¿é—®è¿åŠ¨ä¸å¥èº«æ•°æ®ï¼ˆåŠ é€Ÿåº¦è®¡/æ­¥æ•°ï¼‰ä»¥ç»Ÿè®¡ä¸åˆ†ææ´»åŠ¨ã€‚";

/* ====== è¯­éŸ³ / Siri / Face ID ====== */
"NSSpeechRecognitionUsageDescription" = "éœ€è¦è¿›è¡Œè¯­éŸ³è¯†åˆ«ä»¥å°†æ‚¨çš„è¯­éŸ³è½¬æ¢ä¸ºæ–‡æœ¬ã€‚";
"NSSiriUsageDescription" = "éœ€è¦ä½¿ç”¨ Siri ä»¥æ‰§è¡Œè¯­éŸ³æŒ‡ä»¤æˆ–å¿«æ·æ“ä½œã€‚";
"NSFaceIDUsageDescription" = "éœ€è¦ä½¿ç”¨ Face ID ä»¥å¿«é€Ÿå®Œæˆå®‰å…¨éªŒè¯ã€‚";

/* ====== å®¶åº­(HomeKit) / æœ¬åœ°ç½‘ç»œ / Bonjour ====== */
"NSHomeKitUsageDescription" = "éœ€è¦è®¿é—®å®¶åº­æ•°æ®ä»¥æ§åˆ¶æˆ–ç®¡ç†æ‚¨çš„å®¶åº­è®¾å¤‡ã€‚";
"NSLocalNetworkUsageDescription" = "éœ€è¦è®¿é—®æœ¬åœ°ç½‘ç»œä»¥å‘ç°å’Œè¿æ¥å±€åŸŸç½‘ä¸­çš„è®¾å¤‡æˆ–æœåŠ¡ã€‚";

/* ====== NFC ====== */
"NFCReaderUsageDescription" = "éœ€è¦ä½¿ç”¨ NFC ä»¥è¯»å–æˆ–äº¤äº’æ”¯æŒçš„è¿‘åœºæ ‡ç­¾/è®¾å¤‡ã€‚";

/* ====== Apple Music / åª’ä½“åº“ ====== */
"NSAppleMusicUsageDescription" = "éœ€è¦è®¿é—®æ‚¨çš„åª’ä½“åº“ä»¥è¯»å–æˆ–æ’­æ”¾éŸ³ä¹ã€‚";

/* ====== å¹¿å‘Šè·Ÿè¸ªï¼ˆATTï¼‰ ====== */
"NSUserTrackingUsageDescription" = "ä¸ºæä¾›æ›´ä¸ªæ€§åŒ–çš„å†…å®¹ä¸å¹¿å‘Šä½“éªŒï¼Œéœ€è¦è¯·æ±‚è·Ÿè¸ªæƒé™ï¼›æˆ‘ä»¬ä¸ä¼šæ»¥ç”¨æ‚¨çš„éšç§ã€‚";

/* ====== Nearby Interactionï¼ˆU1/è¶…å®½å¸¦ï¼‰ ====== */
"NSNearbyInteractionUsageDescription" = "éœ€è¦ä½¿ç”¨è¿‘è·ç¦»äº¤äº’ä»¥å®ç°è¶…è¿‘è·å®šä½ä¸è®¾å¤‡äº¤äº’ã€‚";

/* ====== TV Providerï¼ˆè§†é¢‘è®¢é˜…è´¦æˆ·ï¼‰ ====== */
"NSVideoSubscriberAccountUsageDescription" = "éœ€è¦è®¿é—®æ‚¨çš„ç”µè§†ä¾›åº”å•†è´¦æˆ·ä»¥éªŒè¯è®¢é˜…å¹¶æ’­æ”¾å†…å®¹ã€‚";

/* ====== å…³é”®æé†’ï¼ˆCritical Alertsï¼‰ ====== */
"NSCriticalAlertsUsageDescription" = "éœ€è¦å‘é€å…³é”®æé†’ä»¥åœ¨é™éŸ³æˆ–å‹¿æ‰°æ¨¡å¼ä¸‹ä¹Ÿèƒ½é€šçŸ¥é‡è¦äº‹ä»¶ã€‚";

/* ====== ä¸“æ³¨çŠ¶æ€å…±äº«ï¼ˆFocus Statusï¼‰ ====== */
"NSFocusStatusUsageDescription" = "éœ€è¦è¯»å–æ‚¨çš„ä¸“æ³¨çŠ¶æ€ä»¥åœ¨åˆé€‚çš„æ—¶æœºå‘é€é€šçŸ¥æˆ–æ¶ˆæ¯ã€‚";

/* ====== æš´éœ²é€šçŸ¥ï¼ˆExposure Notificationï¼‰ ====== */
"NSExposureNotificationUsageDescription" = "éœ€è¦ä½¿ç”¨æš´éœ²é€šçŸ¥ä»¥æé†’å¯èƒ½çš„æ¥è§¦é£é™©ï¼ˆä»…åœ¨è·å¾—æˆæƒçš„åœ°åŒºä¸ç”¨é€”ä¸‹å¯ç”¨ï¼‰ã€‚";
```

### 6ã€APPå <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å¿«é€Ÿè‡ªæ£€
>
> ```swift
> let displayName =
>     Bundle.main.object(forInfoDictionaryKey: "CFBundleDisplayName")
>     ?? Bundle.main.object(forInfoDictionaryKey: "CFBundleName")
> print("DisplayName =", displayName ?? "nil")
> ```

#### 6.1ã€**`CFBundleName`**  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å†…éƒ¨åŒ…å/å·¥ç¨‹äº§ç‰©åï¼Œç”¨æˆ·é€šå¸¸çœ‹ä¸åˆ°ï¼›ç¼ºçœæ—¶å¯èƒ½è¢«ç”¨æ¥å…œåº•æ˜¾ç¤ºã€‚

```xml
<key>CFBundleName</key>
<string>$(PRODUCT_NAME)</string>
```

![image-20251101102516019](./assets/image-20251101102516019.png)

#### 6.2ã€æ¡Œé¢å  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å•è¯­è¨€æ˜¾ç¤ºå

  ```xml
  <!--Info.plist-->
  <key>CFBundleDisplayName</key>
  <string>ä½ çš„åå­—</string>
  ```

* å¤šè¯­è¨€æ˜¾ç¤ºåï¼šåœ¨å„è¯­è¨€çš„ **`InfoPlist.strings`** é‡Œå†™

  ```
  "CFBundleDisplayName" = "ä¸­æ–‡åæˆ–è‹±æ–‡å";
  ```

### 7ã€åˆ©ç”¨`*.xcconfig`é…ç½®Xcodeå·¥ç¨‹é¡¹ç›® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 7.1ã€æ–°å»ºé…ç½®æ–‡ä»¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

<table style="width:100%; table-layout:fixed;">
  <tr>
    <td><img src="./assets/image-20251101105448424.png" alt="image-20251101105448424" style="width:100%; height:auto;"></td>
    <td><img src="./assets/image-20251101105508441.png" alt="image-20251101105508441" style="width:100%; height:auto;"></td>
  </tr>
</table>

#### 7.2ã€è‡ªåŠ¨è¯†åˆ«å…³è” <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

![image-20251101105957398](./assets/image-20251101105957398.png)

#### 7.3ã€`*.xcconfig`é‡Œé¢çš„å†…å®¹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
//
//  Config.xcconfig
//  JobsSwiftBaseConfigDemo
//
//  Created by Mac on 11/1/25.
//

// Configuration settings file format documentation can be found at:
// https://developer.apple.com/documentation/xcode/adding-a-build-configuration-file-to-your-project

PRODUCT_NAME = SwiftDemo
APP_DISPLAY_NAME = SwiftDemo
INFOPLIST_KEY_CFBundleDisplayName = $(APP_DISPLAY_NAME)
INFOPLIST_KEY_CFBundleName = $(PRODUCT_NAME)
```

### 8ã€åº”ç”¨ç¨‹åºå›¾ç‰‡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 8.1ã€iOS <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **@3x çš„å¼•å…¥ç‚¹æ˜¯ iPhone 6 Plusï¼ˆiOS 8ï¼‰**ã€‚
>  6/7/8 çš„ **é Plus** æœºå‹å§‹ç»ˆæ˜¯ **@2x**ï¼›6/7/8 **Plus** æ˜¯ **@3x**ï¼ˆè€Œä¸”æ¸²æŸ“ 1242Ã—2208 åå†ä¸‹é‡‡æ ·åˆ° 1080Ã—1920 æ˜¾ç¤ºï¼Œè¿™æ˜¯å½“å¹´çš„ downsampling ç‰¹æ€§ï¼‰ã€‚
>
> 2ï¸âƒ£ **åæ¥å¤§é‡æœºå‹æ˜¯ @3x**ï¼šiPhone Xã€XS/XS Maxã€11 Pro/Pro Maxã€12/12 mini/12 Pro/Pro Maxã€13/13 mini/13 Pro/Pro Maxã€14/14 Plus/14 Pro/Pro Maxã€15/15 Plus/15 Pro/Pro Maxï¼ˆä»¥åŠåç»­å¤§å¤šæ•°ï¼‰ã€‚
>  **ä»æ˜¯ @2x çš„å…¸å‹**ï¼šiPhone XRã€iPhone 11ã€å„ä»£ iPhone SEã€‚
>
> 3ï¸âƒ£ **iPad åˆ°ç°åœ¨éƒ½æ²¡æœ‰ @3x**ï¼Œéƒ½æ˜¯ **@2x**ï¼ˆå« iPad Proï¼‰ã€‚

* å¯åŠ¨å›¾
  * å†å²æ ‡å‡†
    * **iPhone 3GS**ï¼š320Ã—480 â†’ `Default~iphone.png`
    * **iPhone 4/4S**ï¼ˆRetinaï¼‰ï¼š640Ã—960 â†’ `Default@2x~iphone.png`
    * **iPhone 5/5s/SE(1st)**ï¼š640Ã—1136 â†’ `Default-568h@2x~iphone.png`
    * **iPhone 6/7/8**ï¼š750Ã—1334 â†’ `Default-667h@2x.png`ï¼ˆæˆ– LaunchImage æ§½ä½ `375w-667h@2x`ï¼‰
    * **iPhone 6/7/8 Plus**ï¼š1242Ã—2208ï¼ˆç³»ç»Ÿç¼©æ”¾åˆ° 1080Ã—1920 æ˜¾ç¤ºï¼‰â†’ `Default-736h@3x.png` / æ§½ä½ `414w-736h@3x`
    * **iPadï¼ˆé Retinaï¼‰**ï¼š768Ã—1024ï¼ˆç«–ï¼‰/ 1024Ã—768ï¼ˆæ¨ªï¼‰ã€‚**iPad Retina**ï¼š1536Ã—2048ï¼ˆç«–ï¼‰/ 2048Ã—1536ï¼ˆæ¨ªï¼‰
    * **iPhone X / XS**ï¼š1125Ã—2436ï¼ˆç«–ï¼‰ç­‰åˆ˜æµ·æœºå‹åœ¨é™æ€å›¾æ—¶ä»£ä¹Ÿæœ‰äººé…ï¼Œä½†å®˜æ–¹å½“æ—¶å·²æ›´**é¼“åŠ±ç”¨ Launch Storyboard é€‚é…å®‰å…¨åŒº**ã€‚
  * ğŸ‘‰ å½“å‰ï¼Œè‹¹æœå·²å½»åº•åºŸå¼ƒé™æ€ **LaunchImage**ï¼Œä¸Šæ¶App Storeå¤šå°ºå¯¸ä½å›¾ä¼šè¢«æ‹’ã€‚å¿…é¡»ç”¨ **LaunchScreen.storyboard** è‡ªé€‚åº”å¸ƒå±€ï¼ˆAuto Layoutï¼Safe Areaï¼çŸ¢é‡æˆ–ç­‰æ¯”çº¦æŸï¼‰ã€‚<font color=red>**å¦‚æœéè¦æ”¾å“ç‰Œå›¾ï¼Œç”¨çº¦æŸè®©å®ƒè‡ªé€‚åº” @2x/@3xï¼Œè€Œä¸æ˜¯æäº¤ä¸€å †å›ºå®šåƒç´ å›¾**</font>
* åº”ç”¨ç¨‹åºå›¾æ ‡
  * App Storeï¼ˆè¥é”€å›¾æ ‡ï¼‰ï¼š**1024Ã—1024 px**ï¼Œ**ä¸å…è®¸é€æ˜**ï¼ˆæ—  alphaï¼‰
  * åœ¨è®¾å¤‡ä¸Šçš„å¿…éœ€å°ºå¯¸ï¼ˆåƒç´ ï¼‰
    * iPhone ä¸»å±ï¼š**180Ã—180**ï¼ˆ@3xï¼‰ï¼Œ**120Ã—120**ï¼ˆ@2xï¼‰
    * iPad ä¸»å±ï¼š**167Ã—167**ï¼ˆiPad Proï¼‰ï¼Œ**152Ã—152**ï¼ˆiPadï¼‰
    * Spotlightï¼š**120Ã—120**ï¼ˆiPhone @3xï¼‰ã€**80Ã—80**ï¼ˆ@2xï¼Œå« iPadï¼‰
    * è®¾ç½®ï¼ˆSettingsï¼‰ï¼š**87Ã—87**ï¼ˆ@3x iPhoneï¼‰ã€**58Ã—58**ï¼ˆ@2xï¼Œå« iPadï¼‰
    * é€šçŸ¥ï¼ˆNotificationsï¼‰ï¼š**60Ã—60**ï¼ˆ@3x iPhoneï¼‰ã€**40Ã—40**ï¼ˆ@2xï¼Œå« iPadï¼‰

#### 8.2ã€Android <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ldpiï¼šï¼ˆ@0.75xï¼‰

* å¯åŠ¨å›¾
  * å“ç‰Œæ¨ªå¹…ï¼š**200Ã—80 dp** â†’
    * mdpiï¼š200Ã—80 ï¼ˆ@1xï¼‰
    * hdpiï¼š300Ã—120ï¼ˆ@1.5xï¼‰
    * xhdpiï¼š400Ã—160ï¼ˆ@2xï¼‰
    * xxhdpiï¼š600Ã—240ï¼ˆ@3xï¼‰
    * xxxhdpiï¼š800Ã—320ï¼ˆ@4xï¼‰
* åº”ç”¨ç¨‹åºå›¾æ ‡
  * å¸¦èƒŒæ™¯çš„åº”ç”¨å›¾æ ‡ï¼š**240Ã—240 dp**ï¼ˆå†…å®¹éœ€è£…è¿› **160 dp** ç›´å¾„åœ†å†…ï¼‰
    * mdpiï¼š240ï¼›360ï¼›480ï¼›720ï¼›960 px
  * æ— èƒŒæ™¯çš„åº”ç”¨å›¾æ ‡ï¼š**288Ã—288 dp**ï¼ˆå†…å®¹éœ€è£…è¿› **192 dp** åœ†å†…ï¼‰
    * mdpiï¼š288ï¼›432ï¼›576ï¼›864ï¼›1152 px
  * **è‡ªé€‚åº”å›¾æ ‡ï¼ˆAdaptive Iconï¼ŒAPI 26+ï¼‰**ï¼šå‰æ™¯å±‚ + èƒŒæ™¯å±‚ **å„ 108Ã—108 dp** ç”»å¸ƒï¼›**å‰æ™¯å¯è§†å®‰å…¨åŒºå»ºè®® â‰¤66Ã—66 dp**ï¼Œå››å‘¨ **18 dp** ä¾›è’™ç‰ˆ/åŠ¨æ•ˆè£åˆ‡ã€‚å¸¸è§åƒç´ å¯¼å‡ºï¼š
    * mdpiï¼š108 px
    * hdpiï¼š162 px
    * xhdpiï¼š216 px
    * xxhdpiï¼š324 px
    * xxxhdpiï¼š432 px
  * **æ—§è®¾å¤‡ï¼ˆLegacy Launcher å›¾æ ‡ï¼‰**ï¼ˆå¦‚ä»éœ€å…¼å®¹ï¼‰ï¼š48ã€72ã€96ã€144ã€192 pxï¼ˆmdpiâ€¦xxxhdpiï¼‰
  * **Google Play ä¸Šæ¶å›¾æ ‡ï¼ˆå•†åº—ç”¨ï¼‰**ï¼š**512Ã—512 px, 32-bit PNG, sRGBï¼Œâ‰¤1MB**ï¼ˆPlay ä¼šç»Ÿä¸€è’™ç‰ˆ/æŠ•å½±ï¼‰ã€‚è¿™ä¸å¯åŠ¨å™¨å›¾æ ‡ä¸åŒï¼Œå•ç‹¬ä¸Šä¼ ã€‚

### 9ã€ğŸ“¦ [**Swift**](https://developer.apple.com/swift/).<font color=red>Package</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ£€æŸ¥ç‰ˆæœ¬

  ```shell
  swift --version
  ```

  > ```shell
  > swift-driver version: 1.127.14.1 Apple Swift version 6.2.1 (swiftlang-6.2.1.4.8 clang-1700.4.4.1)
  > Target: arm64-apple-macosx26.0
  > ```

* ä¾æ®ç³»ç»Ÿæ¨¡ç‰ˆï¼Œæ‰‹åŠ¨åˆ›å»º`swift package`

  ```shell
  swift package init --type macro --name MyMacros
  ```

* æ„å»ºï¼ˆæˆåŠŸåæ–¹å¯é€šè¿‡Xcodeæ·»åŠ è¿› [**Swift**](https://developer.apple.com/swift/)é¡¹ç›®ä¸­ï¼‰

  ```
  swift build
  ```

  > ```shell
  > âœ  MyMacrosClean swift build                             
  > [1/1] Planning build
  > Building for debugging...
  > [17/17] Applying MyMacrosClient
  > Build complete! (2.56s)
  > ```


* ç³»ç»ŸåŒ…å¯ä»¥ç”¨Gitè¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œæœ€åå†æ‰‹åŠ¨å¼•å…¥å·¥ç¨‹ã€‚ä¾‹å¦‚ï¼š[**swift-syntax**](https://github.com/swiftlang/swift-syntax)

* é€šè¿‡Xcodeæ·»åŠ è¿› [**Swift**](https://developer.apple.com/swift/)é¡¹ç›®ä¸­ğŸ‘‡

  <table style="width:100%; table-layout:fixed;">
    <tr>
      <td><img src="./assets/image-20251111112926618.png" style="width:100%; height:auto;"></td>
      <td><img src="./assets/image-20251111113104109.png" style="width:100%; height:auto;"></td>
    </tr>
    <tr>
      <td><img src="./assets/image-20251111113213346.png" style="width:100%; height:auto;"></td>
      <td><img src="./assets/image-20251111113627022.png" style="width:100%; height:auto;"></td>
    </tr>
  </table>
  
* åˆ é™¤ï¼ˆæ¶‰åŠåˆ°3å¤„ï¼‰

  * `Xcode` ğŸ‘‰ `File` ğŸ‘‰ `Add Package Dependencies`

    ![image-20251114135259050](./assets/image-20251114135259050.png)

  * å·¥ç¨‹`x.xcodeproj `ğŸ‘‰ `PROJECT` ğŸ‘‰ `Package Dependencies`

    ![image-20251114135317423](./assets/image-20251114135317423.png)

  * å·¥ç¨‹`x.xcodeproj `ğŸ‘‰ `TARGETS` ğŸ‘‰ `General `ğŸ‘‰ `Frameworks,Libraries,and Embedded Content`

    ![image-20251114135325330](./assets/image-20251114135325330.png)

### 10ã€å…¶ä»– <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ğŸ‘‰ [**Swift**](https://developer.apple.com/swift/) çš„<u>API å±•æœ›ï¼ˆæå‰å£°æ˜æœªæ¥èƒ½åŠ›ï¼‰</u>è¿™ç§æœºåˆ¶ï¼Œ**åœ¨Objcä¸–ç•Œå‡ ä¹ä¸å­˜åœ¨**

  ```
  @available(iOS 26.0, *)
  public static var presentationIntent: UIWritingToolsResultOptions { get }
  ```

  > 1ï¸âƒ£ `.presentationIntent` æ˜¯ Apple æœªæ¥ï¼ˆiOS 26.0ï¼‰æ‰å‡†å¤‡å¼€æ”¾çš„èƒ½åŠ›ï¼›
  >
  > 2ï¸âƒ£` .list`ã€`.table` å¯èƒ½ä¼šåœ¨ **18.x æˆ– 19.x** çš„ç³»ç»Ÿä¸­é€æ­¥å¯ç”¨ï¼›
  >
  > 3ï¸âƒ£ å½“å‰ 18.0 SDK è™½æœ‰å£°æ˜ï¼Œä½†å®ç°æœªæ¿€æ´»ã€‚

* ä¸ªåˆ«åœ°åŒºï¼ˆæ¯”å¦‚ï¼šæŸ¬åŸ”å¯¨ï¼‰ï¼Œéœ€è¦å°†æµè§ˆå™¨è¯­è¨€æ”¹ä¸ºè‹±æ–‡çŠ¶æ€ï¼Œæ–¹å¯è¿›å…¥[**è‹¹æœå¼€å‘è€…ç½‘ç«™**](https://developer.apple.com/)

* æ‰“å¼€è‹¹æœçš„[<font color=red>**åé¦ˆåŠ©ç†**</font>](applefeedback://)

  > ```url
  > feedbackassistant://
  > ```

* <font color=red>**C**</font>ommand <font color=red>**L**</font>ine <font color=red>**T**</font>ools <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>
  
  * å®‰è£…
  
    * ï¼ˆé€šè¿‡ç»ˆç«¯ï¼‰ä¸‹è½½å®‰è£…`Command Line Tools`
  
      ```
      xcode-select --install
      ```
  
    * é€šè¿‡ Xcode å®‰è£…
  
      * æ‰“å¼€ Xcode
      * åœ¨èœå•æ é€‰æ‹© **Xcode > Settings > Locations**
      * åœ¨ <font color=red>**C**</font>ommand <font color=red>**L**</font>ine <font color=red>**T**</font>ools ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©å¯¹åº”çš„ Xcode ç‰ˆæœ¬
  
  * å¸è½½
  
    ```shell
    sudo rm -rf /Library/Developer/CommandLineTools
    xcode-select --install
    ```
  
  * åˆ‡æ¢
  
    ```shell
    sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
    ```
  
  * éªŒè¯å‘½ä»¤
  
    ```shell
    âœ  ~ xcode-select -p
    /Applications/Xcode.app/Contents/Developer
    ```
  
  * æŸ¥çœ‹<font color=red>**C**</font>ommand <font color=red>**L**</font>ine <font color=red>**T**</font>oolsç‰ˆæœ¬
  
    ```shell
    âœ  ~ pkgutil --pkg-info=com.apple.pkg.CLTools_Executables
    package-id: com.apple.pkg.CLTools_Executables
    version: 26.0.0.0.1.1757719676
    volume: /
    location: /
    install-time: 1758341956
    ```
  
* **ObjC**å’Œ[**Swift**](https://developer.apple.com/swift/)æ··ç¼–ä»¥åï¼ŒğŸ“¦æ‰“åŒ…çš„ä½“ç§¯ä¼šå˜å¤§
  
  * [**Swift**](https://developer.apple.com/swift/) æ ‡å‡†åº“è¦éš App æ‰“åŒ…ï¼šiOS ç³»ç»Ÿé‡Œä¸å†…ç½® [**Swift**](https://developer.apple.com/swift/) æ ‡å‡†åº“ï¼ˆè‡³å°‘ä¸èƒ½ä¾èµ–å®ƒä¸€å®šå­˜åœ¨ï¼‰ï¼Œåªè¦é¡¹ç›®é‡Œç”¨äº† [**Swift**](https://developer.apple.com/swift/)ï¼Œå°±å¾—æŠŠ `libswift*.dylib` ä¸€èµ·å¸¦ä¸Šã€‚**ä½“æ„Ÿå¢é‡ï¼š~2â€“7 MB/æ¶æ„ï¼ˆå‹ç¼©åæ›´å°ï¼‰**ï¼Œå–å†³äºç”¨åˆ°çš„æ¨¡å—æ•°é‡
  * æ··ç¼–æœ¬èº«ä¸ä¼šé‡å¤æ‰“åŒ… **ObjC** è¿è¡Œæ—¶ï¼š**ObjC** Runtime å±äºç³»ç»Ÿï¼Œçº¯ **ObjC** å’Œæ··ç¼–åœ¨è¿™æ–¹é¢æ²¡å·®
  * é“¾æ¥å™¨é€‰é¡¹å¯èƒ½æ”¾å¤§ï¼šæ¯”å¦‚ `-ObjC` å¯èƒ½æŠŠé™æ€åº“é‡Œå¾ˆå¤šä¸éœ€è¦çš„å¯¹è±¡ä¸€èµ·æ‹‰è¿›æ¥ï¼Œé€ æˆè†¨èƒ€ï¼ˆå’Œæ˜¯å¦æ··ç¼–æ— å…³ï¼Œä½†æ··ç¼–é¡¹ç›®æ›´å®¹æ˜“â€œå…¨éƒ½è¦â€ï¼‰

## ä¸‰ã€ğŸ’»ä»£ç è®²è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€å¹³å°åŒºåˆ†å¼•ç”¨åº“ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
#if os(OSX)
    import AppKit
#endif

#if os(iOS) || os(tvOS)
    import UIKit
#endif
```

### 2ã€â›“ï¸<font id=æ‡’åŠ è½½+é“¾å¼è°ƒç”¨>æ‡’åŠ è½½+é“¾å¼è°ƒç”¨</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 2.1ã€ğŸ·ï¸`UILabel` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  let label = UILabel()
     .byFont(.systemFont(ofSize: 16))
     .byTextColor(.black)
     .byText("ç›®å½•".localized())
     .byTextAlignment(.center)
     .makeLabelByShowingType(.oneLineTruncatingTail)
     .bgImage(UIImage(named: "bg_pattern"))
     .byNextText(" â†’ More")
  ```

* [ç»™ `UILabel` é‡Œçš„æ–‡å­—åŠ  **ä¸‹åˆ’çº¿**ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šä¸‹åˆ’çº¿çš„é¢œè‰²](#ç»™UILabelé‡Œçš„æ–‡å­—åŠ ä¸‹åˆ’çº¿å¹¶ä¸”å¯ä»¥æŒ‡å®šä¸‹åˆ’çº¿çš„é¢œè‰²@å®ç°é€»è¾‘)

  > ```swift
  > UILabel().underline(color:PYConst.main_color)
  > ```

#### 2.2ã€ğŸ”˜`UIBUtton` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> * **æŒ‰é’®é€‰ä¸­/éé€‰ä¸­**
>
>   ```swift
>   sender.isSelected.toggle()
>   ```
>
> * **é˜²æ­¢ç”¨æˆ·å¿«é€Ÿè¿ç»­ç‚¹æŒ‰é’®**
>
>   ```swift
>   sender.disableAfterClick(interval: 2)
>   ```
>

##### 2.2.1ã€ğŸ”˜æ™®é€šæŒ‰é’®ï¼ˆäº‹ä»¶è¿½åŠ ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var exampleButton: UIButton = {
    UIButton.sys()
        /// æ™®é€šå­—ç¬¦ä¸²@è®¾ç½®ä¸»æ ‡é¢˜
        .byTitle("æ˜¾ç¤º", for: .normal)
        .byTitle("éšè—", for: .selected)
        .byTitleColor(.systemBlue, for: .normal)
        .byTitleColor(.systemRed, for: .selected)
        .byTitleFont(.systemFont(ofSize: 16, weight: .medium))
        /// æ™®é€šå­—ç¬¦ä¸²@è®¾ç½®å‰¯æ ‡é¢˜
        .bySubTitle("æ˜¾ç¤º", for: .normal)
        .bySubTitle("éšè—", for: .selected)
        .bySubTitleColor(.systemBlue, for: .normal)
        .bySubTitleColor(.systemRed, for: .selected)
        .bySubTitleFont(.systemFont(ofSize: 16, weight: .medium))
        /// å¯Œæ–‡æœ¬å­—@è®¾ç½®ä¸»æ ‡é¢˜
        .byRichTitle(JobsRichText.make([
            JobsRichRun(.text("Â¥99")).font(.systemFont(ofSize: 18, weight: .semibold)).color(.systemRed),
            JobsRichRun(.text(" /æœˆ")).font(.systemFont(ofSize: 16)).color(.white)
        ]))
         /// å¯Œæ–‡æœ¬å­—@è®¾ç½®å‰¯æ ‡é¢˜
        .byRichSubTitle(JobsRichText.make([
            JobsRichRun(.text("åŸä»· ")).font(.systemFont(ofSize: 12)).color(.white.withAlphaComponent(0.8)),
            JobsRichRun(.text("Â¥199")).font(.systemFont(ofSize: 12, weight: .medium)).color(.systemYellow)
        ]))
        /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
        .byImage(UIImage(systemName: "eye.slash"), for: .normal)                // æœªé€‰ä¸­å›¾æ ‡
        .byImage(UIImage(systemName: "eye"), for: .selected)                    // é€‰ä¸­å›¾æ ‡
        .byContentEdgeInsets(UIEdgeInsets(top: 4, left: 8, bottom: 4, right: 8))// å›¾æ–‡å†…è¾¹è·
        .byTitleEdgeInsets(UIEdgeInsets(top: 0, left: 6, bottom: 0, right: -6)) // å›¾æ ‡ä¸æ–‡å­—é—´è·
        /// ç‚¹å‡»@æ’­æ”¾å£°éŸ³
        .byTapSound("Sounddd.wav")    
        /// æ™®é€š@ç‚¹æŒ‰äº‹ä»¶è§¦å‘
        .onTap { [weak self] sender in
            guard let self else { return }
            sender.isSelected.toggle()
            // æ–‡å­—ä¸å›¾æ ‡è‡ªåŠ¨åˆ‡æ¢
            self.passwordTF.isSecureTextEntry.toggle()
            self.passwordTF.togglePasswordVisibility()
            print("ğŸ‘ å½“å‰çŠ¶æ€ï¼š\(sender.isSelected ? "éšè—å¯†ç " : "æ˜¾ç¤ºå¯†ç ")")
        }
			  /// è¿½åŠ @ç‚¹æŒ‰äº‹ä»¶è§¦å‘
				.onTapAppend{ sender in
						print("è¿½åŠ çš„ç‚¹æŒ‰äº‹ä»¶")
				}
        /// å³ä¸Šè§’æç¤ºæ–‡æ¡ˆ@å°çº¢ç‚¹
        .byCornerDot(diameter: 10, offset: .init(horizontal: -4, vertical: 4))// çº¢ç‚¹
        /// å³ä¸Šè§’æç¤ºæ–‡æ¡ˆ@æ–‡å­—
        .byCornerBadgeText("NEW") { cfg in
            cfg.byOffset(.init(horizontal: -6, vertical: 6))
                .byInset(.init(top: 2, left: 6, bottom: 2, right: 6))
                .byBgColor(.systemRed)
                .byFont(.systemFont(ofSize: 11, weight: .bold))
                .byShadow(color: UIColor.black.withAlphaComponent(0.25),
                          radius: 2,
                          opacity: 0.6,
                          offset: .init(width: 0, height: 1))
        }
        /// æ™®é€š@é•¿æŒ‰äº‹ä»¶è§¦å‘
        .onLongPress(minimumPressDuration: 0.8) { btn, gr in
             if gr.state == .began {
                 btn.alpha = 0.6
                 print("é•¿æŒ‰å¼€å§‹ on \(btn)")
             } else if gr.state == .ended || gr.state == .cancelled {
                 btn.alpha = 1.0
                 print("é•¿æŒ‰ç»“æŸ")
             }
         }
  			/// è¿½åŠ @é•¿æŒ‰äº‹ä»¶è§¦å‘
        .onLongPressAppend(minimumPressDuration: 0.8) { btn, gr in
             print("è¿½åŠ çš„é•¿æŒ‰äº‹ä»¶")
				}
        .byAddTo(view) { [unowned self] make in
            make.top.equalTo(self.view.safeAreaLayoutGuide.snp.top).offset(40)
            make.left.right.equalToSuperview().inset(24)
            make.height.equalTo(44)
        }
        /// UIButtonConfiguration
        if #available(iOS 15.0, *) {
            b.byConfiguration { c in
                c.byTitle("èƒŒæ™¯å›¾ï¼šBase64 / URL")
                    .byBaseForegroundCor(.white)
                    .byContentInsets(.init(top: 16, leading: 16, bottom: 16, trailing: 16))
                    .byCornerStyle(.large)
                    .byImagePlacement(.trailing)
                    .byImagePadding(8)
            }
        } else {
            b.byTitle("èƒŒæ™¯å›¾ï¼šBase64 / URL", for: .normal)
                .byTitleColor(.white, for: .normal)
                .byContentEdgeInsets(.init(top: 16, left: 16, bottom: 16, right: 16))
                .byBgColor(.systemBlue)
        }
}()
```

##### 2.2.2ã€â° <font color=red id=è®¡æ•°æŒ‰é’®>**è®¡æ•°æŒ‰é’®**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> * â° è®¡æ—¶å™¨å¼€å§‹
>
>   * æ­£è®¡æ—¶
>
>     ```swift
>     self?.startButton.startTimer(
>         total: nil,                 // â¤ï¸ ä¸ä¼  => æ­£è®¡æ—¶
>         interval: self.intervalSec,
>         kind: self.currentKind
>     )
>     ```
>
>   * å€’è®¡æ—¶
>
>     ```swift
>     let total = self.parseCountdownTotal(10)
>     btn.startTimer(
>         total: total, // â¤ï¸ ä¼  total => å€’è®¡æ—¶
>         interval: self.intervalSec,
>         kind: self.currentKind
>     )
>     ```
>
> * â° è®¡æ—¶å™¨æš‚åœ
>
>   ```swift
>   self?.startButton.pauseTimer()
>   self?.countdownButton.pauseTimer()
>   ```
>
> * â° è®¡æ—¶å™¨é‡æ–°å¼€å§‹ï¼ˆæ¢å¤è®¡æ—¶ï¼‰
>
>   ```swift
>   self?.startButton.resumeTimer()
>   self?.countdownButton.resumeTimer()
>   ```
>
> * â° è®¡æ—¶å™¨é”€æ¯
>
>   > è§¦å‘å›è°ƒåé”€æ¯å®šæ—¶å™¨
>
>   ```swift
>   self?.startButton.fireTimerOnce()
>   self?.countdownButton.fireTimerOnce()
>   ```
>
> * â° è®¡æ—¶å™¨åœæ­¢ 
>
>   > é”€æ¯ä½†ä¸è§¦å‘å›è°ƒ
>
>   ```swift
>   self?.startButton.stopTimer()
>   self?.countdownButton.stopTimer()
>   ```
>

###### 2.2.2.1ã€â° æ­£è®¡æ—¶è®¡æ•°æŒ‰é’® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// MARK: - å¼€å§‹æŒ‰é’®ï¼ˆæ­£è®¡æ—¶ï¼šä¸ä¼  totalï¼›æŒ‰é’®æ ‡é¢˜è‡ªåŠ¨æ˜¾ç¤º elapsedï¼‰
private lazy var startButton: UIButton = {
    UIButton(type: .system)
        .byTitle("å¼€å§‹", for: .normal)
        .byTitleFont(.systemFont(ofSize: 22, weight: .bold))
        .byTitleColor(.white, for: .normal)
        .byBackgroundColor(.systemBlue, for: .normal)
        .byCornerRadius(10)
        .byMasksToBounds(true)
        // æ¯ tickï¼šæ›´æ–°æ—¶é—´ & æœ€è¿‘è§¦å‘æ—¶é—´
        .onTimerTick { [weak self] btn, elapsed, _, kind in
            guard let self else { return }
            // æ­£è®¡æ—¶ï¼šelapsedï¼ˆç§’ï¼‰å·²ç”±æŒ‰é’®å†…éƒ¨è‡ªåŠ¨è®¾ç½®ä¸ºæ ‡é¢˜ï¼Œè¿™é‡Œåªè¡¥å…… lastFireLabel
            self.lastFireLabel.text = "Last: " + Self.fmt(Date())
        }
        // çŠ¶æ€å˜åŒ–ï¼šé©±åŠ¨æ§åˆ¶é”®ï¼ˆæš‚åœ/ç»§ç»­/Fire/åœæ­¢ï¼‰çš„å¯ç”¨ä¸é…è‰²
        .onTimerStateChange { [weak self] _, _, new in
            self?.updateControlButtons(by: new)
        }
        // ç‚¹å‡»å¼€å§‹ï¼šä¸ä¼  total => æ­£è®¡æ—¶
        .onTap { [weak self] btn in
            guard let self else { return }
            self.lastFireLabel.text = "Last: -"
            btn.startTimer(
                total: nil,                 // â¤ï¸ ä¸ä¼  => æ­£è®¡æ—¶
                interval: self.intervalSec,
                kind: self.currentKind
            )
        }
        .byAddTo(view) { [unowned self] make in
            make.top.equalTo(countdownField.snp.bottom).offset(14)
            make.left.equalToSuperview().offset(horizontalInset)
            make.right.equalToSuperview().inset(horizontalInset)
            make.height.equalTo(56)
        }
}()
```

###### 2.2.2.2ã€â° å€’è®¡æ—¶è®¡æ•°æŒ‰é’® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// MARK: - å€’è®¡æ—¶æ¼”ç¤ºæŒ‰é’®ï¼ˆåŒä¸€å¥— APIï¼šä¼  total => å€’è®¡æ—¶ï¼‰
private lazy var countdownButton: UIButton = {
    UIButton(type: .system)
        .byTitle("è·å–éªŒè¯ç ", for: .normal)
        .byTitleColor(.white, for: .normal)
        .byBackgroundColor(.systemGreen, for: .normal)
        .onCountdownTick { [weak self] btn, remain, total, kind in
            guard let self else { return }
            print("â±ï¸ [\(kind.jobs_displayName)] \(remain)/\(total)")
            self.lastFireLabel.text = "Last: " + Self.fmt(Date())
            btn.byTitle("è¿˜å‰© \(remain)s", for: .normal)
        }
        .onCountdownFinish { _, kind in
            print("âœ… [\(kind.jobs_displayName)] å€’è®¡æ—¶å®Œæˆ")
        }
        .onTap { [weak self] btn in
            guard let self else { return }
            let total = self.parseCountdownTotal(10)
            btn.startTimer(
                total: total, // â¤ï¸ ä¼  total => å€’è®¡æ—¶
                interval: self.intervalSec,
                kind: self.currentKind
            )
            // å…³é”®ï¼šç­‰ startTimer æŠŠ "10s" è®¾å¥½åå†åŠ å‰ç¼€ï¼Œé¿å…è¢«è¦†ç›–
            DispatchQueue.main.async {
                let cur = btn.title(for: .normal) ?? "\(total)s"
                if !cur.hasPrefix("è¿˜å‰© ") {
                    btn.byTitle("è¿˜å‰© \(cur)", for: .normal)
                }
            }
        }
        .byAddTo(view) { [unowned self] make in
            make.top.equalTo(self.hintLabel.snp.bottom).offset(20)
            make.left.equalToSuperview().offset(horizontalInset)
            make.right.equalToSuperview().inset(horizontalInset)
            make.height.equalTo(50)
        }
}()
```

##### 2.2.3ã€ğŸ”˜ <font id=ç½‘ç»œå›¾æŒ‰é’®>**ç½‘ç»œå›¾æŒ‰é’®**</font>@èƒŒæ™¯å›¾/å‰æ™¯å›¾

* [**SDWebImage**](https://github.com/SDWebImage/SDWebImage)

  ```swift
  /// æŒ‰é’®ç½‘ç»œèƒŒæ™¯å›¾@SDWebImage
  private lazy var btnBG: UIButton = {
      UIButton.sys()
          .byCornerRadius(12)
          .byClipsToBounds(true)
          .byTitle("æˆ‘æ˜¯ä¸»æ ‡é¢˜@SDWebImage")
          .bySubTitle("æˆ‘æ˜¯å‰¯æ ‡é¢˜@SDWebImage")
          .sd_imageURL("https://picsum.photos/3000/2000")
          .sd_placeholderImage(nil)
          .sd_options([.scaleDownLargeImages, .retryFailed])
          .sd_bgNormalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(wrapperImgViewSD.snp.bottom).offset(24)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(64)
          }
  }()
  ```

  ```swift
  /// æŒ‰é’®ç½‘ç»œå‰æ™¯å›¾@SDWebImage
  private lazy var btnImage: UIButton = {
      UIButton.sys()
          .byCornerRadius(12)
          .byBorderWidth(1)
          .byBorderColor(UIColor.systemGray3)
          .byClipsToBounds(true)
          .byTitle("æˆ‘æ˜¯ä¸»æ ‡é¢˜@SDWebImage")
          .bySubTitle("æˆ‘æ˜¯å‰¯æ ‡é¢˜@SDWebImage")
          .sd_imageURL("https://picsum.photos/200")
          .sd_placeholderImage(nil)
          .sd_options([.retryFailed, .highPriority, .scaleDownLargeImages])
          .sd_normalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(btnBG.snp.bottom).offset(16)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.greaterThanOrEqualTo(56)
          }
  }()
  ```

* [**Kingfisher**](https://github.com/onevcat/Kingfishe)

  ```swift
  /// æŒ‰é’®ç½‘ç»œèƒŒæ™¯å›¾@Kingfisher
  private lazy var btnBG_KF: UIButton = {
      UIButton.sys()
          .byCornerRadius(12)
          .byClipsToBounds(true)
          .byTitle("æˆ‘æ˜¯ä¸»æ ‡é¢˜@Kingfisher")
          .bySubTitle("æˆ‘æ˜¯å‰¯æ ‡é¢˜@Kingfisher")
          .kf_imageURL("https://picsum.photos/300/200")
          .kf_placeholderImage(nil)
          .kf_options([
              .processor(DownsamplingImageProcessor(size: CGSize(width: 500, height: 200))),
              .scaleFactor(UIScreen.main.scale),
              .cacheOriginalImage,
              .transition(.fade(0.25)),
              .retryStrategy(DelayRetryStrategy(maxRetryCount: 2, retryInterval: .seconds(1)))
          ])
          .kf_bgNormalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(btnImage.snp.bottom).offset(24)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(64)
          }
  }()
  ```

  ```swift
  /// æŒ‰é’®ç½‘ç»œå‰æ™¯å›¾@Kingfisher
  private lazy var btnImage_KF: UIButton = {
      UIButton.sys()
          .byCornerRadius(12)
          .byBorderWidth(1)
          .byBorderColor(UIColor.systemGray3)
          .byClipsToBounds(true)
          .byTitle("æˆ‘æ˜¯ä¸»æ ‡é¢˜@Kingfisher")
          .bySubTitle("æˆ‘æ˜¯å‰¯æ ‡é¢˜@Kingfisher")
          .kf_imageURL("https://picsum.photos/200")
          .kf_placeholderImage(nil)
          .kf_options([
              .processor(DownsamplingImageProcessor(size: CGSize(width: 64, height: 64))),
              .scaleFactor(UIScreen.main.scale),
              .cacheOriginalImage,
              .transition(.fade(0.25)),
              .retryStrategy(DelayRetryStrategy(maxRetryCount: 2, retryInterval: .seconds(1)))
          ])
          .kf_normalLoad() // ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(btnBG_KF.snp.bottom).offset(16)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(64)
          }
  }()
  ```

##### 2.2.4ã€ğŸ”˜ æ—‹è½¬æŒ‰é’® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var suspendSpinBtn: UIButton = {
    UIButton(type: .system)
        .byTitle("0", for: .normal) // ä¸­é—´æ•°å­—ï¼šç§’
        .byTitleFont(.systemFont(ofSize: 22, weight: .bold))
        .byTitleColor(.white, for: .normal)
        .byBackgroundColor(.systemOrange, for: .normal)
        .byCornerRadius(25)
        .byMasksToBounds(true)

        // æ­£è®¡æ—¶ï¼šæ¯ç§’è§¦å‘ä¸€æ¬¡
        .startTimer(total: nil, interval: 1.0, kind: .gcd)

        // æ¯ tickï¼šæ›´æ–°ä¸­å¿ƒæ•°å­—
        .onTimerTick { [weak self] btn, elapsed, _, _ in
            guard let _ = self else { return }
            let sec = Int(elapsed)             // ç´¯è®¡ç§’
            // åªæœ‰å˜åŒ–æ—¶æ‰åˆ·æ–°ï¼Œé¿å…ä¸å¿…è¦çš„é‡ç»˜
            if btn.title(for: .normal) != "\(sec)" {
                btn.byTitle("\(sec)", for: .normal)
                    .bySetNeedsUpdateConfiguration()
            }
        }
        // é•¿æŒ‰ï¼šåŸé€»è¾‘
        .onLongPress(minimumPressDuration: 0.8) { btn, _ in
            JobsToast.show(
                text: "é•¿æŒ‰äº†æ‚¬æµ®æŒ‰é’®",
                config: JobsToast.Config()
                    .byBgColor(.systemGreen.withAlphaComponent(0.9))
                    .byCornerRadius(12)
            )
        }
        // ç‚¹å‡»ï¼šä¿æŒåŸæ¥çš„ Toastï¼ˆä¸æ”¹åŠ¨è®¡æ—¶é€»è¾‘ï¼‰
        .onTap { [weak self] btn in
            guard let _ = self else { return }
            btn.playTapBounce(haptic: .light)  // ğŸ‘ˆ ä¸´æ—¶æ”¾å¤§â†’å›å¼¹ï¼ˆä¸æ³¨å†Œä»»ä½•æ‰‹åŠ¿/äº‹ä»¶ï¼‰
            if btn.jobs_isSpinning {
                // æš‚åœæ—‹è½¬
                btn.bySpinPause()
                // æš‚åœè®¡æ—¶ï¼ˆä¿ç•™å·²ç´¯è®¡ç§’ï¼Œä¸é‡ç½®ï¼‰
                btn.timer?.pause()        // âœ… æ¨èï¼šä½ çš„ç»Ÿä¸€å†…æ ¸æŒ‚åœ¨ button.timer ä¸Š
                // å¦‚æœä½ æœ‰å°è£…æ–¹æ³•ï¼Œåˆ™ç”¨ï¼šbtn.pauseTimer()
                JobsToast.show(
                    text: "å·²æš‚åœæ—‹è½¬ & è®¡æ—¶",
                    config: .init().byBgColor(.systemGreen.withAlphaComponent(0.9)).byCornerRadius(12)
                )
            } else {
                // æ¢å¤æ—‹è½¬
                btn.bySpinStart()
                // æ¢å¤è®¡æ—¶ï¼ˆä»æš‚åœå¤„ç»§ç»­ç´¯åŠ ï¼‰
                btn.timer?.resume()       // âœ… æ¨è
                // å¦‚æœä½ æœ‰å°è£…æ–¹æ³•ï¼Œåˆ™ç”¨ï¼šbtn.resumeTimer()
                JobsToast.show(
                    text: "ç»§ç»­æ—‹è½¬ & è®¡æ—¶",
                    config: .init().byBgColor(.systemGreen.withAlphaComponent(0.9)).byCornerRadius(12)
                )
            }
        }
        // æ‚¬æµ®é…ç½®
        .bySuspend { cfg in
            cfg
                .byContainer(view)
//                    .byStart(.bottomRight)
                .byStart(.point(CGPoint(x: 300.w, y: 500))) // èµ·å§‹ç‚¹ï¼ˆå¯ç”¨åŒºåŸŸåæ ‡ï¼‰
                .byFallbackSize(CGSize(width: 50, height: 50))
                .byHapticOnDock(true)
        }
}()
```

#### 2.3ã€`UITableView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var tableView: UITableView = {
    UITableView(frame: .zero, style: .insetGrouped)
        .byDataSource(self)
        .byDelegate(self)
        .registerCell(UITableViewCell.self)
        .byNoContentInsetAdjustment()
        .bySeparatorStyle(.singleLine)
        .byNoSectionHeaderTopPadding()
    
        .jobs_emptyButtonProvider { [unowned self] in
            UIButton(type: .system)
                .byTitle("æš‚æ— æ•°æ®", for: .normal)
                .bySubTitle("ç‚¹æˆ‘å¡«å……ç¤ºä¾‹æ•°æ®", for: .normal)
                .byImage("tray".sysImg, for: .normal)
                .byImagePlacement(.top)
                .onTap { [weak self] _ in
                    guard let self else { return }
                    self.items = (1...10).map { "Row \($0)" }
                    self.tableView.reloadData()   // âœ… reload åä¼šè‡ªåŠ¨è¯„ä¼°ç©ºæ€ï¼Œæ— éœ€ä½ å†æ‰‹åŠ¨è°ƒç”¨
                }
                // å¯é€‰ï¼šä¸æ»¡æ„é»˜è®¤å±…ä¸­ -> è‡ªå®šä¹‰å¸ƒå±€
                .jobs_setEmptyLayout { btn, make, host in
                    make.centerX.equalTo(host)
                    make.centerY.equalTo(host).offset(-40)
                    make.leading.greaterThanOrEqualTo(host).offset(16)
                    make.trailing.lessThanOrEqualTo(host).inset(16)
                    make.width.lessThanOrEqualTo(host).multipliedBy(0.9)
                }
        }

//            .byContentInset(UIEdgeInsets(
//                top: UIApplication.jobsSafeTopInset + 30,
//                left: 0,
//                bottom: 0,
//                right: 0
//            ))
            // ä¸‹æ‹‰åˆ·æ–° Header
            .configRefreshHeader(component: JobsDefaultHeader(),
                                 container: self,
                                 trigger: 66) { [weak self] in
                guard let self else { return }
                Task { @MainActor in
                    try? await Task.sleep(nanoseconds: 1_000_000_000)
                    self.rows = 20
                    self.tableView.byReloadData()
                    self.tableView.switchRefreshHeader(to: .normal)
                    self.tableView.switchRefreshFooter(to: .normal) // å¤ä½â€œæ— æ›´å¤šâ€
                }
            }
            // ä¸Šæ‹‰åŠ è½½ Footer
            .configRefreshFooter(component: JobsDefaultFooter(),
                                          container: self,
                                          trigger: 66) { [weak self] in
                guard let self else { return }
                Task { @MainActor in
                    try? await Task.sleep(nanoseconds: 1_000_000_000)
                    if self.rows < 60 {
                        self.rows += 20
                        self.tableView.byReloadData()
                        self.tableView.switchRefreshFooter(to: .normal)
                    } else {
                        self.tableView.switchRefreshFooter(to: .noMoreData)
                    }
                }
            }

        .byAddTo(view) {[unowned self] make in
            if view.jobs_hasVisibleTopBar() {
                make.top.equalTo(self.gk_navigationBar.snp.bottom).offset(10)
                make.left.right.bottom.equalToSuperview()
            } else {
                make.edges.equalToSuperview()
            }
        }
}()
```

#### 2.4ã€`UICollectionView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**`UICollectionViewFlowLayout`**](#UICollectionViewFlowLayout)

* **`UICollectionView`**

  ```swift
  private lazy var collectionView: UICollectionView = {
      UICollectionView(frame: .zero, collectionViewLayout: flowLayout)
          .byDataSource(self)
          .byDelegate(self)
          .registerCell(UICollectionViewCell.self)
          .byBackgroundView(nil)
          .byDragInteractionEnabled(false)
  
          // ç©ºæ€æŒ‰é’®ï¼ˆä¸ UITableView Demo ä¸€è‡´ï¼‰
          .jobs_emptyButtonProvider { [unowned self] in
              UIButton.sys()
                  .byTitle("æš‚æ— æ•°æ®", for: .normal)
                  .bySubTitle("ç‚¹æˆ‘å¡«å……ç¤ºä¾‹æ•°æ®", for: .normal)
                  .byImage(UIImage(systemName: "square.grid.2x2"), for: .normal)
                  .byImagePlacement(.top)
                  .onTap { [weak self] _ in
                      guard let self else { return }
                      self.items = (1...12).map { "Item \($0)" }
                      self.collectionView.byReloadData()        // âœ… reload åè‡ªåŠ¨è¯„ä¼°ç©ºæ€
                  }
                  // å¯é€‰ï¼šè‡ªå®šä¹‰ç©ºæ€æŒ‰é’®å¸ƒå±€
                  .jobs_setEmptyLayout { btn, make, host in
                      make.centerX.equalTo(host)
                      make.centerY.equalTo(host).offset(-40)
                      make.leading.greaterThanOrEqualTo(host).offset(16)
                      make.trailing.lessThanOrEqualTo(host).inset(16)
                      make.width.lessThanOrEqualTo(host).multipliedBy(0.9)
                  }
          }
  
              // ä¸‹æ‹‰åˆ·æ–° Header
              .configRefreshHeader(component: JobsDefaultHeader(),
                                   container: self,
                                   trigger: 66) { [weak self] in
                  guard let self else { return }
                  Task { @MainActor in
                      try? await Task.sleep(nanoseconds: 1_000_000_000)
                      self.rows = 20
                      self.tableView.byReloadData()
                      self.tableView.switchRefreshHeader(to: .normal)
                      self.tableView.switchRefreshFooter(to: .normal) // å¤ä½â€œæ— æ›´å¤šâ€
                  }
              }
              // ä¸Šæ‹‰åŠ è½½ Footer
              .configRefreshFooter(component: JobsDefaultFooter(),
                                            container: self,
                                            trigger: 66) { [weak self] in
                  guard let self else { return }
                  Task { @MainActor in
                      try? await Task.sleep(nanoseconds: 1_000_000_000)
                      if self.rows < 60 {
                          self.rows += 20
                          self.tableView.byReloadData()
                          self.tableView.switchRefreshFooter(to: .normal)
                      } else {
                          self.tableView.switchRefreshFooter(to: .noMoreData)
                      }
                  }
              }
  
          .byAddTo(view) { [unowned self] make in
              if view.jobs_hasVisibleTopBar() {
                  make.top.equalTo(self.gk_navigationBar.snp.bottom).offset(10)
                  make.left.right.bottom.equalToSuperview()
              } else {
                  make.edges.equalToSuperview()
              }
          }
  }()
  ```
  
* åè®®ï¼š**`UICollectionViewDataSource`**ã€**`UICollectionViewDelegate`**ã€**`UICollectionViewDelegateFlowLayout`**

  ```swift
  // ============================== UICollectionViewDataSource ==============================
  func numberOfSections(in collectionView: UICollectionView) -> Int { 1 }
  
  func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
      items.count
  }
  
  func collectionView(_ collectionView: UICollectionView,
                      cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
      let cell: UICollectionViewCell = collectionView.dequeueCell(UICollectionViewCell.self, for: indexPath)
      let label: UILabel
      if let exist = cell.contentView.viewWithTag(1001) as? UILabel {
          label = exist
      } else {
          label = UILabel()
              .byNumberOfLines(1)
              .byTextAlignment(.center)
              .byFont(.systemFont(ofSize: 16, weight: .medium))
              .byTextColor(.label)
              .byTag(1001)
              .byAddTo(cell.contentView) { make in     // âœ… åŠ åˆ° contentView
                  make.edges.equalToSuperview().inset(8)
              }
  
          // èƒŒæ™¯ & åœ†è§’ï¼ˆåªéœ€è®¾ä¸€æ¬¡ï¼‰
          cell.contentView.byBgColor(.secondarySystemBackground)
              .byCornerRadius(10)
              .byMasksToBounds(true)
      }
  
      label.text = items[indexPath.item]
      return cell
  }
  // ============================== UICollectionViewDelegate ==============================
  func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
      print("âœ… didSelect Item: \(indexPath.item)")
      collectionView.deselectItem(at: indexPath, animated: true)
  }
  
  // ============================== UICollectionViewDelegateFlowLayout ==============================
  func collectionView(_ collectionView: UICollectionView,
                      layout collectionViewLayout: UICollectionViewLayout,
                      sizeForItemAt indexPath: IndexPath) -> CGSize {
      // è®¡ç®— 2 åˆ—å¡ç‰‡å®½åº¦ï¼ˆè€ƒè™‘ sectionInset / interItemSpacingï¼‰
      guard let layout = collectionViewLayout as? UICollectionViewFlowLayout else {
          return CGSize(width: 100, height: 60)
      }
      let inset = layout.sectionInset
      let spacing = layout.minimumInteritemSpacing
      let columns: CGFloat = 2
      let totalH = inset.left + inset.right + (columns - 1) * spacing
      let w = floor((collectionView.bounds.width - totalH) / columns)
      return CGSize(width: w, height: 64)
  }
  ```

#### 2.5ã€<font id=UICollectionViewFlowLayout>`UICollectionViewFlowLayout`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var flowLayout: UICollectionViewFlowLayout = {
    UICollectionViewFlowLayout()
        .byScrollDirection(.vertical)
        .byMinimumLineSpacing(10)
        .byMinimumInteritemSpacing(10)
        .bySectionInset(UIEdgeInsets(top: 10, left: 12, bottom: 10, right: 12))
}()
```

#### 2.6ã€`UIImageView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å­—ç¬¦ä¸²æœ¬åœ°å›¾

  ```swift
  /// UIImageView@å­—ç¬¦ä¸²æœ¬åœ°å›¾
  private lazy var localImgView: UIImageView = {
      UIImageView()
          .byImage("Ani".img)
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .onTap { iv in
              toastBy("å•å‡»å›¾ç‰‡ï¼š\(iv)")
           }
          .onLongPress(minDuration: 0.8, movement: 12, touches: 1, name: "customLongPress") { iv, gr in
              switch gr.state {
              case .began:
                  toastBy("é•¿æŒ‰å¼€å§‹ on \(iv)")
              case .ended, .cancelled, .failed:
                  toastBy("é•¿æŒ‰ç»“æŸ on \(iv)")
              default:
                  break
              }
          }
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(scrollView.contentLayoutGuide.snp.top).offset(10.h)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20.w)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20.w)
              make.height.equalTo(180.h)
          }
  }()
  ```
  
* [**Kingfisher**](https://github.com/onevcat/Kingfishe)

  ```swift
  /// UIImageViewå­—ç¬¦ä¸²ç½‘ç»œå›¾@Kingfisher
  private lazy var asyncImgView: UIImageView = {
      UIImageView()
          .byAsyncImageKF("https://picsum.photos/200/300", fallback: "å”è€é¸­".img)
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .onTap { iv in
              toastBy("å•å‡»å›¾ç‰‡ï¼š\(iv)")
           }
          .onLongPress(minDuration: 0.8, movement: 12, touches: 1, name: "customLongPress") { iv, gr in
              switch gr.state {
              case .began:
                  toastBy("é•¿æŒ‰å¼€å§‹ on \(iv)")
              case .ended, .cancelled, .failed:
                  toastBy("é•¿æŒ‰ç»“æŸ on \(iv)")
              default:
                  break
              }
          }
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(localImgView.snp.bottom).offset(20.h)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20.w)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20.w)
              make.height.equalTo(180.h)
          }
  }()
  ```

  ```swift
  /// UIImageViewç½‘ç»œå›¾ï¼ˆå¤±è´¥å…œåº•å›¾ï¼‰@Kingfisher
  private lazy var wrapperImgView: UIImageView = {
      UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .kf_setImage(from: "https://picsum.photos/200", placeholder: "Ani".img)
          .onTap { iv in
              toastBy("å•å‡»å›¾ç‰‡ï¼š\(iv)")
           }
          .onLongPress(minDuration: 0.8, movement: 12, touches: 1, name: "customLongPress") { iv, gr in
              switch gr.state {
              case .began:
                  toastBy("é•¿æŒ‰å¼€å§‹ on \(iv)")
              case .ended, .cancelled, .failed:
                  toastBy("é•¿æŒ‰ç»“æŸ on \(iv)")
              default:
                  break
              }
          }
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(asyncImgViewSD.snp.bottom).offset(20.h)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20.w)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20.w)
              make.height.equalTo(180.h)
          }
  }()
  ```

* [**SDWebImage**](https://github.com/SDWebImage/SDWebImage)

  ```swift
  /// UIImageViewå­—ç¬¦ä¸²ç½‘ç»œå›¾@SDWebImage
  private lazy var asyncImgViewSD: UIImageView = {
      UIImageView()
          .byAsyncImageSD("https://picsum.photos/400/300", fallback: "å”è€é¸­".img)
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .onTap { iv in
              toastBy("å•å‡»å›¾ç‰‡ï¼š\(iv)")
           }
          .onLongPress(minDuration: 0.8, movement: 12, touches: 1, name: "customLongPress") { iv, gr in
              switch gr.state {
              case .began:
                  toastBy("é•¿æŒ‰å¼€å§‹ on \(iv)")
              case .ended, .cancelled, .failed:
                  toastBy("é•¿æŒ‰ç»“æŸ on \(iv)")
              default:
                  break
              }
          }
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(asyncImgView.snp.bottom).offset(20.h)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20.w)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20.w)
              make.height.equalTo(180.h)
          }
  }()
  ```
  
  ```swift
  /// UIImageViewç½‘ç»œå›¾ï¼ˆå¤±è´¥å…œåº•å›¾ï¼‰@SDWebImage
  private lazy var wrapperImgViewSD: UIImageView = {
      UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .sd_setImage(from: "https://picsum.photos/200", placeholder: "Ani".img)
          .onTap { iv in
              toastBy("å•å‡»å›¾ç‰‡ï¼š\(iv)")
           }
          .onLongPress(minDuration: 0.8, movement: 12, touches: 1, name: "customLongPress") { iv, gr in
              switch gr.state {
              case .began:
                  toastBy("é•¿æŒ‰å¼€å§‹ on \(iv)")
              case .ended, .cancelled, .failed:
                  toastBy("é•¿æŒ‰ç»“æŸ on \(iv)")
              default:
                  break
              }
          }
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(wrapperImgView.snp.bottom).offset(20.h)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20.w)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20.w)
              make.height.equalTo(180.h)
          }
  }()
  ```

#### 2.7ã€`UIToolbar` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```
private lazy var passwordAccessory: UIToolbar = {
    UIToolbar().byItems([
        UIBarButtonItem()
            .byTitle("æ¸…ç©º")
            .byTitleFont(.systemFont(ofSize: 15))
            .byTitleColor(.systemRed)
            .byStyle(.plain)
            .onTap { [weak self] _ in
                guard let self = self else { return }   // âœ… ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå®‰å…¨
                /// TODO
            },
        UIBarButtonItem(systemItem: .flexibleSpace),
        UIBarButtonItem()
            .byTitle("å®Œæˆ")
            .byTitleFont(.systemFont(ofSize: 15))
            .byTitleColor(.systemYellow)
            .byStyle(.done)
            .onTap { [weak self] _ in
                guard let self = self else { return }   // âœ… ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå®‰å…¨
                view.endEditing(true)
            },
    ])
    .bySizeToFit()
    .byAddTo(view) { [unowned self] make in
        make.top.equalTo(self.view.safeAreaLayoutGuide.snp.top).offset(40)
        make.left.right.equalToSuperview().inset(24)
        make.height.equalTo(44)
    }
}()
```

#### 2.8ã€`UIBarButtonItem`  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var barButtonItem: UIBarButtonItem = {
    UIBarButtonItem()
        .byTitle("å®Œæˆ")
        .byTitleFont(.systemFont(ofSize: 15))
        .byTitleColor(.systemYellow)
        .byStyle(.done)
        .onTap { [weak self] _ in
            guard let self = self else { return }   // âœ… ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå®‰å…¨
            view.endEditing(true)
    }
}()
```

#### 2.9ã€ğŸŒ`WKWebView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
import WebKit

private lazy var webView: WKWebView = {
    WKWebView(frame: .zero, configuration: WKWebViewConfiguration()
        .byWebsiteDataStore(.default())
        .byAllowsInlineMediaPlayback(true)
        .byUserContentController(WKUserContentController().byAddUserScript(Self.makeBridgeUserScript()))
        .byDefaultWebpagePreferences { wp in
            wp.allowsContentJavaScript = true
        }
    )
    .byAddTo(view) { [unowned self] make in
        make.top.equalTo(textField.snp.bottom).offset(12)
        make.centerX.equalToSuperview()
        make.height.equalTo(36)
    }
}()
```

#### 2.10ã€ğŸŒ`BaseWebView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> åœ¨` Info.plist `æ·»åŠ ğŸ‘‡ï¼ˆæ›´é€šç”¨çš„ **ATS** é…ç½®ï¼Œé¿å…ä¸ºæŸåŸŸåå•ç‹¬å¼€æ´ï¼‰
>
> ```xml
> <key>NSAppTransportSecurity</key>
> <dict>
> <!-- ä»…æ”¾å¼€ Web å†…å®¹ï¼Œå…¶ä»–ç½‘ç»œè¯·æ±‚ä»å— ATS çº¦æŸ -->
> <key>NSAllowsArbitraryLoadsInWebContent</key><true/>
> </dict>
> ```

```swift
private lazy var web: BaseWebView = { [unowned self] in
        return BaseWebView()
            .byBgColor(.clear)
            .byAllowedHosts([])                  // ä¸é™åŸŸ
            .byOpenBlankInPlace(true)
            .byDisableSelectionAndCallout(false)
            .byUserAgentSuffixProvider { _ in
                // æŒ‰è¯·æ±‚åŠ¨æ€è¿½åŠ  UA åç¼€ï¼›nil = ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ UAã€‚
                // éœ€è¦åŒºåˆ†é¡µé¢æ—¶åœ¨æ­¤ return "YourApp/1.0"
                return nil
            }
//            .byNormalizeMToWWW(false)               // â—ï¸å…³é—­ mâ†’www
//            .byForceHTTPSUpgrade(false)             // â—ï¸å…³é—­ httpâ†’https
//            .bySafariFallbackOnHTTP(false)          // â—ï¸å…³é—­ Safari å…œåº•
//            .byInjectRedirectSanitizerJS(false)     // å¯å…³ï¼Œé¿å…å¹²æ¶‰ H5 è‡ªå·±è·³è½¬
            /// URL é‡å†™ç­–ç•¥ï¼ˆé»˜è®¤ä¸é‡å†™ï¼›è¿™é‡Œä¿æŒå…³é—­ï¼‰
            .byURLRewriter { _ in
                // ä¾‹å¦‚è¦åš httpâ†’https å‡çº§ï¼šæ£€æµ‹ url.scheme == "http" å†è¿”å›æ–° URL
                // ç°åœ¨è¿”å› nil è¡¨ç¤ºä¸æ”¹å†™
                return nil
            }
            /// Safari å…œåº•ï¼ˆé»˜è®¤ä¸å¼€ï¼‰ï¼›è¿”å› true å³äº¤ç»™ Safari æ‰“å¼€
            .bySafariFallbackRule { _ in
                return false
            }
            /// ä¸€é”®å¼€å¯¼èˆªæ ï¼ˆé»˜è®¤æ ‡é¢˜=webView.titleï¼Œé»˜è®¤æœ‰è¿”å›é”®ï¼‰
            .byNavBarEnabled(true)
            .byNavBarStyle { s in
                s.byHairlineHidden(false)
                 .byBackgroundColor(.systemBackground)
                 .byTitleAlignmentCenter(true)
            }
            /// è‡ªå®šä¹‰è¿”å›é”®ï¼ˆæƒ³éšè—å°±ï¼š.byNavBarBackButtonProvider { nil }ï¼‰
            .byNavBarBackButtonProvider {
                UIButton(type: .system)
                    .byBackgroundColor(.clear)
                    .byImage(UIImage(systemName: "chevron.left"), for: .normal)
                    .byTitle("è¿”å›", for: .normal)
                    .byTitleFont(.systemFont(ofSize: 16, weight: .medium))
                    .byTitleColor(.label, for: .normal)
                    .byContentEdgeInsets(.init(top: 6, left: 10, bottom: 6, right: 10))
                    .byTapSound("Sound.wav")
            }
            /// è¿”å›è¡Œä¸ºï¼šä¼˜å…ˆåé€€ï¼Œå¦åˆ™å…³é—­å½“å‰æ§åˆ¶å™¨
            .byNavBarOnBack { [weak self] in
                guard let self else { return }
                closeByResult("")
            }
            .byAddTo(view) { [unowned self] make in
                make.edges.equalToSuperview()
            }
            /// ä»¥ä¸‹æ˜¯ä¾æ®å‰ç«¯æš´éœ²çš„è‡ªå®šä¹‰æ–¹æ³•è¿›è¡Œçš„JSäº¤äº’
            .registerMobileAction("navigateToHome") {  [weak self] body, reply in
                /// è·³è½¬åˆ°é¦–é¡µ
                self!.closeByResult("")
                reply(nil)
            }
            .registerMobileAction("getToken") {  [weak self] body, reply in

                reply(nil)
            }
            .registerMobileAction("navigateToSecurityCenter") {  [weak self] body, reply in
                /// è·³è½¬ç¦åˆ©ä¸­å¿ƒ
                reply(nil)
            }
            .registerMobileAction("navigateToLogin") {  [weak self] body, reply in
                /// è·³è½¬åˆ°ç™»å½•é¡µ
                reply(nil)
            }
            .registerMobileAction("navigateToDeposit") {  [weak self] body, reply in
                /// è·³è½¬åˆ°å……å€¼é¡µ
                reply(nil)
            }
            .registerMobileAction("closeWebView") {  [weak self] body, reply in
                /// å…³é—­WebView
                reply(nil)
            }
            .registerMobileAction("showToast") {  [weak self] body, reply in
                /// æ˜¾ç¤ºToast
                JobsToast.show(
                    text: body.stringValue(for: "message") ?? "",
                    config: JobsToast.Config()
                        .byBgColor(.systemGreen.withAlphaComponent(0.9))
                        .byCornerRadius(12)
                )
                reply(nil)
            }
    }()
```

* åŠ è½½çº¿ä¸Š URL

  ```swift
  web.loadBy("https://www.baidu.com")
  /// æˆ–è€…
  web.loadBy(URL(string: "https://www.baidu.com")!)
  ```

* åŠ è½½[**å†…ç½®çš„HTMLä»£ç **](#å†…ç½®çš„HTMLä»£ç )

  ```swift
  web.loadHTMLBy(Self.demoHTML, baseURL: nil)
  ```

* åŠ è½½æœ¬åœ°**`*.HTML`**æ–‡ä»¶@[**bundle**](#bundle)

  ```swift
  web.loadBundleHTMLBy(named: "BaseWebViewDemo")
  ```

#### 2.11ã€âœï¸`UITextField` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ```swift
> override func loadView() {
>    super.loadView()
>    // å»ºè®®åœ¨ App å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡
>    UITextField.enableDeleteBackwardBroadcast()
> }
> ```

##### 2.11.1ã€ğŸ“® é‚®ç®±è¾“å…¥æ¡† <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¸€èˆ¬æ€§å°è£… 

  ```swift
  ///é‚®ç®±è¾“å…¥æ¡†
  private lazy var emailTF: UITextField = {
      UITextField()
          // æ•°æ®æº
          .byDelegate(self)
          // åŸºç¡€è§†è§‰
          .byPlaceholder("è¯·è¾“å…¥é‚®ç®±ï¼ˆè‡³å°‘ 3 ä¸ªå­—ç¬¦ï¼‰")
          .byTextColor(.label)
          .byFont(.systemFont(ofSize: 16))
          .byTextAlignment(.natural)
          .byBorderStyle(.roundedRect)
          .byClearButtonMode(.whileEditing)
  
          .byInputAccessoryView(accessory)
          // é”®ç›˜
          .byKeyboardType(.emailAddress)
          .byKeyboardAppearance(.dark)
          .byReturnKeyType(.next)
          .byEnablesReturnKeyAutomatically(true)
          // æ™ºèƒ½è¾“å…¥
          .byAutocapitalizationType(.none)
          .byAutocorrectionType(.no)
          .bySpellCheckingType(.no)
          .bySmartQuotesType(.no)
          .bySmartDashesType(.no)
          .bySmartInsertDeleteType(.no)
          // å†…å®¹ç±»å‹
          .byTextContentType(.emailAddress)
          // ç¼–è¾‘å±æ€§
          .byAllowsEditingTextAttributes(true)
          .byDefaultTextAttributes([.kern: 0.5]) // å­—è·
          .byTypingAttributes([.foregroundColor: UIColor.label])
          // å·¦/å³è§†å›¾
          //.byLeftView(makeIcon("envelope"), mode: .always)
          .byLeftIcon(UIImage(systemName: "envelope"),
                      tint: .secondaryLabel,
                      size: .init(width: 18, height: 18),
                      leading: 12, spacing: 8)
          .onChange { tf, input, old, isDeleting in
              let new = tf.text ?? ""
              print("âœï¸ input='\(input)' old='\(old)' new='\(new)' deleting=\(isDeleting)")
  
              // ç¤ºä¾‹ï¼š6~20 ä½æœ‰æ•ˆæ€æ ·å¼
              let ok = (6...20).contains(new.count)
              tf.layer.borderWidth = 1
              tf.layer.borderColor = (ok ? UIColor.systemGreen : UIColor.systemRed).cgColor
              tf.layer.masksToBounds = true
              if #available(iOS 13.0, *) { tf.layer.cornerCurve = .continuous }
          }
          .byAddTo(view) { [unowned self] make in
              make.top.equalTo(textField.snp.bottom).offset(12)
              make.centerX.equalToSuperview()
              make.height.equalTo(36)
          }
  }()
  
  // iOS 17+
  if #available(iOS 17.0, *) {
      emailTF.byInlinePredictionType(.default)
  }
  // iOS 18+ï¼ˆæ¼”ç¤ºï¼šå³ä½¿é‚®ç®±æ¡†ä¹Ÿèƒ½è®¾ç½®ï¼Œä¸å½±å“ï¼‰
  if #available(iOS 18.0, *) {
      emailTF.byMathExpressionCompletionType(.default)
             .byWritingToolsBehavior(.default)
      		   .byAllowedWritingToolsResultOptions([])
  }
  ```

* åŠŸèƒ½æ€§å°è£…

  * åˆ é™¤æŒ‰é”®çš„ç›‘å¬

    ```swift
    // MARK: Rx ç»‘å®š â€”â€” åˆ é™¤é”®å¹¿æ’­
    emailTF.didPressDelete
        .subscribe(onNext: { [weak self] in
            guard let self else { return }
            print("ğŸ—‘ delete on emailTF:", self.emailTF.text ?? "")
        })
        .disposed(by: rx.disposeBag)
    ```

  * ç”¨`textInput`é™å®šè¾“å…¥å­—ç¬¦è¿‡æ»¤æ¡ä»¶

    ```swift
    // MARK: Rx ç»‘å®š â€”â€” é‚®ç®±ï¼šå»ç©ºæ ¼ + æœ€é•¿ 8 + ç®€å•è§„åˆ™
    emailTF.textInput(
        maxLength: 8,
        formatter: { $0.trimmingCharacters(in: .whitespaces) },
        validator: { $0.count >= 3 && $0.contains("@") }
    ).isValid
        .subscribe(onNext: { print("ğŸ“§ email valid:", $0) })
        .disposed(by: rx.disposeBag)
    ```

##### 2.11.2ã€ğŸ”’ å¯†ç è¾“å…¥æ¡† <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¸€èˆ¬æ€§å°è£…ï¼ˆ`.byLimitLength(5)// è¾“å…¥é•¿åº¦é™åˆ¶`ï¼‰

  > ```swift
  > passwordTF.isSecureTextEntry.toggle()/// åˆ‡æ¢è¾“å…¥æ¡† æ˜æ–‡/å¯†æ–‡
  > ```

  ```swift
  /// å¯†ç è¾“å…¥æ¡†
  private lazy var tf1: UITextField = {
      UITextField()
          .byDelegate(self) // æ•°æ®æº
          .byPlaceholder("è¯·è¾“å…¥å¯†ç ï¼ˆ6-20 ä½ï¼‰")
          .bySecureTextEntry(true)
          .byInputAccessoryView(UIToolbar().byItems([
              UIBarButtonItem()
                  .byTitle("æ¸…ç©º")
                  .byTitleFont(.systemFont(ofSize: 15))
                  .byTitleColor(.systemRed)
                  .byStyle(.plain)
                  .onTap { [weak self] _ in
                      guard let self = self else { return }   // âœ… ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå®‰å…¨
                      /// TODO
                  },
              UIBarButtonItem(systemItem: .flexibleSpace),
              UIBarButtonItem()
                  .byTitle("å®Œæˆ")
                  .byTitleFont(.systemFont(ofSize: 15))
                  .byTitleColor(.systemYellow)
                  .byStyle(.done)
                  .onTap { [weak self] _ in
                      guard let self = self else { return }   // âœ… ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå®‰å…¨
                      view.endEditing(true)
                  },
          ])
          .bySizeToFit())                                     // âœ… ç»™å¯†ç æ¡†è‡ªå®šä¹‰ inputAccessoryView
          .byBorderStyle(.roundedRect)
          .byReturnKeyType(.done)
          .byTextContentType(.password)
          .byPasswordRules(nil) // ä¹Ÿå¯è‡ªå®šä¹‰
      //            .byLeftView(Self.makeIcon("lock"), mode: .always)
          .byLeftIcon(UIImage(systemName: "lock"),
                      tint: .secondaryLabel,
                      size: .init(width: 18, height: 18),
                      leading: 12, spacing: 8)
          .byRightView(UIButton(type: .system)
                       // æ™®é€šæ–‡å­—ï¼šæœªé€‰ä¸­çŠ¶æ€æ ‡é¢˜
                       .byTitle("æ˜¾ç¤º", for: .normal)
                       // é€‰ä¸­çŠ¶æ€æ ‡é¢˜
                       .byTitle("éšè—", for: .selected)
                       // æ–‡å­—é¢œè‰²ï¼šåŒºåˆ†çŠ¶æ€
                       .byTitleColor(.systemBlue, for: .normal)
                       .byTitleColor(.systemRed, for: .selected)
                       // å­—ä½“ç»Ÿä¸€
                       .byTitleFont(.systemFont(ofSize: 16, weight: .medium))
                       // å›¾æ ‡ï¼ˆSF Symbolï¼‰
                       .byImage(UIImage(systemName: "eye.slash"), for: .normal)   // æœªé€‰ä¸­å›¾æ ‡
                       .byImage(UIImage(systemName: "eye"), for: .selected)       // é€‰ä¸­å›¾æ ‡
                       // å›¾æ–‡å†…è¾¹è·
                       .byContentEdgeInsets(UIEdgeInsets(top: 4, left: 8, bottom: 4, right: 8))
                       // å›¾æ ‡ä¸æ–‡å­—é—´è·
                       .byTitleEdgeInsets(UIEdgeInsets(top: 0, left: 6, bottom: 0, right: -6))
                       // ç‚¹æŒ‰äº‹ä»¶ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
                       .onTap { [weak self] sender in
                           guard let self else { return }
                           sender.isSelected.toggle()
                           // æ–‡å­—ä¸å›¾æ ‡è‡ªåŠ¨åˆ‡æ¢
                           self.passwordTF.isSecureTextEntry.toggle()
                           self.passwordTF.togglePasswordVisibility()
                           print("ğŸ‘ å½“å‰çŠ¶æ€ï¼š\(sender.isSelected ? "éšè—å¯†ç " : "æ˜¾ç¤ºå¯†ç ")")
                       }, mode: .always)
          .byInputView(datePicker) // æ¼”ç¤ºè‡ªå®šä¹‰ inputViewï¼šç‚¹å¯†ç æ¡†å¼¹æ—¥æœŸï¼ˆçº¯å±•ç¤ºï¼Œä¸å»ºè®®çœŸå®é¡¹ç›®è¿™ä¹ˆç”¨ï¼‰
          // é™åˆ¶è¾“å…¥
          .byLimitLength(12) {[weak self] isLimited, tf in
              guard let self else { return }
              tipLabel.byVisible(isLimited)
          }
          .onChange { tf, input, old, isDeleting in
              let new = tf.text ?? ""
              print("âœï¸ input='\(input)' old='\(old)' new='\(new)' deleting=\(isDeleting)")
  
              // ç¤ºä¾‹ï¼š6~20 ä½æœ‰æ•ˆæ€æ ·å¼
              let ok = (6...20).contains(new.count)
              tf.layer.borderWidth = 1
              tf.layer.borderColor = (ok ? UIColor.systemGreen : UIColor.systemRed).cgColor
              tf.layer.masksToBounds = true
              if #available(iOS 13.0, *) { tf.layer.cornerCurve = .continuous }
          }
          .byAddTo(view) { [unowned self] make in
              make.top.equalTo(textField.snp.bottom).offset(12)
              make.centerX.equalToSuperview()
              make.height.equalTo(36)
          }
  }()
  ```

* åŠŸèƒ½æ€§å°è£…

  * ç”¨`textInput`é™å®šè¾“å…¥å­—ç¬¦è¿‡æ»¤æ¡ä»¶ï¼ˆä½†æ˜¯æ²¡æœ‰è®¾ç½®è¾“å…¥é•¿åº¦é™åˆ¶ï¼Œè¾“å…¥é•¿åº¦é™åˆ¶ç”¨`.byLimitLength(5)`ï¼‰

    ```swift
    // MARK: Rx ç»‘å®š â€”â€” å¯†ç ï¼šä¸åšä»»ä½•é™åˆ¶ï¼Œåªæ˜¯ç›‘å¬ï¼ˆä¸è¦ä¼  nilï¼Œç›´æ¥ç”¨é»˜è®¤ï¼‰
    passwordTF.textInput(
        maxLength: 5,
        formatter: { $0.trimmingCharacters(in: .whitespaces) },
        validator: nil
    )
    .isValid
    .subscribe(onNext: { print("ğŸ” password valid:", $0) })
    .disposed(by: rx.disposeBag)
    ```

  * åˆ é™¤æŒ‰é”®çš„ç›‘å¬

    ```swift
    // MARK: ç›‘å¬åˆ é™¤é”®ï¼ˆæ—  .rxï¼‰
    passwordTF.didPressDelete
        .subscribe(onNext: { print("delete pressed") })
        .disposed(by: rx.disposeBag)
    ```

#### 2.12ã€âœï¸`UITextView` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 2.12.1ã€åŸºç¡€æ ·å¼ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var tv: UITextView = { [unowned self] in
    UITextView()
        .byText("è¿™é‡Œå±•ç¤ºåŸºç¡€é“¾å¼è°ƒç”¨ï¼šå­—ä½“ã€é¢œè‰²ã€è¾¹æ¡†ã€å†…è¾¹è·ç­‰ã€‚")
        .byFont(.systemFont(ofSize: 16))
        .byTextColor(.label)
        .byTextAlignment(.left)
        .byEditable(true)
        .bySelectable(true)
        .byTextContainerInset(UIEdgeInsets(top: 8, left: 10, bottom: 8, right: 10))
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .onChange { tv, input, old, isDeleting in
            let new = tv.text ?? ""
            print("âœï¸ input='\(input)' old='\(old)' new='\(new)' deleting=\(isDeleting)")

            // 6~20 æœ‰æ•ˆï¼šç»¿è¾¹ï¼Œå¦åˆ™çº¢è¾¹
            let ok = (6...20).contains(new.count)
            tv.layer.borderWidth = 1
            tv.layer.borderColor = (ok ? UIColor.systemGreen : UIColor.systemRed).cgColor
            tv.layer.masksToBounds = true
            if #available(iOS 13.0, *) { tv.layer.cornerCurve = .continuous }
        }
        .onBackspace { tv in
            print("ğŸ‘ˆ backspace: len=\(tv.text?.count ?? 0)")
        }
        .byAddTo(self.view) { [unowned self] make in
            make.top.equalTo(self.textField.snp.bottom).offset(12)
            make.centerX.equalToSuperview()
            make.height.equalTo(36)
        }
}()
```

##### 2.12.2ã€**é‡‘é¢è¾“å…¥ï¼ˆåªé™å®šæ•°å­—ï¼‰** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private func demo_RxTextInput() {
    addSectionTitle("2ï¸âƒ£ é‡‘é¢è¾“å…¥ï¼ˆformatter + validator + maxLengthï¼‰")

    let tvMoney = UITextView()
        .byFont(.monospacedDigitSystemFont(ofSize: 16, weight: .regular))
        .byKeyboardType(.decimalPad)
        .byTextContainerInset(UIEdgeInsets(top: 6, left: 8, bottom: 6, right: 8))
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byText("123.45")

    stack.addArrangedSubview(tvMoney)
    tvMoney.snp.makeConstraints { $0.height.equalTo(80) }

    tvMoney.textInput(
        maxLength: 12,
        formatter: JobsFormatters.decimal(scale: 2),
        validator: JobsValidators.decimal(min: 0, max: 999_999),
        distinct: true
    )
    .isValid
    .distinctUntilChanged()
    .observe(on: MainScheduler.instance)
    .subscribe(onNext: { ok in
        tvMoney.layer.borderColor = (ok ? UIColor.systemGreen : UIColor.systemRed).cgColor
    })
    .disposed(by: rx.disposeBag)
}
```

##### 2.12.3ã€**æ‰‹æœºå·è¾“å…¥** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private func demo_PhoneInput() {
    addSectionTitle("3ï¸âƒ£ æ‰‹æœºå·è¾“å…¥ï¼ˆ3-4-4 åˆ†ç»„ + 11 ä½æ ¡éªŒï¼‰")

    let tvPhone = UITextView()
        .byFont(.systemFont(ofSize: 16))
        .byKeyboardType(.numberPad)
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byText("13800138000")

    stack.addArrangedSubview(tvPhone)
    tvPhone.snp.makeConstraints { $0.height.equalTo(80) }

    tvPhone.textInput(
        maxLength: 13,
        formatter: JobsFormatters.phoneCN(),
        validator: JobsValidators.phoneCN(),
        distinct: true
    )
    .isValid
    .distinctUntilChanged()
    .observe(on: MainScheduler.instance)
    .subscribe(onNext: { ok in
        tvPhone.layer.borderColor = (ok ? UIColor.systemGreen : UIColor.systemOrange).cgColor
    })
    .disposed(by: rx.disposeBag)
}
```

##### 2.12.4ã€**å¯Œæ–‡æœ¬**å±•ç¤º <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private lazy var tvBlue: UITextView = { [unowned self] in
    return UITextView()
        .byAttributedText(NSMutableAttributedString(
            string: "ğŸ”— é»˜è®¤è“è‰²é“¾æ¥ï¼ˆç³»ç»Ÿæ ·å¼ï¼‰ï¼š",
            attributes: [
                .font: UIFont.systemFont(ofSize: 15),
                .foregroundColor: UIColor.secondaryLabel
            ])
            .add(NSAttributedString(
                string: " Apple å®˜ç½‘",
                attributes: [
                    .link: URL(string: "https://www.apple.com")!,
                    .font: UIFont.boldSystemFont(ofSize: 16)
                ]))
            .add(NSAttributedString(
                string: "\nå®¢æœç”µè¯ï¼š400-123-4567",
                attributes: [.font: UIFont.systemFont(ofSize: 15)]
            )))
        .byEditable(false)
        .bySelectable(true)
        .byDataDetectorTypes([.link, .phoneNumber])   // ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«
        .byTextContainerInset(UIEdgeInsets(top: 8, left: 10, bottom: 8, right: 10))
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byAddTo(self.view) { [unowned self] make in
            make.top.equalTo(self.tv.snp.bottom).offset(12)   // ç´§è·Ÿåœ¨ tv ä¸‹é¢
            make.centerX.equalToSuperview()
            make.height.equalTo(36)
        }
}()
```

##### 2.12.5ã€æŸ¥æ‰¾é«˜äº® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private func demo_Find_Border_WritingTools() {
    addSectionTitle("5ï¸âƒ£ æŸ¥æ‰¾ / é«˜äº® / Writing Tools")
    // æ–‡æœ¬è§†å›¾
    let tvFind = UITextView()
        .byText("""
        æ”¯æŒ iOS16+ çš„æŸ¥æ‰¾ï¼ˆâŒ˜F / æŒ‰é’®è§¦å‘ï¼‰ï¼Œä»¥åŠ iOS17+ çš„ç³»ç»Ÿè¾¹æ¡†æ ·å¼ã€‚
        iOS18+ æ”¯æŒ textHighlightAttributesï¼ˆç”¨äºç³»ç»ŸæŸ¥æ‰¾/å†™ä½œå·¥å…·ç­‰åœºæ™¯ï¼‰ã€‚
        ä¸‹é¢æŒ‰é’®å¯æ‰‹åŠ¨æ‰“å¼€æŸ¥æ‰¾é¢æ¿ï¼Œå¹¶æ¼”ç¤ºé«˜äº®ã€‚
        """)
        .byFont(.systemFont(ofSize: 15))
        .byTextContainerInset(UIEdgeInsets(top: 8, left: 10, bottom: 8, right: 10))
    tvFind.byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
    // iOS16+ å¼€å¯ç³»ç»ŸæŸ¥æ‰¾
    if #available(iOS 16.0, *) {
        tvFind.byFindInteractionEnabled(true)
    }

    // iOS18+ï¼šé…ç½®é«˜äº®é¢œè‰²ï¼ˆåœ¨ç³»ç»Ÿâ€œæŸ¥æ‰¾ç»“æœ/å†™ä½œå·¥å…·â€æ—¶ç”±ç³»ç»Ÿä½¿ç”¨ï¼‰
    if #available(iOS 18.0, *) {
        tvFind.byTextHighlightAttributes([
            .backgroundColor: UIColor.systemYellow.withAlphaComponent(0.35)
        ])
    }

    stack.addArrangedSubview(tvFind)
    tvFind.snp.makeConstraints { $0.height.equalTo(160) }

    // â€”â€”â€” å·¥å…·æŒ‰é’®åŒº â€”â€”â€”
    let btnRow = UIStackView()
        .byAxis(.horizontal)
        .bySpacing(8)
        .byAlignment(.fill)
        .byDistribution(.fillEqually)

    let btnFind  = UIButton(type: .system)
    btnFind.setTitle("æ‰“å¼€æŸ¥æ‰¾é¢æ¿", for: .normal)

    let btnHi    = UIButton(type: .system)
    btnHi.setTitle("æ¨¡æ‹Ÿé«˜äº®â€œiOSâ€", for: .normal)

    let btnClear = UIButton(type: .system)
    btnClear.setTitle("æ¸…é™¤é«˜äº®", for: .normal)

    btnRow.addArrangedSubview(btnFind)
    btnRow.addArrangedSubview(btnHi)
    btnRow.addArrangedSubview(btnClear)
    stack.addArrangedSubview(btnRow)

    // æ‰“å¼€ç³»ç»ŸæŸ¥æ‰¾ UIï¼ˆiOS16+ï¼‰
    if #available(iOS 16.0, *) {
        btnFind.addAction(UIAction { _ in
            tvFind.becomeFirstResponder()
            tvFind.findInteraction?.presentFindNavigator(showingReplace: false)
        }, for: .touchUpInside)
    } else {
        btnFind.isEnabled = false
        btnFind.setTitle("ç³»ç»Ÿç‰ˆæœ¬éœ€ â‰¥ iOS16", for: .normal)
    }

    // æ¨¡æ‹ŸæŠŠâ€œiOSâ€å…¨éƒ¨é«˜äº®ï¼ˆæ¼”ç¤ºæ•ˆæœï¼›ä¸ iOS18 çš„ textHighlightAttributes æ— å†²çªï¼‰
    btnHi.addAction(UIAction { _ in
        let text = tvFind.text as NSString? ?? ""
        let full = NSRange(location: 0, length: text.length)
        let regex = try? NSRegularExpression(pattern: "iOS", options: .caseInsensitive)
        tvFind.textStorage.beginEditing()
        regex?.enumerateMatches(in: text as String, options: [], range: full) { match, _, _ in
            if let r = match?.range {
                tvFind.textStorage.addAttributes(
                    [.backgroundColor: UIColor.systemYellow.withAlphaComponent(0.35)],
                    range: r
                )
            }
        }
        tvFind.textStorage.endEditing()
    }, for: .touchUpInside)

    // æ¸…é™¤æ¨¡æ‹Ÿé«˜äº®
    btnClear.addAction(UIAction { _ in
        let full = NSRange(location: 0, length: (tvFind.text as NSString?)?.length ?? 0)
        tvFind.textStorage.beginEditing()
        tvFind.textStorage.removeAttribute(.backgroundColor, range: full)
        tvFind.textStorage.endEditing()
    }, for: .touchUpInside)
}
```

##### 2.12.6ã€æ•°æ®çš„åŒå‘ç»‘å®š <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private func demo_TwoWayBinding() {
    addSectionTitle("6ï¸âƒ£ åŒå‘ç»‘å®šç¤ºä¾‹ï¼šA â‡„ B â‡„ Relay")

    let tvA = UITextView()
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byFont(.systemFont(ofSize: 16))
        .byText("è¾“å…¥æ¡† A")

    let tvB = UITextView()
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byFont(.systemFont(ofSize: 16))
        .byText("è¾“å…¥æ¡† B")

    stack.addArrangedSubview(tvA)
    tvA.snp.makeConstraints { $0.height.equalTo(80) }
    stack.addArrangedSubview(tvB)
    tvB.snp.makeConstraints { $0.height.equalTo(80) }

    let label = UILabel()
        .byFont(.systemFont(ofSize: 13))
        .byTextColor(.secondaryLabel)
        .byText("Relay: â€”")
    stack.addArrangedSubview(label)

    let relay = BehaviorRelay<String>(value: "Hello Relay")

    let d1 = tvA.bindTwoWay(relay, initial: .fromRelay)
    let d2 = tvB.bindTwoWay(relay, initial: .fromRelay)
    let d3 = relay.asDriver().drive(onNext: { v in label.text = "Relay: \(v)" })

    disposeBag.insert(d1, d2, d3)
}
```

##### 2.12.7ã€**åˆ é™¤é”®ç›‘å¬** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
private func demo_DeleteBackward_Observe() {
    addSectionTitle("7ï¸âƒ£ åˆ é™¤é”®ç›‘å¬")

    let tv = UITextView()
        .byRoundedBorder(color: .systemGray4, width: 1, radius: 8)
        .byFont(.systemFont(ofSize: 16))
        .byText("åˆ é™¤æˆ‘è¯•è¯•çœ‹ ğŸ‘‡")
    stack.addArrangedSubview(tv)
    tv.snp.makeConstraints { $0.height.equalTo(80) }

    let hint = UILabel()
        .byFont(.systemFont(ofSize: 13))
        .byTextColor(.systemPink)
        .byText("âŒ« åˆ é™¤é”®è§¦å‘")
    hint.isHidden = true
    stack.addArrangedSubview(hint)

    tv.didPressDelete
        .observe(on: MainScheduler.instance)
        .subscribe(onNext: {
            hint.isHidden = false
            hint.alpha = 1
            UIView.animate(withDuration: 0.3, delay: 0.8, options: []) {
                hint.alpha = 0
            } completion: { _ in hint.isHidden = true }
        })
        .disposed(by: rx.disposeBag)
}
```

#### 2.13ã€`GKNavigationBarSwift` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
jobsSetupGKNav(
    title: "Demo åˆ—è¡¨",
    leftButton:UIButton.sys()
        .byFrame(CGRect(x: 0, y: 0, width: 32.w, height: 32.h))
        /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
        .byImage("list.bullet".sysImg, for: .normal)
        .byImage("list.bullet".sysImg, for: .selected)
        /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
        .onTap { [weak self] sender in
            guard let self else { return }
            sender.isSelected.toggle()
            debugOnly {  // ä»… Debug æ‰§è¡Œ
                JobsToast.show(
                    text: "ç‚¹æŒ‰äº†åˆ—è¡¨æŒ‰é’®",
                    config: JobsToast.Config()
                        .byBgColor(.systemGreen.withAlphaComponent(0.9))
                        .byCornerRadius(12)
                )
            }
        }
        /// äº‹ä»¶è§¦å‘@é•¿æŒ‰
        .onLongPress(minimumPressDuration: 0.8) { btn, gr in
             if gr.state == .began {
                 btn.alpha = 0.6
                 print("é•¿æŒ‰å¼€å§‹ on \(btn)")
             } else if gr.state == .ended || gr.state == .cancelled {
                 btn.alpha = 1.0
                 print("é•¿æŒ‰ç»“æŸ")
             }
        },
    rightButtons: [
        UIButton.sys()
            /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
            .byImage("moon.circle.fill".sysImg, for: .normal)
            .byImage("moon.circle.fill".sysImg, for: .selected)
            /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
            .onTap { [weak self] sender in
                guard let self else { return }
                sender.isSelected.toggle()
                guard let ws = UIApplication.shared.connectedScenes.first as? UIWindowScene,
                      let win = ws.windows.first else { return }
                win.overrideUserInterfaceStyle =
                    (win.overrideUserInterfaceStyle == .dark) ? .light : .dark
                print("ğŸŒ“ ä¸»é¢˜å·²åˆ‡æ¢ -> \(win.overrideUserInterfaceStyle == .dark ? "Dark" : "Light")")
            },
        UIButton.sys()
            /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
            .byImage("globe".sysImg, for: .normal)
            .byImage("globe".sysImg, for: .selected)
            /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
            .onTap { [weak self] sender in
                guard let self else { return }
                sender.isSelected.toggle()
                print("ğŸŒ åˆ‡æ¢è¯­è¨€ tappedï¼ˆå ä½ï¼‰")
            },
        UIButton.sys()
            /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
            .byImage("stop.circle.fill".sysImg, for: .normal)
            .byImage("stop.circle.fill".sysImg, for: .selected)
            /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
            .onTap { [weak self] sender in
                guard let self else { return }
                sender.isSelected.toggle()
                print("ğŸ›‘ æ‰‹åŠ¨åœæ­¢åˆ·æ–°")
                isPullRefreshing = false
                isLoadingMore    = false
                tableView.pullDownStop()
                tableView.pullUpStop()
            }
    ]
)
```

#### 2.14ã€ğŸ‘‹ æ‰‹åŠ¿çš„å°è£…ï¼ˆä½¿ç”¨ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å› ä¸ºæ‰‹åŠ¿åªèƒ½æ·»åŠ åˆ°**UIView**åŠå…¶å­ç±»ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹**UIView**è¿›è¡Œæ‰©å……

* **é“¾å¼è°ƒç”¨**

  * ç›´æ¥è®¾ç½®æ‰‹åŠ¿ï¼ˆæœªé”šå®šè§†å›¾ï¼‰

    * Tapï¼ˆç‚¹å‡»ï¼‰

      ```swift
      // MARK: - ç‚¹å‡» Tap
      UIView().jobs_addGesture(
          UITapGestureRecognizer
              .byConfig { gr in
                  print("Tap è§¦å‘ on: \(String(describing: gr.view))")
              }
              .byTaps(2)                       // åŒå‡»
              .byTouches(1)                    // å•æŒ‡
              .byCancelsTouchesInView(true)
              .byEnabled(true)
              .byName("customTap")
      )
      ```

      ```swift
      final class DemoInnerView: UIView {
          override init(frame: CGRect) {
              super.init(frame: frame)
      
              isUserInteractionEnabled = true
              jobs_addGesture(
                  UITapGestureRecognizer
                      .byConfig { gr in
                          DemoDetailVC()
                              .byData(DemoModel(id: 7, title: "è¯¦æƒ…"))
                              .onResult { id in
                                  print("å›æ¥äº† id=\(id)")
                              }
                              .byPush(self)           // è‡ªå¸¦é˜²é‡å…¥ï¼Œè¿ç‚¹ä¸é‡å¤
                      }
              )
          }
      
          required init?(coder: NSCoder) {
              fatalError("init(coder:) has not been implemented")
          }
      }
      ```

    * é•¿æŒ‰ LongPress

      ```swift
      // MARK: - é•¿æŒ‰ LongPress
      UIView().addGestureRecognizer(
          UILongPressGestureRecognizer
              .byConfig { gr in
                  if gr.state == .began {
                      print("é•¿æŒ‰å¼€å§‹")
                  } else if gr.state == .ended {
                      print("é•¿æŒ‰ç»“æŸ")
                  }
              }
              .byMinDuration(0.8)              // æœ€å°æŒ‰å‹æ—¶é•¿
              .byMovement(12)                  // å…è®¸ç§»åŠ¨è·ç¦»
              .byTouches(1)                    // å•æŒ‡
      )
      ```

    * æ‹–æ‹½ Pan

      ```swift
      // MARK: - æ‹–æ‹½ Pan
      UIView().jobs_addGesture(
          UIPanGestureRecognizer
              .byConfig { gr in
                  let p = (gr as! UIPanGestureRecognizer).translation(in: gr.view)
                  if gr.state == .changed {
                      print("æ‹–æ‹½ä¸­: \(p)")
                  } else if gr.state == .ended {
                      print("æ‹–æ‹½ç»“æŸ")
                  }
              }
              .byMinTouches(1)
              .byMaxTouches(2)
              .byCancelsTouchesInView(true)
      )
      ```

    * è½»æ‰« Swipeï¼ˆå•æ–¹å‘ï¼‰

      ```swift
      // MARK: - è½»æ‰« Swipeï¼ˆå•æ–¹å‘ï¼‰
      UIView().jobs_addGesture(
          UISwipeGestureRecognizer
              .byConfig { _ in
                  print("ğŸ‘‰ å³æ»‘è§¦å‘")
              }
              .byDirection(.right)
              .byTouches(1)
      )
      ```

    * è½»æ‰« Swipeï¼ˆå¤šæ–¹å‘ï¼‰

      ```swift
      // MARK: - è½»æ‰« Swipeï¼ˆå¤šæ–¹å‘ï¼‰
      let swipeContainer = UIView()
      swipeContainer.jobs_addGesture(
          UISwipeGestureRecognizer
              .byConfig { _ in print("â† å·¦æ»‘") }
              .byDirection(.left)
      )
      swipeContainer.jobs_addGesture(
          UISwipeGestureRecognizer
              .byConfig { _ in print("â†’ å³æ»‘") }
              .byDirection(.right)
      )
      swipeContainer.jobs_addGesture(
          UISwipeGestureRecognizer
              .byConfig { _ in print("â†‘ ä¸Šæ»‘") }
              .byDirection(.up)
      )
      swipeContainer.jobs_addGesture(
          UISwipeGestureRecognizer
              .byConfig { _ in print("â†“ ä¸‹æ»‘") }
              .byDirection(.down)
      )
      ```

    * æåˆ Pinch

      ```swift
      // MARK: - æåˆ Pinch
      UIView().jobs_addGesture(
          UIPinchGestureRecognizer
              .byConfig { _ in }
              .byOnScaleChange { gr, scale in
                  if gr.state == .changed {
                      print("ç¼©æ”¾æ¯”ä¾‹: \(scale)")
                  }
              }
              .byScale(1.0)
      )
      ```

    * æ—‹è½¬ Rotate

      ```swift
      // MARK: - æ—‹è½¬ Rotate
      UIView().jobs_addGesture(
          UIRotationGestureRecognizer
              .byConfig { _ in }
              .byOnRotationChange { gr, r in
                  if gr.state == .changed {
                      print("æ—‹è½¬è§’åº¦(å¼§åº¦): \(r)")
                  }
              }
              .byRotation(0)
      )
      ```

  * ç›´æ¥è®¾ç½®æ‰‹åŠ¿ï¼ˆå·²é”šå®šè§†å›¾ï¼‰

    ```swift
    let views = UIView()
        .addTapAction { gr in
            print("ç‚¹å‡» \(gr.view!)")
        }
        .addLongPressAction { gr in
            if gr.state == .began { print("é•¿æŒ‰å¼€å§‹") }
        }
        .addPanAction { gr in
            let p = (gr as! UIPanGestureRecognizer).translation(in: gr.view)
            print("æ‹–æ‹½ä¸­: \(p)")
        }
        .addPinchAction { gr in
            let scale = (gr as! UIPinchGestureRecognizer).scale
            print("ç¼©æ”¾æ¯”ä¾‹ï¼š\(scale)")
        }
        .addRotationAction { gr in
            let rotation = (gr as! UIRotationGestureRecognizer).rotation
            print("æ—‹è½¬è§’åº¦ï¼š\(rotation)")
        }
    ```

* <font color=red>åœ¨å·²æœ‰çš„æ‰‹åŠ¿è§¦å‘äº‹ä»¶é‡Œé¢æ–°å¢æ‰‹åŠ¿è¡Œä¸ºï¼š`byAction`</font>

  ```swift
  UIView().jobs_addGesture(UISwipeGestureRecognizer()
      .byDirection(.left)
      .byAction { gr in print("å·¦æ»‘ \(gr.view!)") })
  ```

* **å¤šä¸ªæ–¹å‘çš„ swipe å¹¶å­˜**

  ```swift
  // åŒä¸€ view ä¸ŠåŒæ—¶æ·»åŠ å››ä¸ªæ–¹å‘çš„ swipe
  let idL = view.addSwipeActionMulti(direction: .left)  { gr in print("â†") }
  let idR = view.addSwipeActionMulti(direction: .right) { gr in print("â†’") }
  let idU = view.addSwipeActionMulti(direction: .up)    { gr in print("â†‘") }
  let idD = view.addSwipeActionMulti(direction: .down)  { gr in print("â†“") }
  
  // æŒ‡å®š idï¼Œæ–¹ä¾¿é“¾å¼ä¸ç®¡ç†
  view.addSwipeActionMulti(use: "swipe.left", direction: .left) { _ in }
      .addSwipeActionMulti(use: "swipe.right", direction: .right) { _ in }
  
  // ç²¾ç¡®ç§»é™¤æŸä¸€ä¸ª
  view.removeSwipeActionMulti(id: idL)
  // æˆ–æ‰¹é‡ç§»é™¤è¯¥ç±»æ‰‹åŠ¿
  view.removeAllSwipeActionsMulti()
  ```

#### 2.15ã€<font id=UIAlertController>`UIAlertController`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ

  ```swift
  // MARK: æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeAlert("æç¤º", "è¿™æ˜¯ä¸€æ¡ç®€å•æç¤º")
          .byAddCancel { [weak self] _ in
              guard let self else { return }
              print("Cancel")
              // TODO: è¿™é‡Œå†™ä½ çš„å–æ¶ˆé€»è¾‘
          }
          .byAddOK { [weak self] _ in
              guard let self else { return }
              print("OK")
              // TODO: è¿™é‡Œå†™ä½ çš„ç¡®è®¤é€»è¾‘
          }
  }()
  ```

* æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ

  ```swift
  // MARK: æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeAlert("é‡å‘½å", "è¯·è¾“å…¥æ–°çš„åç§°")
  //        .bySDBgImageView("https://picsum.photos/800/600",
  //                         image: "å”è€é¸­".img,
  //                         hideSystemBackdrop: true)
  //        .byKFBgImageView("https://picsum.photos/800/600",
  //                         image: "å”è€é¸­".img,
  //                         hideSystemBackdrop: true)
          .byBgImage("å”è€é¸­".img)                      // æœ¬åœ°å›¾èƒŒæ™¯ï¼ˆåŒæ­¥é˜¶æ®µï¼Œæ— åŠ¨ç”»ï¼‰
          .byCardBorder(width: 1, color: .systemBlue)   // å¤–å±‚å¡ç‰‡æè¾¹
          .byAddTextField(placeholder: "æ–°åç§°",
                          borderWidth: nil,             // â† ä¸ç»™ tf è‡ªèº«æè¾¹
                          borderColor: nil,
                          cornerRadius: 8) { alert, tf, input, oldText, isDeleting in
              let ok = alert.actions.first { $0.title == "ç¡®å®š" }
              ok?.isEnabled = !(tf.text ?? "").trimmingCharacters(in: .whitespacesAndNewlines).isEmpty
          }
          .byTextFieldOuterBorder(at: 0, width: 1, color: .systemBlue, cornerRadius: 10, insets: .init(top: 6, left: 12, bottom: 6, right: 12)) // â† ç»™ç°è‰²å®¹å™¨æè¾¹
          .byAddCancel { _ in                          // âœ… ä¸€ä¸ªå›è°ƒï¼ˆåªç»™ actionï¼‰
              print("Cancel tapped")
          }
          .byAddOK{ alert, _ in                 // éœ€è¦ alert + action çš„å›è°ƒ
              let name = alert.textField(at: 0)?.text ?? ""
              print("new name =", name)
          }
          .byTintColor(.systemBlue)
          .byPresent(self)
  }()
  ```

* ä¸»æ ‡é¢˜ + ç›¸æœº_ç›¸å†Œ_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + å±å¹•åº•éƒ¨å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ

  ```swift
  // MARK: ä¸»æ ‡é¢˜ + ç›¸æœº_ç›¸å†Œ_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + å±å¹•åº•éƒ¨å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeActionSheet("é€‰æ‹©æ¥æº", nil)
          .byAddAction(title: "ç›¸æœº") { _ in
              print("camera")
          }
          .byAddAction(title: "ç›¸å†Œ") { _ in
              print("photos")
          }
          .byAddCancel { _ in
              print("Cancel tapped")
          }
          .byPresent(self)
  }()
  ```

* ä¸»æ ‡é¢˜ + åˆ é™¤_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä»æŒ‰é’®è‡ªèº«ä½ç½®ï¼ˆé”šç‚¹ï¼‰å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ

  ```swift
  // MARK: ä¸»æ ‡é¢˜ + åˆ é™¤_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä»æŒ‰é’®è‡ªèº«ä½ç½®ï¼ˆé”šç‚¹ï¼‰å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeActionSheet("æ“ä½œ", nil)
          .byAddDestructive("åˆ é™¤") { _ in
              print("delete")
          }
          .byAddCancel { _ in
              print("Cancel tapped")
          }
          .byPresent(self, anchor: .view(sender, sender.bounds)) // æŒ‡å®šé”šç‚¹
  }()
  ```

### 3ã€ğŸ“ è®¾å¤‡å°ºå¯¸ç›¸å…³ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 3.1ã€ğŸ“ [æŒ‰æ¯”ä¾‹ï¼ˆé»˜è®¤æ¯”ä¾‹1ï¼‰è·å–å±å¹•å®½é«˜@å…¼å®¹è®¾å¤‡æ¨ªç«–å±](#è·å–å±å¹•å°ºå¯¸@å®ç°é€»è¾‘) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
let w = ScreenWidth()
let h = ScreenHeight()
```

#### 3.2ã€ğŸ“ [**å…¨å±€æ¯”ä¾‹å°º**](#å…¨å±€æ¯”ä¾‹å°º@å®ç°é€»è¾‘) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å…¥å£é…ç½®

  ```swift
  import UIKit
  
  @main
  class AppDelegate: UIResponder, UIApplicationDelegate {
  
      func application(
          _ application: UIApplication,
          didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
      ) -> Bool {
          JXScale.setup(designWidth: 375, designHeight: 812, useSafeArea: false)
          return true
      }
  
      // MARK: UISceneSession Lifecycle
      func application(
          _ application: UIApplication,
          configurationForConnecting connectingSceneSession: UISceneSession,
          options: UIScene.ConnectionOptions
      ) -> UISceneConfiguration {
          return UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
      }
  }
  ```

* è°ƒç”¨

  ```swift
  CGRect(x: 20.w, y: 100.h, width: 200.w, height: 40.h)
  ```

### 4ã€ğŸ–¨ï¸ æ—¥å¿—æ‰“å°å·¥å…·çš„å°è£…ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ—¶é—´+æ–‡ä»¶å…¨å+å½“å‰çš„æ‰“å°è§¦å‘è¡Œæ•°+å½“å‰æ‰€åœ¨æ–¹æ³•å+é¡¶å±‚main+å…·ä½“çš„æ‰“å°å†…å®¹

```swift
// MARK: - æ‰“å°ç¤ºä¾‹
private func printDemo() {
    // 1) æ™®é€šæ–‡æœ¬ / å‚æ•°æ··åˆ
    log("ä½ å¥½ï¼Œä¸–ç•Œ", 123, true)
    // 2) JSONï¼šè‡ªåŠ¨è¯†åˆ« String/Data/å­—å…¸/æ•°ç»„ï¼ˆé»˜è®¤ pretty + ä¸­æ–‡è¿˜åŸï¼‰
    log(#"{"key":"\u7231\u60c5"}"#)                 // String JSON
    log(["user": "å¼ ä¸‰", "tags": ["iOS","Swift"]])  // å­—å…¸/æ•°ç»„
    log(DataFromNetwork(
        statusCode: 200,
        message: "OK",
        url: URL(string: "https://api.example.com/users")!,
        headers: ["Content-Type": "application/json"],
        body: #"{"user":"\u5f20\u4e09","tags":["iOS","Swift"],"ok":true}"#.data(using: .utf8),
        receivedAt: Date(),
        retryable: false
    ))                            // Data
    // 3) å¯¹è±¡ï¼šè‡ªåŠ¨åå°„ä¸º JSONï¼ˆé˜²ç¯ã€å¯æ§æ·±åº¦ï¼‰
    struct User { let id: Int; let name: String }
    let u = User(id: 1, name: "å¼ ä¸‰")
    log(u)                      // .auto ä¸‹ä¼šè½¬å¯¹è±¡ JSON
    log(u, mode: .object)       // å¼ºåˆ¶å¯¹è±¡æ¨¡å¼ï¼ˆä¸èµ° stringifyï¼‰
    // 4) æŒ‡å®šçº§åˆ«ï¼ˆä»æ˜¯ä¸€ä¸ªå…¥å£ï¼‰
    log("å¯åŠ¨å®Œæˆ", level: .info)
    log("æ¥å£æ…¢",  level: .warn)
    log(["err": "timeout"], level: .error)
    log(["arr": ["\\u7231\\u60c5", 1]], level: .debug)
}
```

> ```swift
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:97 | printDemo() | main â†’ ä½ å¥½ï¼Œä¸–ç•Œ 123 true
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:99 | printDemo() | main â†’ {
>   "key" : "çˆ±æƒ…"
> }
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:100 | printDemo() | main â†’ {
>   "user" : "å¼ ä¸‰",
>   "tags" : [
>     "iOS",
>     "Swift"
>   ]
> }
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:101 | printDemo() | main â†’ {
>   "_type" : "DataFromNetwork",
>   "_props" : {
>     "body" : {
>       "<Data>" : 56
>     },
>     "statusCode" : 200,
>     "headers" : {
>       "Content-Type" : "application\/json"
>     },
>     "url" : "https:\/\/api.example.com\/users",
>     "message" : "OK",
>     "receivedAt" : "2025-10-03T03:16:56Z",
>     "retryable" : false
>   }
> }
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:113 | printDemo() | main â†’ {
>   "_props" : {
>     "name" : "å¼ ä¸‰",
>     "id" : 1
>   },
>   "_type" : "User"
> }
> ğŸ“ 10:16:56 | CNIDDemoVC.swift:114 | printDemo() | main â†’ {
>   "_props" : {
>     "name" : "å¼ ä¸‰",
>     "id" : 1
>   },
>   "_type" : "User"
> }
> â„¹ï¸ 10:16:56 | CNIDDemoVC.swift:116 | printDemo() | main â†’ å¯åŠ¨å®Œæˆ
> âš ï¸ 10:16:56 | CNIDDemoVC.swift:117 | printDemo() | main â†’ æ¥å£æ…¢
> âŒ 10:16:56 | CNIDDemoVC.swift:118 | printDemo() | main â†’ {
>   "err" : "timeout"
> }
> ğŸ 10:16:56 | CNIDDemoVC.swift:119 | printDemo() | main â†’ {
>   "arr" : [
>     "çˆ±æƒ…",
>     1
>   ]
> }
> ```

### 5ã€é¿å…ä» `XIB`/`Storyboard` åˆå§‹åŒ– <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
required init?(coder: NSCoder) {
    fatalError()
}
```

### 6ã€ğŸ–¼ï¸ <font color=red>**ä½¿ç”¨`Color Set`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é€‰ä¸­å›¾ç‰‡ä»¥åï¼Œè·³åˆ°ç¬¬å››ä¸ªé€‰é¡¹å¡

  ```swift
  if #available(iOS 11.0, *) {
      UIColor(named: "TextColor0")
  }
  ```

  <p align="center">
    <img src="./assets/image-20250924174836800.png" width="20%"/>
    <img src="./assets/image-20250924175446796.png" width="60%"/>
  </p>

* æ”¯æŒæš—é»‘æ¨¡å¼

  > Darkä¼˜å…ˆçº§é«˜ä¸€äº›ï¼Œå¦‚æœåœ¨Darké‡Œé¢æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å›¾ç‰‡ï¼Œä¼šå»Anyæ‰¾
  >
  > ```swift
  > self.nameLabel.textColor = .textColor1// ä»£ç é‡Œé¢åªå¯¹åº”ä¸€ä¸ªå€¼ã€‚ä½†æ˜¯åœ¨textColor1è¿™ä¸ªèµ„æºåŒ…é‡Œé¢åŒºåˆ† ç™½å¤©/é»‘å¤œ
  > ```

![image-20251001161600357](./assets/image-20251001161600357.png)

### 7ã€ç½‘ç»œé‰´æƒ`Code`çš„å°è£… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> - `r0.code` æ˜¯ `Int?`
>
> - `JXAuthCode.tokenEmpty` æ˜¯ä¸€ä¸ª **æšä¸¾å€¼ (`JXAuthCode`)**
>
> - [**Swift**](https://developer.apple.com/swift/) ä¸å…è®¸ç›´æ¥æ¯”è¾ƒ `Int` å’Œ `JXAuthCode`ã€‚
>
>   ```swift
>   if r0.code == JXAuthCode.tokenEmpty.rawValue
>       || r0.code == JXAuthCode.tokenInvalid.rawValue
>       || r0.code == JXAuthCode.loginExpired.rawValue
>       || r0.code == JXAuthCode.authorizationFail.rawValue {
>       print("éœ€è¦é‡æ–°ç™»å½•")
>   }
>   ```

* å®šä¹‰å°è£…

  ```swift
  // MARK: -ç½‘ç»œé‰´æƒ
  public enum JXAuthCode: UInt {
      case tokenEmpty        = 10006  // ä»¤ç‰Œä¸ºç©º
      case tokenInvalid      = 10007  // ä»¤ç‰Œé”™è¯¯
      case loginExpired      = 10008  // ç™»é™†è¿‡æœŸ
      case authorizationFail = 10014  // æˆæƒå¤±è´¥
      case success           = 10000  // æˆåŠŸ
  }
  ```

  ```swift
  // MARK: - æ‰©å±• Int ä¸ JXAuthCode çš„æ¯”è¾ƒã€‚é¿å…å†™rawValue
  public func ==(lhs: Int?, rhs: JXAuthCode) -> Bool {
      guard let lhs = lhs else { return false }
      return lhs == Int(rhs.rawValue)
  }
  
  public func ==(lhs: Int, rhs: JXAuthCode) -> Bool {
      return lhs == Int(rhs.rawValue)
  }
  
  public func ==(lhs: JXAuthCode, rhs: Int?) -> Bool {
      guard let rhs = rhs else { return false }
      return Int(lhs.rawValue) == rhs
  }
  
  public func ==(lhs: JXAuthCode, rhs: Int) -> Bool {
      return Int(lhs.rawValue) == rhs
  }
  
  // MARK: - æ‰©å±• Int ä¸ JXAuthCode çš„ä¸ç­‰äº
  public func !=(lhs: Int?, rhs: JXAuthCode) -> Bool {
      !(lhs == rhs)
  }
  
  public func !=(lhs: Int, rhs: JXAuthCode) -> Bool {
      !(lhs == rhs)
  }
  
  public func !=(lhs: JXAuthCode, rhs: Int?) -> Bool {
      !(lhs == rhs)
  }
  
  public func !=(lhs: JXAuthCode, rhs: Int) -> Bool {
      !(lhs == rhs)
  }
  ```

* ä½¿ç”¨

  ```swift
  if (r0.code == JXAuthCode.tokenEmpty // ä»¤ç‰Œä¸ºç©º
   || r0.code == 10007 // ä»¤ç‰Œé”™è¯¯
   || r0.code == 10008 // ç™»é™†è¿‡æœŸ
   || r0.code == 10056
   || r0.code == 10014)// æˆæƒå¤±è´¥
  {/*TODO*/}
  ```



### 8ã€å¯Œæ–‡æœ¬çš„å°è£…ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 8.1ã€è®¾ç½®å¯Œæ–‡æœ¬ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  UILabel().richTextBy(runs, paragraphStyle: ps)
  ```

* ```swift
  UITextView().richTextBy(runs, paragraphStyle: ps)
  ```

* ```swift
  UITextField().richTextBy(runs, paragraphStyle: ps)
  ```

#### 8.2ã€å¯Œæ–‡æœ¬å½¢å¼ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¸‹åˆ’çº¿

  ```swift
  // æ®µè½æ ·å¼
  let ps = jobsMakeParagraphStyle {
      $0.alignment = .center
      $0.lineSpacing = 6
  }
  // å¯Œæ–‡æœ¬é…ç½®æ•°ç»„
  let runs: [JobsRichRun] = [
      JobsRichRun(.text("æ¬¢è¿ä½¿ç”¨ "))
          .font(.systemFont(ofSize: 18))
          .color(.secondaryLabel),
  
      JobsRichRun(.text("JobsRichText "))
          .font(.boldSystemFont(ofSize: 18))
          .color(.systemBlue)
          .underline(.single, color: .systemBlue),
  
      JobsRichRun(.text("å°è£…ç¤ºä¾‹"))
          .font(.systemFont(ofSize: 18))
          .strike(.single, color: .systemRed)
  ]
  ```

* è¶…é“¾æ¥

  ```swift
  let ps = jobsMakeParagraphStyle {
      $0.alignment = .center
      $0.lineSpacing = 4
  }
  
  let runs: [JobsRichRun] = [
      JobsRichRun(.text("å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³» "))
          .font(.systemFont(ofSize: 15))
          .color(.secondaryLabel),
  
      JobsRichRun(.text("ä¸“å±å®¢æœ"))
          .font(.systemFont(ofSize: 15))
          .color(.systemBlue)
          .link("click://customer")
  ]
  ```

  > <font color=red>**å¯Œæ–‡æœ¬çš„ç‚¹å‡»äº‹ä»¶å¤„ç†**</font>
  >
  > * åˆ©ç”¨ **`UITextViewDelegate`** å¤„ç†ç‚¹å‡»äº‹ä»¶
  >
  >   ```swift
  >   extension RichTextDemoVC: UITextViewDelegate {
  >       // MARK: âœ… iOS17+ æ–° API
  >       @available(iOS 17.0, *)
  >       func textView(_ textView: UITextView,
  >                     textItemMenuConfiguration configuration: UITextItem.MenuConfiguration,
  >                     for textRange: UITextRange,
  >                     point: CGPoint) -> UITextItem.MenuConfiguration? {
  >           // å¯è‡ªå®šä¹‰èœå•è¡Œä¸ºï¼ˆå¤åˆ¶/æ‰“å¼€/åˆ†äº«ï¼‰
  >           return configuration
  >       }
  >   
  >       @available(iOS 17.0, *)
  >       func textView(_ textView: UITextView,
  >                     primaryActionFor textItem: UITextItem) -> UIAction? {
  >   
  >           switch textItem.content {
  >           case .link(let url):
  >               if url.scheme == "click" {
  >                   print("ç‚¹å‡»äº‹ä»¶")
  >                   // è¿”å› nil è¡¨ç¤ºä¸æ‰§è¡Œç³»ç»Ÿé»˜è®¤è¡Œä¸º
  >                   return nil
  >               }
  >               return nil
  >   
  >           default:
  >               // é link ç±»å‹çš„å†…å®¹ï¼Œä¿æŒé»˜è®¤
  >               return nil
  >           }
  >       }
  >       // MARK: âœ… iOS16 åŠä»¥ä¸‹æ—§ API
  >       @available(iOS, introduced: 10.0, deprecated: 17.0, message: "Use textView(_:primaryActionFor:) on iOS17+ instead")
  >       func textView(_ textView: UITextView,
  >                     shouldInteractWith URL: URL,
  >                     in characterRange: NSRange,
  >                     interaction: UITextItemInteraction) -> Bool {
  >           if URL.scheme == "click" {
  >               print("ç‚¹å‡»äº‹ä»¶")
  >               return false
  >           }
  >           return true
  >       }
  >   }
  >   ```
  >
  > * åˆ©ç”¨ [**RxSwift**](https://github.com/ReactiveX/RxSwift)/[**RxCocoa**](https://github.com/ReactiveX/RxSwift) å¤„ç†ç‚¹å‡»äº‹ä»¶
  >
  >   ```swift
  >   // ğŸ”¹è®¢é˜…ç‚¹å‡»ï¼ˆRACé£æ ¼ï¼‰
  >   textView.linkTap
  >           .observe(on: MainScheduler.instance)
  >           .subscribe(onNext: { [weak self] url in
  >               guard let self else { return }
  >               if url.scheme == "click" {
  >                   self.presentAlert(for: url.absoluteString)
  >               }
  >           })
  >           .disposed(by: disposeBag)
  >   ```

* å¯Œæ–‡æœ¬@å›¾

  ```swift
  // å›¾æ ‡é™„ä»¶
  let config = UIImage.SymbolConfiguration(pointSize: 16, weight: .medium)
  let image = UIImage(systemName: "paperclip", withConfiguration: config)!
  let att = NSTextAttachment()
  att.image = image
  
  let ps = jobsMakeParagraphStyle {
      $0.alignment = .center
      $0.lineSpacing = 2
  }
  
  let runs: [JobsRichRun] = [
      JobsRichRun(.attachment(att, CGSize(width: 16, height: 16))),
      JobsRichRun(.text("  é™„ä»¶è¯´æ˜"))
          .font(.systemFont(ofSize: 15))
          .color(.secondaryLabel)
  ]
  ```

### 9ã€<font id=å¼±å¼•ç”¨çš„ç­‰ä»·å†™æ³•>**å¼±å¼•ç”¨çš„ç­‰ä»·å†™æ³•**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  guard let `self` = self else { return }
  ```

  * ä¼ ç»Ÿå†™æ³•ï¼Œ[ç”¨äº†åå¼•å· ``self``ï¼ŒæŠŠå…³é”®å­— <font color=red>**`self`**</font> å½“ä½œå¸¸é‡åï¼Œé¿å¼€å…³é”®å­—å†²çª](#swiftå…³é”®å­—ç”¨ä½œå˜é‡å) 

  * å®é™…æ„ä¹‰ï¼š

    ```swift
    if let tmp = self {
        let `self` = tmp   // ä¸´æ—¶å¼ºå¼•ç”¨
    } else {
        return
    }
    ```

  * åç»­ç”¨çš„å°±æ˜¯æ–°çš„å¼ºå¼•ç”¨ `self`

* ```swift
  someAsync { [weak self] in
      self?.doSomething()// æ¯æ¬¡éƒ½è¦å†™ ?ï¼Œå¦‚æœè¦è°ƒç”¨å¤šè¡Œé€»è¾‘å°±ä¼šå¾ˆå•°å—¦ã€‚
  }
  ```

* ```swift
  guard let self else { return }
  ```

  * [**Swift**](https://developer.apple.com/swift/) 5.7+ ç®€å†™å†™æ³•ï¼Œæ›´ç®€æ´

  * ç›¸å½“äº

    ```swift
    guard let self = self else { return }
    ```

  * ç¼–è¯‘å™¨è‡ªåŠ¨æŠŠå³è¾¹çš„ `self` å½“ä½œå¯é€‰ï¼ˆ`Self?`ï¼‰ï¼Œå·¦è¾¹çš„ `self` å½“ä½œæ–°çš„è§£åŒ…å¸¸é‡ã€‚

* ```swift
  guard let strongSelf = self else { return }
  ```

  * å…¼å®¹**Objc**çš„ä»£ç é£æ ¼
  * å‘½åä¸åŒï¼Œè¯»èµ·æ¥æ›´ç›´è§‚ï¼Œé¿å…å…³é”®å­—æ··æ·†
  * åç»­ç”¨`strongSelf`

* æ¨¡å¼åŒ¹é…

  ```swift
  someAsync { [weak self] in
      guard case let self? = self else { return }
      self.doSomething()
  }
  ```

* æ›´å‡½æ•°å¼

  > å¯è¯»æ€§å·®ï¼Œä¸å¸¸è§ã€‚

  ```swift
  someAsync { [weak self] in
      self.map { $0.doSomething() }// è¿™é‡Œ self æ˜¯ Optionalï¼Œç”¨ map åªåœ¨æœ‰å€¼æ—¶æ‰§è¡Œã€‚
  }
  ```

### 10ã€å¯¹é€šçŸ¥åçš„å°è£… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  import Foundation
  /// é€šçŸ¥åˆ†ç±»
  extension Notification.Name {
      /// ç”¨æˆ·ç™»é™†
      static let userDidLogin = Notification.Name("userDidLogin")
      /// è·³è½¬åœ¨çº¿å®¢æœé€šçŸ¥
      static let pushOnlineCustomerService = Notification.Name("pushOnlineCustomerService")
  }
  ```

  > ```swift
  > Notification.Name.userDidLogin
  > NotificationCenter.default.post(name: .userDidLogin, object: nil)
  > ```

* ```swift
  import Foundation
  /// é€šçŸ¥åˆ†ç±»
  extension Notification {
      struct Jobs {
      /// ç”¨æˆ·ç™»é™†
      static let userDidLogin = Notification.Name("userDidLogin")
      /// è·³è½¬åœ¨çº¿å®¢æœé€šçŸ¥
      static let pushOnlineCustomerService = Notification.Name("pushOnlineCustomerService")
      }
  }
  ```

  > ```swift
  > Notification.Jobs.userDidLogin
  > NotificationCenter.default.post(name: .userDidLogin, object: nil)
  > ```

### 11ã€<font id=å›è°ƒä¸»çº¿ç¨‹>å›è°ƒä¸»çº¿ç¨‹ï¼ˆ2å¤§æ‰‹æ®µï¼‰</font><a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è‹¥è°ƒç”¨ç‚¹æœ¬èº«åœ¨ä¸»çº¿ç¨‹ï¼š**ç«‹å³**æ‰§è¡Œï¼ˆä¸å»¶è¿Ÿï¼‰ã€‚è‹¥è°ƒç”¨ç‚¹ä¸åœ¨ä¸»çº¿ç¨‹/ä¸åœ¨ä¸» Actorï¼šéœ€è¦ä¸€æ¬¡**actor hop**ï¼Œé€šå¸¸è¦æ±‚ `await` æ‰èƒ½è°ƒç”¨ã€‚
>
> ```swift
> /// è¿™ä¸ªå‡½æ•°å¿…é¡»åœ¨ä¸»çº¿ç¨‹è¿è¡Œ
> /// ä¸»çº¿ç¨‹éš”ç¦»çš„å£°æ˜
> @MainActor
> func updateUI() {
>     // UI æ›´æ–°
> }
> ```

#### 11.1ã€**C.GCDç³»åˆ—**@ä¼ ç»Ÿè½»é‡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **GCD çš„åº•å±‚å®ç°** â†’ åœ¨ **`libdispatch`** é‡Œï¼ˆC è¯­è¨€åº“ï¼‰ï¼Œå±äº **Darwin** ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†
>
> 2ï¸âƒ£ **åœ¨ iOS / macOS ä¸Š** â†’ GCD æ˜¯ **ç³»ç»Ÿçº§ API**ï¼Œä¸æ˜¯ `Foundation` æä¾›çš„
>
> 3ï¸âƒ£ **[Swift](https://developer.apple.com/swift/) é‡Œä½¿ç”¨ `DispatchQueue`** â†’ å…¶å®æ˜¯ Apple åœ¨ `Dispatch` æ¨¡å—é‡Œç»™ GCD åšçš„ [**Swift**](https://developer.apple.com/swift/) å°è£…
>
> 4ï¸âƒ£ åº•å±‚è°ƒåº¦æ¡†æ¶ï¼Œæ€§èƒ½å¥½ã€ç²’åº¦ç»†ï¼ŒAPI ååº•å±‚
>
> 5ï¸âƒ£ ç‰¹ç‚¹ï¼š**åªç®¡æ—¶æœºä¸æ’é˜Ÿ**ï¼Œä¸æä¾›å¹¶å‘éš”ç¦»

* ```swift
  /// å¼ºåˆ¶ä¸‹ä¸€å¸§ï¼ˆå“ªæ€•å½“å‰å·²åœ¨ä¸»çº¿ç¨‹ï¼Œä¹Ÿè¦ç­‰ä¸€ç­‰ï¼‰ï¼š
  // âš ï¸ åˆ«åœ¨ä¸»çº¿ç¨‹ç”¨ main.syncï¼Œä¼šæ­»é”
  DispatchQueue.main.async {
      // UI æ›´æ–°
  }
  ```

  * âš ï¸ åˆ«åœ¨ä¸»çº¿ç¨‹ç”¨ **`main.sync`**ï¼Œä¼šæ­»é”ğŸ”’

    ```swift
    âŒ é”™è¯¯ç¤ºä¾‹1
    final class DeadlockVC: UIViewController {
        override func viewDidLoad() {
            super.viewDidLoad()
            // ğŸš¨ å½“å‰å°±åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
            DispatchQueue.main.sync {
                // è¿™ä¸ª block ä¼šæ’åˆ°ä¸»é˜Ÿåˆ—ï¼Œä½†è°ƒç”¨æ–¹â€œåŒæ­¥ç­‰å¾…â€å®ƒå®Œæˆ
                // ä¸»é˜Ÿåˆ—åˆè¢«å½“å‰è¿™è¡Œä»£ç å ç€ -> æ°¸è¿œè½®ä¸åˆ°æ‰§è¡Œ -> æ­»é”å¡æ­»
                self.view.backgroundColor = .systemRed
            }
        }
    }
    âŒ é”™è¯¯ç¤ºä¾‹2
    @IBAction func onTap(_ sender: UIButton) {
        print("A")
        // ğŸš¨ UI äº‹ä»¶å›è°ƒåœ¨ä¸»çº¿ç¨‹
        DispatchQueue.main.sync {
            print("B") // æ°¸è¿œåˆ°ä¸äº†è¿™é‡Œ -> æ­»é”
        }
        print("C")
    }
    ```

* **`Foundation`.OperationQueue**

  > é«˜å±‚å°è£…ï¼ˆåŸºäº**Objc**/[**Swift**](https://developer.apple.com/swift/)ï¼‰ï¼Œå†…éƒ¨é»˜è®¤è¿˜æ˜¯ç”¨ **GCD** è°ƒåº¦

  ```swift
  /// å°è£…åœ¨ GCD ä¹‹ä¸Šï¼Œå¤šäº†ä¾èµ–/å–æ¶ˆ/QoS/æš‚åœ
  OperationQueue.main.addOperation {
      // UI æ›´æ–°
  }
  ```

* é—ç•™ API

  ```swift
  performSelector(onMainThread:)
  ```

#### 11.2ã€**[Swift](https://developer.apple.com/swift/).Concurrency.MainActorï¼ˆæ‰§è¡Œå™¨å±‚ï¼‰**@<font color=red>**ç°ä»£æ¨èæ–¹å¼**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ç«‹åˆ»åˆ‡ä¸»çº¿ç¨‹å¹¶ç­‰ç»“æœ

  ```swift
  let value = await MainActor.run { /* UI è¯»å†™ */ }
  ```

* å¼‚æ­¥ï¼Œä¸‹ä¸€è½®å†è·‘

  * ```swift
    Task {
        await updateUI()
    }
    ```

  * ```swift
    Task { @MainActor in
        /// UI æ›´æ–°
    }
    ```

### 12ã€`Block/é—­åŒ…` çš„å®‰å…¨è°ƒç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ä»¥ä¸‹ä¸ºç­‰ä»·è°ƒç”¨

* **Objc**

  ```objective-c
  if (success) {
      success(YES);
  }
  ```

* [**Swift**](https://developer.apple.com/swift/)

  * ```swift
    if let success = success {
        success(true)
    }
    ```

  * ```swift
    success?(true)
    ```

### 13ã€Thenï¼ˆè‡ªå®šä¹‰/ä½¿ç”¨ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å®šä¹‰

  ```swift
  // MARK: - å°‘é‡ä¾¿æ· thenï¼ˆå¯é€‰ï¼‰
  public protocol Then {}
  extension Then where Self: AnyObject {
      @discardableResult
      func then(_ block: (Self) -> Void) -> Self {
          block(self); return self
      }
  }
  extension NSObject: Then {}
  ```

* ä½¿ç”¨

  ```swift
  let label = UILabel().then {
      $0.text = "Hello"
      $0.textColor = .red
      $0.textAlignment = .center
  }
  ```

### 14ã€å¯¹[**SnapKit**](https://github.com/SnapKit/SnapKit)çš„å°è£…ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é›†æˆ

  ```ruby
  pod 'SnapKit'
  ```

* ä½¿ç”¨

  ```swift
  import SnapKit
  
  private lazy var view: UIView = {
      UIView().byAddTo(subView) { [unowned self] make in
              make.top.equalTo(self.view.safeAreaLayoutGuide.snp.top).offset(40)
              make.left.right.equalToSuperview().inset(24)
              make.height.equalTo(44)
          }   
  }()
  ```

### 15ã€ğŸ§­ è‡ªå®šä¹‰å¯¼èˆªæ  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 15.1ã€[**åŸºäºæ§åˆ¶å™¨å±‚çš„è‡ªå®šä¹‰å¯¼èˆªæ @GKNavigationBarSwift**](https://github.com/QuintGao/GKNavigationBarSwift)çš„äºŒæ¬¡å°è£…å’Œä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é›†æˆ

  ```ruby
  pod 'GKNavigationBarSwift'
  ```

* ä½¿ç”¨

  ```swift
  import GKNavigationBarSwift
  
  override func viewDidLoad() {
      super.viewDidLoad()
          jobsSetupGKNav(
              title: "Demo åˆ—è¡¨",
              leftButton:UIButton.sys()
                  .byFrame(CGRect(x: 0, y: 0, width: 32.w, height: 32.h))
                  /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
                  .byImage(UIImage(systemName: "list.bullet"), for: .normal)
                  .byImage(UIImage(systemName: "list.bullet"), for: .selected)
                  /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
                  .onTap { [weak self] sender in
                      guard let self else { return }
                      sender.isSelected.toggle()
                      debugOnly {  // ä»… Debug æ‰§è¡Œ
                          JobsToast.show(
                              text: "ç‚¹æŒ‰äº†åˆ—è¡¨æŒ‰é’®",
                              config: JobsToast.Config()
                                  .byBgColor(.systemGreen.withAlphaComponent(0.9))
                                  .byCornerRadius(12)
                          )
                      }
                  }
                  /// äº‹ä»¶è§¦å‘@é•¿æŒ‰
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                       if gr.state == .began {
                           btn.alpha = 0.6
                           print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                       } else if gr.state == .ended || gr.state == .cancelled {
                           btn.alpha = 1.0
                           print("é•¿æŒ‰ç»“æŸ")
                       }
                  },
              rightButtons: [
                  UIButton.sys()
                      /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
                      .byImage(UIImage(systemName: "moon.circle.fill"), for: .normal)
                      .byImage(UIImage(systemName: "moon.circle.fill"), for: .selected)
                      /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
                      .onTap { [weak self] sender in
                          guard let self else { return }
                          sender.isSelected.toggle()
                          print("ğŸŒ“ ä¸»é¢˜å·²åˆ‡æ¢ -> \(win.overrideUserInterfaceStyle == .dark ? "Dark" : "Light")")
                      },
                  UIButton.sys()
                      /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
                      .byImage(UIImage(systemName: "globe"), for: .normal)
                      .byImage(UIImage(systemName: "globe"), for: .selected)
                      /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
                      .onTap { [weak self] sender in
                          guard let self else { return }
                          sender.isSelected.toggle()
                          print("ğŸŒ åˆ‡æ¢è¯­è¨€ tappedï¼ˆå ä½ï¼‰")
                      },
                  UIButton.sys()
                      /// æŒ‰é’®å›¾ç‰‡@å›¾æ–‡å…³ç³»
                      .byImage(UIImage(systemName: "stop.circle.fill"), for: .normal)
                      .byImage(UIImage(systemName: "stop.circle.fill"), for: .selected)
                      /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
                      .onTap { [weak self] sender in
                          guard let self else { return }
                          sender.isSelected.toggle()
                          print("ğŸ›‘ æ‰‹åŠ¨åœæ­¢åˆ·æ–°")
                      }
              ]
          )
  }
  ```

#### 15.2ã€åŸºäºè§†å›¾å±‚çš„è‡ªå®šä¹‰å¯¼èˆªæ  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// ğŸ”½ ä¸€é”®å¼€å¯¼èˆªæ ï¼ˆé»˜è®¤æ ‡é¢˜=webView.titleï¼Œé»˜è®¤æœ‰è¿”å›é”®ï¼‰
UIView().byNavBarEnabled(true)
    .byNavBarStyle { s in
        s.byHairlineHidden(false)
            .byBackgroundColor(.systemBackground)
            .byTitleAlignmentCenter(true)
    }
    // è‡ªå®šä¹‰è¿”å›é”®ï¼ˆæƒ³éšè—å°±ï¼š.byNavBarBackButtonProvider { nil }ï¼‰
    .byNavBarBackButtonProvider {
        UIButton(type: .system)
            .byBackgroundColor(.clear)
            .byImage(UIImage(systemName: "chevron.left"), for: .normal)
            .byTitle("è¿”å›", for: .normal)
            .byTitleFont(.systemFont(ofSize: 16, weight: .medium))
            .byTitleColor(.label, for: .normal)
            .byContentEdgeInsets(.init(top: 6, left: 10, bottom: 6, right: 10))
            .byTapSound("Sound.wav")
    }
    // è¿”å›è¡Œä¸ºï¼šä¼˜å…ˆåé€€ï¼Œå¦åˆ™ pop
    .byNavBarOnBack { [weak self] in
        guard let self else { return }
        closeByResult("") /// ç³»ç»Ÿçš„é€šç”¨è¿”å›
    }
    .byAddTo(view) { [unowned self] make in
        if view.jobs_hasVisibleTopBar() {
            make.top.equalTo(self.gk_navigationBar.snp.bottom).offset(10) // è‹¥ä½ ç¡®ä¿¡æ­¤æ—¶å·²å­˜åœ¨ï¼Œæ‰å»å–
            make.left.right.bottom.equalToSuperview()
        } else {
            make.edges.equalToSuperview()
        }
    }
```

### 16ã€è·å–é«˜é¢‘ç³»ç»Ÿå…³é”®é‡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `jobsNearestVC` ğŸ‘‰ ä»ä»»æ„ **UIResponder**ï¼ˆView / VCï¼‰å‘ä¸Šæ‰¾åˆ°æœ€è¿‘çš„å®¿ä¸» VCï¼›è‹¥å…¨ç¨‹æ‰¾ä¸åˆ°åˆ™å…œåº•åˆ° **`keyWindow`** çš„ **root**

* `UIApplication.jobsKeyWindow()?` ğŸ‘‰ ç»Ÿä¸€çš„ **KeyWindow** è·å–ï¼ˆ**æ”¯æŒ iOS 13 å¤šåœºæ™¯ï¼›è€ç³»ç»Ÿå…œåº•**ï¼‰

* ` UIApplication.jobsTopMostVC()` ğŸ‘‰ï¼ˆé€’å½’è§£æï¼‰è·å–å½“å‰â€œæœ€é¡¶å±‚å¯è§â€çš„ **UIViewController**
* `UIResponder.jobsCurrentFirstResponder()` ğŸ‘‰ å®šä½å½“å‰ç¬¬ä¸€å“åº”è€…

### 17ã€<font color=red>æ¨é¡µé¢@å¸¦å‚æ•°</font>ï¼ˆ`push`/`present`ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ å°è£…åœ¨`UIResponder`å±‚ï¼Œèƒ½å…¨è¦†ç›–ï¼š**ä»»æ„æ§åˆ¶å™¨**å’Œ**ä»»æ„è§†å›¾**
>
> 2ï¸âƒ£ è®¾è®¡åªæœ‰ä¸€ä¸ªå…¥å‚ï¼Œå½“å¤šå‚æ•°çš„æ—¶å€™ï¼Œå»ºè®®å°è£…æˆä¸€ä¸ªæ¨¡å‹ï¼Œè¿›è¡Œæ•´ä½“ä¼ å…¥ï¼Œæ–¹ä¾¿ç®¡ç†
>
> 3ï¸âƒ£ è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ï¼šå­—ç¬¦ä¸²ã€åŸºæœ¬æ•°æ®ç±»å‹ã€è‡ªå®šä¹‰æ¨¡å‹ï¼ˆç±»/ç»“æ„ä½“ï¼‰ã€å­—å…¸ã€æ•°ç»„
>
> 4ï¸âƒ£ <font color=red>**æ¡†æ¶å†…éƒ¨é˜²æ­¢äº†å¤šæ¬¡ç‚¹å‡»é€ æˆçš„å¤šæ¬¡æ¨å‡ºé¡µé¢çš„é—®é¢˜**</font>
>
> ```swift
> .byData(DemoModel(id: 7, title: "è¯¦æƒ…"))// è‡ªå®šä¹‰æ¨¡å‹ç±» DemoModelï¼ˆç±»/ç»“æ„ä½“ï¼‰
> .byData(["id": 7, "title": "è¯¦æƒ…", "price": 9.9])// å­—å…¸
> .byData(["å¤§æ ‘","å°è‰","å¤ªé˜³"])// æ•°ç»„
> .byData("Jobs")// å­—ç¬¦ä¸²
> .byData(3.14)// åŸºæœ¬æ•°æ®ç±»å‹
> ```

* å¼ºè¡Œ`push`é¡µé¢è¿›è¡Œå±•ç¤ºã€‚å‘èµ·è€…å¯ä»¥æ˜¯ï¼šä»»æ„æ§åˆ¶å™¨ï¼ˆ**å³ä¾¿è¿™ä¸ªæ§åˆ¶å™¨ç›®å‰æ˜¯ä¸å…·å¤‡å¯¼èˆªæ§åˆ¶å™¨çš„**ï¼‰ã€ä»»æ„è§†å›¾

  ```swift
  DemoDetailVC()
      .byData(Data)
      .onResult { id in
          print("å›æ¥äº† id=\(id)")
      }
      .byPush(self)           // è‡ªå¸¦é˜²é‡å…¥ï¼Œè¿ç‚¹ä¸é‡å¤
      .byCompletion{
          print("ç»“æŸ")
      }
  ```

* å¼ºè¡Œ`present`é¡µé¢è¿›è¡Œå±•ç¤ºã€‚å‘èµ·è€…å¯ä»¥æ˜¯ï¼šä»»æ„æ§åˆ¶å™¨ï¼ˆ**å³ä¾¿è¿™ä¸ªæ§åˆ¶å™¨ç›®å‰æ˜¯ä¸å…·å¤‡å¯¼èˆªæ§åˆ¶å™¨çš„**ï¼‰ã€ä»»æ„è§†å›¾

  * ç³»ç»Ÿé»˜è®¤é«˜åº¦

    ```swift
    DemoDetailVC()
        .byData(Data)
        .onResult { name in
            print("å›æ¥äº† \(name)")
        }
        .byPresent(self)           // è‡ªå¸¦é˜²é‡å…¥ï¼Œè¿ç‚¹ä¸é‡å¤
        .byCompletion{
            print("ç»“æŸ")
        }
    ```
  
  * è‡ªå®šä¹‰`present`çš„é¡µé¢é«˜åº¦
  
    ```swift
    HalfSheetDemoVC()
        .byModalPresentationStyle(.custom)
        .byTransitioningDelegate(self)
        .byData(Data)
        .onResult { id in
            print("å›æ¥äº† \(id)")
        }
        .byPresent(self)           // è‡ªå¸¦é˜²é‡å…¥ï¼Œè¿ç‚¹ä¸é‡å¤
        .byCompletion{
            print("ç»“æŸ")
        }
    ```

### 18ã€<font id=å­—ç¬¦ä¸²åŠ è½½å›¾ç‰‡èµ„æº>ä¾æ®<font color=red>**å­—ç¬¦ä¸²**</font>åŠ è½½å›¾ç‰‡èµ„æº</font>ï¼ˆæœ¬åœ°/ç½‘ç»œï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 18.1ã€å–æœ¬åœ°å›¾ç‰‡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
/// æœ¬åœ°å›¾åƒåï¼ˆåœ¨ Assets ä¸­æ”¾ä¸€å¼ å« "Ani" çš„å›¾ï¼‰
localImageView.image = "Ani".img
```

#### 18.2ã€å–ç½‘ç»œå›¾ç‰‡@[**Kingfisher**](https://github.com/onevcat/Kingfisher) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ```ruby
> pod 'Kingfisher'                         # https://github.com/onevcat/Kingfisher             â¤ï¸ Swiftå¹³å°ä¸Šçš„SDWebImageå¹³æ›¿
> ```
>
> ```swift
> import Kingfisherx
> ```

* ç›´æ¥å–ï¼Œä¸å¤„ç†å¤±è´¥å…œåº•

  ```swift
  /// UIImageViewå­—ç¬¦ä¸²ç½‘ç»œå›¾@Kingfisher
  private lazy var asyncImgView: UIImageView = {
      let imageView = UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(localImgView.snp.bottom).offset(20)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(180)
          }
      Task {
          do {
              imageView.byImage(try await "https://picsum.photos/200/300".kfLoadImage())
              print("âœ… åŠ è½½æˆåŠŸ (KF async)")
          } catch {
              print("âŒ åŠ è½½å¤±è´¥ (KF async)ï¼š\(error)")
          }
      }
      return imageView
  }()
  ```

* å¤±è´¥å…œåº•å¤„ç†

  ```swift
  /// UIImageViewç½‘ç»œå›¾ï¼ˆå¤±è´¥å…œåº•å›¾ï¼‰@Kingfisher
  private lazy var wrapperImgView: UIImageView = {
      UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .kf_setImage(from: "https://picsum.photos/200", placeholder: "Ani".img)
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(asyncImgViewSD.snp.bottom).offset(20)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(180)
          }
  }()
  ```

#### 18.3ã€å–ç½‘ç»œå›¾ç‰‡@[**SDWebImage**](https://github.com/SDWebImage/SDWebImage) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

>```ruby
>pod 'SDWebImage'                         # https://github.com/SDWebImage/SDWebImage          â¤ï¸
>```
>
>```swift
>import SDWebImage
>```

* ç›´æ¥å–ï¼Œä¸å¤„ç†å¤±è´¥å…œåº•

  ```swift
  /// UIImageViewå­—ç¬¦ä¸²ç½‘ç»œå›¾@SDWebImage
  private lazy var asyncImgViewSD: UIImageView = {
      let imageView = UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(asyncImgView.snp.bottom).offset(20)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(180)
          }
      Task {
          do {
              imageView.byImage(try await "https://picsum.photos/400/300".sdLoadImage())
              print("âœ… åŠ è½½æˆåŠŸ (SD async)")
          } catch {
              print("âŒ åŠ è½½å¤±è´¥ (SD async)ï¼š\(error)")
          }
      }
      return imageView
  }()
  ```

* å¤±è´¥å…œåº•å¤„ç†

  ```swift
  /// UIImageViewç½‘ç»œå›¾ï¼ˆå¤±è´¥å…œåº•å›¾ï¼‰@SDWebImage
  private lazy var wrapperImgViewSD: UIImageView = {
      UIImageView()
          .byContentMode(.scaleAspectFill)
          .byClipsToBounds()
          .sd_setImage(from: "https://picsum.photos/200", placeholder: "Ani".img)
          .byAddTo(scrollView) { [unowned self] make in
              make.top.equalTo(wrapperImgView.snp.bottom).offset(20)
              make.left.equalTo(scrollView.frameLayoutGuide.snp.left).offset(20)
              make.right.equalTo(scrollView.frameLayoutGuide.snp.right).inset(20)
              make.height.equalTo(180)
          }
  }()
  ```

### 19ã€ç‚¹å‡»äº‹ä»¶çš„å°è£… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 19.1ã€å°è£…åœ¨`UIControl` å±‚çš„ç‚¹å‡»äº‹ä»¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  private lazy var toggle: UISwitch = {
      UISwitch()
          .onJobsChange { (sw: UISwitch) in
              print("å¼€å…³çŠ¶æ€ï¼š\(sw.isOn)")
          }
  }()
  ```
  
* ```swift
  private lazy var datePicker: UIDatePicker = {
      UIDatePicker()
          .byDatePickerMode(.date)
          .onJobsChange { (picker: UIDatePicker) in
              print("é€‰æ‹©æ—¥æœŸï¼š\(picker.date)")
          }
  }()
  ```
  
* ```swift
  private lazy var slider: UISlider = {
      UISlider()
          .onJobsChange { (slider: UISlider) in
              print("æ»‘å—å€¼ï¼š\(slider.value)")
          }
  }()
  ```
  
* ```swift
  private lazy var textField: UITextField = {
      UITextField()
          .onJobsEvent(.editingChanged) { (tf: UITextField) in
              print("æ–‡å­—å˜åŒ–ï¼š\(tf.text ?? "")")
          }
  }()
  ```
  
* ```swift
  private lazy var kindSeg: UISegmentedControl = {
      UISegmentedControl(items: ["Foundation", "GCD", "DisplayLink", "RunLoopCore"])
          .bySelectedSegmentIndex(0)
          .byAddTo(view) { [unowned self] make in
              make.top.equalTo(self.view.safeAreaLayoutGuide.snp.top).offset(16)
              make.left.right.equalToSuperview().inset(16)
              make.height.equalTo(34)
          }
          .onJobsChange { [weak self] (_: UISegmentedControl) in
              self?.onKindChanged()
          }
  }()
  ```

#### 19.2ã€[**å°è£…åœ¨`UIButton` å±‚çš„ç‚¹å‡»äº‹ä»¶**](#UIButton) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
let button = UIButton(type: .system)
    .byTitle("æäº¤")
    .onTap { btn in
        print("âœ… ä½¿ç”¨ UIButton ä¸“å± UIAction å®ç°")
    }
```

### 20ã€ğŸŒ¡ï¸ å¯åŠ¨æ£€æµ‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
AppLaunchManager.handleLaunch(
    firstInstall: {
        log("ğŸš€ æ–°ç”¨æˆ·å¼•å¯¼ / åˆå§‹åŒ–é…ç½®")
    },
    firstToday: {
        log("â˜€ï¸ æ¯æ—¥ç­¾åˆ°å¼¹çª— / åˆ·æ–°ç¼“å­˜")
    },
    normal: {
        log("â¡ï¸ æ­£å¸¸å¯åŠ¨ / å¸¸è§„é€»è¾‘")
    }
)
```

### 21ã€ğŸ¡ å­—ç¬¦ä¸² <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 21.1ã€ğŸ¡ é€šç”¨æ ¼å¼çš„è½¬æ¢  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **`String`** â†’ **`Int`**

  ```swift
  "123".toInt()   
  // âœ… è¾“å‡ºï¼š123
  // ğŸ“˜ è¯´æ˜ï¼šå°†å­—ç¬¦ä¸²è½¬ä¸º Intï¼Œå¦‚æœåŒ…å«éæ•°å­—å­—ç¬¦åˆ™è¿”å› nil
  ```

* **`String`** â†’ **`Int64`**

  ```swift
  "9876543210".toInt64()   
  // âœ… è¾“å‡ºï¼š9876543210
  // ğŸ“˜ è¯´æ˜ï¼šé€‚ç”¨äºè¶…å‡º Int èŒƒå›´çš„å¤§æ•´æ•°
  ```

* **`String`** â†’ **`Double`**

  ```swift
  "3.14159".toDouble()   
  // âœ… è¾“å‡ºï¼š3.14159
  // ğŸ“˜ è¯´æ˜ï¼šæ”¯æŒå°æ•°ç‚¹ä¸åƒåˆ†ä½ï¼ˆå¦‚ "1,234.56" â†’ 1234.56ï¼‰
  ```

* **`String`** â†’ **`Double`**ï¼ˆå¸¦ç²¾åº¦æ§åˆ¶ï¼‰

  ```swift
  "3.1".toDouble(2, 2)   
  // âœ… è¾“å‡ºï¼š3.10
  // ğŸ“˜ è¯´æ˜ï¼šé™åˆ¶æœ€å¤š 2 ä½å°æ•°ï¼Œæœ€å°‘ä¹Ÿæ˜¾ç¤º 2 ä½ï¼ˆè‡ªåŠ¨è¡¥é›¶ï¼‰
  ```

* **`String`** â†’ **`Float`**

  ```swift
  "123.45".toFloat()   
  // âœ… è¾“å‡ºï¼š123.45
  // ğŸ“˜ è¯´æ˜ï¼šæµ®ç‚¹æ•°ç‰ˆæœ¬ï¼ˆç²¾åº¦ç•¥ä½äº Doubleï¼‰

* **`String`** â†’ **`Bool`**

  ```swift
  "true".toBool()     // âœ… true
  "False".toBool()    // âœ… false
  "YES".toBool()      // âœ… true
  "no".toBool()       // âœ… false
  "1".toBool()        // âœ… true
  "0".toBool()        // âœ… false
  "maybe".toBool()    // âŒ nilï¼ˆæ— æ³•è¯†åˆ«ï¼‰
  // ğŸ“˜ è¯´æ˜ï¼šå¤§å°å†™ä¸æ•æ„Ÿ
  ```

* **`String`** â†’ **`NSString`**

  ```swift
  "ä½ å¥½".toNSString   
  // âœ… è¾“å‡ºï¼šNSString("ä½ å¥½")
  // ğŸ“˜ è¯´æ˜ï¼šSwift String è½¬ Foundation NSString
  ```

* <font color=red>**`String`** â†’ **`NSAttributedString`**</font>

  ```swift
  "Hello".rich   
  // âœ… è¾“å‡ºï¼šNSAttributedString("Hello")
  // ğŸ“˜ è¯´æ˜ï¼šå°†æ™®é€šå­—ç¬¦ä¸²è½¬ä¸ºå¯Œæ–‡æœ¬ï¼ˆæ— æ ·å¼ï¼‰
  ```

* <font color=red>**`String`** â†’ **`NSAttributedString`**</font> å¸¦å±æ€§

  ```swift
  "çº¢è‰²åŠ ç²—".rich([
      .foregroundColor: UIColor.red,
      .font: UIFont.boldSystemFont(ofSize: 18)
  ])
  // âœ… è¾“å‡ºï¼šçº¢è‰²åŠ ç²—ï¼ˆå¯Œæ–‡æœ¬æ ·å¼ï¼‰
  // ğŸ“˜ è¯´æ˜ï¼šé™„åŠ å­—ä½“ä¸é¢œè‰²å±æ€§
  ```

#### 21.2ã€ğŸ¡ [**å­—ç¬¦ä¸²åŠ è½½å›¾ç‰‡èµ„æº**](#å­—ç¬¦ä¸²åŠ è½½å›¾ç‰‡èµ„æº) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 21.3ã€ğŸ¡ å­—ç¬¦ä¸²æ‰“å¼€ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ‰“å¼€ç½‘ç«™ / **`Scheme`**ï¼ˆå¸¦å‚ï¼‰

  ```swift
  "www.baidu.com".open()
  "https://example.com/search?q=ä¸­æ–‡ å…³é”®è¯".open()
  ```

* æ‰“ç”µè¯ï¼ˆä»…æ”¯æŒçœŸæœºï¼‰

  ```swift
  "13434343434".call()
  ```

* å‘é‚®ä»¶ï¼ˆå¸¦å‚ï¼‰

  ```swift
  "test@qq.com".mail()
  ```

  ```swift
  "ops@company.com".mail(
      subject: "åé¦ˆ",
      body: "ä½ å¥½ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜..."
  )
  ```

  ```swift
  "a@b.com,c@d.com".mail(
      subject: "æ—¥æŠ¥",
      body: "<b>ä»Šå¤©å®Œæˆï¼š</b><br/>1. xxx<br/>2. yyy",
      isHTML: true,
      cc: ["pm@company.com"],
      bcc: ["boss@company.com"]
  ) { result in
      print("mail result = \(result)")
  }
  ```

### 22ã€â° è®¡æ—¶å™¨ï¼ˆæŒ‰é’®ï¼‰çš„å°è£… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ å°† iOSç³»ç»Ÿå†…ç½®çš„4å¤§åŸºæœ¬è®¡æ—¶å™¨ï¼ˆ`NSTimer`/`GCD`/`DisplayLink`/`RunLoop`ï¼‰ä»¥åè®®çš„æ–¹å¼è¿›è¡Œç»Ÿä¸€å°è£…ï¼šå¼€å§‹ã€æš‚åœã€é‡å¯ã€åœæ­¢ã€é”€æ¯
>
> 2ï¸âƒ£ æŒ‰é’®å½“å‰çš„çŠ¶æ€ **`TimerState`** ç½®äºæŒ‰é’®å†…éƒ¨ï¼ˆå¤–ç•Œä¾æ®æŒ‰é’®å½“å‰çŠ¶æ€æ¥è¿›è¡Œä¸šåŠ¡å®‰æ’ï¼‰
>
> 3ï¸âƒ£ æ­£è®¡æ—¶ä¸å€’è®¡æ—¶çš„å·®å¼‚å°±åœ¨äºæ˜¯å¦ä¼ å€¼**`total`**
>
> 4ï¸âƒ£ çº¯é“¾å¼è°ƒç”¨ï¼Œä»£ç å—ï¼Œæ–¹ä¾¿è°ƒè¯•

#### 22.1ã€â°[ï¼ˆ`NSTimer`/`GCD`/`DisplayLink`/`RunLoop`ï¼‰ç»Ÿä¸€åè®®æ–¹ä¾¿è°ƒç”¨](#å®šæ—¶å™¨) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
public protocol JobsTimerProtocol: AnyObject {
    /// å½“å‰æ˜¯å¦è¿è¡Œä¸­
    var isRunning: Bool { get }
    /// å¯åŠ¨è®¡æ—¶å™¨
    func start()
    /// æš‚åœè®¡æ—¶å™¨
    func pause()
    /// æ¢å¤è®¡æ—¶å™¨
    func resume()
    /// åœæ­¢è®¡æ—¶å™¨ï¼ˆé”€æ¯@æœ‰å›è°ƒï¼‰
    func fireOnce()
    /// åœæ­¢è®¡æ—¶å™¨ï¼ˆé”€æ¯@æ— å›è°ƒï¼‰
    func stop()
    /// æ³¨å†Œå›è°ƒï¼ˆæ¯ tick æ‰§è¡Œä¸€æ¬¡ï¼‰
    @discardableResult
    func onTick(_ block: @escaping () -> Void) -> Self
    /// æ³¨å†Œå®Œæˆå›è°ƒï¼ˆç”¨äºä¸€æ¬¡æ€§å®šæ—¶å™¨æˆ–å€’è®¡æ—¶ï¼‰
    @discardableResult
    func onFinish(_ block: @escaping () -> Void) -> Self
}
```

#### 22.2ã€ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
JobsTimerFactory.make(kind: .displayLink,
                      config: JobsTimerConfig(interval: 1, repeats: true, tolerance: 0.002, queue: .main)) {
    ///  æ—¥æœŸæ‰“å°
    print(Date().formatted(date: .numeric, time: .standard))
}.start()
```

#### 22.3ã€[è®¡æ•°æŒ‰é’®](#è®¡æ•°æŒ‰é’®) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 23ã€è·‘é©¬ç¯+è½®æ’­å›¾ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* è·‘é©¬ç¯

  ```swift
  // MARK: - 1. å‘ä¸Šè¿ç»­æ»šåŠ¨
  private lazy var upContinuousMarquee: JobsMarqueeView = { [unowned self] in
      JobsMarqueeView()
          .byDirection(.up)
          .byScrollMode(.continuous(speed: 40))
          .byItemSizeMode(.fitContent)   // å…¸å‹å…¬å‘Šè·‘é©¬ç¯
          .byDataSourceButtons([
              UIButton.sys()
                  .byBackgroundColor(.systemYellow.withAlphaComponent(0.2), for: .normal)
                  .byTitle("å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 1", for: .normal)
                  .byTitleColor(.label, for: .normal)
                  .byTitleFont(.systemFont(ofSize: 14, weight: .medium))
                  .bySubTitle("æ›´å¤šå†…å®¹ 1", for: .normal)
                  .bySubTitleColor(.secondaryLabel, for: .normal)
                  .bySubTitleFont(.systemFont(ofSize: 11, weight: .regular))
                  .byImage("megaphone.fill".sysImg, for: .normal)
                  .byContentEdgeInsets(UIEdgeInsets(top: 4, left: 8, bottom: 4, right: 8))
                  .byTitleEdgeInsets(UIEdgeInsets(top: 0, left: 6, bottom: 0, right: -6))
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”” å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 1 tapped, selected=\(sender.isSelected)")
                      toastBy(sender.title!)
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  },
              UIButton.sys()
                  .byBackgroundColor(.systemYellow.withAlphaComponent(0.2), for: .normal)
                  .byTitle("å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 2", for: .normal)
                  .byTitleColor(.label, for: .normal)
                  .byTitleFont(.systemFont(ofSize: 14, weight: .medium))
                  .bySubTitle("æ›´å¤šå†…å®¹ 2", for: .normal)
                  .bySubTitleColor(.secondaryLabel, for: .normal)
                  .bySubTitleFont(.systemFont(ofSize: 11, weight: .regular))
                  .byImage("megaphone.fill".sysImg, for: .normal)
                  .byContentEdgeInsets(UIEdgeInsets(top: 4, left: 8, bottom: 4, right: 8))
                  .byTitleEdgeInsets(UIEdgeInsets(top: 0, left: 6, bottom: 0, right: -6))
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”” å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 2 tapped, selected=\(sender.isSelected)")
                      toastBy(sender.title!)
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  },
              UIButton.sys()
                  .byBackgroundColor(.systemYellow.withAlphaComponent(0.2), for: .normal)
                  .byTitle("å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 3", for: .normal)
                  .byTitleColor(.label, for: .normal)
                  .byTitleFont(.systemFont(ofSize: 14, weight: .medium))
                  .bySubTitle("æ›´å¤šå†…å®¹ 3", for: .normal)
                  .bySubTitleColor(.secondaryLabel, for: .normal)
                  .bySubTitleFont(.systemFont(ofSize: 11, weight: .regular))
                  .byImage("megaphone.fill".sysImg, for: .normal)
                  .byContentEdgeInsets(UIEdgeInsets(top: 4, left: 8, bottom: 4, right: 8))
                  .byTitleEdgeInsets(UIEdgeInsets(top: 0, left: 6, bottom: 0, right: -6))
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”” å‘ä¸Šè¿ç»­ Â· å…¬å‘Š 3 tapped, selected=\(sender.isSelected)")
                      toastBy(sender.title!)
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  }
          ])
          .byBgColor(.randomColor)
          .byAddTo(self.scrollView) { [unowned self] make in
              if #available(iOS 11.0, *) {
                  make.top.equalTo(self.scrollView.contentLayoutGuide.snp.top).offset(10)
                  make.left.equalTo(self.scrollView.frameLayoutGuide.snp.left).offset(self.horizontalInset)
                  make.right.equalTo(self.scrollView.frameLayoutGuide.snp.right).inset(self.horizontalInset)
              } else {
                  make.top.equalTo(self.scrollView.snp.top).offset(10)
                  make.left.equalTo(self.scrollView).offset(self.horizontalInset)
                  make.right.equalTo(self.scrollView).inset(self.horizontalInset)
              }
              make.height.equalTo(self.marqueeHeight)
          }
  }()
  ```

* è½®æ’­å›¾

  ```swift
  // MARK: - 13. Kingfisher@èƒŒæ™¯å›¾
  private lazy var kingfisherImageButtonsMarquee: JobsMarqueeView = { [unowned self] in
      JobsMarqueeView()
          .byDirection(.left)
          .byScrollMode(.frequency(interval: 1.0))
          .byItemSizeMode(.fillBounds)
          .byDataSourceButtons ([
              UIButton.sys()
                  .byTitle("æˆ‘æ˜¯UIButtonä¸»æ ‡é¢˜@Kingfisher").byTitleColor(.red)
                  .bySubTitle("æˆ‘æ˜¯UIButtonå‰¯æ ‡é¢˜@Kingfisher").bySubTitleColor(.yellow)
                  .kf_imageURL("https://picsum.photos/" + ScreenWidth().toString(0) + "/" + self.marqueeHeight.toString(0))
                  .kf_placeholderImage("å”è€é¸­".img)
                  .kf_options([
                      .processor(DownsamplingImageProcessor(size: CGSize(width: 500, height: 200))),
                      .scaleFactor(UIScreen.main.scale),
                      .cacheOriginalImage,
                      .transition(.fade(0.25)),
                      .retryStrategy(DelayRetryStrategy(maxRetryCount: 2, retryInterval: .seconds(1)))
                  ])
                  .kf_bgNormalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”´ Kingfisher@èƒŒæ™¯å›¾ 1 tapped, selected=\(sender.isSelected)")
                      toastBy("ç‚¹å‡»äº†Kingfisher@èƒŒæ™¯å›¾")
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  },
              UIButton.sys()
                  .byTitle("æˆ‘æ˜¯UIButtonä¸»æ ‡é¢˜@Kingfisher").byTitleColor(.red)
                  .bySubTitle("æˆ‘æ˜¯UIButtonå‰¯æ ‡é¢˜@Kingfisher").bySubTitleColor(.yellow)
                  .kf_imageURL("https://picsum.photos/" + ScreenWidth().toString(0) + "/" + self.marqueeHeight.toString(0))
                  .kf_placeholderImage("å”è€é¸­".img)
                  .kf_options([
                      .processor(DownsamplingImageProcessor(size: CGSize(width: 500, height: 200))),
                      .scaleFactor(UIScreen.main.scale),
                      .cacheOriginalImage,
                      .transition(.fade(0.25)),
                      .retryStrategy(DelayRetryStrategy(maxRetryCount: 2, retryInterval: .seconds(1)))
                  ])
                  .kf_bgNormalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”´ Kingfisher@èƒŒæ™¯å›¾ 2 tapped, selected=\(sender.isSelected)")
                      toastBy("ç‚¹å‡»äº†Kingfisher@èƒŒæ™¯å›¾")
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  },
              UIButton.sys()
                  .byTitle("æˆ‘æ˜¯UIButtonä¸»æ ‡é¢˜@Kingfisher").byTitleColor(.red)
                  .bySubTitle("æˆ‘æ˜¯UIButtonå‰¯æ ‡é¢˜@Kingfisher").bySubTitleColor(.yellow)
                  .kf_imageURL("https://picsum.photos/" + ScreenWidth().toString(0) + "/" + self.marqueeHeight.toString(0))
                  .kf_placeholderImage("å”è€é¸­".img)
                  .kf_options([
                      .processor(DownsamplingImageProcessor(size: CGSize(width: 500, height: 200))),
                      .scaleFactor(UIScreen.main.scale),
                      .cacheOriginalImage,
                      .transition(.fade(0.25)),
                      .retryStrategy(DelayRetryStrategy(maxRetryCount: 2, retryInterval: .seconds(1)))
                  ])
                  .kf_bgNormalLoad()// ä¹‹å‰æ˜¯é…ç½®é¡¹ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å†³å®šæ¸²æŸ“èƒŒæ™¯å›¾/å‰æ™¯å›¾
                  .byTapSound("Sound.wav")
                  .onTap { sender in
                      print("ğŸ”´ Kingfisher@èƒŒæ™¯å›¾ 3 tapped, selected=\(sender.isSelected)")
                      toastBy("ç‚¹å‡»äº†Kingfisher@èƒŒæ™¯å›¾")
                  }
                  .onLongPress(minimumPressDuration: 0.8) { btn, gr in
                      if gr.state == .began {
                          btn.alpha = 0.6
                          print("é•¿æŒ‰å¼€å§‹ on \(btn)")
                      } else if gr.state == .ended || gr.state == .cancelled {
                          btn.alpha = 1.0
                          print("é•¿æŒ‰ç»“æŸ")
                      }
                  },
          ])
          .byBgColor(.randomColor)
          .byAddTo(self.scrollView) { [unowned self] make in
              make.top.equalTo(self.sdWebImageButtonsMarquee.snp.bottom).offset(self.verticalSpacing)
              make.left.right.height.equalTo(self.upContinuousMarquee)
              // ğŸ”š æœ€åä¸€æ¡å°åº•ï¼Œå†³å®š scrollView.contentSize.height
              if #available(iOS 11.0, *) {
                  make.bottom.equalTo(self.scrollView.contentLayoutGuide.snp.bottom).inset(20)
              } else {
                  make.bottom.equalTo(self.scrollView.snp.bottom).inset(20)
              }
          }
  }()
  ```

### 24ã€æ§åˆ¶å™¨æ·»åŠ èƒŒæ™¯å›¾ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æœ¬åœ°èƒŒæ™¯å›¾

  ```swift
  bgImageView().byImage("å”è€é¸­".img)
  ```

* ç½‘ç»œèƒŒæ™¯å›¾

  ```swift
  Task { @MainActor in
      bgImageView().byImage(await "https://picsum.photos/400/300".sdLoadImage(fallbackImage: "å”è€é¸­".img))
  }
  ```

  ```swift
  Task { @MainActor in
      bgImageView().byImage(await "https://picsum.photos/400/300".kfLoadImage(fallbackImage: "å”è€é¸­".img))
  }
  ```

### 25ã€å¼¹å‡ºçª— <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 25.1ã€**`JobsToast`** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* è‡ªå®šä¹‰æŒç»­åŠ¨ç”»æ—¶é—´

  ```swift
  JobsToast.show(
      text: "å½“å‰æ§åˆ¶å™¨é”€æ¯æˆåŠŸ",
      config: JobsToast.Config()
          .byBgColor(.systemGreen.withAlphaComponent(0.9))
          .byCornerRadius(12)
          .duration = 2.5       // â¬…ï¸ åœç•™ 2.5s
  )
  ```

* è‡ªå®šä¹‰å…¥åœºåŠ¨ç”»æ—¶é—´

  ```swift
  JobsToast.show(
      text: "å·²ä¿å­˜",
      showDuration: 0.30   // â¬…ï¸ å…¥åœºåŠ¨ç”» 0.30sï¼ˆé»˜è®¤ 0.18ï¼‰
  )
  ```

* è‡ªå®šä¹‰äº‹ä»¶

  ```swift
  JobsToast.show(
      text: "ç‚¹æˆ‘é‡è¯•",
      tap: { btn in
          print("ç”¨æˆ·ç‚¹å‡»äº† Toast æŒ‰é’®ï¼š\(btn)")
          /// TODO
      }
  )
  ```

#### 25.2ã€[`UIAlertController`](#UIAlertController) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a> 

* æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ

  ```swift
  // MARK: æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeAlert("æç¤º", "è¿™æ˜¯ä¸€æ¡ç®€å•æç¤º")
          .byAddCancel { [weak self] _ in
              guard let self else { return }
              print("Cancel")
              // TODO: è¿™é‡Œå†™ä½ çš„å–æ¶ˆé€»è¾‘
          }
          .byAddOK { [weak self] _ in
              guard let self else { return }
              print("OK")
              // TODO: è¿™é‡Œå†™ä½ çš„ç¡®è®¤é€»è¾‘
          }
  }()
  ```

* æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ

  ```swift
  // MARK: æœ€ç®€å•çš„ Alertï¼šä¸»/å‰¯æ ‡é¢˜ + å–æ¶ˆ_ç¡®å®š@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä¸­é—´å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸä¸å¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeAlert("é‡å‘½å", "è¯·è¾“å…¥æ–°çš„åç§°")
  //        .bySDBgImageView("https://picsum.photos/800/600",
  //                         image: "å”è€é¸­".img,
  //                         hideSystemBackdrop: true)
  //        .byKFBgImageView("https://picsum.photos/800/600",
  //                         image: "å”è€é¸­".img,
  //                         hideSystemBackdrop: true)
          .byBgImage("å”è€é¸­".img)                      // æœ¬åœ°å›¾èƒŒæ™¯ï¼ˆåŒæ­¥é˜¶æ®µï¼Œæ— åŠ¨ç”»ï¼‰
          .byCardBorder(width: 1, color: .systemBlue)   // å¤–å±‚å¡ç‰‡æè¾¹
          .byAddTextField(placeholder: "æ–°åç§°",
                          borderWidth: nil,             // â† ä¸ç»™ tf è‡ªèº«æè¾¹
                          borderColor: nil,
                          cornerRadius: 8) { alert, tf, input, oldText, isDeleting in
              let ok = alert.actions.first { $0.title == "ç¡®å®š" }
              ok?.isEnabled = !(tf.text ?? "").trimmingCharacters(in: .whitespacesAndNewlines).isEmpty
          }
          .byTextFieldOuterBorder(at: 0,
                                  width: 1,
                                  color: .systemBlue,
                                  cornerRadius: 10,
                                  insets: .init(top: 6, left: 12, bottom: 6, right: 12)) // â† ç»™ç°è‰²å®¹å™¨æè¾¹
          .byAddCancel { _ in                          // âœ… ä¸€ä¸ªå›è°ƒï¼ˆåªç»™ actionï¼‰
              print("Cancel tapped")
          }
          .byAddOK{ alert, _ in                 // éœ€è¦ alert + action çš„å›è°ƒ
              let name = alert.textField(at: 0)?.text ?? ""
              print("new name =", name)
          }
          .byTintColor(.systemBlue)
          .byPresent(self)
  }()
  ```

* ä¸»æ ‡é¢˜ + ç›¸æœº_ç›¸å†Œ_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + å±å¹•åº•éƒ¨å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ

  ```swift
  // MARK: ä¸»æ ‡é¢˜ + ç›¸æœº_ç›¸å†Œ_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + å±å¹•åº•éƒ¨å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeActionSheet("é€‰æ‹©æ¥æº", nil)
          .byAddAction(title: "ç›¸æœº") { _ in
              print("camera")
          }
          .byAddAction(title: "ç›¸å†Œ") { _ in
              print("photos")
          }
          .byAddCancel { _ in
              print("Cancel tapped")
          }
          .byPresent(self)
  }()
  ```

* ä¸»æ ‡é¢˜ + åˆ é™¤_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä»æŒ‰é’®è‡ªèº«ä½ç½®ï¼ˆé”šç‚¹ï¼‰å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ

  ```swift
  // MARK: ä¸»æ ‡é¢˜ + åˆ é™¤_å–æ¶ˆ@æŒ‰é’®è¡Œä¸ºç›‘å¬ + ä»æŒ‰é’®è‡ªèº«ä½ç½®ï¼ˆé”šç‚¹ï¼‰å¼¹å‡º + ç‚¹å‡»ç©ºç™½åŒºåŸŸå¯å–æ¶ˆ
  private lazy var simpleAlert: UIAlertController = {
      UIAlertController
          .makeActionSheet("æ“ä½œ", nil)
          .byAddDestructive("åˆ é™¤") { _ in
              print("delete")
          }
          .byAddCancel { _ in
              print("Cancel tapped")
          }
          .byPresent(self, anchor: .view(sender, sender.bounds)) // æŒ‡å®šé”šç‚¹
  }()
  ```

### 26ã€è°ƒç”¨ç³»ç»Ÿè®¾å¤‡ï¼ˆå†…éƒ¨æœ‰é‰´æƒ@éœ€é…ç½®[**`Info.plist`**](#Info.plist) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 26.1ã€è°ƒç”¨iOSç³»ç»Ÿç›¸æœº@ç…§ç›¸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
#if targetEnvironment(simulator)
  showToast("æ¨¡æ‹Ÿå™¨æ— æ³•ä½¿ç”¨ç›¸æœº"); return
  #else
  guard UIImagePickerController.isSourceTypeAvailable(.camera) else {
      showToast("æ­¤è®¾å¤‡ä¸æ”¯æŒç›¸æœº"); return
  }
  pickFromCamera(allowsEditing: false) { [weak self] img in
      guard let self else { return }
      showToast("å·²æ‹ç…§ 1 å¼ ")
      self.showCameraImage(img)
  }
#endif
```

#### 26.2ã€è°ƒç”¨iOSç³»ç»Ÿç›¸æœº@å½•åƒ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
#if targetEnvironment(simulator)
showToast("æ¨¡æ‹Ÿå™¨æ— æ³•å½•åˆ¶è§†é¢‘"); return
#else
MediaPickerService.recordVideo(from: self, maxDuration: 30, quality: .typeHigh) { [weak self] url in
    guard let self else { return }
    showToast("å·²å½•åˆ¶ 1 æ®µè§†é¢‘")
    self.showCameraVideo(url)
}
#endif
```

#### 26.3ã€è°ƒç”¨iOSç³»ç»Ÿç›¸å†Œ@é€‰ç…§ç‰‡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
/// maxSelection:æœ€å¤§å¯é€‰
pickFromPhotoLibrary(maxSelection: imageMaxSelection, imagesOnly: true) { [weak self] imgs in
    guard let self else { return }
    showToast(imgs.isEmpty ? "æœªé€‰æ‹©å›¾ç‰‡" : "å·²é€‰æ‹© \(imgs.count) å¼ ")
    self.showAlbumImages(imgs)
}
```

#### 26.4ã€è°ƒç”¨iOSç³»ç»Ÿç›¸å†Œ@é€‰è§†é¢‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
/// maxSelection:æœ€å¤§å¯é€‰
pickVideosFromLibrary(maxSelection: 1) { [weak self] urls in
    guard let self, let u = urls.first else { return }
    showToast("å·²é€‰æ‹© 1 ä¸ªè§†é¢‘")
    self.showCameraVideo(u)
}
```

### 27ã€[ğŸ“–](https://sdwebimage.github.io/documentation/sdwebimage/) [**`SDWebImage`**](https://github.com/SDWebImage/SDWebImage) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 27.1ã€`SDAnimatedImage` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **SDAnimatedImage æ˜¯ [`SDWebImage`](https://github.com/SDWebImage/SDWebImage) æä¾›çš„â€œå¯æ’­æ”¾çš„åŠ¨æ€å›¾åƒå¯¹è±¡â€**ï¼ˆç»§æ‰¿è‡ª `UIImage`ï¼‰ï¼Œæ­é… **`SDAnimatedImageView`** æ¥æ’­æ”¾ã€‚å®ƒè§£å†³äº† `UIImage.animatedImageâ€¦` ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰å¸§è§£ç è¿›å†…å­˜ã€å®¹æ˜“å†…å­˜æš´æ¶¨/æ‰å¸§çš„é—®é¢˜
  
  * **æŒ‰éœ€è§£ç **ï¼šä¸æ˜¯æŠŠ **GIF**/**APNG**/**WebP** å…¨éƒ¨å¸§ä¸€æ¬¡æ€§æ”¾è¿›å†…å­˜ï¼Œè€Œæ˜¯â€œè¾¹æ’­è¾¹è§£ç  + å¸§ç¼“å­˜ç­–ç•¥â€ï¼Œæ˜¾è‘—é™ä½å³°å€¼å†…å­˜
  * **å¤šæ ¼å¼åŠ¨ç”»**ï¼šä¸ä»…æ˜¯ **GIF**ï¼Œè¿˜æ”¯æŒ **APNG**ã€**WebP**ã€**HEIC**/**HEIF**ã€**AVIF** ç­‰ï¼ˆé€šè¿‡å¯¹åº” coder æ’ä»¶ï¼‰
  * **å¯æ§ç¼“å­˜**ï¼šæœ‰æœ€å¤§ç¼“å†²åŒºã€å¸§å¤ç”¨ç­‰ç­–ç•¥ï¼Œå¹³è¡¡ **CPU è§£ç ** ğŸ†š **å†…å­˜å ç”¨**
  * **å³æ’å³ç”¨**ï¼šAPI å½¢æ€è·Ÿ `UIImage` ç›¸è¿‘ï¼›åªè¦æŠŠ `SDAnimatedImage` èµ‹ç»™ `SDAnimatedImageView.image` å°±èƒ½å¹³æ»‘æ’­æ”¾
  * **æ›´é¡ºæ»‘**ï¼šåŸºäº `CADisplayLink` çš„é©±åŠ¨ï¼ŒæŒ‰æ¯å¸§çš„çœŸå® duration æ’­æ”¾ï¼Œä¸å®¹æ˜“æ‰å¸§æˆ–èŠ‚å¥ä¸å¯¹
  
* å’Œç³»ç»Ÿ `UIImage.animatedImageâ€¦` çš„å·®å¼‚

  | ç‚¹       | `UIImage.animatedImage` | `SDAnimatedImage`                                     |
  | -------- | ----------------------- | ----------------------------------------------------- |
  | è§£ç ç­–ç•¥ | é¢„è§£æ‰€æœ‰å¸§              | æŒ‰éœ€è§£ç  + å¸§ç¼“å­˜                                     |
  | å†…å­˜å³°å€¼ | é«˜ï¼ˆå¸§æ•°Ã—åˆ†è¾¨ç‡Ã—é€šé“ï¼‰  | ä½å¾ˆå¤š                                                |
  | æ”¯æŒæ ¼å¼ | ä¸»è¦ **GIF**            | **GIF**/**APNG**/**WebP**/**HEIC**/**AVIF**ï¼ˆé…æ’ä»¶ï¼‰ |
  | æ’­æ”¾è§†å›¾ | `UIImageView`           | `SDAnimatedImageView`ï¼ˆæ›´é¡ºæ»‘ã€æ§ä»¶åŒ–ï¼‰               |

* ä½¿ç”¨æ–¹å¼

  * åŸºæœ¬ç”¨æ³•

    ```swift
    import SDWebImage
    import SDWebImageWebPCoder // å¦‚æœéœ€è¦ WebP åŠ¨ç”»
    
    // 1) å¯é€‰ï¼šæ³¨å†Œé¢å¤–çš„ coderï¼ˆä¸€æ¬¡æ€§ï¼‰
    SDImageCodersManager.shared.addCoder(SDImageWebPCoder.shared)
    
    // 2) æ„é€ åŠ¨æ€å›¾åƒå¯¹è±¡
    let data: Data = /* æ¥è‡ªç½‘ç»œæˆ–æœ¬åœ° */
    let animated = SDAnimatedImage(data: data)   // ä¹Ÿå¯ SDAnimatedImage(named: "xxx.gif")
    
    // 3) ç”¨ SDAnimatedImageView æ’­æ”¾
    let imageView = SDAnimatedImageView(frame: .zero)
    imageView.contentMode = .scaleAspectFit
    imageView.image = animated                   // å…³é”®ï¼šä¸æ˜¯ UIImageView
    imageView.startAnimating()                   // å¯çœç•¥ï¼šè®¾ç½® image åä¼šè‡ªåŠ¨æ’­æ”¾
    
    // å¸¸è§æ§åˆ¶
    // imageView.stopAnimating()
    // imageView.animationRepeatCount = 0 // 0 = æ— é™å¾ªç¯ï¼ˆå’Œ UIImageView ä¸€è‡´ï¼‰
    ```

  * ä» URL åŠ è½½ï¼ˆæœ€å¸¸è§ï¼‰

    ```swift
    let iv = SDAnimatedImageView()
    iv.sd_setImage(with: URL(string: "https://example.com/a.webp")) // è‡ªåŠ¨è¯†åˆ«åŠ¨å›¾å¹¶æŒ‰éœ€è§£ç 
    ```

* ç‰¹åˆ«æ³¨æ„

  * **ä¸€å®šç”¨ `SDAnimatedImageView`** æ¥æ’­ `SDAnimatedImage`ï¼Œä¸è¦ç”¨ç³»ç»Ÿ `UIImageView`ã€‚
  * éœ€è¦ **WebP**/**AVIF** ç­‰ï¼Œ**åˆ«å¿˜è£…å¯¹åº” coder æ’ä»¶å¹¶æ³¨å†Œ**ã€‚
  * è¶…å¤§ã€è¶…é•¿åŠ¨å›¾ä»ä¼šåƒ CPUï¼Œå¿…è¦æ—¶**é™åˆ¶å°ºå¯¸/å¸§ç‡æˆ–æ‡’åŠ è½½**ã€‚

### 28ã€æ‚¬æµ®è§†å›¾ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
UIView().bySuspend { cfg in
    cfg
        .byContainer(view)
        .byFallbackSize(CGSize(width: 88, height: 44))
        .byDocking(.nearestEdge)
        .byInsets(UIEdgeInsets(top: 20, left: 16, bottom: 34, right: 16))
        .byHapticOnDock(true)
}

/// æˆ–

UIView().suspend(
    .default
        .byContainer(view)
        .byFallbackSize(CGSize(width: 88, height: 44))
        .byDocking(.nearestEdge)
        .byInsets(UIEdgeInsets(top: 20, left: 16, bottom: 34, right: 16))
        .byHapticOnDock(true)
)
```

### 29ã€æ—‹è½¬è§†å›¾ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
btn.onTap { [weak self] btn in
			 guard let _ = self else { return }
       btn.playTapBounce(haptic: .light)  // ğŸ‘ˆ ä¸´æ—¶æ”¾å¤§â†’å›å¼¹ï¼ˆä¸æ³¨å†Œä»»ä½•æ‰‹åŠ¿/äº‹ä»¶ï¼‰
       if btn.jobs_isSpinning {
           // æš‚åœæ—‹è½¬
           btn.bySpinPause()
           // æš‚åœè®¡æ—¶ï¼ˆä¿ç•™å·²ç´¯è®¡ç§’ï¼Œä¸é‡ç½®ï¼‰
           btn.timer?.pause()        // âœ… æ¨èï¼šä½ çš„ç»Ÿä¸€å†…æ ¸æŒ‚åœ¨ button.timer ä¸Š
           // å¦‚æœä½ æœ‰å°è£…æ–¹æ³•ï¼Œåˆ™ç”¨ï¼šbtn.pauseTimer()
           JobsToast.show(
               text: "å·²æš‚åœæ—‹è½¬ & è®¡æ—¶",
               config: .init().byBgColor(.systemGreen.withAlphaComponent(0.9)).byCornerRadius(12)
           )
       } else {
           // æ¢å¤æ—‹è½¬
           btn.bySpinStart()
           // æ¢å¤è®¡æ—¶ï¼ˆä»æš‚åœå¤„ç»§ç»­ç´¯åŠ ï¼‰
           btn.timer?.resume()       // âœ… æ¨è
           // å¦‚æœä½ æœ‰å°è£…æ–¹æ³•ï¼Œåˆ™ç”¨ï¼šbtn.resumeTimer()
           JobsToast.show(
               text: "ç»§ç»­æ—‹è½¬ & è®¡æ—¶",
               config: .init().byBgColor(.systemGreen.withAlphaComponent(0.9)).byCornerRadius(12)
           )
       }
}
```

### 30ã€è§’æ ‡æç¤º@å³ä¸Šè§’æç¤ºæ–‡æ¡ˆ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å±•ç¤º

  * å³ä¸Šè§’è‡ªå®šä¹‰æ–‡å­—

    ```swift
    UIView().byCornerBadgeText("NEW") { cfg in
                cfg.byOffset(.init(horizontal: -6, vertical: 6))
                    .byInset(.init(top: 2, left: 6, bottom: 2, right: 6))
                    .byBgColor(.systemRed)
                    .byFont(.systemFont(ofSize: 11, weight: .bold))
                    .byShadow(color: UIColor.black.withAlphaComponent(0.25),
                              radius: 2,
                              opacity: 0.6,
                              offset: .init(width: 0, height: 1))
            }
    ```

  * å³ä¸Šè§’å°çº¢ç‚¹

    ```swift
    UIView().byCornerDot(diameter: 10, offset: .init(horizontal: -4, vertical: 4))// çº¢ç‚¹
    ```

* å…³é—­

  ```swift
  UIButton(type: .system)
      /// äº‹ä»¶è§¦å‘@ç‚¹æŒ‰
      .onTap { [weak self] sender in
          guard let self else { return }
          sender.isSelected.toggle()
          if sender.isSelected {
              sender.byCornerDot(diameter: 10, offset: .init(horizontal: -4, vertical: 4))
          } else {
              sender.removeCornerBadge()
          }
          JobsToast.show(
              text: "ä¼˜æƒ @ç‚¹æŒ‰äº‹ä»¶",
              config: JobsToast.Config()
                  .byBgColor(.systemGreen.withAlphaComponent(0.9))
                  .byCornerRadius(12)
          )
      }
  ```

### 31ã€æ¡ä»¶ç¼–è¯‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 31.1ã€`DEBUG` æ¨¡å¼ä¸‹æ‰å…è®¸åšçš„äº‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å®šä¹‰

  ```swift
  // MARK: - DEBUG æ¨¡å¼ä¸‹æ‰å…è®¸åšçš„äº‹
  @inline(__always)
  func debugOnly(_ work: @escaping @MainActor () -> Void) {
      #if DEBUG
      Task { @MainActor in work() }
      #endif
  }
  ```

* ä½¿ç”¨

  ```swift
  debugOnly {  // ä»… Debug æ‰§è¡Œ
      JobsToast.show(
          text: "å½“å‰æ§åˆ¶å™¨é”€æ¯æˆåŠŸ",
          config: JobsToast.Config()
              .byBgColor(.systemGreen.withAlphaComponent(0.9))
              .byCornerRadius(12)
      )
  }
  ```

#### 31.2ã€ä»£ç å¯ç”¨ï¼ˆå½“å¼•å…¥æŸç¬¬ä¸‰æ–¹åï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
#if canImport(Kingfisher)
import UIKit
import Kingfisher
import ObjectiveC.runtime
/// TODO
#endif
```

### 32ã€ğŸ’¼ <font color=green id=bundle>**Bundle**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ‰“å°å½“å‰**Bundle**çš„è·¯å¾„

  ```swift
  print("Bundle:", Bundle.main.bundlePath)
  ```

* æŸ¥æ‰¾å½“å‰çš„**Bundle**åŒ…é‡Œé¢æ˜¯å¦å­˜åœ¨åç¼€åä¸º**html**çš„æ–‡ä»¶

  ```swift
  let all = Bundle.main.urls(forResourcesWithExtension: "html", subdirectory: nil) ?? []
  print("SomeThing in bundle:", all.map { $0.lastPathComponent })
  ```

### 33ã€è¿”å›åˆ°ä¸Šä¸€é¡µ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**å®šä¹‰åœ¨æ§åˆ¶å™¨å±‚çš„è¿”å›åŠŸèƒ½**](#å…³é—­é¡µé¢å®ç°é€»è¾‘)

  ```swift
  closeByResult("")
  ```

### 34ã€ç»™æ§åˆ¶å™¨å¸¦ä¸Šå¯¼èˆªæ§åˆ¶å™¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class SceneDelegate: UIResponder, UIWindowSceneDelegate {
    var window: UIWindow?
    func scene(
        _ scene: UIScene,
        willConnectTo session: UISceneSession,
        options connectionOptions: UIScene.ConnectionOptions
    ) {
        guard let windowScene = (scene as? UIWindowScene) else { return }
        self.window = UIWindow(windowScene: windowScene)
            .byRootViewController(RootListVC().jobsNav.jobsNavContainer)
            .byMakeKeyAndVisible()
    }
}
```

### 35ã€**`NavigationBar`**çš„æ˜¾éšæ§åˆ¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 35.1ã€å¯¹ç³»ç»Ÿçš„å¯¼èˆªæ  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å®˜æ–¹å§¿åŠ¿

  ```swift
  override func viewWillAppear(_ animated: Bool) {
      super.viewWillAppear(animated)
      navigationController?.setNavigationBarHidden(true, animated: animated)
  }
  
  override func viewWillDisappear(_ animated: Bool) {
      super.viewWillDisappear(animated)
      navigationController?.setNavigationBarHidden(false, animated: animated)
  }
  ```

* è¿›å…¥æœ¬é¡µéšè—ï¼›ç¦»å¼€è‡ªåŠ¨è¿˜åŸ

  ```swift
  override func viewDidLoad() {
      super.viewDidLoad()
      byNavBarHiddenLifecycle(true)   // è¿›å…¥æœ¬é¡µéšè—ï¼›ç¦»å¼€è‡ªåŠ¨è¿˜åŸ
  }
  ```

* éšæ—¶éšåœ°æ˜¾éš

  ```
  override func viewDidLoad() {
      super.viewDidLoad()
      self.byNavBarHidden(true)
  }
  ```

#### 35.2ã€å¯¹[**`GKNavigationBarSwift`**]( https://github.com/QuintGao/GKNavigationBarSwift) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
override func viewWillAppear(_ animated: Bool) {
    super.viewWillAppear(animated)
    byGKNavBarHidden(true)          // å½»åº•éšè—
    // æˆ–ï¼šbyGKNavTransparent(true)  // é€æ˜æ²‰æµ¸å¼
}

override func viewWillDisappear(_ animated: Bool) {
    super.viewWillDisappear(animated)
    byGKNavBarHidden(false)         // è¿˜åŸ
    // æˆ–ï¼šbyGKNavTransparent(false)
}
```

### 36ã€ä¿®æ”¹çŠ¶æ€æ é¢œè‰²@å½“å‰æ§åˆ¶å™¨é¡µé¢ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¿®æ”¹**Info.plist**

  ```xml
  <!--  é»˜è®¤ UIViewControllerBasedStatusBarAppearance å°±æ˜¯ YES  -->
  <key>UIViewControllerBasedStatusBarAppearance</key>
  <true/>
  ```

* **`UIViewController`**

  ```swift
  override func viewDidLoad() {
      super.viewDidLoad()
      view.backgroundColor = .systemBackground
  }
  
  override func viewWillAppear(_ animated: Bool) {
      super.viewWillAppear(animated)
      overrideUserInterfaceStyle = .dark
      setNeedsStatusBarAppearanceUpdate()
  }
  
  override var preferredStatusBarStyle: UIStatusBarStyle {
      // æ·±è‰²å¤–è§‚æ—¶ï¼Œå¸¸ç”¨ç™½å­—
      .lightContent   // æµ…è‰²å¤–è§‚ç”¨ .darkContent
  }
  ```

### 37ã€åŠ¨ç”» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **`UIView`**ç‚¹å‡»æ”¾å¤§åŠ¨ç”»

  ```swift
  btn.playTapBounce(haptic: .light)  // ğŸ‘ˆ ä¸´æ—¶æ”¾å¤§â†’å›å¼¹ï¼ˆä¸æ³¨å†Œä»»ä½•æ‰‹åŠ¿/äº‹ä»¶ï¼‰
  ```

* **`UIView`**æ—‹è½¬åŠ¨ç”»

  * å¼€å§‹æ—‹è½¬ï¼ˆåŸºäº CALayerï¼Œä¸æ”¹ view.transformï¼›ä¸ç‚¹å‡»æ”¾å¤§å¯å åŠ ï¼‰
    
    ```swift
    btn.bySpinStart()
    ```
    
  * æš‚åœæ—‹è½¬ï¼ˆä¿æŒå½“å‰è§’åº¦ï¼‰

    ```swift
    btn.bySpinPause()
    ```

  * æ¢å¤æ—‹è½¬ï¼ˆä»æš‚åœè§’åº¦ç»§ç»­ï¼‰

    ```swift
    btn.bySpinResume()
    ```

  * åœæ­¢å¹¶ç§»é™¤æ—‹è½¬åŠ¨ç”»

    ```swift
    btn.bySpinStop()
    ```

### 38ã€å¤šè¯­è¨€å›½é™…åŒ– <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 38.1ã€å¯¹`info.plist`æ–‡ä»¶é‡Œé¢ç”¨åˆ°çš„å­—ç¬¦ä¸²è¿›è¡Œå¤šè¯­è¨€å›½é™…åŒ–çš„å¤„ç† <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> åªèƒ½é  **`InfoPlist.strings` åšå¤šè¯­è¨€**ï¼Œä¸èƒ½ç”¨ `NSLocalizedString` é‚£ä¸€å¥—åœ¨è¿è¡Œæ—¶åˆ‡ã€‚

* æ–°å»ºè¯­è¨€æ˜ å°„æ–‡ä»¶`InfoPlist.strings`

  <table style="width:100%; table-layout:fixed;">
    <tr>
      <td><img src="./assets/image-20251117141745486.png" style="width:110%; height:auto;"></td>
      <td><img src="./assets/image-20251117141820620.png" style="width:50%; height:auto;"></td>
    </tr>
  </table>

  * `InfoPlist.strings (English)`

    ```
    /* 
     InfoPlist.strings (English)
      JobsSwiftBaseConfigDemo
    
      Created by Jobs on 11/17/25.
      
    */
    
    /* ====== Camera / Microphone / Photo Library ====== */
    "NSCameraUsageDescription" = "This app requires access to the camera to take photos and record videos.";
    "NSMicrophoneUsageDescription" = "This app requires access to the microphone to record audio and videos.";
    "NSPhotoLibraryUsageDescription" = "This app requires access to your photo library to select and read your photos and videos.";
    "NSPhotoLibraryAddUsageDescription" = "This app requires permission to save photos and videos to your photo library.";
    
    /* ====== Location (When In Use / Always / Temporary Precise) ====== */
    "NSLocationWhenInUseUsageDescription" = "To provide location-based services, this app needs access to your location while you are using it.";
    "NSLocationAlwaysAndWhenInUseUsageDescription" = "To support continuous location features (navigation, geofencing, etc.), this app needs access to your location in the foreground and background.";
    "NSLocationAlwaysUsageDescription" = "This app needs access to your location in the foreground and background to provide full location services.";
    
    /* iOS 14+ temporary precise location reasons */
    "NavigationPrecise" = "Used for precise navigation and route planning.";
    "NearbySearch" = "Used to find nearby services and devices.";
    "ARAnchors" = "Used for precise positioning and anchors in augmented reality experiences.";
    
    /* ====== Bluetooth ====== */
    "NSBluetoothAlwaysUsageDescription" = "This app needs Bluetooth access to connect to and manage nearby devices.";
    "NSBluetoothPeripheralUsageDescription" = "This app needs Bluetooth access to discover, connect to, and communicate with nearby devices.";
    
    /* ====== Contacts / Calendars / Reminders ====== */
    "NSContactsUsageDescription" = "This app needs access to your contacts to select people or autofill their information.";
    
    "NSCalendarsUsageDescription" = "This app needs access to your calendars to read and write your events.";
    "NSCalendarsFullAccessUsageDescription" = "This app needs full access to your calendars to read, create, and edit your events.";
    "NSCalendarsWriteOnlyAccessUsageDescription" = "This app needs permission to add events to your calendars (write-only, without reading existing events).";
    
    "NSRemindersUsageDescription" = "This app needs access to your reminders to read and create tasks.";
    "NSRemindersFullAccessUsageDescription" = "This app needs full access to your reminders to read, create, and edit tasks.";
    "NSRemindersWriteOnlyAccessUsageDescription" = "This app needs permission to add tasks to your reminders (write-only, without reading existing tasks).";
    
    /* ====== Health / Motion & Fitness ====== */
    "NSHealthShareUsageDescription" = "This app needs to read your health data to provide health-related features and analysis.";
    "NSHealthUpdateUsageDescription" = "This app needs to write health data to log your activities and vital signs.";
    "NSHealthClinicalHealthRecordsShareUsageDescription" = "This app needs to read your clinical health records to provide related services and suggestions.";
    "NSMotionUsageDescription" = "This app needs access to motion and fitness data (accelerometer, step count, etc.) to track and analyze your activity.";
    
    /* ====== Speech / Siri / Face ID ====== */
    "NSSpeechRecognitionUsageDescription" = "This app needs speech recognition to convert your voice into text.";
    "NSSiriUsageDescription" = "This app uses Siri to perform voice commands and shortcuts.";
    "NSFaceIDUsageDescription" = "This app uses Face ID to quickly and securely verify your identity.";
    
    /* ====== HomeKit / Local Network / Bonjour ====== */
    "NSHomeKitUsageDescription" = "This app needs access to your home data to control and manage your HomeKit devices.";
    "NSLocalNetworkUsageDescription" = "This app needs access to your local network to discover and connect to devices or services on your LAN.";
    
    /* ====== NFC ====== */
    "NFCReaderUsageDescription" = "This app needs to use NFC to read and interact with supported nearby tags and devices.";
    
    /* ====== Apple Music / Media Library ====== */
    "NSAppleMusicUsageDescription" = "This app needs access to your media library to read and play your music.";
    
    /* ====== App Tracking Transparency (ATT) ====== */
    "NSUserTrackingUsageDescription" = "To provide more personalized content and ads, this app requests permission to track your activity; your privacy will not be misused.";
    
    /* ====== Nearby Interaction ====== */
    "NSNearbyInteractionUsageDescription" = "This app needs Nearby Interaction to enable ultra-short-range positioning and device interactions.";
    
    /* ====== TV Provider (Video Subscriber Account) ====== */
    "NSVideoSubscriberAccountUsageDescription" = "This app needs access to your TV provider account to verify your subscription and play content.";
    
    /* ====== Critical Alerts ====== */
    "NSCriticalAlertsUsageDescription" = "This app needs to send critical alerts so important events can be notified even in Silent or Do Not Disturb mode.";
    
    /* ====== Focus Status ====== */
    "NSFocusStatusUsageDescription" = "This app needs to read your Focus status so it can send notifications and messages at appropriate times.";
    
    /* ====== Exposure Notification ====== */
    "NSExposureNotificationUsageDescription" = "This app needs Exposure Notifications to alert you to possible contact risks (enabled only where authorized).";
    ```

  * `InfoPlist.strings (Chinese, Simplified)`

    ```
    /* 
     InfoPlist.strings (Chinese, Simplified)
      JobsSwiftBaseConfigDemo
    
      Created by Jobs on 11/17/25.
      
    */
    
    /* ====== ç›¸æœº / éº¦å…‹é£ / ç›¸å†Œ ====== */
    "NSCameraUsageDescription" = "éœ€è¦è®¿é—®ç›¸æœºç”¨äºæ‹æ‘„ç…§ç‰‡æˆ–è§†é¢‘ã€‚";
    "NSMicrophoneUsageDescription" = "éœ€è¦è®¿é—®éº¦å…‹é£ç”¨äºå½•éŸ³æˆ–è§†é¢‘å½•åˆ¶ã€‚";
    "NSPhotoLibraryUsageDescription" = "éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å’Œè¯»å–æ‚¨çš„ç…§ç‰‡ä¸è§†é¢‘ã€‚";
    "NSPhotoLibraryAddUsageDescription" = "éœ€è¦å†™å…¥ç›¸å†Œä»¥ä¿å­˜æ‚¨æ‹æ‘„æˆ–ç¼–è¾‘çš„å›¾ç‰‡/è§†é¢‘ã€‚";
    
    /* ====== å®šä½ï¼ˆä½¿ç”¨æœŸé—´ / å§‹ç»ˆ / ä¸´æ—¶ç²¾ç¡®ï¼‰ ====== */
    "NSLocationWhenInUseUsageDescription" = "ä¸ºæä¾›ä¸ä½ç½®ç›¸å…³çš„æœåŠ¡ï¼Œéœ€è¦åœ¨æ‚¨ä½¿ç”¨ App æœŸé—´è®¿é—®ä½ç½®ä¿¡æ¯ã€‚";
    "NSLocationAlwaysAndWhenInUseUsageDescription" = "ä¸ºå®ç°æŒç»­å®šä½ï¼ˆå¯¼èˆª/åœ°ç†å›´æ ç­‰ï¼‰ï¼Œéœ€è¦åœ¨å‰å°ä¸åå°è®¿é—®ä½ç½®ä¿¡æ¯ã€‚";
    "NSLocationAlwaysUsageDescription" = "éœ€è¦åœ¨å‰å°ä¸åå°è®¿é—®ä½ç½®ä¿¡æ¯ä»¥æä¾›å®Œæ•´å®šä½æœåŠ¡ã€‚";
    
    /* iOS 14+ ä¸´æ—¶â€œç²¾ç¡®å®šä½â€ç”¨é€”å£°æ˜ */
    "NavigationPrecise" = "ç”¨äºç²¾ç¡®å¯¼èˆªä¸è·¯çº¿è§„åˆ’ã€‚";
    "NearbySearch" = "ç”¨äºæŸ¥æ‰¾é™„è¿‘çš„æœåŠ¡ä¸è®¾å¤‡ã€‚";
    "ARAnchors" = "ç”¨äºå¢å¼ºç°å®åœºæ™¯çš„ç²¾ç¡®å®šä½ä¸é”šç‚¹ã€‚";
    
    /* ====== è“ç‰™ï¼ˆæ—§/æ–°ï¼‰ ====== */
    "NSBluetoothAlwaysUsageDescription" = "éœ€è¦ä½¿ç”¨è“ç‰™ä»¥è¿æ¥æˆ–ç®¡ç†é™„è¿‘çš„è®¾å¤‡ã€‚";
    "NSBluetoothPeripheralUsageDescription" = "éœ€è¦ä½¿ç”¨è“ç‰™ä»¥å‘ç°ã€è¿æ¥æˆ–ä¸å‘¨è¾¹è®¾å¤‡é€šä¿¡ã€‚";
    
    /* ====== é€šè®¯å½• / æ—¥å† / æé†’äº‹é¡¹ ====== */
    "NSContactsUsageDescription" = "éœ€è¦è®¿é—®é€šè®¯å½•ä»¥é€‰æ‹©è”ç³»äººæˆ–è‡ªåŠ¨å¡«å……ä¿¡æ¯ã€‚";
    
    "NSCalendarsUsageDescription" = "éœ€è¦è®¿é—®æ—¥å†ä»¥è¯»å–æˆ–å†™å…¥æ‚¨çš„æ—¥ç¨‹ã€‚";
    "NSCalendarsFullAccessUsageDescription" = "éœ€è¦å®Œæ•´è®¿é—®æ‚¨çš„æ—¥å†ä»¥è¯»å–ã€åˆ›å»ºä¸ä¿®æ”¹æ—¥ç¨‹ã€‚";
    "NSCalendarsWriteOnlyAccessUsageDescription" = "éœ€è¦å‘æ‚¨çš„æ—¥å†æ·»åŠ äº‹ä»¶ï¼ˆä»…å†™å…¥ï¼Œä¸è¯»å–å·²æœ‰äº‹ä»¶ï¼‰ã€‚";
    
    "NSRemindersUsageDescription" = "éœ€è¦è®¿é—®æé†’äº‹é¡¹ä»¥è¯»å–æˆ–åˆ›å»ºå¾…åŠã€‚";
    "NSRemindersFullAccessUsageDescription" = "éœ€è¦å®Œæ•´è®¿é—®æé†’äº‹é¡¹ä»¥è¯»å–ã€åˆ›å»ºä¸ä¿®æ”¹å¾…åŠã€‚";
    "NSRemindersWriteOnlyAccessUsageDescription" = "éœ€è¦å‘æé†’äº‹é¡¹æ·»åŠ å¾…åŠï¼ˆä»…å†™å…¥ï¼Œä¸è¯»å–å·²æœ‰å¾…åŠï¼‰ã€‚";
    
    /* ====== å¥åº· / è¿åŠ¨ä¸å¥èº« ====== */
    "NSHealthShareUsageDescription" = "éœ€è¦è¯»å–å¥åº·æ•°æ®ä»¥æä¾›å¥åº·ç›¸å…³åŠŸèƒ½ä¸åˆ†æã€‚";
    "NSHealthUpdateUsageDescription" = "éœ€è¦å†™å…¥å¥åº·æ•°æ®ä»¥è®°å½•æ‚¨çš„è¿åŠ¨æˆ–ä½“å¾ã€‚";
    "NSHealthClinicalHealthRecordsShareUsageDescription" = "éœ€è¦è¯»å–æ‚¨çš„ä¸´åºŠå¥åº·è®°å½•ä»¥æä¾›ç›¸å…³æœåŠ¡ä¸å»ºè®®ã€‚";
    "NSMotionUsageDescription" = "éœ€è¦è®¿é—®è¿åŠ¨ä¸å¥èº«æ•°æ®ï¼ˆåŠ é€Ÿåº¦è®¡/æ­¥æ•°ï¼‰ä»¥ç»Ÿè®¡ä¸åˆ†ææ´»åŠ¨ã€‚";
    
    /* ====== è¯­éŸ³ / Siri / Face ID ====== */
    "NSSpeechRecognitionUsageDescription" = "éœ€è¦è¿›è¡Œè¯­éŸ³è¯†åˆ«ä»¥å°†æ‚¨çš„è¯­éŸ³è½¬æ¢ä¸ºæ–‡æœ¬ã€‚";
    "NSSiriUsageDescription" = "éœ€è¦ä½¿ç”¨ Siri ä»¥æ‰§è¡Œè¯­éŸ³æŒ‡ä»¤æˆ–å¿«æ·æ“ä½œã€‚";
    "NSFaceIDUsageDescription" = "éœ€è¦ä½¿ç”¨ Face ID ä»¥å¿«é€Ÿå®Œæˆå®‰å…¨éªŒè¯ã€‚";
    
    /* ====== å®¶åº­(HomeKit) / æœ¬åœ°ç½‘ç»œ / Bonjour ====== */
    "NSHomeKitUsageDescription" = "éœ€è¦è®¿é—®å®¶åº­æ•°æ®ä»¥æ§åˆ¶æˆ–ç®¡ç†æ‚¨çš„å®¶åº­è®¾å¤‡ã€‚";
    "NSLocalNetworkUsageDescription" = "éœ€è¦è®¿é—®æœ¬åœ°ç½‘ç»œä»¥å‘ç°å’Œè¿æ¥å±€åŸŸç½‘ä¸­çš„è®¾å¤‡æˆ–æœåŠ¡ã€‚";
    
    /* ====== NFC ====== */
    "NFCReaderUsageDescription" = "éœ€è¦ä½¿ç”¨ NFC ä»¥è¯»å–æˆ–äº¤äº’æ”¯æŒçš„è¿‘åœºæ ‡ç­¾/è®¾å¤‡ã€‚";
    
    /* ====== Apple Music / åª’ä½“åº“ ====== */
    "NSAppleMusicUsageDescription" = "éœ€è¦è®¿é—®æ‚¨çš„åª’ä½“åº“ä»¥è¯»å–æˆ–æ’­æ”¾éŸ³ä¹ã€‚";
    
    /* ====== å¹¿å‘Šè·Ÿè¸ªï¼ˆATTï¼‰ ====== */
    "NSUserTrackingUsageDescription" = "ä¸ºæä¾›æ›´ä¸ªæ€§åŒ–çš„å†…å®¹ä¸å¹¿å‘Šä½“éªŒï¼Œéœ€è¦è¯·æ±‚è·Ÿè¸ªæƒé™ï¼›æˆ‘ä»¬ä¸ä¼šæ»¥ç”¨æ‚¨çš„éšç§ã€‚";
    
    /* ====== Nearby Interactionï¼ˆU1/è¶…å®½å¸¦ï¼‰ ====== */
    "NSNearbyInteractionUsageDescription" = "éœ€è¦ä½¿ç”¨è¿‘è·ç¦»äº¤äº’ä»¥å®ç°è¶…è¿‘è·å®šä½ä¸è®¾å¤‡äº¤äº’ã€‚";
    
    /* ====== TV Providerï¼ˆè§†é¢‘è®¢é˜…è´¦æˆ·ï¼‰ ====== */
    "NSVideoSubscriberAccountUsageDescription" = "éœ€è¦è®¿é—®æ‚¨çš„ç”µè§†ä¾›åº”å•†è´¦æˆ·ä»¥éªŒè¯è®¢é˜…å¹¶æ’­æ”¾å†…å®¹ã€‚";
    
    /* ====== å…³é”®æé†’ï¼ˆCritical Alertsï¼‰ ====== */
    "NSCriticalAlertsUsageDescription" = "éœ€è¦å‘é€å…³é”®æé†’ä»¥åœ¨é™éŸ³æˆ–å‹¿æ‰°æ¨¡å¼ä¸‹ä¹Ÿèƒ½é€šçŸ¥é‡è¦äº‹ä»¶ã€‚";
    
    /* ====== ä¸“æ³¨çŠ¶æ€å…±äº«ï¼ˆFocus Statusï¼‰ ====== */
    "NSFocusStatusUsageDescription" = "éœ€è¦è¯»å–æ‚¨çš„ä¸“æ³¨çŠ¶æ€ä»¥åœ¨åˆé€‚çš„æ—¶æœºå‘é€é€šçŸ¥æˆ–æ¶ˆæ¯ã€‚";
    
    /* ====== æš´éœ²é€šçŸ¥ï¼ˆExposure Notificationï¼‰ ====== */
    "NSExposureNotificationUsageDescription" = "éœ€è¦ä½¿ç”¨æš´éœ²é€šçŸ¥ä»¥æé†’å¯èƒ½çš„æ¥è§¦é£é™©ï¼ˆä»…åœ¨è·å¾—æˆæƒçš„åœ°åŒºä¸ç”¨é€”ä¸‹å¯ç”¨ï¼‰ã€‚";
    ```

* `Info.plist`

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
  <plist version="1.0">
  <dict>
  
      <key>UIApplicationSceneManifest</key>
      <dict>
          <key>UIApplicationSupportsMultipleScenes</key>
          <false/>
          <key>UISceneConfigurations</key>
          <dict>
              <key>UIWindowSceneSessionRoleApplication</key>
              <array>
                  <dict>
                      <key>UISceneConfigurationName</key>
                      <string>Default Configuration</string>
                      <key>UISceneDelegateClassName</key>
                      <string>$(PRODUCT_MODULE_NAME).SceneDelegate</string>
                      <key>UISceneStoryboardFile</key>
                      <string>Main</string>
                  </dict>
              </array>
          </dict>
      </dict>
  
      <key>NSAppTransportSecurity</key>
      <dict>
        <!-- ATS é…ç½®ï¼šä»…æ”¾å¼€ WebView å†…å®¹çš„ä»»æ„åŠ è½½ï¼Œå…¶ä»–ç½‘ç»œè¯·æ±‚ä»å— ATS çº¦æŸ -->
        <key>NSAllowsArbitraryLoadsInWebContent</key>
        <true/>
      </dict>
  
      <!-- é€‚é… iOS 16+ çš„ UI å…¼å®¹å¼€å…³ï¼Œä¸æ˜¯éšç§æƒé™ -->
      <key>UIDesignRequiresCompatibility</key>
      <true/>
  
      <!-- ====== ç›¸æœº / éº¦å…‹é£ / ç›¸å†Œ ====== -->
  
      <!-- ç›¸æœºæƒé™ï¼šç”¨äºæ‹ç…§ã€æ‰«ç ã€è§†é¢‘å½•åˆ¶ç­‰éœ€è¦è°ƒç”¨æ‘„åƒå¤´çš„åœºæ™¯ -->
      <key>NSCameraUsageDescription</key>
      <string>NSCameraUsageDescription</string>
  
      <!-- éº¦å…‹é£æƒé™ï¼šç”¨äºå½•éŸ³ã€è§†é¢‘é€šè¯ã€è¯­éŸ³æ¶ˆæ¯ç­‰éœ€è¦é‡‡é›†å£°éŸ³çš„åœºæ™¯ -->
      <key>NSMicrophoneUsageDescription</key>
      <string>NSMicrophoneUsageDescription</string>
  
      <!-- ç›¸å†Œè¯»å–æƒé™ï¼šä»ç³»ç»Ÿç›¸å†Œä¸­é€‰æ‹©ã€è¯»å–ç…§ç‰‡æˆ–è§†é¢‘ -->
      <key>NSPhotoLibraryUsageDescription</key>
      <string>NSPhotoLibraryUsageDescription</string>
  
      <!-- ç›¸å†Œå†™å…¥æƒé™ï¼šå°†æ‹æ‘„æˆ–ç¼–è¾‘åçš„å›¾ç‰‡/è§†é¢‘ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ -->
      <key>NSPhotoLibraryAddUsageDescription</key>
      <string>NSPhotoLibraryAddUsageDescription</string>
  
      <!-- ====== å®šä½ï¼ˆä½¿ç”¨æœŸé—´ / å§‹ç»ˆ / ä¸´æ—¶ç²¾ç¡®ï¼‰ ====== -->
  
      <!-- ä»…â€œä½¿ç”¨æœŸé—´â€å®šä½ï¼šApp åœ¨å‰å°ä½¿ç”¨æ—¶è®¿é—®ä½ç½®ä¿¡æ¯ï¼ˆå¸¸è§å¯¼èˆªã€é™„è¿‘æœåŠ¡ï¼‰ -->
      <key>NSLocationWhenInUseUsageDescription</key>
      <string>NSLocationWhenInUseUsageDescription</string>
  
      <!-- å§‹ç»ˆ + ä½¿ç”¨æœŸé—´å®šä½ï¼šå‰å° + åå°éƒ½å¯è®¿é—®ä½ç½®ä¿¡æ¯ï¼ˆæŒç»­å¯¼èˆªã€åœ°ç†å›´æ ï¼‰ -->
      <key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
      <string>NSLocationAlwaysAndWhenInUseUsageDescription</string>
  
      <!-- æ—§ç³»ç»Ÿå…¼å®¹çš„â€œå§‹ç»ˆå®šä½â€æè¿°ï¼Œå’Œä¸Šé¢çš„é”®é…åˆä½¿ç”¨ -->
      <key>NSLocationAlwaysUsageDescription</key>
      <string>NSLocationAlwaysUsageDescription</string>
  
      <!-- iOS 14+ ä¸´æ—¶â€œç²¾ç¡®å®šä½â€ç”¨é€”å£°æ˜ï¼Œéœ€è¦è¯¦ç»†è¯´æ˜æ¯ä¸ªç”¨é€”åœºæ™¯ -->
  
      <!-- ç²¾ç¡®å¯¼èˆªï¼šæ¯”å¦‚é©¾è½¦/æ­¥è¡Œå¯¼èˆªæ—¶éœ€è¦é«˜ç²¾åº¦å®šä½ -->
      <key>NSLocationTemporaryUsageDescriptionDictionary</key>
      <dict>
          <key>NavigationPrecise</key>
          <string>NavigationPrecise</string>
  
          <!-- é™„è¿‘æœç´¢ï¼šæŸ¥æ‰¾å‘¨è¾¹æœåŠ¡ã€è®¾å¤‡ã€é—¨åº—ç­‰ -->
          <key>NearbySearch</key>
          <string>NearbySearch</string>
  
          <!-- AR é”šç‚¹ï¼šåœ¨å¢å¼ºç°å®åœºæ™¯ä¸­è¿›è¡Œç²¾ç¡®å®šä½å’Œæ”¾ç½®é”šç‚¹ -->
          <key>ARAnchors</key>
          <string>ARAnchors</string>
      </dict>
  
      <!-- ====== è“ç‰™ï¼ˆæ—§/æ–°ï¼‰ ====== -->
  
      <!-- å§‹ç»ˆè“ç‰™æƒé™ï¼šApp åœ¨å‰å°æˆ–åå°éƒ½å¯ä¸è“ç‰™è®¾å¤‡äº¤äº’ -->
      <key>NSBluetoothAlwaysUsageDescription</key>
      <string>NSBluetoothAlwaysUsageDescription</string>
  
      <!-- æ—§é”®ï¼šè“ç‰™å¤–è®¾æƒé™ï¼Œç”¨äºå‘ç°/è¿æ¥/é€šä¿¡é™„è¿‘çš„è“ç‰™è®¾å¤‡ -->
      <key>NSBluetoothPeripheralUsageDescription</key>
      <string>NSBluetoothPeripheralUsageDescription</string>
  
      <!-- ====== é€šè®¯å½• / æ—¥å† / æé†’äº‹é¡¹ ====== -->
  
      <!-- é€šè®¯å½•æƒé™ï¼šè¯»å–è”ç³»äººç”¨äºé€‰æ‹©è”ç³»äººã€è‡ªåŠ¨å¡«å……ç­‰ -->
      <key>NSContactsUsageDescription</key>
      <string>NSContactsUsageDescription</string>
  
      <!-- æ—¥å†åŸºç¡€æƒé™ï¼šè¯»å–/å†™å…¥æ—¥å†äº‹ä»¶ï¼ˆæ—§é”®ï¼Œå…¼å®¹æ€§ç”¨é€”ï¼‰ -->
      <key>NSCalendarsUsageDescription</key>
      <string>NSCalendarsUsageDescription</string>
  
      <!-- iOS 17+ æ—¥å†â€œå®Œå…¨è®¿é—®â€ï¼šå¯è¯»ã€å¯å†™ã€å¯ä¿®æ”¹æ‰€æœ‰æ—¥å†äº‹ä»¶ -->
      <key>NSCalendarsFullAccessUsageDescription</key>
      <string>NSCalendarsFullAccessUsageDescription</string>
  
      <!-- iOS 17+ æ—¥å†â€œä»…å†™å…¥â€ï¼šåªèƒ½å¾€æ—¥å†é‡Œæ·»åŠ äº‹ä»¶ï¼Œä¸èƒ½è¯»å–å·²æœ‰äº‹ä»¶ -->
      <key>NSCalendarsWriteOnlyAccessUsageDescription</key>
      <string>NSCalendarsWriteOnlyAccessUsageDescription</string>
  
      <!-- æé†’äº‹é¡¹åŸºç¡€æƒé™ï¼šè¯»å–/åˆ›å»ºæé†’ï¼ˆæ—§é”®ï¼Œå…¼å®¹æ€§ç”¨é€”ï¼‰ -->
      <key>NSRemindersUsageDescription</key>
      <string>NSRemindersUsageDescription</string>
  
      <!-- iOS 17+ æé†’äº‹é¡¹â€œå®Œå…¨è®¿é—®â€ï¼šè¯»ã€å†™ã€æ”¹æ‰€æœ‰å¾…åŠ/æé†’ -->
      <key>NSRemindersFullAccessUsageDescription</key>
      <string>NSRemindersFullAccessUsageDescription</string>
  
      <!-- iOS 17+ æé†’äº‹é¡¹â€œä»…å†™å…¥â€ï¼šåªèƒ½æ·»åŠ æ–°çš„å¾…åŠï¼Œä¸è¯»å–å·²æœ‰è®°å½• -->
      <key>NSRemindersWriteOnlyAccessUsageDescription</key>
      <string>NSRemindersWriteOnlyAccessUsageDescription</string>
  
      <!-- ====== å¥åº· / è¿åŠ¨ä¸å¥èº«ï¼ˆHealthKitï¼‰ ====== -->
  
      <!-- å¥åº·æ•°æ®è¯»å–æƒé™ï¼šä» HealthKit è¯»å–å¥åº·/ä½“å¾/è¿åŠ¨æ•°æ® -->
      <key>NSHealthShareUsageDescription</key>
      <string>NSHealthShareUsageDescription</string>
  
      <!-- å¥åº·æ•°æ®å†™å…¥æƒé™ï¼šå‘ HealthKit å†™å…¥è¿åŠ¨è®°å½•ã€å¥åº·æŒ‡æ ‡ç­‰ -->
      <key>NSHealthUpdateUsageDescription</key>
      <string>NSHealthUpdateUsageDescription</string>
  
      <!-- ä¸´åºŠå¥åº·æ¡£æ¡ˆè¯»å–ï¼šè®¿é—®åŒ»é™¢/è¯Šæ‰€ç­‰æ¥æºçš„ä¸´åºŠå¥åº·è®°å½• -->
      <key>NSHealthClinicalHealthRecordsShareUsageDescription</key>
      <string>NSHealthClinicalHealthRecordsShareUsageDescription</string>
  
      <!-- è¿åŠ¨ä¸å¥èº«æƒé™ï¼šè®¿é—®åŠ é€Ÿåº¦è®¡ã€æ­¥æ•°ç­‰è¿åŠ¨æ•°æ® -->
      <key>NSMotionUsageDescription</key>
      <string>NSMotionUsageDescription</string>
  
      <!-- ====== è¯­éŸ³ / Siri / Face ID ====== -->
  
      <!-- è¯­éŸ³è¯†åˆ«æƒé™ï¼šå°†è¯­éŸ³å®æ—¶è½¬æˆæ–‡å­—ï¼ˆéå½•éŸ³æœ¬èº«ï¼‰ -->
      <key>NSSpeechRecognitionUsageDescription</key>
      <string>NSSpeechRecognitionUsageDescription</string>
  
      <!-- Siri æƒé™ï¼šä½¿ç”¨ Siri æ‰§è¡Œè¯­éŸ³æŒ‡ä»¤ã€å¿«æ·æŒ‡ä»¤ -->
      <key>NSSiriUsageDescription</key>
      <string>NSSiriUsageDescription</string>
  
      <!-- Face ID æƒé™ï¼šç”¨é¢å®¹è¯†åˆ«è¿›è¡Œç™»å½•ã€æ”¯ä»˜æˆ–æ•æ„Ÿæ“ä½œéªŒè¯ -->
      <key>NSFaceIDUsageDescription</key>
      <string>NSFaceIDUsageDescription</string>
  
      <!-- ====== å®¶åº­(HomeKit) / æœ¬åœ°ç½‘ç»œ / Bonjour ====== -->
  
      <!-- HomeKit æƒé™ï¼šæ§åˆ¶å’Œç®¡ç†æ™ºèƒ½å®¶å±…è®¾å¤‡ï¼ˆç¯ã€é—¨é”ç­‰ï¼‰ -->
      <key>NSHomeKitUsageDescription</key>
      <string>NSHomeKitUsageDescription</string>
  
      <!-- æœ¬åœ°ç½‘ç»œæƒé™ï¼šåœ¨å±€åŸŸç½‘ä¸­å‘ç°å¹¶è¿æ¥å…¶å®ƒè®¾å¤‡æˆ–æœåŠ¡ -->
      <key>NSLocalNetworkUsageDescription</key>
      <string>NSLocalNetworkUsageDescription</string>
  
      <!-- Bonjour æœåŠ¡åˆ—è¡¨ï¼šå£°æ˜éœ€è¦å‘ç°çš„å±€åŸŸç½‘æœåŠ¡ç±»å‹ -->
      <key>NSBonjourServices</key>
      <array>
          <!-- æŒ‰éœ€æ·»åŠ ä½ çœŸå®ä½¿ç”¨çš„æœåŠ¡ç±»å‹ï¼›ä¸‹é¢æ˜¯ç¤ºä¾‹ -->
          <string>_http._tcp.</string>
          <string>_airplay._tcp.</string>
          <string>_yourservice._tcp.</string>
      </array>
  
      <!-- ====== NFC ====== -->
  
      <!-- NFC æƒé™ï¼šè¯»å– NFC æ ‡ç­¾æˆ–ä¸æ”¯æŒ NFC çš„è®¾å¤‡äº¤äº’ -->
      <key>NFCReaderUsageDescription</key>
      <string>NFCReaderUsageDescription</string>
  
      <!-- ====== Apple Music / åª’ä½“åº“ ====== -->
  
      <!-- åª’ä½“åº“æƒé™ï¼šè®¿é—®ç³»ç»ŸéŸ³ä¹åº“ï¼Œè¯»å–/æ’­æ”¾éŸ³ä¹ -->
      <key>NSAppleMusicUsageDescription</key>
      <string>NSAppleMusicUsageDescription</string>
  
      <!-- ====== å¹¿å‘Šè·Ÿè¸ªï¼ˆATTï¼‰ ====== -->
  
      <!-- App Tracking æƒé™ï¼šç”¨äºè·¨ App / ç½‘ç«™çš„å¹¿å‘Šå½’å› ä¸ä¸ªæ€§åŒ–æ¨è -->
      <key>NSUserTrackingUsageDescription</key>
      <string>NSUserTrackingUsageDescription</string>
  
      <!-- ====== Nearby Interactionï¼ˆU1/è¶…å®½å¸¦ï¼‰ ====== -->
  
      <!-- è¿‘è·ç¦»äº¤äº’æƒé™ï¼šåˆ©ç”¨ UWB/è¶…å®½å¸¦è¿›è¡Œè¶…è¿‘è·ç¦»å®šä½ä¸è®¾å¤‡ååŒ -->
      <key>NSNearbyInteractionUsageDescription</key>
      <string>NSNearbyInteractionUsageDescription</string>
  
      <!-- ====== TV Providerï¼ˆè§†é¢‘è®¢é˜…è´¦æˆ·ï¼‰ ====== -->
  
      <!-- ç”µè§†ä¾›åº”å•†è´¦æˆ·æƒé™ï¼šéªŒè¯ç”¨æˆ·è®¢é˜…ï¼Œç”¨äºæ’­æ”¾ä»˜è´¹é¢‘é“/è§†é¢‘ -->
      <key>NSVideoSubscriberAccountUsageDescription</key>
      <string>NSVideoSubscriberAccountUsageDescription</string>
  
      <!-- ====== å…³é”®æé†’ï¼ˆCritical Alertsï¼Œéœ€è¦ç‰¹æƒèƒ½åŠ›ï¼‰ ====== -->
  
      <!-- å…³é”®æé†’æƒé™ï¼šåœ¨é™éŸ³/å‹¿æ‰°æ¨¡å¼ä¸‹ä»å¯å‘å‡ºé«˜ä¼˜å…ˆçº§é€šçŸ¥ -->
      <key>NSCriticalAlertsUsageDescription</key>
      <string>NSCriticalAlertsUsageDescription</string>
  
      <!-- ====== ä¸“æ³¨çŠ¶æ€å…±äº«ï¼ˆFocus Statusï¼‰ ====== -->
  
      <!-- è¯»å–ä¸“æ³¨çŠ¶æ€ï¼šæ ¹æ®å½“å‰ä¸“æ³¨æ¨¡å¼è°ƒæ•´é€šçŸ¥/æ¶ˆæ¯çš„å‘é€æ—¶æœº -->
      <key>NSFocusStatusUsageDescription</key>
      <string>NSFocusStatusUsageDescription</string>
  
      <!-- ====== æš´éœ²é€šçŸ¥ï¼ˆExposure Notificationï¼Œéœ€è¦ç‰¹æƒèƒ½åŠ›ï¼‰ ====== -->
  
      <!-- æš´éœ²é€šçŸ¥æƒé™ï¼šç”¨äºç–«æƒ…ç­‰åœºæ™¯ä¸‹çš„æ¥è§¦é£é™©æé†’ï¼ˆéœ€å®˜æ–¹æˆæƒï¼‰ -->
      <key>NSExposureNotificationUsageDescription</key>
      <string>NSExposureNotificationUsageDescription</string>
  
  </dict>
  </plist>
  ```


#### 38.2ã€å¯¹å…¨å±€æ™®é€šçš„å­—ç¬¦ä¸²è¿›è¡Œå¤šè¯­è¨€å›½é™…åŒ–çš„å¤„ç† <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ–°å»ºè¯­è¨€æ˜ å°„æ–‡ä»¶`*.strings`
 ![image-20251101165105182](./assets/image-20251101165105182.png)

 * `Localizable.strings (English)` **ä¸­æ–‡ä¸ºé”®**

   ```
   "ğŸ”‘ æ³¨å†Œç™»å½•" = "ğŸ”‘ Sign in / Register";
   ```

 * `Localizable.strings (Chinese, Simplified)`

   ```
   "ğŸ”‘ æ³¨å†Œç™»å½•" = "ğŸ”‘ æ³¨å†Œç™»å½•";
   ```

* å¯åŠ¨é…ç½®
  
  ```swift
  func application(
      _ application: UIApplication,
      didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
      TRLang.bundleProvider = { LanguageManager.shared.localizedBundle }
      TRLang.localeCodeProvider = { LanguageManager.shared.currentLanguageCode }
      return true
  }
  ```
  
* ä½¿ç”¨æ–¹å¼ï¼ŒApiç±»[**Flutter**](https://flutter.dev)

   ```swift
   "ğŸ”‘ æ³¨å†Œç™»å½•".tr
   ```

* è¯´æ˜

   * åˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡å‘é€šçŸ¥æ¥è½¬æ¢çš„
   * å¯¹äºå·²ç»èµ‹å€¼çš„UIæ§ä»¶ï¼Œè¿˜æ˜¯éœ€è¦é‡æ–°èµ‹å€¼ã€‚**`*.tr`**åªæ˜¯æ”¹å˜å­—ç¬¦ä¸²

### 39ã€PDF <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
import PDFKit // ç³»ç»ŸAPI

private lazy var pdfView: PDFView = {
    PDFView()
        .byAutoScales(NO) // äº¤ç»™æˆ‘ä»¬æ‰‹åŠ¨æ§åˆ¶
        .byDisplayMode(.singlePageContinuous)
        .byDisplayDirection(.vertical)
        .byBgColor(.secondarySystemBackground)
        .byAddTo(view) { [unowned self] make in
            make.top.equalTo(view.safeAreaLayoutGuide.snp.top)
            make.leading.trailing.equalTo(view.safeAreaLayoutGuide)
            make.bottom.equalTo(thumbnailView.snp.top)
        }
}()

private lazy var thumbnailView: PDFThumbnailView = { [unowned self] in
    PDFThumbnailView()
        .byLayoutMode(.horizontal)
        .byThumbnailSize(CGSize(width: 60, height: 80))
        .byBgColor(.tertiarySystemBackground)
        .byContentInset(UIEdgeInsets(top: 6, left: 8, bottom: 6, right: 8))
        .byAddTo(view) { [unowned self] make in
            make.leading.trailing.equalTo(view.safeAreaLayoutGuide)
            make.bottom.equalTo(view.safeAreaLayoutGuide.snp.bottom)
            make.height.equalTo(96)
        }
}()

thumbnailView.byPDFView(to: pdfView)

override func viewDidLayoutSubviews() {
    super.viewDidLayoutSubviews()
    pdfView.byFitScale(max: 4.0)
        .byFitNow(maxScale: 4.0)
}
/// å¯é€‰å¢å¼ºï¼ˆé¿å…æ—‹è½¬ååˆå˜æ ·ï¼‰ï¼š
override func viewWillTransition(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator) {
    super.viewWillTransition(to: size, with: coordinator)
    coordinator.animate(alongsideTransition: { _ in
        let fit = self.pdfView.scaleFactorForSizeToFit
        self.pdfView.minScaleFactor = fit
        self.pdfView.maxScaleFactor = max(fit, 4.0)
        self.pdfView.scaleFactor   = fit
    })
}
```

### 40ã€è½¯é”®ç›˜é€€å‡º <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
jobsDismissKeyboard()
```

### 41ã€`UITableViewCell`  çš„æ•°æ®é…ç½®ä½“ç³»ï¼ˆ`UICollectionViewCell` åŒç†ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ­¤åè®®ç”¨äº `UITableViewCell` äº¦å¯ç”¨äº`UICollectionViewCell` 

  ```swift
  // MARK: - ç»Ÿä¸€çš„ã€Œä»»æ„é…ç½®ã€åè®®
  public protocol JobsConfigCellProtocol: AnyObject {
      /// any å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ˆstruct / enum / tuple / dictï¼‰ï¼Œ
      /// åœ¨å…·ä½“ cell é‡Œè‡ªå·±å»è§£åŒ…ã€‚
      @discardableResult
      func byConfigure(_ any: Any?) -> Self
  }
  ```

* é€šè¿‡ä¸€æŸ**æ•°æ®æŸ**è¿›è¡Œç®¡ç†ï¼Œé™¤äº†èƒ½æºå¸¦å¿…è¦çš„é…ç½®ä¿¡æ¯ä»¥å¤–ï¼Œ**è¿˜å¯ä»¥æºå¸¦ä¸€äº›ç‰¹å®šçš„æ•°æ®ï¼ˆdata: Any?ï¼‰**

  ```swift
  // MARK: - é€šç”¨äº UITableViewCell å’Œ UICollectionViewCell çš„æ¨¡å‹ç»„ä»¶
  public struct JobsCellConfig {
      public let title: String?
      public let detail: String?
      public let image: UIImage?
      public let data: Any?
  
      public init(title: String? = nil,
                  detail: String? = nil,
                  image: UIImage? = nil,
                  data: Any? = nil) {
          self.title = title
          self.detail = detail
          self.image = image
          self.data = data 
      }
  }
  ```

* ç»™æ‰€æœ‰çš„`UITableViewCell`æ·»åŠ æ­¤åè®®ï¼ˆ**`JobsConfigCellProtocol`**ï¼‰æ‰€èµ‹äºˆçš„æ–¹æ³•ï¼ˆ**`byConfigure`**ï¼‰,ä»¥ä¼ é€’æ•°æ®æ¨¡å‹ï¼ˆ**`JobsCellConfig`**ï¼‰

  ```swift
  extension UITableViewCell: JobsConfigCellProtocol {
      @discardableResult
      @objc
      public func byConfigure(_ any: Any?) -> Self {
          // å¦‚æœä¸æ˜¯ç»™æ™®é€š value1 ç”¨çš„ï¼Œç›´æ¥å¿½ç•¥
          guard let cfg = any as? JobsCellConfig else { return self }
          if #available(iOS 14.0, *) {
              return byContentConfiguration { content in
                  // ä½ è‡ªå·±çš„ UIListContentConfiguration DSL å†™æ³•
                  content
                      .byText(cfg.title)
                      .bySecondaryText(cfg.detail)
                      .byImage(cfg.image)
              }
          } else {
              // æ—§ç³»ç»Ÿä¾èµ– textLabel / detailTextLabel
              if let title = cfg.title {
                  textLabel?.byText(title)
              }
              if let detail = cfg.detail {
                  detailTextLabel?.byText(detail)
              }
              if let image = cfg.image {
                  imageView?.byImage(image)
              };return self
          }
      }
  }
  ```

* åœ¨è‡ªå®šä¹‰çš„`UITableViewCell`é‡Œé¢è¿›è¡Œè‡ªæˆ‘è§£æ

  ```swift
  final class AvatarCell: UITableViewCell {
  
      private lazy var avatarView: UIImageView = {
          UIImageView()
              .byContentMode(.scaleAspectFill)
              .byClipsToBounds(true)
              .byCornerRadius(22)
              .byBgColor(.systemGray5)
              .byAddTo(contentView) { [unowned self] make in
                  make.size.equalTo(CGSize(width: 44, height: 44))
                  make.centerY.equalToSuperview()
                  // é¢„ç•™ disclosureIndicator çš„ç©ºé—´
                  make.trailing.equalToSuperview().inset(16)
              }
      }()
  
      override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {
          super.init(style: .value1, reuseIdentifier: reuseIdentifier)
          bySelectionStyle(.none)
              .byAccessoryType(.disclosureIndicator)
  
          textLabel?.byFont(.systemFont(ofSize: 16)).byTextColor(.label)
          detailTextLabel?.byFont(.systemFont(ofSize: 14)).byTextColor(.secondaryLabel)
          avatarView.byVisible(YES)
      }
  
      required init?(coder: NSCoder) {
          fatalError("init(coder:) has not been implemented")
      }
  
      @discardableResult
      @objc
      override func byConfigure(_ any: Any?) -> Self {
          guard let cfg = any as? JobsCellConfig else { return self }
  
          // å¤´åƒè¡Œåªå…³å¿ƒ title + imageï¼Œdetail ç›´æ¥å¿½ç•¥
          if let title = cfg.title {
              textLabel?.byText(title)
          }
          if let image = cfg.image {
              avatarView.byImage(image)
          }
          return self
      }
  }
  ```

### 42ã€ğŸ¨ å­—ç¬¦ä¸²å–è‰²ï¼ˆæ ¡éªŒè§„å®šæ ¼å¼ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
/// æ”¯æŒæ ¼å¼ï¼š
/// "#RRGGBB" / "RRGGBB" / "0xRRGGBB"
/// "#RGB"   / "RGB"
/// "#AARRGGBB" / "AARRGGBB"

"#353a3e".cor          // OK â†’ æ­£å¸¸è‰²
"353a3e".cor           // OK
"0x353a3e".cor         // OK
"#FFF".cor             // OK â†’ å±•å¼€æˆ #FFFFFF
"80FF0000".cor         // OK â†’ alpha=0x80, red
"ä¹±ä¸ƒå…«ç³Ÿ".cor         // âŒ â†’ ç›´æ¥çº¢è‰²

"80FF0000".cor(alpha: 1) // alpha èµ°å­—ç¬¦ä¸²é‡Œçš„ 0x80ï¼Œè€Œä¸æ˜¯ä½ ä¼ çš„ 1
"åƒåœ¾".cor(.black)        // éæ³• â†’ black
```

### 43ã€ç½‘ç»œæ•°æ®çš„ç›‘å¬ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

![image-20251117172827722](./assets/image-20251117172827722.png)

#### 43.1ã€ç›‘å¬ï¼šæ•°æ®æ¥æº + ä¸Šè¡Œâ¬†ï¸ / ä¸‹è½½â¬‡ï¸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
networkNormalListenerBy(view) // æ™®é€šæ–‡æœ¬
networkRichListenerBy(view) // å¯Œæ–‡æœ¬
```

```swift
/// æ‰‹åŠ¨ç§»é™¤
deinit {
    JobsNetworkTrafficMonitorStop()  /// åœæ­¢ç½‘ç»œå®æ—¶ç›‘å¬
}
```

#### 43.2ã€ç›‘å¬ç¬¬ä¸€æ¬¡æ•°æ®æº <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
 jobsWaitNetworkDataReady(
     onWiFiReady: {
         print("âœ… Wi-Fi å·²æœ‰çœŸå®æµé‡")
     },
     onCellularReady: {
         print("âœ… èœ‚çªå·²å®é™…å¯ç”¨ï¼Œå¯ä»¥èµ°åç»­é€»è¾‘")
         // æ¯”å¦‚è¿™é‡Œå†å»é‡è¯•æ¥å£ã€å‘èµ·æ’­æ”¾ç­‰
     }
 )
```

```swift
/// æ‰‹åŠ¨ç§»é™¤
deinit {
    JobsCancelWaitNetworkDataReady()       /// åœæ­¢ç½‘ç»œæ•°æ®æºç›‘å¬
}
```

### 44ã€å°†ä¸åŒçš„æ•°æ®åˆäºŒä¸ºä¸€ï¼ˆæ™®é€šå­—ç¬¦ä¸²â•å¯Œæ–‡æœ¬å­—ç¬¦ä¸²ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é€šè¿‡**`func byConfigure(_ any: Any?) -> Self`**å¯¹å¤–ç»Ÿä¸€æ¥æ”¶å”¯ä¸€çš„æ•°æ®æŸï¼ˆè¿™é‡Œæ˜¯**`JobsCellConfig`**ï¼‰ï¼Œæ–¹ä¾¿ç®¡ç†

  ```swift
  // MARK: - ç»Ÿä¸€çš„ã€Œä»»æ„é…ç½®ã€åè®®
  public protocol JobsConfigCellProtocol: AnyObject {
      /// any å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ˆstruct / enum / tuple / dictï¼‰ï¼Œ
      /// åœ¨å…·ä½“ cell é‡Œè‡ªå·±å»è§£åŒ…ã€‚
      @discardableResult
      func byConfigure(_ any: Any?) -> Self
  }
  ```

  ```swift
  extension UITableViewCell: JobsConfigCellProtocol {
      @discardableResult
      @objc
      public func byConfigure(_ any: Any?) -> Self {
          // å¦‚æœä¸æ˜¯ç»™æ™®é€š value1 ç”¨çš„ï¼Œç›´æ¥å¿½ç•¥
          guard let cfg = any as? JobsCellConfig else { return self }
          if #available(iOS 14.0, *) {
              return self
                  .byJobsText(cfg.title)                  // è§£æä¸ºæ™®é€šå­—ç¬¦ä¸²
                  .bySecondaryJobsText(cfg.detail)        // è§£æä¸ºå¯Œæ–‡æœ¬å­—ç¬¦ä¸²
                  .byImage(cfg.image)
          } else {
              // æ—§ç³»ç»Ÿä¾èµ– textLabel / detailTextLabel
              if let title = cfg.title {
                  textLabel?.byJobsAttributedText(title)
              }
              if let detail = cfg.detail {
                  detailTextLabel?.byJobsAttributedText(detail)
              }
              if let image = cfg.image {
                  imageView?.byImage(image)
              };return self
          }
      }
  }
  ```

* è‡ªå®šä¹‰æ•°æ®ï¼ˆæ¨¡å‹ï¼‰å±‚**`JobsCellConfig`**

  * æ•°æ®æ¨¡å‹é‡Œé¢çš„æ•°æ®ç±»å‹æ˜¯**`JobsText`**

    ```swift
    // MARK: - é€šç”¨äº UITableViewCell å’Œ UICollectionViewCell çš„æ¨¡å‹ç»„ä»¶
    public struct JobsCellConfig {
        public let title: JobsText?
        public let detail: JobsText?
        public let image: UIImage?
        public let data: Any?
    
        public init(title: JobsText? = nil,
                    detail: JobsText? = nil,
                    image: UIImage? = nil,
                    data: Any? = nil) {
            self.title = title
            self.detail = detail
            self.image = image
            self.data = data
        }
    }
    ```

  * æšä¸¾é‡Œé¢çš„å€¼çš„ç±»å‹æ˜¯**`JobsText`**

    ```swift
    // MARK: - è¡Œæ¨¡å‹
    private enum EditProfileRow: CaseIterable {
        case avatar
        case nickname
        case gender
    
        var title: JobsText {
            switch self {
            case .avatar:     return "å¤´åƒ"
            case .nickname:   return "æ˜µç§°"
            case .gender:     return "æ€§åˆ«"
            }
        }
    		/// â¤ï¸ è¿™é‡Œçš„å­—æ®µâ€œdetailâ€ï¼Œæ—¢å¯ä»¥æ˜¯Stringç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯NSAttributedStringç±»å‹ã€‚åˆäºŒä¸ºä¸€
        var detail: JobsText? {
            switch self {
            case .avatar:
                return nil
            case .nickname:
              	/// å¯Œæ–‡æœ¬
                return JobsText(JobsRichText.make([
                    JobsRichRun(.text("ç­‰çº§è¾¾åˆ°2çº§æ‰èƒ½ä¿®æ”¹æ˜µç§°"))
                        .font(.systemFont(ofSize: 14))
                        .color(.systemRed),
                    JobsRichRun(.text("Eric"))
                        .font(.systemFont(ofSize: 14, weight: .semibold))
                        .color(.secondaryLabel)
                ]))
            case .gender:
                /// æ™®é€šæ–‡æœ¬
                return "female"
        }
    }
    ```

* æ•°æ®çŒå…¥

  ```swift
  tableView.py_dequeueReusableCell(withType: BaseTableViewCellByValue1.self, for: indexPath)
           .byConfigure(JobsCellConfig(title: row.title,detail:row.detail))
  ```

* <font color=red>**æ•°æ®è§£æï¼ˆæ ¸å¿ƒï¼‰**</font>

  * è§£ææ•°æ®åˆ°`UILabel`

    ```swift
    extension UILabel {
        @discardableResult
        func byJobsAttributedText(_ text: JobsText?) -> Self {
            guard let text else { return self }
            self.attributedText = text.asAttributed
            return self
        }
        @discardableResult
        func byJobsText(_ text: JobsText?) -> Self {
            guard let text else { return self }
            self.text = text.asString
            return self
        }
    }
    ```

  * è§£ææ•°æ®åˆ°`UITableViewCell`

    ```swift
    public extension UITableViewCell {
        /// è§£æä¸ºå¯Œæ–‡æœ¬
        func byJobsAttributedText(_ text: JobsText?) -> Self {
            guard let text else { return self }
            if #available(iOS 14.0, *) {
                return byContentConfiguration { $0.attributedText = text.asAttributed }
            } else {
                self.textLabel?.attributedText = text.asAttributed
                return self
            };
        }
        /// è§£æä¸ºæ™®é€šæ–‡æœ¬
        func byJobsText(_ text: JobsText?) -> Self {
            guard let text else { return self }
            if #available(iOS 14.0, *) {
                return byContentConfiguration { $0.text = text.asString }
            } else {
                self.textLabel?.text = text.asString
                return self
            };
        }
    }
    ```

### 45ã€æœ‰åºå­—å…¸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

iOS çš„åŸç”Ÿå­—å…¸ï¼Œåœ¨æ‰“å°çš„æ—¶å€™ä¸ä¼šæŒ‰ç…§é”®å€¼å¯¹çš„æ·»åŠ å…ˆåé¡ºåºæ‰“å°ã€‚æ­¤æ—¶éœ€è¦ç”¨åˆ°[**OrderedDictionary**](https://github.com/apple/swift-collections#)

```ruby
pod 'swift-collections'                  # https://github.com/apple/swift-collections#       â¤ï¸ æœ‰åºå­—å…¸
```

```swift
/// https://github.com/apple/swift-collections#
/// åŒä¸€ä¸ªç±»å‹ï¼Œä¸åŒæ¥å…¥æ–¹å¼çš„ module åä¸ä¸€æ ·
#if canImport(Collections)
import Collections          // âœ… Pod æˆ– SPM ç›´æ¥æ¥ apple/swift-collections
#elseif canImport(OrderedCollections)
import OrderedCollections   // âœ… SPM åªæ¥ OrderedCollections product çš„æƒ…å†µ
#endif
```

![image-20251118154055795](./assets/image-20251118154055795.png)

### 46ã€[**å®‰å…¨å–å€¼**](#Subscript) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å®‰å…¨å–å­—ç¬¦

  ```swift
  let s = "Jobs"
  print(s[1] as Any)   // Optional("o")
  print(s[10] as Any)  // nil
  ```

* å®‰å…¨å–æ•°ç»„

  ```swift
  let arr = [10, 20, 30]
  
  let a = arr[safe:1]              // Optional(20)
  let b = arr[safe:99]             // nil
  print(a as Any)   // Optional(20)
  print(b as Any)  // nil
  ```

* å®‰å…¨å–å­—å…¸

  ```swift
  let dict = ["a": 1, "b": 2]
  
  let x = dict[safe: "a"]                 // Optional(1)
  let y = dict[safe: "zzz"]               // nil
  
  print(x as Any)   // Optional("o")
  print(y as Any)   // nil
  ```
  
* å®‰å…¨å–`UICollectionViewCell`

  ```swift
  let cell = collectionView[section: 0, item: 3]
  let cell1 = collectionView[section: 0, item: 300]
  print("")
  ```
  
* å®‰å…¨å–`UITableViewCell`

  ```swift
  let cell = tableView[section: 0, row: 3]
  let cell1 = tableView[section: 12, row: 3]
  print("")
  ```

### 47ã€`UserDefaults.standard` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
public let UD = UserDefaults.standard

struct UserInfoModel: Codable {
    let id: Int
    let name: String
    let isVIP: Bool
}
```

#### 47.1ã€å­˜å–å¯¹è±¡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å­˜å¯¹è±¡**

  ```swift
  func udSave(){
      UD.save(UserInfoModel(id: 1001, name: "Jobs", isVIP: true), forKey: "kUserInfo")
  }
  ```

* **å–å¯¹è±¡**

  ```swift
  func udRead(){
      // è¯»å–æ—¶æŒ‡å®šç±»å‹
      if let loadedUser = UD.load(UserInfoModel.self, forKey: "kUserInfo") {
          print(loadedUser.id)     // 1001
          print(loadedUser.name)   // Jobs
          print(loadedUser.isVIP)  // true
      } else {
          print("è¿˜æ²¡æœ‰å­˜è¿‡ç”¨æˆ·ä¿¡æ¯")
      }
  }
  ```

#### 47.2ã€å­˜å–[**Swift**](https://developer.apple.com/swift/)çš„åŸºæœ¬æ•°æ®ç±»å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å­˜ Int**

  ```swift
  func udSaveAge() {
      let age = 18
      UD.save(age, forKey: "kUserAge")   // T = Intï¼ˆInt: Codableï¼‰
  }
  ```

* **å– Int**

  ```swift
  func udReadAge() {
      let age: Int? = UD.load(Int.self, forKey: "kUserAge")
      if let age {
          print("å½“å‰å¹´é¾„ï¼š\(age)")
      } else {
          print("è¿˜æ²¡æœ‰å­˜è¿‡å¹´é¾„")
      }
  }
  ```

### 48ã€æ—‹è½¬çš„æŠ½å¥–è½®ç›˜ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  private lazy var wheelView: LuckyWheelView = {
      LuckyWheelView()
          .bySegments([
              .init(text: "ä¸€ç­‰å¥–".tr,
                    textFont: .systemFont(ofSize: 12, weight: .medium),
                    textColor: .randomColor,
                    backgroundColor: .randomColor,
                    placeholderImage: "globe".sysImg,
                    imageURLString:"https://picsum.photos/30"),
              .init(text: "äºŒç­‰å¥–".tr,
                    textFont: .systemFont(ofSize: 12, weight: .medium),
                    textColor: .randomColor,
                    backgroundColor: .randomColor,
                    placeholderImage: "plus".sysImg,
                    imageURLString:"https://picsum.photos/30"),
              .init(text: "ä¸‰ç­‰å¥–".tr,
                    textFont: .systemFont(ofSize: 12, weight: .medium),
                    textColor: .randomColor,
                    backgroundColor: .randomColor,
                    placeholderImage: "message".sysImg,
                    imageURLString:"https://picsum.photos/30"),
              .init(text: "è°¢è°¢å‚ä¸".tr,
                    textFont: .systemFont(ofSize: 12, weight: .medium),
                    textColor: .randomColor,
                    backgroundColor: .randomColor,
                    placeholderImage: "tray".sysImg,
                    imageURLString:"https://picsum.photos/30"),
          ])
          .byPointerDirection(.right) // åœæ­¢é”šç‚¹ä½œä¸ºä¸­å¥–ç»“æœ
          .bySpinDuration(3.0)
          .byInitialVelocity(25.0)
          .byPanRotationEnabled(true)
          .onSegmentTap { segment in
              /// çŸ­æŒ‰å’Œæ—‹è½¬åœæ­¢åçš„ä¸­å¥–ç»“æœ
              toastBy("ğŸ€ çŸ­æŒ‰æ‰‡å½¢ \(String(describing: segment.text?.rnl))")
          }
          .onSegmentLongPress { segment, gr in
              if gr.state == .began {
                  toastBy("ğŸ‘† é•¿æŒ‰å¼€å§‹ \(String(describing: segment.text?.rnl))")
              }
          }
          .byAddTo(view) { make in
              make.center.equalToSuperview()
              make.width.height.equalTo(300)
          }
  }()
  ```

* ```swift
   wheelView.stopSpin() // åœæ­¢
  ```

### 49ã€å±å¹•å¸¸äº® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// MARK: - å±å¹•å¸¸äº®
public extension NSObject {
    /// å±å¹•æ˜¯å¦ä¿æŒå¸¸äº®
    var isScreenAlwaysOn: Bool {
        get { UIApplication.shared.isIdleTimerDisabled }
        set { UIApplication.shared.isIdleTimerDisabled = newValue }
    }
    /// å¼€å¯å¸¸äº®
    func keepScreenOn() {
        UIApplication.shared.isIdleTimerDisabled = true
    }
    /// å…³é—­å¸¸äº®
    func endScreenOn() {
        UIApplication.shared.isIdleTimerDisabled = false
    }
}
```

### 50ã€è‡ªå®šä¹‰è¿›åº¦æ¡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* è§£å†³ç—›ç‚¹ï¼šç³»ç»Ÿè¿›åº¦æ¡ï¼ˆä¸èƒ½å®šä¹‰å‰è¿›æ–¹å‘ä»¥åŠå®æ—¶è¿›åº¦å€¼ï¼‰

* å¿«æ·åˆ›å»º

  ```swift
  /// è‡ªå®šä¹‰è¿›åº¦æ¡ï¼šå®æ—¶è¿›åº¦å€¼ã€å‰è¿›æ–¹å‘
  private lazy var progressView: JobsProgressView = {
      JobsProgressView()
          .byDirection(.leftToRight)
          .byValueMode(.countDown)   // åˆå§‹ï¼šæ˜¾ç¤ºä¸º 100â†’0
          .byTrackColor(.systemGray5)
          .byLabelBackgroundColor(.secondarySystemBackground)
          .byLabelFont(.monospacedDigitSystemFont(ofSize: 12, weight: .medium))
          .byAddTo(view) { [unowned self] make in
              make.top.equalTo(modeToggleButton.snp.bottom).offset(24.h)
              make.left.equalToSuperview().offset(40.w)
              make.right.equalToSuperview().inset(40.w)
              make.height.equalTo(80.h) /// ç»™ç‚¹é«˜åº¦è®©ä¸Šæ–¹ label æœ‰ç©ºé—´ç§»åŠ¨
          }
  }()
  ```

* æ‰‹åŠ¨è®¾ç½®è¿›åº¦ï¼ˆåŠ¨ç”»å‘ˆç°ï¼‰

  ```swift
  private var currentProgress: CGFloat = 0
  progressView.setProgress(currentProgress, animated: true)
  ```

## å››ã€[**Swift**](https://developer.apple.com/swift/) è¯­è¨€ç‰¹æ€§ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€æ³¨è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> [**Swift**](https://developer.apple.com/swift/) ä¸æ”¯æŒè¿è¡Œæ—¶åå°„æ³¨è§£
>
> éšç€[**Swift**](https://developer.apple.com/swift/)ç‰ˆæœ¬çš„ä¸æ–­æ›´æ–°ï¼Œä¹Ÿä¼šå‡ºç°æ–°çš„æ³¨è§£ã€‚æ¯”å¦‚ï¼š<font color=red>**`@freestanding`**</font> **ä» [Swift](https://developer.apple.com/swift/) 5.9 å¼€å§‹** æ‰æ­£å¼å¯ç”¨çš„ï¼ˆä¹Ÿå°±æ˜¯ Xcode 15 å¯¹åº”çš„é‚£ä¸ª [**Swift**](https://developer.apple.com/swift/) ç‰ˆæœ¬ï¼‰ã€‚

#### 1.1ã€ç³»ç»Ÿæ³¨è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.1ã€<font color=red>**`@available(...)`**</font>/ <font color=red>**`@unavailable(...)`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ§åˆ¶å¹³å°/ç‰ˆæœ¬å¯ç”¨æ€§ã€å¼ƒç”¨ä¿¡æ¯

```swift
@available(iOS 14, *) 
func foo() {}

@available(*, deprecated, message: "Use newFoo()")
func oldFoo() {}

@unavailable(iOS, message: "Not on iOS")
func macOnly() {}
```

##### 1.1.2ã€<font color=red>**`@main`**</font>æŒ‡å®šç¨‹åºå…¥å£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å–ä»£æ—§çš„ `@UIApplicationMain` / `@NSApplicationMain`

```swift
@main
struct AppMain {
  static func main() { /* ... */ }
}
```

##### 1.1.3ã€<font color=red>**`@inlinable`**</font>/ <font color=red>**`@usableFromInline`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è·¨æ¨¡å—å†…è”/ç¬¦å·å¯è§æ€§å¾®æ§ï¼ˆå‘å¸ƒåº“æ—¶å¸¸ç”¨ï¼‰

```swift
@inlinable public func add(_ a:Int,_ b:Int)->Int { a+b }
@usableFromInline internal let cache = ...
```

##### 1.1.4ã€<font color=red>**`@frozen`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> * å†»ç»“ `enum` çš„å¸ƒå±€ï¼Œä¿è¯ **ABI** ç¨³å®šï¼ˆåº“ä½œè€…ç”¨ï¼‰
>   *  [**API ğŸ†š ABI**](#APIğŸ†šABI)
>   * [**ABIä¸å…¼å®¹**](#ABIä¸å…¼å®¹)

```swift
@frozen public enum ColorSpace { case srgb, displayP3 }
```

##### 1.1.5ã€<font color=red>**`@discardableResult`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å…è®¸ä¸¢å¼ƒè¿”å›å€¼ï¼ˆé“¾å¼ API å¸¸ç”¨ï¼‰

```swift
@discardableResult
func setTitle(_ s:String) -> Self { /* ... */ return self }
```

##### 1.1.6ã€<font color=red>**`@escaping`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ ‡è®°é€ƒé€¸é—­åŒ…å‚æ•°

```swift
func asyncOp(_ block: @escaping ()->Void) { /* store & call later */ }
```

##### 1.1.7ã€<font color=red>**`@autoclosure`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è°ƒç”¨ç«¯å¯çœç•¥ `{}` å»¶è¿Ÿæ±‚å€¼

```swift
func assert(_ cond: @autoclosure ()->Bool) {}
assert(1 < 2)   // ç­‰ä»·äº { 1 < 2 }
```

##### 1.1.8ã€<font color=red>**`@Sendable`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å¹¶å‘å®‰å…¨é—­åŒ…ï¼ˆè·¨ **actor**/çº¿ç¨‹ï¼‰

```swift
func run(_ job: @Sendable ()->Void) {}
```

##### 1.1.9ã€<font id=@MainActor color=red>**`@MainActor`**</font>/ è‡ªå®šä¹‰ <font color=red>**`@globalActor`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å®ƒä»£è¡¨äº†ä¸€ä¸ª**ç‰¹æ®Šçš„ actor**ï¼Œè¿™ä¸ª actor ç»‘å®šåœ¨ **ä¸»çº¿ç¨‹ï¼ˆä¸» runloopï¼‰** ä¸Š
>
> è¢«æ ‡è®°ä¸º <font color=red>**`@MainActor`**</font> çš„å‡½æ•° / å±æ€§ / ç±»å‹ï¼Œ**é€»è¾‘ä¸Šå½’å±äºè¿™ä¸ª actor çš„éš”ç¦»åŸŸ**
>
> å¦‚æœæ ‡æ³¨åœ¨ç±»å‹ä¸Šï¼Œè¿™ä¸ªç±»å‹é‡Œçš„ **æ‰€æœ‰å­˜å‚¨å±æ€§å’Œå®ä¾‹æ–¹æ³•**ï¼Œé»˜è®¤éƒ½è§†ä¸º <font color=red>**`@MainActor`**</font>
>
> å¦‚æœæ ‡æ³¨åœ¨å±æ€§ / å…¨å±€å˜é‡ä¸Šï¼Œåªä¼šé’ˆå¯¹è¿™ä¸ªå±æ€§ / å…¨å±€å˜é‡ <font color=red>**`@MainActor`**</font>

* ç¼–è¯‘å™¨å±‚é¢çš„æ•ˆæœï¼ˆé™æ€æ£€æŸ¥ï¼‰

  ```swift
  @MainActor
  class MyViewModel {
      var title: String = ""
      func updateUI() {
          // å°±ç®— updateUI å†™çš„æ˜¯ funcï¼ˆåŒæ­¥å‡½æ•°ï¼‰ï¼Œå¯¹åˆ«çš„ actor æ¥è¯´å®ƒä¹Ÿæ˜¯â€œé€»è¾‘å¼‚æ­¥â€çš„ï¼Œ
        	// å› ä¸ºè¦å…ˆ hop åˆ° MainActor çš„æ‰§è¡Œå™¨ï¼Œè¿™ä¸€æ­¥æœ¬èº«å°±æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä½ è¿˜æ˜¯è¦ awaitã€‚è¿™ä¸æ˜¯â€œæ ‡æ³¨â€ï¼Œæ˜¯å®æ‰“å®æ”¹å˜äº†è°ƒç”¨æ–¹å¼ã€‚
      }
  }
  
  actor Worker {
      func doWork(vm: MyViewModel) async {
          vm.title = "xxx"      // âŒ è·¨ actor è®¿é—® main actor éš”ç¦»çš„å±æ€§
          vm.updateUI()         // âŒ è·¨ actor è°ƒç”¨ main actor éš”ç¦»çš„æ–¹æ³•
      }
  }
  /// å¿…é¡» é€šè¿‡ await + è‡ªåŠ¨ hop æ¥è°ƒç”¨ï¼š
  actor Worker {
      func doWork(vm: MyViewModel) async {
          await vm.updateUI()   // âœ… ç¼–è¯‘å™¨çŸ¥é“ï¼šè¿™é‡Œè¦ hop åˆ° MainActor
      }
  }
  ```

* è¿è¡Œæ—¶å±‚é¢çš„æ•ˆæœï¼ˆçº¿ç¨‹/æ‰§è¡Œå™¨åˆ‡æ¢ï¼‰

  * å‘ç°ä½ åœ¨é <font color=red>**`@MainActor`**</font> ä¸Š `await` ä¸€ä¸ª `@MainActor` å‡½æ•°
  * è‡ªåŠ¨åšä¸€ä»¶æœ‰ç‚¹åƒ `DispatchQueue.main.async` çš„äº‹ï¼š**è·³åˆ°ä¸» actorï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸Šæ‰§è¡Œè¿™æ®µä»£ç **
  * ç¡®ä¿è¿™æ®µä»£ç åœ¨ä¸»çº¿ç¨‹è¿è¡Œ

* <font color=red>**`@MainActor(unsafe)`**</font>

  * å‘Šè¯‰ç¼–è¯‘å™¨â€œè¿™ç©æ„ç®— <font color=red>**`@MainActor`**</font> çš„â€ï¼Œä½†æ˜¯ **å®é™…è¿è¡Œæ—¶ä¸ä¿è¯çœŸåœ¨ä¸»çº¿ç¨‹**ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸€äº›è¿‡æ¸¡åœºæ™¯åšå…¼å®¹
  * è¿™ä¸ªä¸€èˆ¬ä¸æ¨èä¹±ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ UI çš„æ—¶å€™

* `nonisolated` æ‰“æ´

  ```swift
  /// å¦‚æœæŠŠä¸€ä¸ªç±»æ ‡è®°ä¸º @MainActorï¼Œä½†æœ‰äº›æ–¹æ³•åˆæ˜ç¡®å¸Œæœ›ä»»ä½•çº¿ç¨‹éƒ½èƒ½è°ƒç”¨ï¼Œå¯ä»¥ï¼š
  @MainActor
  final class MyViewModel {
      var state: String = ""
      nonisolated func logState() {
          // è¿™é‡Œä¸èƒ½ç›´æ¥è®¿é—® stateï¼ˆå› ä¸ºæ‰“ç ´äº†éš”ç¦»ï¼‰
          // ä½†å¯ä»¥åšä¸ä¾èµ–éš”ç¦»çš„é€»è¾‘ï¼Œæ¯”å¦‚æ‰“å°
          print("log")
      }
  }
  ```

##### 1.1.10ã€<font color=red>**`@preconcurrency`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ä¸ºæ—§æ¥å£æä¾›å‘åå…¼å®¹çš„å¹¶å‘æ³¨é‡Šï¼ˆè¿ç§»æœŸä¼šè§åˆ°ï¼‰

##### 1.1.11ã€<font color=red>**`@objc`**</font>/ <font color=red>**`@objcMembers`**</font>/ <font color=red>**`@nonobjc`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**`@objc`**</font>

  * æŠŠ **[Swift](https://developer.apple.com/swift/) ç¬¦å·æš´éœ²ç»™ Objcè¿è¡Œæ—¶** ç”¨çš„æ ‡è®°ã€‚åªæœ‰æš´éœ²åï¼Œæ‰èƒ½ç”¨ **selector / KVC / KVO / ç›®æ ‡-åŠ¨ä½œ** ç­‰åŸºäº Obj-C Runtime çš„æœºåˆ¶ã€‚

  * ä»… `@objc` åªæ˜¯â€œå¯è§â€ï¼Œ**ä¸å¼ºåˆ¶åŠ¨æ€æ´¾å‘**ï¼›éœ€è¦æ¶ˆæ¯å‘é€ï¼ˆ`objc_msgSend`ï¼‰å°±ç”¨ `dynamic`ï¼ˆ`dynamic` ä¼šéšå¼å¸¦ä¸Š `@objc`ï¼‰ã€‚

  * ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨â“

    * **Target-Action**ï¼ˆæŒ‰é’®ã€æ‰‹åŠ¿ã€å®šæ—¶å™¨ç­‰ï¼‰

      ```
      @objc func didTap(_ sender: UIButton) { ... }
      button.addTarget(self, action: #selector(didTap(_:)), for: .touchUpInside)
      ```

    * KVO / KVC

      ```
      @objc dynamic var titleText: String = ""   // KVO éœ€è¦åŠ¨æ€æ´¾å‘
      ```

    * selector ç‰ˆé€šçŸ¥å›è°ƒ

      ```
      @objc private func onLangChanged(_ n: Notification) { ... }
      NotificationCenter.default.addObserver(self,
                                             selector: #selector(onLangChanged(_:)),
                                             name: .JobsLanguageDidChange, object: nil)
      ```

    * **å¯é€‰åè®®æ–¹æ³•**ï¼ˆåªæœ‰ `@objc protocol` æ‰èƒ½ `optional`ï¼‰

      ```
      @objc protocol JobsDelegate: AnyObject {
          @objc optional func didFinish(_ vc: UIViewController)
      }
      ```

  * ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦â“

    * å…¨æ˜¯ **çº¯ [Swift](https://developer.apple.com/swift/)** é—­åŒ…å›è°ƒï¼ˆä½ è‡ªå·±çš„ `.onTap { }` / Rx / Combineï¼‰ã€‚
    * çº¯ [**Swift**](https://developer.apple.com/swift/) è°ƒç”¨ã€æ²¡æœ‰ selector/KVO/KVC çš„åœºæ™¯ã€‚
    * ä¸å¯¹å¤–æš´éœ²ç»™ ObjC çš„ç±»å‹/æ–¹æ³•ã€‚

  * ç‰¹åˆ«æ³¨æ„

    * **å¿˜äº†ç»§æ‰¿ `NSObject`**ï¼šå³ä½¿ `@objc` äº†ï¼ŒæŸäº›æœºåˆ¶ä»ç”¨ä¸äº†ã€‚
    * **KVO åªå†™äº† `@objc`**ï¼šæ²¡ `dynamic` ä¸ä¼šè§¦å‘ã€‚
    * **æ–¹æ³•é‡è½½** å¯¼è‡´ selector å†²çªï¼šç”¨ `@objc(customName:)` æŒ‡å®šã€‚
    * **æ‰©å±•é‡Œæš´éœ²**ï¼šåœ¨ extension æˆå‘˜ä¸Šå•ç‹¬åŠ  `@objc`ï¼Œæˆ–å¯¹ç±»ç”¨ `@objcMembers`ï¼ˆåŒæ–‡ä»¶ï¼‰ã€‚
    * **å¯è§æ€§**ï¼š`private` æˆå‘˜ç»™ Obj-C ç”¨ä¸åˆ°ï¼›ä¸€èˆ¬ç”¨ `internal`/`@objc` å³å¯ï¼ˆå¿…è¦æ—¶ `@objc public`ï¼‰ã€‚

* <font color=red>**`@objcMembers`**</font>

  * å†™åœ¨ **ç±»** ä¸Šï¼Œè®©**è¯¥ç±»çš„æˆå‘˜é»˜è®¤éƒ½æš´éœ²**åˆ° ObjCï¼ˆåŒæ–‡ä»¶å†…çš„æ‰©å±•ä¹Ÿå—å½±å“ï¼‰ã€‚
  * é£é™©ï¼šæš´éœ²è¿‡å¤šï¼ŒABI/äºŒè¿›åˆ¶ä½“ç§¯è†¨èƒ€ï¼Œè°ƒåº¦å¼€é”€â†‘ã€‚**ä¸å»ºè®®å…¨å¼€**ï¼Œç²¾ç¡®æ ‡æ³¨æ›´å¥½ã€‚

* <font color=red>**`@nonobjc`**</font>

##### 1.1.12ã€<font color=red>**`@warn_unqualified_access`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æœªåŠ ç±»å‹å‰ç¼€è°ƒç”¨æ—¶äº§ç”Ÿè­¦å‘Šï¼Œé€¼è°ƒç”¨æ–¹åŠ å‰ç¼€ï¼Œé¿å… API åç§°å†²çª

```swift
@warn_unqualified_access
func ambiguous() {}
```

##### 1.1.13ã€<font color=red>**`@dynamicMemberLookupÂ `**</font>& <font color=red>**`@dynamicCallable`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è®©ç±»å‹æ”¯æŒ `obj.someName` åŠ¨æ€è§£ææˆ–åƒå‡½æ•°ä¸€æ ·è¢«â€œè°ƒç”¨â€

```swift
@dynamicMemberLookup
struct JSON {
  subscript(dynamicMember key: String) -> JSON { /* ... */ JSON() }
}
```

##### 1.1.14ã€<font color=red>**`@resultBuilder`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **SwiftUI** ç­‰ **DSL** èƒŒåçš„æœºåˆ¶ã€‚ä½ ç”¨åˆ°çš„å¤šæ˜¯æ¡†æ¶æä¾›çš„å…·ä½“ **builder**

```swift
@resultBuilder
struct HTMLBuilder { /* ... */ }
```

##### 1.1.15ã€<font color=red>**`@testable`**</font> **import ModuleName**  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å…è®¸æµ‹è¯•è®¿é—®ç›®æ ‡æ¨¡å—çš„ **internal** æˆå‘˜

##### 1.1.16ã€<font color=red>**`@IBAction`**</font>/ <font color=red>**`@IBOutlet`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è¿æ¥ storyboard/xib

```swift
@IBAction func didTap(_ sender: UIButton) {}
@IBOutlet weak var titleLabel: UILabel!
```

##### 1.1.17ã€<font color=red>**`@IBInspectable`**</font>/ <font color=red>**`@IBDesignable`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> åœ¨ IB å¯ç¼–è¾‘/å®æ—¶æ¸²æŸ“è‡ªå®šä¹‰è§†å›¾å±æ€§

```swift
@IBDesignable
class CardView: UIView {
  @IBInspectable var corner: CGFloat = 8
}
```

##### 1.1.18ã€<font color=red>**`@NSManaged`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **Core Data**åŠ¨æ€è§£æå±æ€§/æ–¹æ³•ï¼ˆä¸éœ€è¦è‡ªå·±å®ç°å­˜å–å™¨ï¼‰

```swift
class User: NSManagedObject {
  @NSManaged var name: String
}
```

##### 1.1.19ã€<font color=red>**`@NSCopying`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å±æ€§èµ‹å€¼æ—¶è‡ªåŠ¨æ‹·è´ï¼ˆè¦æ±‚å€¼ç±»å‹å®ç° `NSCopying`ï¼‰

```swift
class Foo: NSObject {
  @NSCopying var path: NSString = ""
}
```

##### 1.1.20ã€<font color=red>**`@State`**</font>/<font color=red>**`@Binding`**</font>/<font color=red>**`@StateObject`**</font>/<font color=red>**`@ObservedObject`**</font>/<font color=red>**`@Environment`**</font>/<font color=red>**`@EnvironmentObject`**</font>/<font color=red>**`@AppStorage`**</font>/<font color=red>**`@SceneStorage`**</font>/<font color=red>**`@FocusState`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
struct Counter: View {
  @State private var count = 0
  var body: some View { Text("\(count)") }
}
```

##### 1.1.21ã€<font color=red>**`@Published`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class VM: ObservableObject {
  @Published var name = ""
}
```

##### 1.1.22ã€<font color=red>**`@unchecked`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å®ƒæ˜¯ **[Swift](https://developer.apple.com/swift/) çš„ä¸€ä¸ªå±æ€§ä¿®é¥°ç¬¦**ï¼Œç›®å‰ä¸»è¦å’Œ **åè®® `Sendable`** ç»“åˆä½¿ç”¨
>
> æœ¬è´¨å°±æ˜¯ [**Swift**](https://developer.apple.com/swift/) æä¾›çš„ä¸€ä¸ª **å®‰å…¨é€ƒç”Ÿå£**

```swift
/// è·³è¿‡ç¼–è¯‘å™¨çš„å¹¶å‘å®‰å…¨æ£€æŸ¥ï¼Œç”±å¼€å‘è€…è‡ªå·±ä¿è¯ã€‚
@unchecked Sendable
```

* èƒŒæ™¯ï¼šå¹¶å‘å®‰å…¨æ£€æŸ¥

  > ä» [**Swift**](https://developer.apple.com/swift/) 5.5 å¼•å…¥å¹¶å‘ï¼ˆ`async/await`ã€`Task` ç­‰ï¼‰å¼€å§‹ï¼Œè‹¹æœä¸ºäº†é˜²æ­¢ **æ•°æ®ç«äº‰**ï¼Œæå‡ºäº†ä¸€ä¸ªåè®®ï¼š
  >
  > ```swift
  > protocol Sendable { }
  > ```
  >
  > ä¸€ä¸ªç±»å‹å¦‚æœè¦åœ¨ **å¤šçº¿ç¨‹ / å¹¶å‘ä»»åŠ¡** ä¸­å®‰å…¨ä¼ é€’ï¼Œå°±å¿…é¡»æ˜¯ `Sendable`
  >
  > - å€¼ç±»å‹ï¼ˆ`struct`ï¼Œå†…éƒ¨å…¨æ˜¯ `Sendable` æˆå‘˜ï¼‰ â†’ è‡ªåŠ¨ç¬¦åˆ `Sendable`ã€‚
  > - å¼•ç”¨ç±»å‹ï¼ˆ`class`ï¼‰ â†’ é»˜è®¤ **ä¸æ˜¯ `Sendable`**ï¼Œå› ä¸ºå¼•ç”¨å¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œé€ æˆæ•°æ®ç«äº‰ã€‚

##### 1.1.23ã€<font color=red>**`@resultBuilder`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.24ã€<font color=red>**`@ViewBuilder`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.25ã€<font color=red>**`@SceneBuilder`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.26ã€<font color=red>**`@ToolbarContentBuilder`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.27ã€<font color=red>**`@CommandsBuilder`**</font>  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 1.1.28ã€<font color=red>**`@LibraryContentBuilder`**</font>  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 1.2ã€ğŸ™‹ <font color=red>**è‡ªå®šä¹‰æ³¨è§£**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å® ([**Swift**](https://developer.apple.com/swift/) 5.9+ / [**Swift**](https://developer.apple.com/swift/) Macros)

  > [**Swift**](https://developer.apple.com/swift/) 5.9 å¼•å…¥äº† **å®ç³»ç»Ÿ**ï¼Œå¯ä»¥å†™ç±»ä¼¼ `@CodingKeys`ã€`@AddCompletionHandler` çš„ **ç¼–è¯‘æœŸæ³¨è§£/ä»£ç ç”Ÿæˆ**ã€‚
  >  ä¾‹å¦‚ Apple æä¾›çš„ `@freestanding(expression)` / `@attached(peer)` ç­‰ã€‚
  >  æœªæ¥è¿™å°±æ˜¯ [**Swift**](https://developer.apple.com/swift/) ç‰ˆçš„â€œæ³¨è§£ç³»ç»Ÿâ€ã€‚

  ```swift
  @MyMacro
  struct Foo { ... }
  ```

### 2ã€åè®® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**Swift**](https://developer.apple.com/swift/) çš„ç³»ç»Ÿåè®®å¤§æ¦‚åˆ†å‡ å¤§ç±»

  * **å€¼è¯­ä¹‰**ï¼š`RawRepresentable`, `CaseIterable`ï¼ˆå‡ ä¹åªåœ¨ <font color=red>**enum**</font> ä¸Šæœ‰æ„ä¹‰ï¼‰

    * ç±»å‹ <-> åŸå§‹å€¼ åŒå‘æ˜ å°„ï¼Œå¸¸ç”¨äºæšä¸¾å’Œ ID åŒ…è£…ç±»å‹

      ```swift
      protocol RawRepresentable {
          associatedtype RawValue
          init?(rawValue: RawValue)
          var rawValue: RawValue { get }
      }
      ```

    * è®©æšä¸¾è‡ªåŠ¨ç”Ÿæˆ `allCases`ï¼Œå¯ä»¥éå†æ‰€æœ‰ case

      ```swift
      protocol CaseIterable {
          associatedtype AllCases: Collection where AllCases.Element == Self
          static var allCases: AllCases { get }
      }
      ```

  * **æ¯”è¾ƒ/å“ˆå¸Œ**ï¼š`Equatable`, `Comparable`, `Hashable`

    * å®šä¹‰åˆ¤ç­‰é€»è¾‘ï¼Œ`==` è¿ç®—ç¬¦

      ```swift
      protocol Equatable {
          static func == (lhs: Self, rhs: Self) -> Bool
      }
      ```

    * æä¾› `<` å®ç°ï¼Œç¼–è¯‘å™¨èƒ½æ¨å¯¼å‡º `>`, `<=`, `>=`

      ```swift
      protocol Comparable : Equatable {
          static func < (lhs: Self, rhs: Self) -> Bool
      }
      ```

    * å¯ä½œä¸º `Set` å…ƒç´ æˆ– `Dictionary` keyï¼Œè¦å’Œ `Equatable` ä¿æŒä¸€è‡´æ€§

      ```swift
      protocol Hashable : Equatable {
          func hash(into hasher: inout Hasher)
      }
      ```

  * **é›†åˆ**ï¼š`Sequence`, `Collection`

    * å¯ä»¥è¢« `for-in` éå†

      ```swift
      protocol Sequence {
          associatedtype Iterator: IteratorProtocol
          func makeIterator() -> Iterator
      }
      ```

    * æ”¯æŒä¸‹æ ‡ã€ç´¢å¼•

      ```swift
      /// Arrayã€Dictionaryã€Set éƒ½ç¬¦åˆ
      protocol Collection : Sequence {
          associatedtype Index : Comparable
          var startIndex: Index { get }
          var endIndex: Index { get }
          subscript(position: Index) -> Element { get }
          func index(after i: Index) -> Index
      }
      ```

  * **è¡¨ç¤º/è°ƒè¯•**ï¼š`CustomStringConvertible`

    * è‡ªå®šä¹‰ print() æ˜¾ç¤ºçš„å†…å®¹

      ```swift
      protocol CustomStringConvertible {
          var description: String { get }
      }
      ```

  * **åºåˆ—åŒ–**ï¼š`Codable`

    * è‡ªåŠ¨/æ‰‹åŠ¨ JSON / Plist åºåˆ—åŒ–ä¸ååºåˆ—åŒ–

      ```swift
      typealias Codable = Decodable & Encodable
      
      protocol Encodable {
          func encode(to encoder: Encoder) throws
      }
      protocol Decodable {
          init(from decoder: Decoder) throws
      }
      ```

  * **å¹¶å‘**ï¼š`Sendable`

    * è¡¨ç¤ºç±»å‹åœ¨å¹¶å‘ä¸­å®‰å…¨ä¼ é€’ã€‚Swift Concurrency çš„ä¸€éƒ¨åˆ†

      ```swift
      protocol Sendable { }
      ```

  * **Foundationæ¡¥æ¥**ï¼š`NSCopying`, `NSSecureCoding`

    * ç”¨äºå¯¹è±¡å¤åˆ¶ `copy()`

      ```swift
      @objc protocol NSCopying {
          func copy(with zone: NSZone? = nil) -> Any
      }
      ```

    * ç”¨äºæŒä¹…åŒ–ã€ä¼ è¾“

      ```swift
      /// æ”¯æŒå®‰å…¨å½’æ¡£ / è§£æ¡£ 
      @objc protocol NSSecureCoding : NSCoding {
          static var supportsSecureCoding: Bool { get }
      }
      ```

*  `associatedtype`

  * `associatedtype` è¡¨ç¤º **åè®®é‡Œçš„å ä½ç±»å‹**ã€‚
  * å®ƒä¸æ˜¯å…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯â€œç±»å‹å‚æ•°â€ï¼Œç­‰åˆ°**æŸä¸ªå…·ä½“ç±»å‹å»éµå®ˆåè®®æ—¶å†æŒ‡å®š**ã€‚
  * å¯ä»¥ç†è§£ä¸º **æ³›å‹çš„åè®®ç‰ˆ**ã€‚
  
*  åœ¨ [**Swift**](https://developer.apple.com/swift/) é‡Œï¼Œ**æ²¡å®ç°**åè®®è¦æ±‚ï¼ˆåŒ…æ‹¬å±æ€§çš„ getter/setterï¼‰ä¼š<font color=red>**ç¼–è¯‘æœŸæŠ¥é”™**</font>ï¼Œ**ä¸ä¼š**ç­‰åˆ°è¿è¡ŒæœŸæ‰â€œé‡æŒ‡é’ˆå´©æºƒâ€ã€‚åªæœ‰èµ° **`@objc` å¯é€‰åè®®** çš„è€è·¯ï¼Œä¸”**å¼ºè¡Œè§£åŒ…/ä¸åšåˆ¤æ–­**ï¼Œæ‰å¯èƒ½åœ¨è¿è¡ŒæœŸå´©ã€‚

*  [**Swift**](https://developer.apple.com/swift/)  â†” **Objc** åè®®å¯¹ç…§

  | Swift åè®®                                                   | ä½œç”¨                     | [**Swift**](https://developer.apple.com/swift/) ç”¨æ³•      | Objc å¯¹åº”                                                    |
  | ------------------------------------------------------------ | ------------------------ | --------------------------------------------------------- | ------------------------------------------------------------ |
  | <font color=red>`Equatable`</font>                           | åˆ¤ç­‰                     | `struct A: Equatable { let id:Int }`                      | è¦†å†™ `-isEqual:`                                             |
  | <font color=red>`Comparable`</font>                          | æ’åºæ¯”è¾ƒ                 | `struct A: Comparable { static func < (...) -> Bool }`    | å®ç° `-compare:`ï¼ˆè¿”å› `NSComparisonResult`ï¼‰ï¼Œæˆ–æä¾›æ’åº block |
  | <font color=red>`Hashable`</font>                            | å¯åš `Set`/å­—å…¸é”®        | `struct A: Hashable { var id:Int }`                       | è¦†å†™ `-isEqual:` + `-hash`                                   |
  | <font color=red>`Identifiable`</font>                        | å”¯ä¸€æ ‡è¯†ï¼ˆSwiftUI/Listï¼‰ | `struct Row: Identifiable { let id: UUID }`               | è‡ªå®šä¹‰ `-identifier` æ–¹æ³•ï¼ˆæ— ç»Ÿä¸€åè®®ï¼‰ï¼Œæˆ–ç”¨ä¸»é”®å­—æ®µ        |
  | `RawRepresentable`                                           | åŸå§‹å€¼æ˜ å°„               | `enum T:Int { case a=1 }`ï¼ˆè‡ªåŠ¨ç¬¦åˆï¼‰                     | `NS_ENUM(NSInteger, T){ T_a=1 }` + è‡ªå†™â€œåŸå§‹å€¼ â†” æšä¸¾â€è½¬æ¢å‡½æ•° |
  | `CaseIterable`                                               | æšä¸¾éå†                 | `enum T: CaseIterable { case a,b }`                       | æ— ç­‰ä»·ï¼›æ‰‹å†™ `+allValues` è¿”å›æ•°ç»„                           |
  | <font color=green>`CustomStringConvertible`</font>           | æ‰“å°å‹å¥½æ–‡æ¡ˆ             | `var description:String { ... }`                          | è¦†å†™ `-description`                                          |
  | <font color=green>`CustomDebugStringConvertible`</font>      | è°ƒè¯•æ–‡æ¡ˆ                 | `var debugDescription:String { ... }`                     | è¦†å†™ `-debugDescription`                                     |
  | <font color=purple >`Error`</font>                           | å¯æŠ›å‡ºé”™è¯¯               | `enum E: Error { case bad }`                              | çº¦å®š `NSError`ï¼ˆåŸŸ/ç /ä¿¡æ¯ï¼‰ï¼Œæˆ–è‡ªå®šä¹‰ `NSError` å·¥å‚        |
  | <font color=purple >`LocalizedError`</font>                  | æœ¬åœ°åŒ–é”™è¯¯               | `var errorDescription:String?`                            | ç”¨ `NSError` çš„ `localizedDescription`                       |
  | `Codable` (`Encodable`/`Decodable`)                          | JSON/Plist ç¼–è§£ç         | `struct A: Codable { ... }`                               | `NSSecureCoding`ï¼ˆå½’æ¡£ï¼‰æˆ–ç¬¬ä¸‰æ–¹ JSONï¼ˆYYModel/MJExtensionï¼‰ï¼Œæˆ–æ‰‹å†™ KVC |
  | <font color=blue>`Sequence`</font>                           | å¯ for-in                | `struct S: Sequence { func makeIterator()->I }`           | éµå¾ª `NSFastEnumeration`ï¼ˆå¦‚ `NSArray`ï¼‰                     |
  | <font color=blue>`IteratorProtocol`</font>                   | è¿­ä»£å™¨                   | `struct I: IteratorProtocol { mutating func next()->T? }` | è‡ªå®šä¹‰æšä¸¾å™¨å¯¹è±¡ï¼Œé…åˆ `NSFastEnumeration`                   |
  | <font color=blue>`Collection`</font>/<br>`BidirectionalCollection`/<br>`RandomAccessCollection` | å¯ä¸‹æ ‡/ç´¢å¼•é›†åˆ          | `struct C: Collection { ... }`                            | `NSArray`/`NSDictionary` ç³»åˆ—ï¼›è‡ªå®šä¹‰éœ€å®ç° `NSFastEnumeration` + ä¸‹æ ‡æ–¹æ³• |
  | `ExpressibleBy*Literal` ç³»åˆ—                                 | å­—é¢é‡åˆå§‹åŒ–             | `struct A: ExpressibleByStringLiteral { ... }`            | æ— ç­‰ä»·ï¼›æä¾›å·¥å‚æ–¹æ³•æˆ–åˆ†ç±»åˆå§‹åŒ–                             |
  | `Sendable`                                                   | å¹¶å‘å¯å®‰å…¨ä¼ é€’           | `struct A: Sendable { ... }`                              | æ— ç­‰ä»·ï¼›é çº¿ç¨‹å®‰å…¨çº¦æŸï¼ˆä¸å¯å˜/é”/é˜Ÿåˆ—ï¼‰                     |
  | `NSCopying`                                                  | æ‹·è´                     | `class A: NSCopying { -copyWithZone: }`                   | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSMutableCopying`                                           | å¯å˜æ‹·è´                 | `-mutableCopyWithZone:`                                   | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSSecureCoding`                                             | å®‰å…¨å½’æ¡£                 | `+supportsSecureCoding` / ç¼–è§£ç                           | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSObjectProtocol`                                           | åŸºç¡€è¡Œä¸º                 | â€”â€”                                                        | åŒååè®®ï¼ˆObjc åŸºç¡€ï¼‰                                        |

### 3ã€å±æ€§ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 3.1ã€`å­˜å‚¨å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ çœŸæ­£å­˜æ”¾åœ¨å†…å­˜é‡Œçš„å˜é‡/å¸¸é‡ã€‚å¯ä»¥æ˜¯ `var`ï¼ˆå¯å˜ï¼‰æˆ– `let`ï¼ˆä¸å¯å˜ï¼‰
>
> 2ï¸âƒ£ <font color=red>åªèƒ½å®šä¹‰åœ¨ **ç±»** å’Œ **ç»“æ„ä½“** é‡Œ</font>ã€‚<font color=blue>ä¸èƒ½å®šä¹‰åœ¨æ‹“å±•ï¼ˆ**extension**ï¼‰é‡Œ</font>
>
> 3ï¸âƒ£ `let` çš„å­˜å‚¨å±æ€§åªèƒ½åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼
>
> 4ï¸âƒ£ ç±»é‡Œçš„å­˜å‚¨å±æ€§å¦‚æœä¸æ˜¯å¯é€‰ï¼Œå°±å¿…é¡»åœ¨ `init` å‰å…¨éƒ¨åˆå§‹åŒ–

```swift
struct User {
    var name: String      // å¯å˜å­˜å‚¨å±æ€§
    let id: Int           // ä¸å¯å˜å­˜å‚¨å±æ€§
}
```

#### 3.2ã€`è®¡ç®—å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯é€šè¿‡ **getter/setter** è®¡ç®—å‡ºæ¥ã€‚**æ¯æ¬¡è®¿é—®éƒ½ä¼šé‡æ–°è®¡ç®—**
>
> 2ï¸âƒ£ è®¡ç®—å±æ€§ä¸æ”¯æŒ `async throws`
>
> 3ï¸âƒ£ <font color=red>å¯ä»¥å®šä¹‰åœ¨ **ç±»ã€ç»“æ„ä½“ã€æšä¸¾**é‡Œ</font>

```swift
struct Rectangle {
    var width: Double
    var height: Double
    
    var area: Double {        // åªè¯»è®¡ç®—å±æ€§
        width * height
    }
    
    var halfWidth: Double {   // å¯è¯»å†™è®¡ç®—å±æ€§
        get { width / 2 }
        set { width = newValue * 2 }
    }
}
```

#### 3.3ã€`ç±»å‹å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ å±äº **ç±»å‹æœ¬èº«**ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚ç±»ä¼¼äº **ObjC**/**Java** çš„ `static` æˆå‘˜ã€‚
>
> 2ï¸âƒ£ ç”¨å…³é”®å­—ï¼š <font color=red>**`static`**</font>ï¼ˆå€¼ä¸å¯è¢«å­ç±»é‡å†™ï¼‰ æˆ– <font color=red>**`class`**</font> ï¼ˆåªèƒ½ç”¨äºç±»ï¼Œå…è®¸å­ç±»é‡å†™ï¼‰ã€‚

```swift
struct Config {
    static let maxCount = 10   // ç±»å‹å±æ€§
}

print(Config.maxCount)   // ç›´æ¥é€šè¿‡ç±»å‹è®¿é—®
```

#### 3.4ã€`å»¶è¿Ÿå­˜å‚¨å±æ€§`ï¼ˆæ‡’åŠ è½½ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ç”¨ `lazy` ä¿®é¥°ï¼Œ<font color=red>**åªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰åˆå§‹åŒ–**</font>ã€‚
>
> å¸¸ç”¨äºåˆå§‹åŒ–æˆæœ¬è¾ƒé«˜ï¼Œæˆ–è€…ä¾èµ–å¤–éƒ¨æ•°æ®çš„å±æ€§ã€‚

* [**æ‡’åŠ è½½+é“¾å¼è°ƒç”¨**](#æ‡’åŠ è½½+é“¾å¼è°ƒç”¨)

#### 3.5ã€<font id=å±æ€§è§‚å¯Ÿå™¨>`å±æ€§è§‚å¯Ÿå™¨`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ å¯ä»¥ç»™å­˜å‚¨å±æ€§åŠ  `willSet` / `didSet`ã€‚ç”¨äºç›‘æ§å±æ€§å€¼å˜åŒ–
>
> 2ï¸âƒ£ <font color=red>**ä¸èƒ½ç›´æ¥ç”¨åœ¨è®¡ç®—å±æ€§ä¸Š**</font>ï¼ˆè®¡ç®—å±æ€§å¯ä»¥ç›´æ¥åœ¨ `set` é‡Œå†™é€»è¾‘ï¼‰

* é»˜è®¤å

  > åœ¨ [**Swift**](https://developer.apple.com/swift/) çš„ **å±æ€§è§‚å¯Ÿå™¨** é‡Œï¼Œå¦‚æœä¸å†™å‚æ•°åï¼Œç³»ç»Ÿé»˜è®¤ç»™ä¸¤ä¸ªåå­—
  >
  > - `willSet` é‡Œé¢çš„æ–°å€¼å« **`newValue`**
  > - `didSet` é‡Œé¢çš„æ—§å€¼å« **`oldValue`**

  ```swift
  var score: Int = 0 {
      willSet {   // è¿™é‡Œçš„ newValue é»˜è®¤å­˜åœ¨
          print("å³å°†æ”¹æˆ \(newValue)")
      }
      didSet {    // è¿™é‡Œçš„ oldValue é»˜è®¤å­˜åœ¨
          print("ä» \(oldValue) æ”¹æˆ \(score)")
      }
  }
  ```


* æ‡’åŠ è½½ + å±æ€§è§‚å¯Ÿå™¨

  ```swift
  final class Demo {
      lazy var cache: [Int] = {
          print("lazy init")
          return [1, 2, 3]
      }() {
          willSet { print("willSet cache ->", newValue) }
          didSet  { print("didSet cache  <-", oldValue) }
      }
  }
  ```

* è‡ªå®šä¹‰å‚æ•°å

  ```swift
  var score: Int = 0 {
      willSet(newScore) {
          print("å³å°†æ”¹æˆ \(newScore)")   // ç”¨ newScore ä»£æ›¿ newValue
      }
      didSet(previousScore) {
          print("ä» \(previousScore) æ”¹æˆ \(score)") // ç”¨ previousScore ä»£æ›¿ oldValue
      }
  }
  ```
  
* ä¸åˆå§‹åŒ– / ææ„çš„å…³ç³»

  ```swift
  final class X {
      var a: Int = 0 {
          willSet { print("willSet a ->", newValue) }
          didSet  { print("didSet  a <-", oldValue) }
      }
  
      init() {
          a = 1            // ä¸è§¦å‘ willSet/didSetï¼ˆæ„é€ æœŸé—´ï¼‰
      }
  
      deinit {
          a = 2            // ä¸è§¦å‘ willSet/didSetï¼ˆææ„æœŸé—´ï¼‰
      }
  }
  ```

### 4ã€å±æ€§åŒ…è£…å™¨ <font color=red>**@propertyWrapper**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**`@propertyWrapper`**</font>çœ‹èµ·æ¥åƒâ€œæ³¨è§£â€ï¼Œä½†å®ƒ**ä¸æ˜¯çº¯å…ƒæ•°æ®**ï¼Œè€Œæ˜¯**ä¸€æ®µå¯æ‰§è¡Œã€å¸¦çŠ¶æ€çš„åŒ…è£…ç±»å‹**ï¼Œä¼šçœŸå®æ”¹å†™è¿™ä¸ªå±æ€§çš„å­˜å–è¿‡ç¨‹ã€‚å®ƒä¹Ÿä¸æ˜¯ç»™ç¼–è¯‘å™¨çœ‹çš„é™æ€æ ‡ç­¾

* å¹²é¢„ï¼ˆæ‹¦æˆªå¹¶è‡ªå®šä¹‰ï¼‰å±æ€§çš„**`init`** / **`set`** / **`get`**è¿‡ç¨‹ï¼Œå°†åŒè´¨åŒ–æ“ä½œæå–å‡ºæ¥ï¼Œä¾¿äºä»£ç çš„è§£è€¦ã€‚å¤šç”¨äºæ¶æ„å±‚é¢ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨å¯¹æ¯”ğŸ‘‡

  * ä¸ä½¿ç”¨å±æ€§åŒ…è£…å™¨

    ```swift
    struct Settings_NoWrapper {
        var enableHaptics: Bool {
            get { UserDefaults.standard.object(forKey: "enableHaptics") as? Bool ?? true }
            set { UserDefaults.standard.set(newValue, forKey: "enableHaptics") }
        }
        var username: String {
            get { UserDefaults.standard.string(forKey: "username") ?? "guest" }
            set { UserDefaults.standard.set(newValue, forKey: "username") }
        }
    }
    ```

  * ä½¿ç”¨å±æ€§åŒ…è£…å™¨

    ```swift
    @propertyWrapper
    struct Defaults<T> {
        let key: String
        let defaultValue: T
        var wrappedValue: T {
            get { (UserDefaults.standard.object(forKey: key) as? T) ?? defaultValue }
            set { UserDefaults.standard.set(newValue, forKey: key) }
        }
    }
    
    struct Settings {
        @Defaults(key: "enableHaptics", defaultValue: true)  var enableHaptics: Bool
        @Defaults(key: "username",      defaultValue: "guest") var username: String
    }
    ```

### 5ã€ğŸ’¼ [**Swift**](https://developer.apple.com/swift/) é—­åŒ… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 5.1ã€**é—­åŒ…è¡¨è¾¾å¼** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `{ (å‚æ•°) -> è¿”å› in è¯­å¥ }`

#### 5.2ã€[**Swift**](https://developer.apple.com/swift/) é‡Œçš„é—­åŒ…åˆ†ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 5.2.1ã€ğŸŒªï¸ <font id=å°¾éšé—­åŒ…>**å°¾éšé—­åŒ…ï¼ˆè¯­æ³•ç³–ï¼‰**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> çº¯ç²¹æ˜¯ **è¯­æ³•ç³–**ï¼Œå’Œé—­åŒ…æœ¬è´¨æ²¡åŒºåˆ«ã€‚
> ç”¨åœ¨å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯é—­åŒ…æ—¶ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚

* å•ä¸ªé—­åŒ…å‚æ•°

  ```swift
  func doSomething(action: () -> Void) { action() }
  
  // å°¾éšé—­åŒ…å†™æ³•
  doSomething {
      print("å°¾éšé—­åŒ…æ‰§è¡Œ")
  }
  ```

* å¤šä¸ªå‚æ•° + æœ€åä¸€ä¸ªæ˜¯é—­åŒ…

  ```swift
  func fetchData(from url: String, completion: (String) -> Void) {
      print("å¼€å§‹è¯·æ±‚ï¼š\(url)")
      completion("æœåŠ¡ç«¯è¿”å›æ•°æ®")
  }
  
  // è°ƒç”¨ï¼šåªæœ‰æœ€åä¸€ä¸ªé—­åŒ…èƒ½ç”¨å°¾éšé—­åŒ…è¯­æ³•
  fetchData(from: "https://api.xxx.com") { data in
      print("ç»“æœï¼š\(data)")
  }
  ```

* å¤šä¸ªå‚æ•°ï¼Œé—­åŒ…ä¸åœ¨æœ€å

  ```swift
  func doSomething(first: () -> Void, second: () -> Void) {
      first()
      second()
  }
  
  // è°ƒç”¨
  doSomething(first: {
      print("ç¬¬ä¸€ä¸ªé—­åŒ…")
  }, second: {
      print("ç¬¬äºŒä¸ªé—­åŒ…")
  })
  ```

* å¤šä¸ªé—­åŒ…å‚æ•°ï¼Œæœ€åä¸€ä¸ªç”¨å°¾éšé—­åŒ…

  ```swift
  func animate(duration: Double,
               animations: () -> Void,
               completion: () -> Void) {
      print("åŠ¨ç”»å¼€å§‹ï¼ŒæŒç»­ \(duration)s")
      animations()
      completion()
  }
  
  // è°ƒç”¨ï¼šæœ€åä¸€ä¸ªé—­åŒ…å¯ä»¥å°¾éš
  animate(duration: 0.3, animations: {
      print("æ‰§è¡ŒåŠ¨ç”»å†…å®¹")
  }) {
      print("åŠ¨ç”»ç»“æŸ")
  }
  ```

* å¤šä¸ªå°¾éšé—­åŒ…ï¼ˆ[**Swift**](https://developer.apple.com/swift/) 5.3+ æ–°è¯­æ³•ï¼‰

  ```swift
  func animate(duration: Double,
               animations: () -> Void,
               completion: () -> Void) {
      print("åŠ¨ç”»å¼€å§‹ï¼ŒæŒç»­ \(duration)s")
      animations()
      completion()
  }
  
  // è°ƒç”¨ï¼šä¸¤ä¸ªé—­åŒ…éƒ½èƒ½ç”¨å°¾éšé—­åŒ…å†™æ³•
  animate(duration: 0.3) {
      print("æ‰§è¡ŒåŠ¨ç”»å†…å®¹")
  } completion: {
      print("åŠ¨ç”»ç»“æŸ")
  }
  ```

##### 5.2.2ã€é€ƒé€¸<font color=red>**`@escaping`**</font>/éé€ƒé€¸é—­åŒ… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ å½“ä¸€ä¸ªé—­åŒ…åœ¨å‡½æ•°**è¿”å›ä¹‹å**è¿˜ä¼šè¢«**æŒæœ‰æˆ–æ‰§è¡Œ**æ—¶ï¼Œè¿™ä¸ªé—­åŒ…å°±æ˜¯ã€Œé€ƒé€¸é—­åŒ…ã€ã€‚
>
> 2ï¸âƒ£ é€ƒé€¸é—­åŒ…ç”¨ <font color=red>**`@escaping`**</font> æ ‡è®°ï¼Œä¼šåœ¨å‡½æ•°è¿”å›åæ‰è°ƒç”¨
>
> 3ï¸âƒ£ å¸¸è§äº **å¼‚æ­¥å›è°ƒ/å­˜å‚¨/è·¨è¶Šç”Ÿå‘½å‘¨æœŸ**ã€ä»»åŠ¡å®Œæˆæ—¶é€šçŸ¥
>
> 4ï¸âƒ£ **é»˜è®¤**ï¼šå‚æ•°é—­åŒ…æ˜¯**éé€ƒé€¸**ï¼ˆå‡½æ•°ä½“å†…è°ƒç”¨å®Œå°±ç»“æŸï¼‰
>
> 5ï¸âƒ£ **åˆ¤æ–­å£è¯€**ï¼šé—­åŒ…è¢«**ä¿å­˜**ï¼ˆå±æ€§/æ•°ç»„ï¼‰æˆ–**å¼‚æ­¥**è°ƒç”¨ â‡’ <font color=red>**`@escaping`**</font>

* é€ƒé€¸é—­åŒ…

  ```swift
  /// asyncOperation è°ƒç”¨ç»“æŸæ—¶å‡½æ•°ä½“å·²ç»è¿”å›ï¼›
  /// ä½†é—­åŒ… completion è¿˜è¢« DispatchQueue ä¿å­˜èµ·æ¥ï¼›
  /// æ‰€ä»¥é—­åŒ…åœ¨å‡½æ•°ç»“æŸåæ‰è¢«æ‰§è¡Œï¼›
  /// å› æ­¤å¿…é¡»æ ‡è®°ä¸º @escapingã€‚
  func asyncOperation(completion: @escaping (String) -> Void) {
      DispatchQueue.global().async {
          print("æ­£åœ¨æ‰§è¡Œè€—æ—¶ä»»åŠ¡...")
          sleep(2)
          completion("done")// å‡½æ•°æ—©å·²è¿”å›ï¼Œè¿™é‡Œé—­åŒ…å»¶è¿Ÿæ‰§è¡Œ
      }
  }
  ```

  > ```swift
  > asyncOperation {
  >     print("ä»»åŠ¡å®Œæˆ")
  > }
  > ```

* éé€ƒé€¸é—­åŒ…ï¼ˆé»˜è®¤ï¼‰

  ```swift
  /// å¦‚æœé—­åŒ…åœ¨å‡½æ•°å†…éƒ¨ç«‹å³æ‰§è¡Œï¼Œä¸éœ€è¦é€ƒé€¸
  /// ä¸éœ€è¦ @escapingï¼Œå› ä¸ºé—­åŒ…ä¼šåœ¨å‡½æ•°è¿”å›å‰æ‰§è¡Œå®Œæ¯•
  func performNow(task: () -> Void) {
      task()
  }
  ```

##### 5.2.3ã€è‡ªåŠ¨ï¼ˆæƒ°æ€§ï¼‰é—­åŒ…<font color=red>**`@autoclosure`**</font>  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç”¨ <font color=red>**`@autoclosure`**</font> æ ‡è®°ï¼Œ**æŠŠä¸€ä¸ªè¡¨è¾¾å¼è‡ªåŠ¨åŒ…è£…æˆé—­åŒ…**ã€‚**ç”¨åˆ°æ‰æ‰§è¡Œ**ï¼›**ä¸ç¼“å­˜**ã€‚
>
> 2ï¸âƒ£ å¸¸ç”¨äºæ‡’æ‰§è¡Œã€æ–­è¨€ã€æ—¥å¿—ã€‚

```swift
func debugLog(_ msg: @autoclosure () -> String, enabled: Bool) {
    guard enabled else { return } // ä¸éœ€è¦å°±ä¸æ‰§è¡Œ msg()
    print(msg())
}

debugLog("expensive build \(verySlow())", enabled: false) // ä¸è§¦å‘ verySlow()
```

#### 5.3ã€é—­åŒ…çš„ç®€å†™ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**å°¾éšé—­åŒ…çš„è°ƒç”¨ç®€å†™**](#å°¾éšé—­åŒ…)

* ```swift
  // å®Œæ•´
  let f: (Int, Int) -> Int = { (a: Int, b: Int) -> Int in return a + b }
  
  // çœç±»å‹ + çœ returnï¼ˆå•è¡¨è¾¾å¼è‡ªåŠ¨è¿”å›ï¼‰
  let f1 = { a, b in a + b }
  
  // å‚æ•°å ä½ç®€å†™
  let f2: (Int, Int) -> Int = { $0 + $1 }
  
  // è¿ç®—ç¬¦å‡½æ•°ï¼ˆæ­¤æ—¶æ¶‰åŠåˆ°è¿ç®—ç¬¦/å‡½æ•°çš„é‡è½½ï¼‰
  // Swift é‡Œçš„ + æ‰€æœ‰å®šä¹‰éƒ½æ˜¯äºŒå…ƒå‡½æ•°ï¼š(T, T) -> Tã€‚
  let f3 = (+)
  
  // KeyPath è½¬å‡½æ•°ï¼ˆSwift 5.2+ï¼‰
  struct User { let name: String }
  let names = [User(name:"A"), User(name:"B")].map(\.name)
  ```

#### 5.4ã€[**é¿å…å¾ªç¯å¼•ç”¨**](#é¿å…å¾ªç¯å¼•ç”¨) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 6ã€[**Swift**](https://developer.apple.com/swift/) è¿ç®—ç¬¦é‡è½½ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ è¿ç®—ç¬¦é‡è½½æœ¬è´¨å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼Œæ€§èƒ½æ²¡æœ‰ç‰¹åˆ«æŸè€—
>
> 2ï¸âƒ£ è¿‡åº¦æ»¥ç”¨ä¼šé™ä½å¯è¯»æ€§
>
> 3ï¸âƒ£ Apple çš„ API æŒ‡å—å»ºè®®ï¼šåªæœ‰åœ¨â€œè¯­ä¹‰éå¸¸æ˜ç¡®â€çš„æƒ…å†µä¸‹æ‰å®šä¹‰è¿ç®—ç¬¦ã€‚å¤æ‚æ“ä½œå»ºè®®ç”¨å‡½æ•°æ–¹æ³•è€Œä¸æ˜¯è¿ç®—ç¬¦ã€‚

* **æœ¬è´¨**ï¼šè¿ç®—ç¬¦å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªæ˜¯æœ‰ç‰¹æ®Šç¬¦å·å†™æ³•è€Œå·²

* **è¿ç®—ç¬¦é‡è½½**ï¼šç»™å·²æœ‰çš„è¿ç®—ç¬¦ï¼ˆå¦‚ `+`ã€`-`ã€`==`ï¼‰æä¾›æ–°çš„å®ç°ï¼Œæˆ–è€…ä¸ºè‡ªå®šä¹‰ç±»å‹æ·»åŠ æ”¯æŒ

* è‡ªå®šä¹‰è¿ç®—ç¬¦

  > [**Swift**](https://developer.apple.com/swift/)  è¿ç®—ç¬¦åˆ†ç±»ï¼š
  >
  > - `prefix` å‰ç¼€è¿ç®—ç¬¦
  > - `postfix` åç¼€è¿ç®—ç¬¦
  > - `infix` ä¸­ç¼€è¿ç®—ç¬¦ï¼ˆè¦å®šä¹‰ä¼˜å…ˆçº§ç»„ï¼‰

  ```swift
  // å£°æ˜ä¸€ä¸ªä¸­ç¼€è¿ç®—ç¬¦
  infix operator **: MultiplicationPrecedence
  
  // å®šä¹‰å®ç°
  func ** (lhs: Int, rhs: Int) -> Int {
      return Int(pow(Double(lhs), Double(rhs)))
  }
  
  print(2 ** 3) // 8
  ```

* ç¤ºä¾‹

  * é‡è½½ç­‰äºå·

    > [**Swift**](https://developer.apple.com/swift/) æ›´æ¨èè®©ç±»å‹éµå®ˆ `Equatable` / `Comparable` åè®®ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆæˆ `==` å’Œ `<`

    ```swift
    struct User {
        let id: Int
    }
    
    func == (lhs: User, rhs: User) -> Bool {
        lhs.id == rhs.id
    }
    ```

### 7ã€<font color=red>**å•ä¾‹**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 7.1ã€æ— æ³•ä¸»åŠ¨é”€æ¯çš„å•ä¾‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 7.1.1ã€æ¨èå†™æ³• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ <font color=red>**`static let` **</font>**æ‡’åŠ è½½**ï¼š [**Swift**](https://developer.apple.com/swift/) ä¸­ `static let` å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„æ‡’åŠ è½½ã€‚ä¸ä¼šæå‰åˆå§‹åŒ–ï¼Œä¹Ÿä¸ç”¨é¢å¤–åŠ é”ã€‚
>
> 2ï¸âƒ£ <font color=red>**`final` **</font>**ä¿®é¥°ç±»**ï¼šé˜²æ­¢è¢«ç»§æ‰¿ï¼Œé¿å…å­ç±»åŒ–ç ´åå•ä¾‹æ¨¡å¼ã€‚
>
> 3ï¸âƒ£ <font color=red>**`private` **</font>**ç§æœ‰åŒ– init**ï¼šé¿å… `MySingleton()` è¢«å¤–éƒ¨ç›´æ¥è°ƒç”¨ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚

```swift
/// çº¿ç¨‹å®‰å…¨æ‡’åŠ è½½å•ä¾‹
final class MySingleton {
    // å”¯ä¸€å®ä¾‹ï¼ˆé™æ€å¸¸é‡ï¼Œæ‡’åŠ è½½ + çº¿ç¨‹å®‰å…¨ï¼‰
    static let shared = MySingleton()
    
    // ç§æœ‰åŒ–åˆå§‹åŒ–æ–¹æ³•ï¼Œé¿å…å¤–éƒ¨ new
    private init() {
        print("MySingleton åˆå§‹åŒ–äº†")
    }
    
    // ä½ å¯ä»¥åœ¨è¿™é‡Œå†™å„ç§æ–¹æ³•æˆ–å±æ€§
    func doSomething() {
        print("åšç‚¹äº‹æƒ…")
    }
}

MySingleton.shared.doSomething()
```

##### 7.1.2ã€å…¶ä»–å†™æ³•ï¼ˆå¯¹æ¯”ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¸æ¨èï¼Œä»£ç æ›´å¤æ‚

  ```swiftÂ 
  /// å»¶è¿Ÿå­˜å‚¨å±æ€§ + static var
  class MySingleton {
      static var shared: MySingleton = {
          let instance = MySingleton()
          return instance
      }()
      private init() {}
  }
  ```

* **ObjC** é£æ ¼çš„ `dispatch_once`ï¼ˆ[**Swift**](https://developer.apple.com/swift/) 1/2 æ—¶ä»£ç”¨çš„ï¼Œç°åœ¨å¤šä½™ï¼‰æœ¬è´¨ç­‰ä»·äº `static let`

  ```swiftÂ 
  class MySingleton {
      static let shared: MySingleton = {
          return MySingleton()
      }()
      private init() {}
  }
  ```

#### 7.2ã€å¯ä»¥ä¸»åŠ¨é”€æ¯çš„å•ä¾‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> éœ€è¦**è‡ªå·±ç»´æŠ¤å¼•ç”¨**ï¼Œè€Œä¸æ˜¯ `static let`ï¼š

```swift
final class MySingleton {
    static var shared: MySingleton? = MySingleton()
    private init() { print("åˆå§‹åŒ–") }
    
    static func destroy() {
        print("é”€æ¯å•ä¾‹")
        shared = nil
    }
}

MySingleton.shared?.doSomething()
MySingleton.destroy()
```

### 8ã€[**Swift**](https://developer.apple.com/swift/)æ´¾å‘ï¼ˆDispatchï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ğŸ”¹ æ€§èƒ½å¯¹æ¯” (å¿« â†’ æ…¢)
> * **é™æ€æ´¾å‘**ï¼ˆæœ€ä¼˜åŒ–ï¼Œå¯èƒ½å†…è”ï¼‰
> * **è™šæ‹Ÿæ´¾å‘**ï¼ˆvtable æŸ¥è¡¨ï¼‰
> * **åè®® witness table æ´¾å‘**
> * **åŠ¨æ€æ´¾å‘**ï¼ˆobjc_msgSendï¼‰
>
> ğŸ”¹ å¼€å‘ä¸­å¸¸ç”¨çš„ä¿®é¥°ç¬¦ä¸æ´¾å‘å…³ç³»
> * `final` â†’ å¼ºåˆ¶é™æ€æ´¾å‘ï¼ˆä¸èƒ½è¢« overrideï¼‰
> * `private` / `fileprivate` â†’ é™æ€æ´¾å‘
> * `dynamic` â†’ å¼ºåˆ¶åŠ¨æ€æ´¾å‘ï¼ˆobjc runtimeï¼‰
> * `@objc` â†’ èµ° objc runtime
> * åè®®æ–¹æ³• â†’ witness table
> * å€¼ç±»å‹ (struct/enum) â†’ é™æ€æ´¾å‘


#### 8.1ã€é™æ€æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç¼–è¯‘æœŸå°±ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚
>
> 2ï¸âƒ£ è¿è¡Œæ—¶ä¸éœ€è¦æŸ¥è¡¨ï¼Œæœ€å¿«ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - `struct` / `enum`ï¼ˆå€¼ç±»å‹çš„æ–¹æ³•ï¼‰
> - `final class` æˆ– `final` æ–¹æ³•
> - `private` / `fileprivate` æ–¹æ³•
> - `static` æ–¹æ³•

 ```swift
 struct Foo {
     func bar() { print("bar") }
 }
 
 let foo = Foo()
 foo.bar()   // é™æ€æ´¾å‘ï¼Œç¼–è¯‘å™¨ç›´æ¥å†…è”
 ```

#### 8.2ã€è™šæ‹Ÿæ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç»å…¸çš„ **vtable (è™šå‡½æ•°è¡¨)** æ´¾å‘ã€‚
>
> 2ï¸âƒ£ ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ–¹æ³•è¡¨ï¼Œè¿è¡Œæ—¶æŸ¥è¡¨å†³å®šè°ƒç”¨å“ªä¸ªå®ç°ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - class çš„å®ä¾‹æ–¹æ³•ï¼ˆé»˜è®¤ï¼‰

```swift
class A {
    func foo() { print("A") }
}
class B: A {
    override func foo() { print("B") }
}

let a: A = B()
a.foo()   // è™šæ‹Ÿæ´¾å‘ï¼Œé€šè¿‡ vtable æŸ¥æ‰¾ -> "B"
```

#### 8.3ã€åŠ¨æ€æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ é€šè¿‡ **Objective-C runtime çš„æ¶ˆæ¯å‘é€æœºåˆ¶ (`objc_msgSend`)**ã€‚
>
> 2ï¸âƒ£ æ€§èƒ½æ¯” vtable æ…¢ï¼Œä½†æ›´çµæ´»ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - `@objc` æ–¹æ³•
> - `dynamic` ä¿®é¥°çš„æ–¹æ³•

```swift
class C: NSObject {
    @objc dynamic func foo() { print("C") }
}
let c = C()
c.foo()   // objc_msgSend åŠ¨æ€æ´¾å‘
```

#### 8.4ã€ç›´æ¥æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç”¨åœ¨ **åè®®çš„é»˜è®¤å®ç°**ï¼Œé€šè¿‡ **witness table (è§è¯è¡¨)** æ¥è°ƒç”¨ã€‚
>
> 2ï¸âƒ£ ç¼–è¯‘æ—¶ä¸èƒ½ç¡®å®šå®ç°ï¼Œè¿è¡Œæ—¶æŸ¥è¡¨å†³å®šã€‚

```swift
protocol P {
    func foo()
}

extension P {
    func foo() { print("default") }
}

struct S: P {}
let p: P = S()
p.foo()   // witness table æ´¾å‘
```

### 9ã€[**Swift**](https://developer.apple.com/swift/) é«˜é˜¶å‡½æ•°<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 9.1ã€`joined()` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ­£å¸¸æ‹¼æ¥

  ```Swift
  let words = ["Hello", "World", "Swift"]
  
  let sentence = words.joined()
  print(sentence)   // HelloWorldSwift
  ```

* æŒ‡å®šæ‹¼æ¥æ—¶çš„åˆ†éš”ç¬¦

  ```Swift
  let words = ["Hello", "World", "Swift"]
  
  let sentence = words.joined(separator: " ")
  print(sentence)   // Hello World Swift
  ```

### 10ã€[**Swift**](https://developer.apple.com/swift/) æ²¡æœ‰ç›´æ¥çš„<font color=red>**KVO**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**KVO**</font>çš„ç‰¹ç‚¹
  * ä¾èµ– **runtime åŠ¨æ€ç”Ÿæˆå­ç±»ï¼ˆisa-swizzlingï¼‰** æ¥æ‹¦æˆªå±æ€§ setter
  * èƒ½ç›‘å¬å‡ ä¹ä»»æ„å±æ€§ï¼ˆåªè¦ç¬¦åˆ<font color=red>**KVO**</font>è§„åˆ™ï¼‰
  * å†™æ³•ç¹çï¼ˆ`addObserver/removeObserver`ï¼‰
  * å´©æºƒé£é™©å¤§ï¼ˆæ²¡ç§»é™¤ã€å±æ€§æ²¡æ ‡<font color=red>**KVO**</font>ï¼‰
  * ä¸é€æ˜ï¼ˆè°ƒè¯•æ—¶å¾ˆéš¾çœ‹å‡ºèƒŒåå‘ç”Ÿäº†å•¥ï¼‰
* [**Swift**](https://developer.apple.com/swift/) ä¸ºä»€ä¹ˆä¸ç›´æ¥ç»™å‡º<font color=red>**KVO**</font>ï¼Ÿ
  * [**Swift**](https://developer.apple.com/swift/) çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ **ç±»å‹å®‰å…¨ + å¯é¢„æµ‹æ€§**
  * å› æ­¤ [**Swift**](https://developer.apple.com/swift/) å¹¶æ²¡æœ‰æŠŠ **ObjC** é‚£å¥— runtime hack çº§çš„ä¸œè¥¿æ¬è¿‡æ¥ï¼Œè€Œæ˜¯æä¾›äº† **æ›´å®‰å…¨çš„é€‰æ‹©**ã€‚
* ğŸ”‘[**Swift**](https://developer.apple.com/swift/) ä¸­æ›¿ä»£ <font color=red>**KVO**</font> çš„æ–¹å¼
  *  <a href="#å±æ€§è§‚å¯Ÿå™¨" style="font-size:17px; color:green;"><b>å±æ€§è§‚å¯Ÿå™¨</b></a>
  * `ObservableObject` + `@Published`ï¼ˆSwiftUI / Combineï¼‰
  * æ¡¥æ¥**ObjC**åä½¿ç”¨<font color=red>**KVO**</font>
  * å¼€æºåº“æ”¯æŒï¼š[**Bond**](https://github.com/DeclarativeHub/Bond)ã€[**RxSwift**](https://github.com/ReactiveX/RxSwift)ã€[**ReactiveSwift**](https://github.com/ReactiveCocoa/ReactiveSwift)

### 11ã€`throw`/`do`/`try`/`catch`/`finally` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**`throw`**</font>

  > æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆå¿…é¡»æ˜¯ `Error` åè®®ç±»å‹ï¼‰

  ```swift
  enum MyError: Error { case bad }
  func work() throws {
      throw MyError.bad
  }
  ```

* <font color=red>**`do`**</font>

  ```swift
do {
      let data = try encoder.encode(self)  // å¯èƒ½æŠ›é”™
      print("æˆåŠŸ: \(data)")
  } catch {
      print("å¤±è´¥: \(error)")
  }
  ```

* <font color=red>**`try`**</font>

  * `try` â†’ æ­£å¸¸æŠ›é”™ï¼Œå¿…é¡»åœ¨ `do-catch` æˆ–è€… `throws` å‡½æ•°é‡Œ
  * `try?` â†’ é”™è¯¯è½¬æˆ `nil`
  * `try!` â†’ é”™è¯¯ä¼šç›´æ¥å´©æºƒ

* <font color=red>**`catch`**</font>

  ```swift
  do {
      try work()
  } catch MyError.bad {
      print("æ•è·åˆ° bad é”™è¯¯")
  } catch {
      print("æœªçŸ¥é”™è¯¯: \(error)")
  }
  ```

* **`finally`**ï¼ˆ[**Swift**](https://developer.apple.com/swift/) ç”¨ <font color=red>**`defer`**</font> å®ç°ï¼‰

  > **[Swift](https://developer.apple.com/swift/) æ²¡æœ‰ `finally`å…³é”®å­—**

  ```swift
  // è¿›å…¥ test â†’ æ³¨å†Œ defer
  // æ‰§è¡Œ do/tryï¼Œå¦‚æœæŠ›é”™è·³åˆ° catch
  // åœ¨ä½œç”¨åŸŸé€€å‡ºæ—¶ï¼Œdefer ä¸€å®šä¼šæ‰§è¡Œï¼ˆä¸ç®¡æœ‰æ²¡æœ‰æŠ›é”™ï¼‰
  func test() {
      defer {
          print("ä¸€å®šä¼šæ‰§è¡Œï¼ˆç±»ä¼¼ finallyï¼‰")
      }
  
      do {
          try work()
          print("è¿™é‡Œå¯èƒ½æŠ›é”™")
      } catch {
          print("æ•è·é”™è¯¯: \(error)")
      }
  }
  ```

### 12ã€â° <font id=å®šæ—¶å™¨>å®šæ—¶å™¨</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ UI å±‚ã€ç®€å•é‡å¤ â†’ `Timer`ï¼ˆé…åˆ `.common` æ¨¡å¼ & `tolerance`ï¼‰
>
> 2ï¸âƒ£ å¯¹ç²¾åº¦ç¨³å®šæ€§æ›´æ•æ„Ÿã€è·‘åœ¨åå°é˜Ÿåˆ— â†’ `DispatchSourceTimer`
>
> 3ï¸âƒ£ åŠ¨ç”»æˆ–é€å¸§é€»è¾‘ â†’ `CADisplayLink`ï¼ˆæˆ– Core Animationï¼‰
>
> 4ï¸âƒ£ SwiftUI/å£°æ˜å¼ â†’ Combine çš„ `Timer.publish(...).autoconnect()` æˆ– `Task` å¾ªç¯
>
> 5ï¸âƒ£ çº¯å¼‚æ­¥ä»»åŠ¡ã€æ˜“å–æ¶ˆ â†’ `Task.sleep` å¾ªç¯ï¼Œæˆ–ï¼ˆæ›´ç°ä»£ï¼‰åŸºäº `Clock`

#### 12.1ã€å®šæ—¶å™¨åˆ†ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 12.1.1ã€Foundation.Timerï¼ˆ`NSTimer`ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **RunLoop ä¾èµ–**ï¼š`Timer` åªä¼šåœ¨å…¶æ‰€é™„çš„ RunLoop è¿è¡Œæ—¶è§¦å‘ã€‚
>
> - æ”¾ä¸»çº¿ç¨‹ï¼šé»˜è®¤ OKã€‚
> - æ”¾å­çº¿ç¨‹ï¼šä½ å¾—è‡ªå·±è®©è¯¥çº¿ç¨‹æœ‰ RunLoop ä¸”åœ¨è·‘ï¼ˆ`RunLoop.current.run()` æˆ–æœ‰åˆ«çš„äº‹ä»¶æºï¼‰ã€‚
>
> 2ï¸âƒ£ **RunLoop æ¨¡å¼**ï¼š
>
> - `.default`ï¼šæ»šåŠ¨ UIScrollView ç­‰ UI è¿½è¸ªæ—¶ä¼šæš‚åœã€‚
> - `.common`ï¼šæŠŠå®šæ—¶å™¨åŠ å…¥ Common Modesï¼Œæ»šåŠ¨æ—¶ä¹Ÿä¼šè·‘ã€‚**é€šå¸¸ä¸šåŠ¡æ¨è `.common`**ã€‚
>
> 3ï¸âƒ£ **å¼ºå¼•ç”¨å¾ªç¯**ï¼šé—­åŒ…é‡Œè¦ç”¨ `[weak self]`ï¼›selector é£æ ¼ä¸­ Timer ä¼šå¼ºæŒæœ‰ targetã€‚
>
> 4ï¸âƒ£ **é”€æ¯/åœæ­¢**ï¼šè°ƒç”¨ `invalidate()`ï¼›å¦åˆ™é‡å¤å®šæ—¶å™¨ä¼šä¸€ç›´å ç€ RunLoop & å†…å­˜ã€‚
>
> 5ï¸âƒ£ **å®¹å¿åº¦ `tolerance`**ï¼šè®©ç³»ç»Ÿåˆå¹¶å”¤é†’ï¼Œçœç”µï¼›ä¸€èˆ¬è®¾ä¸º `â‰¤ timeInterval * 0.1`ã€‚
>
> 6ï¸âƒ£ **ç²¾åº¦ä¸æ¼‚ç§»**ï¼šä¸»çº¿ç¨‹å¡é¡¿/RunLoop è¢«å ç”¨ â†’ è§¦å‘ä¼šå»¶åï¼›Timer ä¼šæŒ‰æ—¶é—´æ¨è¿›è€Œéè¿½å¸§è¡¥å‘ã€‚
>
> 7ï¸âƒ£ **åå°é™åˆ¶**ï¼šApp è¿›åå°åï¼Œæ™®é€š `Timer` è§¦å‘ä¼šè¢«ç³»ç»ŸæŒ‚èµ·ï¼ˆé™¤éç‰¹å®šåå°æ¨¡å¼ï¼‰ã€‚ä¸è¦æŒ‡æœ›åå°é•¿æœŸèµ°æ—¶é’Ÿï¼Œæ”¹ç”¨æ¨é€ã€`BGTaskScheduler`ã€VoIPã€å®šä½ç­‰ç³»ç»Ÿèƒ½åŠ›ã€‚

* é—­åŒ…é£æ ¼ï¼ˆæ¨èï¼‰

  ```swift
  class Foo {
      private var timer: Timer?
  
      func start() {
          timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { [weak self] t in
              guard let self else { return }
              // ä½ çš„é€»è¾‘
              print("tick: \(Date())")
          }
          // æ³¨æ„ RunLoop æ¨¡å¼ï¼ˆè§ä¸‹æ–¹ï¼‰
          RunLoop.current.add(timer!, forMode: .common)
          // å¯é€‰ï¼šå®¹å¿åº¦ï¼Œçœç”µ
          timer?.tolerance = 0.1
      }
  
      func stop() {
          timer?.invalidate()
          timer = nil
      }
  }
  ```

* `selector` é£æ ¼ï¼ˆ**ObjC** å…¼å®¹ï¼‰

  * åˆ›å»º/å®šä¹‰ å®šæ—¶å™¨

    ```swift
    timer = Timer.scheduledTimer(timeInterval: 1.0,
                                 target: self,
                                 selector: #selector(tick),
                                 userInfo: nil,
                                 repeats: true)
    ```

  * æ‰‹åŠ¨æ·»åŠ åˆ° RunLoop

    ```swift
    RunLoop.current.add(timer!, forMode: .common)
    ```

  * å®šæ—¶å™¨æ–¹æ³•å®ç°

    ```swift
    @objc private func tick() {
        // ...
    }
    ```

##### 12.1.2ã€`DispatchSourceTimer`ï¼ˆGCD è®¡æ—¶å™¨ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **ä¸ä¾èµ– RunLoop**ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½èƒ½å‡†ç‚¹è§¦å‘ï¼›æ›´é€‚åˆâ€œæœåŠ¡å‹â€ä»»åŠ¡ã€‚
>
> 2ï¸âƒ£ **å¿…é¡» `resume()` ä¸€æ¬¡**ï¼ˆæ–°å»ºæ—¶æ˜¯ suspendedï¼‰ã€‚
>
> 3ï¸âƒ£ **`leeway` éå¸¸é‡è¦**ï¼šåˆé€‚çš„ leeway èƒ½æ˜¾è‘—çœç”µã€‚
>
> 4ï¸âƒ£ **çº¿ç¨‹å®‰å…¨**ï¼šå›è°ƒåœ¨ä½ æŒ‡å®šçš„é˜Ÿåˆ—ä¸Šï¼Œä¸è¦åœ¨é‡Œå¤´åšé‡ UIï¼›è¦å›ä¸»çº¿ç¨‹å°± `DispatchQueue.main.async {}`ã€‚
>
> 5ï¸âƒ£ **å–æ¶ˆåä¸å¯å¤ç”¨**ï¼šå–æ¶ˆå³åºŸï¼Œéœ€é‡å»ºã€‚

```swift
final class Ticker {
    private var timer: DispatchSourceTimer?

    func start() {
        let queue = DispatchQueue(label: "com.example.ticker")
        let t = DispatchSource.makeTimerSource(queue: queue)
        t.schedule(deadline: .now() + 1.0,        // é¦–æ¬¡å»¶è¿Ÿ
                   repeating: 1.0,                 // å‘¨æœŸ
                   leeway: .milliseconds(100))     // å®¹å¿åº¦ï¼ˆçœç”µï¼‰
        t.setEventHandler { [weak self] in
            // åå°é˜Ÿåˆ—æ‰§è¡Œ
            self?.doWork()
        }
        t.resume()     // âš ï¸ å¿…é¡» resume ä¸€æ¬¡
        timer = t
    }

    func stop() {
        timer?.cancel()  // ç»ˆæ­¢äº‹ä»¶æº
        timer = nil
    }

    private func doWork() { /* ... */ }
}
```

##### 12.1.3ã€`CADisplayLink`ï¼ˆé€å¸§å®šæ—¶ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **ç”¨é€”**ï¼šè‡ªç»˜åŠ¨ç”»ã€æ¸¸æˆå¾ªç¯ã€è¿›åº¦æ¡å¹³æ»‘æ›´æ–°ã€‚
> 2ï¸âƒ£ **ä¸è¦ç”¨å®ƒ** åšâ€œæ¯ 1s ä¸€æ¬¡â€çš„ä¸šåŠ¡å®šæ—¶ï¼Œæµªè´¹ç”µã€‚

```swift
class DisplayDriver {
    private var link: CADisplayLink?

    func start() {
        link = CADisplayLink(target: self, selector: #selector(step))
        // è·Ÿéš UI äº¤äº’ï¼Œç”¨ common æ¨¡å¼
        link?.add(to: .main, forMode: .common)
        // iOS 15+ï¼ˆå¯é€‰ï¼‰æ›´ç»†çš„å¸§ç‡èŒƒå›´
        // link?.preferredFrameRateRange = CAFrameRateRange(minimum: 30, maximum: 120, preferred: 60)
    }

    func stop() {
        link?.invalidate()
        link = nil
    }

    @objc private func step() {
        // æ¯å¸§è°ƒç”¨ï¼›å—å±å¹•åˆ·æ–°ç‡å½±å“
    }
}
```

##### 12.1.4ã€`Combine` çš„ `Timer.TimerPublisher`  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **UIKit**

  ```swift
  import Combine
  
  final class VM {
      private var bag = Set<AnyCancellable>()
  
      func start() {
          Timer.publish(every: 1.0, on: .main, in: .common)
              .autoconnect()
              .sink { _ in
                  // æ¯ç§’è§¦å‘
              }
              .store(in: &bag)
      }
  
      func stop() {
          bag.removeAll()
      }
  }
  ```

* **SwiftUI**

  > **ç‰¹ç‚¹**ï¼šå“åº”å¼ã€æ˜“ç»„åˆã€å’Œ SwiftUI å¤©ç„¶å¥‘åˆã€‚
  > **æœ¬è´¨**ï¼šä»å— RunLoop/é˜Ÿåˆ—ä¸å‰å°çŠ¶æ€å½±å“ï¼Œç²¾åº¦ â‰ˆ `Timer`ã€‚

  ```swift
  struct ContentView: View {
      @State private var tick = 0
      private let timer = Timer.publish(every: 1, on: .main, in: .common).autoconnect()
  
      var body: some View {
          Text("tick: \(tick)")
              .onReceive(timer) { _ in
                  tick += 1
              }
      }
  }
  ```

##### 12.1.5ã€[**Swift**](https://developer.apple.com/swift/)  å¹¶å‘çš„<u>è½¯å®šæ—¶å™¨</u>ï¼ˆ`Task.sleep` / `Clock`ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **ä¼˜ç‚¹**ï¼šæ—  RunLoop ä¾èµ–ï¼›å¤©ç„¶æ”¯æŒå–æ¶ˆï¼›å†™æ³•ç›´è§‚ã€‚
> **æ³¨æ„**ï¼šè¿™ä¸æ˜¯ç³»ç»Ÿçº§â€œå®šæ—¶å™¨äº‹ä»¶æºâ€ï¼Œè€Œæ˜¯åç¨‹é‡Œâ€œç¡çœ  + å¾ªç¯â€çš„æ¨¡å¼ã€‚ä¸è¦åœ¨é‡Œå¤´åšé˜»å¡å·¥ä½œï¼›éœ€è¦ UI æ›´æ–°å°±å›ä¸»çº¿ç¨‹ã€‚

* æœ€é€šç”¨å†™æ³•ï¼ˆæ‰€æœ‰ç³»ç»Ÿç‰ˆæœ¬å¯ç”¨ï¼‰

  ```swift
  final class Worker {
      private var task: Task<Void, Never>?
  
      func start() {
          task = Task {
              while !Task.isCancelled {
                  // ä½ çš„é€»è¾‘
                  try? await Task.sleep(nanoseconds: 1_000_000_000) // 1s
              }
          }
      }
  
      func stop() {
          task?.cancel()
          task = nil
      }
  }
  ```

* ä½¿ç”¨ Clockï¼ˆè¾ƒæ–°çš„ã€æ›´è¯­ä¹‰åŒ–çš„ APIï¼›å¦‚æœä½ çš„ Swift/OS æ”¯æŒï¼‰

  ```swift
  import Foundation
  
  let clock = ContinuousClock()   // ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“çš„å•è°ƒæ—¶é’Ÿ
  
  task = Task {
      var next = clock.now
      while !Task.isCancelled {
          next += .seconds(1)
          // do work
          try? await clock.sleep(until: next)
      }
  }
  ```

#### 12.2ã€ç²¾åº¦ã€è€—ç”µä¸åå°çš„ç¡¬çº¦æŸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **ç²¾åº¦ç°å®**ï¼šç§»åŠ¨ç«¯ä¸è¿½æ±‚çº³ç§’çº§ã€‚ä¸»çº¿ç¨‹å¡é¡¿ã€CPU è´Ÿè½½ã€ç³»ç»Ÿçœç”µåˆå¹¶éƒ½ä¼šè®©ä½ **å»¶å**ã€‚

* **çœç”µç­–ç•¥**ï¼š

  - è®¾å®š `tolerance`ï¼ˆTimerï¼‰æˆ–åˆç† `leeway`ï¼ˆGCDï¼‰ã€‚
  - ä¸è¦æŠŠå‘¨æœŸè®¾å¾—è¿‡å°ï¼ˆ<16ms è¿™ç±»é™¤éåšéŸ³è§†é¢‘/åŠ¨ç”»ï¼‰ã€‚
  - ä¸šåŠ¡ä¸Šåˆå¹¶ä»»åŠ¡ï¼ˆæ‰¹å¤„ç†ï¼‰æ›¿ä»£é«˜é¢‘å”¤é†’ã€‚

* **åå°é™åˆ¶ï¼ˆiOSï¼‰**ï¼šåº”ç”¨è¿›å…¥åå°ï¼Œæ™®é€š Timer/GCD äº‹ä»¶å¤§æ¦‚ç‡è¢«ç³»ç»ŸæŒ‚èµ·ã€‚éœ€è¦çœŸæ­£åå°æ‰§è¡Œï¼Œç”¨**ç³»ç»Ÿæ”¯æŒçš„åå°èƒ½åŠ›**ï¼š

  - `BGTaskScheduler`ï¼ˆåå°å¤„ç†/åˆ·æ–°ï¼‰ã€
  - åå°éŸ³é¢‘ã€VoIPã€å®šä½ã€è“ç‰™ç­‰**ç‰¹å®š**åå°æ¨¡å¼ã€
  - Push/é™é»˜æ¨é€ï¼ˆAPNs + Background Fetchï¼‰ã€‚**ä¸è¦**è¯•å›¾ç”¨å®šæ—¶å™¨â€œå·è·‘â€åå°â€”â€”ä¼šè¢«ç³»ç»Ÿæ€/é™ã€‚

#### 12.3ã€`RunLoop` æ¨¡å¼ä¸çº¿ç¨‹æ¨¡å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **æ¨¡å¼**ï¼š

  - `.default`ï¼šæ™®é€šäº‹ä»¶ã€‚
  - `.tracking`ï¼šæ»šåŠ¨è·Ÿè¸ªç­‰äº¤äº’é˜¶æ®µã€‚
  - `.common`ï¼šä¸€ä¸ªâ€œæ ‡ç­¾é›†åˆâ€ï¼ŒæŠŠå®šæ—¶å™¨åŠ å…¥ `.common` â‡’ åœ¨å¤šä¸ªæ¨¡å¼ä¸‹éƒ½æœ‰æ•ˆï¼ˆå¦‚è¾¹æ»šè¾¹è§¦å‘ï¼‰ã€‚
  - UI å±‚é€šç”¨å»ºè®®ï¼šæŠŠå®šæ—¶å™¨åŠ å…¥ `.common`ã€‚

* **çº¿ç¨‹**ï¼š

  - `Timer` ç»‘å®šåˆ›å»ºå®ƒçš„çº¿ç¨‹çš„ RunLoopã€‚å­çº¿ç¨‹éœ€è¦æ‰‹åŠ¨è·‘ RunLoopã€‚
  - `DispatchSourceTimer` ç»‘å®š `DispatchQueue`ï¼Œä¸éœ€è¦ RunLoopã€‚

#### 12.4ã€å…¸å‹åœºæ™¯ä»£ç ç‰‡æ®µ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å€’è®¡æ—¶ï¼ˆUI å®‰å…¨ã€ä¸å¡é¡¿ï¼‰

  ```swift
  final class Countdown {
      private var remain: Int
      private var timer: DispatchSourceTimer?
  
      init(seconds: Int) { self.remain = seconds }
  
      func start(tick: @escaping (Int) -> Void, done: @escaping () -> Void) {
          let q = DispatchQueue(label: "countdown")
          let t = DispatchSource.makeTimerSource(queue: q)
          t.schedule(deadline: .now(), repeating: 1, leeway: .milliseconds(50))
          t.setEventHandler { [weak self] in
              guard let self else { return }
              if self.remain <= 0 {
                  t.cancel()
                  DispatchQueue.main.async { done() }
                  return
              }
              self.remain -= 1
              DispatchQueue.main.async { tick(self.remain) }
          }
          t.resume()
          timer = t
      }
  
      func stop() {
          timer?.cancel()
          timer = nil
      }
  }
  ```

* é˜²æŠ–/èŠ‚æµï¼ˆä¸»çº¿ç¨‹ï¼‰

  ```swift
  /// é˜²æŠ–ï¼ˆdebounceï¼‰ï¼šåªåœ¨â€œåœæ­¢è§¦å‘åä¸€æ®µæ—¶é—´â€æ‰§è¡Œ
  final class Debouncer {
      private var workItem: DispatchWorkItem?
  
      func schedule(after delay: TimeInterval, _ block: @escaping () -> Void) {
          workItem?.cancel()
          let item = DispatchWorkItem(block: block)
          workItem = item
          DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: item)
      }
  }
  ```

  ```swift
  /// èŠ‚æµï¼ˆthrottleï¼‰ï¼šå›ºå®šçª—å£å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡
  final class Throttler {
      private var lastFire: DispatchTime = .now()
      private var scheduled = false
  
      func call(interval: TimeInterval, _ block: @escaping () -> Void) {
          let now = DispatchTime.now()
          let delta = now.uptimeNanoseconds - lastFire.uptimeNanoseconds
          if delta >= UInt64(interval * 1_000_000_000) {
              lastFire = now
              block()
          } else if !scheduled {
              scheduled = true
              let delay = Double(UInt64(interval * 1_000_000_000) - delta) / 1_000_000_000
              DispatchQueue.main.asyncAfter(deadline: .now() + delay) { [weak self] in
                  guard let self else { return }
                  self.lastFire = .now()
                  self.scheduled = false
                  block()
              }
          }
      }
  }
  ```

#### 12.5ã€`SwiftUI`@å®šæ—¶å™¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Timer + onReceive**ï¼šç®€å•åˆ—è¡¨/å€’è®¡æ—¶ UI ç”¨è¿™ä¸ªå¤Ÿäº†
* **`Task` + `sleep`**ï¼šåœ¨ `task { }` é‡Œå†™å¾ªç¯ï¼Œæ”¯æŒå–æ¶ˆï¼Œé€»è¾‘æ›´ç›´
* **TimelineView**ï¼ˆåšæ—¶é—´é©±åŠ¨çš„è§†å›¾åˆ·æ–°ï¼Œå¦‚è¡¨ç›˜/ç§’é’ˆï¼‰æ¯”ç”Ÿ Timer æ›´è¯­ä¹‰åŒ–
* **ä¸è¦åœ¨ View é‡Œç›´æ¥æŒæœ‰ GCD timer**ï¼›æŠŠå®ƒæ”¾åˆ° **ViewModel**/**ObservableObject** ç®¡ç†

#### 12.6ã€æ—¶é—´æ¥æºä¸æ ¡æ­£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **ç³»ç»Ÿæ—¶é—´ ğŸ†š å•è°ƒæ—¶é’Ÿ**ï¼šç”¨æˆ·æ”¹ç³»ç»Ÿæ—¶é’Ÿå¯èƒ½å½±å“åŸºäº<u>**æŒ‚é’Ÿæ—¶é—´**</u>çš„è°ƒåº¦
  - å¯¹æŠ—ï¼šä½¿ç”¨å•è°ƒæ—¶é—´ï¼ˆGCD/Clockï¼‰ï¼Œæˆ–åŸºäºç›¸å¯¹æ—¶é—´æ¨è¿›
  
* **é•¿ä»»åŠ¡æ¼‚ç§»**ï¼šå¦‚æœæ¯è½®å¤„ç†æ—¶é—´æ¥è¿‘å‘¨æœŸï¼Œæ¼‚ç§»ä¸å¯é¿å…ï¼›æ§åˆ¶å›è°ƒé‡Œå·¥ä½œé‡ï¼Œå¿…è¦æ—¶å¼‚æ­¥åŒ–

* **çº åç­–ç•¥**ï¼šè®°å½•åŸºå‡† `Date/Instant`ï¼Œæ¯æ¬¡è®¡ç®—â€œåº”è¯¥çš„ä¸‹ä¸€æ¬¡â€è€Œé<u>**å½“å‰æ—¶é—´ + å›ºå®šå‘¨æœŸ**</u>

### 13ã€**`JSONDecoder`** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**æ ‡å‡† JSONæ ¼å¼ é‡Œï¼ŒJSONå¯¹è±¡çš„ key æ°¸è¿œæ˜¯å­—ç¬¦ä¸²**</font>

* **` enum CodingKeys : String, CodingKey`** ğŸ‘‰ è¿™æ˜¯ä¸€ä¸ªç”¨å­—ç¬¦ä¸²åš key çš„ **CodingKey** é›†åˆ

* `keyDecodingStrategy` ğŸ†š `CodingKeys`

  * `JSONDecoder().keyDecodingStrategy = .convertFromSnakeCase` è¿™ä¸ªå¼€å…³å¯ä»¥ç›´æ¥å…¨å±€æ‰“å¼€
  * æœ€å¥½å†™ `CodingKeys`ã€‚`keyDecodingStrategy`ä¸æ˜¯ä¸‡èƒ½çš„
  * æ²¡å†™ `CodingKeys` æ—¶ï¼šç”¨ keyDecodingStrategy çš„è§„åˆ™ã€‚
  * å†™äº† `CodingKeys`ï¼šä»¥ `CodingKeys` ä¸ºå‡†ï¼ˆä½ æ‰‹åŠ¨æŒ‡å®šæ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼‰ã€‚

* å½“éœ€è¦è®©ä¸€ä¸ª `struct` æˆ– `class` éµå®ˆ <font color=red>**`Codable`**</font>ï¼ˆå³ï¼Œ<font color=red>**`Codable`**</font> =  `Encodable` + ` Decodable`ï¼‰åè®®æ—¶ï¼Œ[**Swift**](https://developer.apple.com/swift/)  é»˜è®¤ä¼šåš **å±æ€§å â‡† JSON key** çš„è‡ªåŠ¨æ˜ å°„ï¼š

  ```swift
  /// JSONDecoderè§£æå­—æ®µ@ç”¨keyDecodingStrategyå¤„ç†Jsonå­—æ®µåå’Œæ¨¡å‹åä¸ä¸€è‡´
  func JSONDecoder_keyDecodingStrategy(){
  
      let json = """
      {
        "user_id": 1,
        "user_name": "Jobs"
      }
      """.data(using: .utf8)!
  
      struct User: Codable {
          let userId: Int
          let userName: String
      }
  
      do {
          let user = try JSONDecoder()
              .bykeyDecodingStrategy(.convertFromSnakeCase) // ğŸ‘ˆ å…³é”®
              .decode(User.self, from: json)
          print(user.userId, user.userName) // 1 Jobs true
      } catch {
          print("âŒ è§£æå¤±è´¥ï¼š\(error)")
      }
  }
  ```

* ä½†æ˜¯æœ‰äº›æƒ…å†µ

  - ä½ çš„å±æ€§åå’Œ **JSON** å­—æ®µå **ä¸ä¸€æ ·**

  - ä½ éœ€è¦ **æ‰‹åŠ¨æ§åˆ¶æ˜ å°„**

  - ä½ æƒ³ **å¿½ç•¥æŸäº›å­—æ®µ**

    ```swift
    /// JSONDecoderè§£æå­—æ®µ@ç”¨CodingKeyså¤„ç†Jsonå­—æ®µåå’Œæ¨¡å‹åä¸ä¸€è‡´ä»¥åŠå¿½ç•¥å­—æ®µï¼ˆageï¼‰
    func JSONDecoder_CodingKeys(){
    
        let json = """
        {
          "user_id": 1,
          "user_name": "Jobs"
        }
        """.data(using: .utf8)!
    
        struct User: Codable {
            let userId: Int
            let userName: String
            let age: Int? = nil  // ğŸ‘ˆ æƒ³å¿½ç•¥:åœ¨ä¸‹é¢çš„ `enum CodingKeys: String, CodingKey` é‡Œé¢ä¸åšæ˜ å°„,å¹¶ä¸”ç»™äºˆé»˜è®¤å€¼ï¼ˆå¦åˆ™è¯­æ³•é”™è¯¯ï¼‰
            /// æ¨¡å‹å = æœåŠ¡å™¨å­—æ®µå
            /// å¦‚æœå±æ€§ä¸å†™åœ¨ `CodingKeys` é‡Œï¼Œå°±ä¸ä¼šè¢«ç¼–è§£ç 
            /// ç»“è®ºï¼šæœ€å¥½å†™ CodingKeysã€‚keyDecodingStrategyä¸æ˜¯ä¸‡èƒ½çš„
            enum CodingKeys: String, CodingKey {
                case userId   = "user_id"
                case userName = "user_name"
            }
        }
    
        do {
            let user = try JSONDecoder().decode(User.self, from: json)
            print(user.userId, user.userName) // 1 Jobs true
        } catch {
            print("âŒ è§£æå¤±è´¥ï¼š\(error)")
        }
    }
    ```

* è¿›é˜¶ï¼šæ‰‹åŠ¨å®ç° `init(from:)`

  ```swift
  /// CodingKeys ä¹Ÿå¸¸é…åˆæ‰‹å†™è§£æ
  struct Person: Codable {
      var greeting: String
      var name: String
  
      enum CodingKeys: String, CodingKey {
          case greeting
          case name
      }
  
      init(from decoder: Decoder) throws {
          let container = try decoder.container(keyedBy: CodingKeys.self)
          greeting = try container.decode(String.self, forKey: .greeting)
          name = try container.decode(String.self, forKey: .name)
      }
  }
  ```

### 14ã€<font id=Subscript color=red>`Subscript`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `subscript` = å¸¦å‚æ•°çš„**è®¡ç®—å±æ€§**ï¼Œç”¨ `[]` è¯­æ³•è®¿é—®ã€‚ç”¨æ¥è®©è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä¹Ÿèƒ½åƒæ•°ç»„ / å­—å…¸é‚£æ · `obj[...]` å–å€¼ã€æ”¹å€¼ã€‚

* ç»å…¸æ¡ˆä¾‹

  * å®‰å…¨å–`Array`

    ```swift
    extension Array {
        /// å®‰å…¨è¯»ï¼šè¶Šç•Œè¿”å› nilï¼Œä¸ crash
        subscript(safe index: Int) -> Element? {
            indices.contains(index) ? self[index] : nil
        }
    }
    ```

  * å®‰å…¨å–`Dictionary`.`Value`

    ```swift
    extension Dictionary {
        /// è¯­ä¹‰åŒ–å®‰å…¨è¯»ï¼šå…¶å®å°±æ˜¯ self[key]
        subscript(safe key: Key) -> Value? {
            self[key]      // è¿™é‡Œä¼šè°ƒç”¨æ ‡å‡†åº“åŸæ¥çš„ subscript(key:)
        }
    }
    ```

  * å®‰å…¨å–å­—ç¬¦`String`.`Character`

    ```swift
    public extension String {
        /// å®‰å…¨å–å­—ç¬¦
        subscript(_ index: Int) -> Character? {
            guard index >= 0 && index < count else { return nil }
            let i = self.index(startIndex, offsetBy: index)
            return self[i]
        }
    }
    ```

  * å®‰å…¨å–`UITableViewCell`

    ```swift
    extension UITableView {
        /// æ ¡éªŒ IndexPath æ˜¯å¦åœ¨å½“å‰ tableView çš„æœ‰æ•ˆèŒƒå›´å†…
        private func isValid(indexPath: IndexPath) -> Bool {
            let section = indexPath.section
            let row = indexPath.row
    
            guard section >= 0, row >= 0 else { return false }
            guard section < numberOfSections else { return false }
            guard row < numberOfRows(inSection: section) else { return false }
            return true
        }
        /// é€šè¿‡ IndexPath å®‰å…¨è·å– cellï¼šè¶Šç•Œ / ä¸å­˜åœ¨ è¿”å› nil
        subscript(safe indexPath: IndexPath) -> UITableViewCell? {
            guard isValid(indexPath: indexPath) else { return nil }
            return cellForRow(at: indexPath)
        }
        /// é€šè¿‡ section / row å®‰å…¨è·å– cellï¼šè¶Šç•Œ / ä¸å­˜åœ¨ è¿”å› nil
        subscript(section s: Int, row r: Int) -> UITableViewCell? {
            let indexPath = IndexPath(row: r, section: s)
            return self[safe: indexPath]
        }
    }
    ```

  * å®‰å…¨å–`UICollectionViewCell`

    ```swift
    extension UICollectionView {
        /// æ ¡éªŒ IndexPath æ˜¯å¦åœ¨å½“å‰ collectionView çš„æœ‰æ•ˆèŒƒå›´å†…
        private func isValid(indexPath: IndexPath) -> Bool {
            let section = indexPath.section
            let item = indexPath.item
    
            guard section >= 0, item >= 0 else { return false }
            guard section < numberOfSections else { return false }
            guard item < numberOfItems(inSection: section) else { return false }
            return true
        }
        /// é€šè¿‡ IndexPath å®‰å…¨è·å– cellï¼šè¶Šç•Œ / ä¸å­˜åœ¨ è¿”å› nil
        subscript(safe indexPath: IndexPath) -> UICollectionViewCell? {
            guard isValid(indexPath: indexPath) else { return nil }
            return cellForItem(at: indexPath)
        }
        /// é€šè¿‡ section / item å®‰å…¨è·å– cellï¼šè¶Šç•Œ / ä¸å­˜åœ¨ è¿”å› nil
        subscript(section section: Int, item item: Int) -> UICollectionViewCell? {
            let indexPath = IndexPath(item: item, section: section)
            return self[safe: indexPath]
        }
    }
    ```

### 15ã€<font color=red>**`inout`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> - <font color=red>**`inout`**</font> ç”¨æ¥ **æŠŠå‚æ•°å½“ä½œå¼•ç”¨ä¼ é€’**ï¼ˆç±»ä¼¼ **C++** çš„å¼•ç”¨ / æŒ‡é’ˆï¼Œæˆ–è€… **Objc** çš„ `&` å‚æ•°ï¼‰
> - é»˜è®¤æƒ…å†µä¸‹ï¼Œ[**Swift**](https://developer.apple.com/swift/) çš„å‡½æ•°å‚æ•°æ˜¯ **å€¼ä¼ é€’**ï¼Œå‡½æ•°é‡Œä¿®æ”¹ä¸ä¼šå½±å“å¤–éƒ¨
> - ç”¨ <font color=red>**`inout`**</font> ä¿®é¥°åï¼Œå‡½æ•°é‡Œä¿®æ”¹çš„å°±æ˜¯å¤–éƒ¨å˜é‡æœ¬èº«

#### 15.1ã€åŸºæœ¬ç”¨æ³• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ä¸ºä»€ä¹ˆè¦å†™ `&`
> - [**Swift**](https://developer.apple.com/swift/) å¾ˆå¼ºè°ƒå®‰å…¨æ€§ï¼Œä¸å…è®¸ä½ <u>æ— æ„ä¸­</u>æŠŠä¸€ä¸ªå€¼ä¼ è¿›å»å°±è¢«å‡½æ•°æ”¹æ‰ã€‚
> - `&` æ˜¯ä¸€ä¸ª **æ˜¾å¼æ ‡è®°**ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å’Œè¯»ä»£ç çš„äººï¼šâš ï¸ è¿™ä¸ªå‡½æ•°ä¼šä¿®æ”¹ä¼ è¿›å»çš„å€¼ã€‚

```swift
func addTen(to number: inout Int) {
    number += 10
}

var value = 5
addTen(to: &value)   // ä¼ å‚æ—¶è¦åŠ  & ç¬¦å·
print(value)         // 15
```

#### 15.2ã€[**å‚æ•°ä¼ é€’çš„æ¯”è¾ƒ**](#æ™®é€šå‚æ•°ä¼ é€’ğŸ†šinoutå‚æ•°ä¼ é€’) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 15.3ã€<font color=red>**`inout`**</font>çš„é™åˆ¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* åªèƒ½ä¼ å˜é‡ï¼Œä¸èƒ½ä¼ å¸¸é‡ / å­—é¢é‡

  ```swift
  var a = 10
  addTen(to: &a)   // âœ… OK
  
  addTen(to: &5)   // âŒ æŠ¥é”™ï¼šä¸èƒ½ç›´æ¥ä¼ å­—é¢é‡
  ```

* **ä¸èƒ½é»˜è®¤å€¼**ï¼ˆæ¯”å¦‚ `inout Int = 0` è¿™ç§å†™æ³•ä¸è¡Œï¼‰

* **ä¸èƒ½å’Œå¯å˜å‚æ•° `...` ä¸€èµ·ç”¨**

#### 15.4ã€ä½¿ç”¨åœºæ™¯ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* äº¤æ¢ä¸¤ä¸ªå˜é‡

  ```swift
  func mySwap<T>(_ a: inout T, _ b: inout T) {
      let tmp = a
      a = b
      b = tmp
  }
  
  var x = 1, y = 2
  mySwap(&x, &y)
  print(x, y) // 2 1
  ```

* åŸåœ°ä¿®æ”¹é›†åˆ

  ```swift
  func doubleAll(_ numbers: inout [Int]) {
      for i in numbers.indices {
          numbers[i] *= 2
      }
  }
  
  var list = [1, 2, 3]
  doubleAll(&list)
  print(list)  // [2, 4, 6]
  
  ```

#### 15.5ã€åº•å±‚ç†è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> `inout` æœ¬è´¨ä¸Šæ˜¯ **Copy-In Copy-Out**ï¼š

- è°ƒç”¨æ—¶ï¼ŒæŠŠå˜é‡çš„åœ°å€ä¼ è¿›å‡½æ•°ã€‚
- å‡½æ•°å†…éƒ¨æ“ä½œçš„æ˜¯ä¸´æ—¶å¼•ç”¨ã€‚
- å‡½æ•°è¿”å›æ—¶ï¼ŒæŠŠä¿®æ”¹åŒæ­¥å›åŸå˜é‡ã€‚

æ‰€ä»¥å®ƒæ¯”çœŸæ­£çš„<u>**æŒ‡é’ˆ**</u>å®‰å…¨ä¸€äº›ï¼Œä½†è¯­ä¹‰ä¸Šç­‰ä»·äº<u>**å¼•ç”¨ä¼ é€’**</u>

### 16ã€[**Swift**](https://developer.apple.com/swift/) æ•°å€¼ç±»å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 16.1ã€æ•´æ•°ç±»å‹ï¼ˆå†…å»ºï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ¥æºï¼š**[Swift](https://developer.apple.com/swift/) æ ‡å‡†åº“ (Swift Standard Library)** 

* æœ‰ç¬¦å·æ•´æ•° (signed)
  * `Int`ï¼šé»˜è®¤æ•´æ•°ç±»å‹ï¼ˆå’Œå¹³å°ä½å®½ä¸€è‡´ï¼Œ32 ä½ç³»ç»Ÿä¸Šå°±æ˜¯ 32 ä½ï¼Œ64 ä½ç³»ç»Ÿä¸Šå°±æ˜¯ 64 ä½ï¼‰
  * `Int8`ï¼š8 ä½ï¼ŒèŒƒå›´ -128 ~ 127
  * `Int16`ï¼š16 ä½ï¼ŒèŒƒå›´ -32,768 ~ 32,767
  * `Int32`ï¼š32 ä½ï¼ŒèŒƒå›´ -2,147,483,648 ~ 2,147,483,647
  * `Int64`ï¼š64 ä½ï¼ŒèŒƒå›´ -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807
* æ— ç¬¦å·æ•´æ•° (unsigned)
  * `UInt`ï¼š**å’Œå¹³å°ä½å®½ä¸€è‡´**
  * `UInt8`ï¼š0 ~ 255
  * `UInt16`ï¼š0 ~ 65,535
  * `UInt32`ï¼š0 ~ 4,294,967,295
  * `UInt64`ï¼š0 ~ 18,446,744,073,709,551,615

#### 16.2ã€æµ®ç‚¹æ•°ç±»å‹ï¼ˆå†…å»ºï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> æ¥æºï¼š[**Swift**](https://developer.apple.com/swift/) **æ ‡å‡†åº“ (Swift Standard Library)** 
>
> [**Swift**](https://developer.apple.com/swift/) éµå¾ª **IEEE 754** æ ‡å‡†

* `Float`ï¼š32 ä½æµ®ç‚¹æ•°ï¼ˆçº¦ 6 ä½åè¿›åˆ¶ç²¾åº¦ï¼‰
* `Double`ï¼š64 ä½æµ®ç‚¹æ•°ï¼ˆçº¦ 15 ä½åè¿›åˆ¶ç²¾åº¦ï¼‰
* `Float16`ï¼š16 ä½åŠç²¾åº¦æµ®ç‚¹æ•°ï¼ˆç²¾åº¦ä½ï¼Œå¸¸ç”¨äºå›¾å½¢/æœºå™¨å­¦ä¹ ä¼˜åŒ–ï¼‰
* `Float80`ï¼š80 ä½æ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆä»…åœ¨æŸäº›å¹³å°å¯ç”¨ï¼Œæ¯”å¦‚ **macOS** çš„ `x86_64`ï¼›**Apple Silicon** ä¸Šå·²ç»æ²¡æœ‰ï¼‰

#### 16.3ã€å…¶ä»–æ•°å€¼ç›¸å…³ç±»å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `Decimal`ï¼ˆæ¥è‡ª **`Foundation`**ï¼‰ï¼šé«˜ç²¾åº¦åè¿›åˆ¶æµ®ç‚¹æ•°ï¼Œå¸¸ç”¨äºé‡‘è/è´§å¸è®¡ç®—ï¼Œé¿å… `Double` çš„ç²¾åº¦è¯¯å·®ã€‚
* `NSNumber`ï¼ˆæ¥è‡ª **`Foundation`**ï¼Œ**Objc** æ¡¥æ¥ï¼‰ï¼šå¯ä»¥åŒ…è£… **Int**ã€**Float**ã€**Double**ã€**Bool** ç­‰ã€‚
* `CGFloat`ï¼ˆæ¥è‡ª **CoreGraphics**ï¼‰ï¼š<font color=red>**åœ¨ 32 ä½å¹³å°æ˜¯ `Float`ï¼Œåœ¨ 64 ä½å¹³å°æ˜¯ `Double`ï¼Œå¸¸ç”¨äº UI æ¡†æ¶ã€‚**</font>

#### 16.4ã€ç‰¹æ®Šç±»å‹ / æ ‡è®° <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `Bool`ï¼šä¸¥æ ¼æ¥è¯´ä¸æ˜¯æ•°å€¼ç±»å‹ï¼Œä½†åªæœ‰ `true` / `false`ï¼Œåº•å±‚å­˜å‚¨ä¸º 1 bit/1 byteã€‚
* `Character`ã€`UnicodeScalar` è™½ç„¶èƒ½è½¬æˆæ•°å€¼ï¼ˆ`asciiValue` / `value`ï¼‰ï¼Œä½†ä¸ç®—æ•°å€¼ç±»å‹ã€‚
* `SIMD` å‘é‡ç±»å‹ï¼ˆ`SIMD2<Float>`ã€`SIMD4<Double>` ç­‰ï¼‰ï¼šApple é’ˆå¯¹å¹¶è¡Œè®¡ç®—/Metal æä¾›çš„æ•°å€¼å‘é‡ã€‚

### 17ã€<font id=swiftå…³é”®å­—ç”¨ä½œå˜é‡å>[**Swift**](https://developer.apple.com/swift/)å…³é”®å­—ç”¨ä½œå˜é‡å</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å°†[**Swift**](https://developer.apple.com/swift/)å…³é”®å­—ç”¨åå¼•å·åŒ…èµ·æ¥

```swift
let `class` = "Jobs"
print(`class`)   // è¾“å‡º "Jobs"
```

### 18ã€[**Swift**](https://developer.apple.com/swift/)æ–¹æ³•çš„é‡è½½ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> åœ¨ [**Swift**](https://developer.apple.com/swift/) é‡Œï¼Œåªè¦ **æ–¹æ³•ç­¾åï¼ˆæ–¹æ³•å + å‚æ•°æ ‡ç­¾ + å‚æ•°ç±»å‹ï¼‰ä¸åŒ**ï¼Œå°±å¯ä»¥è§†ä¸ºä¸åŒçš„æ–¹æ³•ï¼Œä¸ä¼šå†²çªã€‚

```swift
func resizableImage(edge: UIEdgeInsets = UIEdgeInsets(top: 10.h,
                                                      left: 20.w,
                                                      bottom: 10.h,
                                                      right: 20.w)) -> UIImage {
    return self.resizableImage(
        withCapInsets: edge,
        resizingMode: .stretch
    )
}
```

### 19ã€[**Swift**](https://developer.apple.com/swift/).<font color=red>**extension**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **èƒ½åšçš„äº‹**ï¼š
>
> * æ·»åŠ  **è®¡ç®—å±æ€§**ï¼ˆä¸èƒ½åŠ å­˜å‚¨å±æ€§ï¼‰
> * æ·»åŠ  **æ–¹æ³•**ï¼ˆå®ä¾‹æ–¹æ³•ã€é™æ€æ–¹æ³•ï¼‰
> * æ·»åŠ  **ä¸‹æ ‡**
> * æ·»åŠ  **åµŒå¥—ç±»å‹**
> * æ·»åŠ  **åè®®é€‚é…**
>
> **èƒ½åšçš„äº‹**ï¼š
>
> * ä¸èƒ½åŠ å­˜å‚¨å±æ€§
> * ä¸èƒ½ <font color=red>**@override**</font>

#### 19.1ã€[**Swift**](https://developer.apple.com/swift/).<font color=red>**extension**</font>çš„åŸºæœ¬ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> [**Swift**](https://developer.apple.com/swift/) é‡Œé¢ <font color=red>**extension**</font> å¯ä»¥åŠ åœ¨ä»»ä½•ç±»å‹ä¸Šï¼Œä¸å±€é™äºç±»ï¼ˆ<font color=red>**class**</font>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ <font color=red>**struct**</font>ã€<font color=red>**enum**</font>ã€ç”šè‡³ <font color=red>**protocol**</font>

* **class**

  ```swift
  class Dog {
      var name: String
      init(name: String) { self.name = name }
  }
  
  extension Dog {
      func bark() { print("\(name) is barking!") }
  }
  
  let d = Dog(name: "Buddy")
  d.bark()  // Buddy is barking!
  ```

* **struct**

  ```swift
  struct Point {
      var x: Double
      var y: Double
  }
  
  extension Point {
      var distance: Double {
          sqrt(x * x + y * y)
      }
  }
  
  let p = Point(x: 3, y: 4)
  print(p.distance)  // 5.0
  
  ```

* **enum**

  ```swift
  enum Direction {
      case north, south, east, west
  }
  
  extension Direction {
      var description: String {
          switch self {
          case .north: return "â¬†ï¸"
          case .south: return "â¬‡ï¸"
          case .east:  return "â¡ï¸"
          case .west:  return "â¬…ï¸"
          }
      }
  }
  
  print(Direction.north.description)  // â¬†ï¸
  ```

* **protocol**

  ```swift
  protocol Flyable {
      func fly()
  }
  
  // æä¾›é»˜è®¤å®ç°ï¼ˆä¼ªç»§æ‰¿ï¼‰
  extension Flyable {
      func fly() {
          print("Default flying...")
      }
  }
  
  struct Bird: Flyable {}
  Bird().fly()  // Default flying...
  ```

#### 19.2ã€[**Swift**](https://developer.apple.com/swift/).<font color=red>**extension**</font>çš„é™åˆ¶ä½¿ç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ```swift
> extension <ç±»å‹> where <æ¡ä»¶> {
>     // åªæœ‰æ»¡è¶³æ¡ä»¶æ—¶æ‰ç”Ÿæ•ˆçš„æ–¹æ³• / å±æ€§
> }
> ```

* æ‰©å±•åªå¯¹ `String?` ç”Ÿæ•ˆï¼Œ`Int?` å°±ä¸èƒ½ç”¨

  ```swift
  extension Optional where Wrapped == String {
      var isEmptyOrNil: Bool {
          return self?.isEmpty ?? true
      }
  }
  
  let a: String? = nil
  print(a.isEmptyOrNil)  // true
  
  let b: String? = ""
  print(b.isEmptyOrNil)  // true
  ```

### 20ã€è¿”å›ç±»å¯¹è±¡ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Objc**å†™æ³•

  ```objective-c
  UITableViewCell.class
  ```

* [**Swift**](https://developer.apple.com/swift/)å†™æ³•

  ```swift
  UITableViewCell.self
  ```

### 21ã€[**Swift**](https://developer.apple.com/swift/).**Actor**ï¼ˆé«˜é˜¶ç”¨æ³•ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ğŸ‘‰ `class` æ˜¯å¤šçº¿ç¨‹ã€Œå…±äº«å†…å­˜ï¼Œè‡ªå·±å°å¿ƒåŠ é”ã€
>  ğŸ‘‰ `actor` æ˜¯ã€Œé»˜è®¤ä¸å…±äº«å†…å­˜ï¼Œ[**Swift**](https://developer.apple.com/swift/)  ç¼–è¯‘å™¨å¸®ä½ ä¿è¯ä¸ä¼šåŒæ—¶è®¿é—®ã€

* **Actor** æ˜¯ä»€ä¹ˆï¼Ÿ

  * **Actor = ä¸€ç§å¼•ç”¨ç±»å‹ï¼ˆåƒ class ä¸€æ ·ï¼‰ï¼Œä½†é»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚**ï¼ˆ[**Swift**](https://developer.apple.com/swift/) 5.5 å¼•å…¥ï¼‰

  * å®ƒå’Œ `class` ä¸€æ ·æ˜¯**å¼•ç”¨ç±»å‹**ï¼Œæœ‰ `init`ï¼Œå¯ä»¥ç»§æ‰¿åè®®ï¼Œç”šè‡³ä¹Ÿèƒ½ç»§æ‰¿ `NSObject`

  * **å†…éƒ¨çŠ¶æ€éš”ç¦»**

    - `actor` çš„å­˜å‚¨å±æ€§ä¸èƒ½è¢«å¤–éƒ¨ç›´æ¥å¹¶å‘è®¿é—®ï¼Œè®¿é—®æ—¶å¿…é¡»é€šè¿‡ `await`ã€‚
    - ç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ä½ å†™ `await`ï¼Œé˜²æ­¢è¯¯ç”¨ã€‚

  * **ééš”ç¦»æ–¹æ³• (`nonisolated`)**

    > å¦‚æœæ–¹æ³•å†…éƒ¨æ²¡æœ‰è®¿é—®å—ä¿æŠ¤çš„çŠ¶æ€ï¼Œå¯ä»¥æ ‡è®°ä¸º `nonisolated`ï¼Œè¿™æ ·å¤–éƒ¨è°ƒç”¨æ—¶å°±ä¸éœ€è¦ `await`ï¼š

    ```swift
    actor Logger {
        nonisolated func version() -> String {
            "1.0"
        }
    }
    print(Logger().version())  // ä¸éœ€è¦ await
    ```

  * ä½†å®ƒçš„å…³é”®ç‰¹æ€§æ˜¯ï¼š
    - **å†…éƒ¨çŠ¶æ€æ˜¯å—ä¿æŠ¤çš„**ï¼Œåªèƒ½åœ¨åŒä¸€ä¸ªã€Œæ‰§è¡Œä¸Šä¸‹æ–‡ã€é‡Œè®¿é—®ï¼Œé¿å…å¤šçº¿ç¨‹æ•°æ®ç«äº‰
    - **é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ¥éš”ç¦»å¹¶å‘è®¿é—®**
    
  * <font color=red>**`@MainActor`**</font>

    > ç‰¹æ®Šçš„ actorï¼Œä¿è¯ä»£ç åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ

    ```swift
    @MainActor
    class ViewModel {
        func updateUI() {
            // ä¸€å®šåœ¨ä¸»çº¿ç¨‹
        }
    }
    ```

* [**å’Œç±»çš„åŒºåˆ«**](#ActorğŸ†šClas)

* ä½¿ç”¨åœºæ™¯

  * **å¦‚æœä½ å†™çš„ App é€»è¾‘éƒ½åœ¨ä¸»çº¿ç¨‹ï¼ˆæ¯”å¦‚å¸¸è§„ UI é€»è¾‘ï¼‰ï¼Œå¯èƒ½ä¸€è¾ˆå­ç”¨ä¸åˆ° `actor`**
  * ä½†å¦‚æœä½ å†™ **ç½‘ç»œè¯·æ±‚å±‚ã€æ•°æ®åº“å±‚ã€åå°ä»»åŠ¡ã€å¹¶å‘ç®—æ³•**ï¼Œ`actor` å°±èƒ½æ›¿ä»£é”å’Œé˜Ÿåˆ—ï¼Œå¤§å¹…é™ä½çº¿ç¨‹å®‰å…¨çš„å¤æ‚åº¦
  * éœ€è¦ä¿è¯ **çº¿ç¨‹å®‰å…¨** çš„å…¨å±€å…±äº«å¯¹è±¡ï¼ˆè®¡æ•°å™¨ã€ç¼“å­˜ã€æ•°æ®åº“ sessionï¼‰
  * æ›¿ä»£æ‰‹åŠ¨åŠ é”çš„åœºæ™¯
  * **iOS.SwiftUI**é‡Œå¸¸ç”¨æ¥ä¿è¯ UI æ›´æ–°ä¸€å®šåœ¨ä¸»çº¿ç¨‹
  
* åŸºæœ¬ç”¨æ³•

  ```swift
  actor Counter {
      private var value = 0
      
      func increment() {
          value += 1
      }
      
      func getValue() -> Int {
          value
      }
  }
  ```

  ```swift
  let counter = Counter()
  
  // actor çš„æ–¹æ³•é»˜è®¤æ˜¯éš”ç¦»çš„ï¼Œè¦ç”¨ await
  Task {
      await counter.increment()
      let v = await counter.getValue()
      print(v)
  }
  ```

### 22ã€<font color=red>**@available**</font> çš„ä½¿ç”¨ç¤ºä¾‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 22.1ã€åŸºæœ¬è¯­æ³• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
@available(å¹³å°åç§° ç‰ˆæœ¬å·, introduced: å¼•å…¥ç‰ˆæœ¬, deprecated: å¼ƒç”¨ç‰ˆæœ¬, obsoleted: åºŸå¼ƒç‰ˆæœ¬, message: "æç¤ºä¿¡æ¯")
```

| å¹³å°åç§° | è¯´æ˜           |
| -------- | -------------- |
| iOS      | é€‚ç”¨äº iOS     |
| macOS    | é€‚ç”¨äº macOS   |
| tvOS     | é€‚ç”¨äº tvOS    |
| watchOS  | é€‚ç”¨äº watchOS |
| *        | é€‚ç”¨äºæ‰€æœ‰å¹³å° |

#### 22.2ã€å¸¸è§å†™æ³•ç¤ºä¾‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æŒ‡å®šå¯ç”¨å¹³å°å’Œç‰ˆæœ¬

  ```swift
  @available(iOS 15.0, *)
  func useModernAPI() {
      print("ä»…åœ¨ iOS 15.0+ å¯ç”¨")
  }
  ```

* å¤šå¹³å°ç‰ˆæœ¬åˆ†åˆ«å£°æ˜

  ```swift
  @available(iOS 15.0, macOS 12.0, *)
  func crossPlatformFeature() {
      print("å¤šå¹³å°ç‰ˆæœ¬è¦æ±‚")
  }
  ```

* å¼ƒç”¨ï¼ˆ**`Deprecated`**ï¼‰å’ŒåºŸå¼ƒï¼ˆ**`Obsoleted`**ï¼‰

  * ç¼–è¯‘å™¨ä¼šè­¦å‘Šï¼šâ€œå·²å¼ƒç”¨ï¼Œè¯·æ”¹ç”¨ newAPI()â€ã€‚

    ```swift
    @available(iOS, deprecated: 16.0, message: "è¯·æ”¹ç”¨ newAPI()")
    func oldAPI() {
        print("æ—§æ–¹æ³•")
    }
    ```

  * `obsoleted` ä¼šå¯¼è‡´ **ç¼–è¯‘é”™è¯¯**ï¼ˆæ— æ³•å†ä½¿ç”¨ï¼‰ã€‚

    ```swift
    @available(iOS, obsoleted: 18.0, message: "æ­¤æ–¹æ³•åœ¨ iOS 18 åä¸å¯ç”¨")
    func removedAPI() {}
    ```

* åŒæ—¶æŒ‡å®š **`introduced`** / **`deprecated`** / **`obsoleted`**
  ```swift
  @available(iOS, introduced: 13.0, deprecated: 17.0, obsoleted: 18.0, message: "è¯·è¿ç§»åˆ°æ–°ç‰ˆæœ¬æ¥å£")
  func lifecycleAPI() {
      print("ç”Ÿå‘½å‘¨æœŸç®¡ç†API")
  }
  ```

* ä»…æ ‡è®°å¼ƒç”¨ä¿¡æ¯

  ```swift
  @available(*, deprecated, message: "ä¸å†æ¨èä½¿ç”¨")
  func legacyFunc() {}
  ```

* é™å®šæŸå¹³å°ä¸å¯ç”¨

  ```swift
  /// åœ¨ macOS ç¯å¢ƒä¸‹ç¼–è¯‘ä¼šç›´æ¥æŠ¥é”™ã€‚
  @available(macOS, unavailable)
  func iOSOnlyFeature() {
      print("æ­¤åŠŸèƒ½ä»…æ”¯æŒ iOSï¼Œä¸æ”¯æŒ macOS")
  }
  ```

* ç»“åˆ <font color=red>#available</font> åŠ¨æ€åˆ¤æ–­

  ```swift
  if #available(iOS 17.0, *) {
      useModernAPI()
  } else {
      useLegacyAPI()
  }
  ```

* æ ‡è®°ç±»æˆ–ç»“æ„ä½“

  ```swift
  @available(iOS 16.0, *)
  class ModernViewController: UIViewController {
      // ...
  }
  ```

### 23ã€åµŒå¥—å®šä¹‰ **<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>**

#### 23.1ã€åµŒå¥— <font color=red>class</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class Outer {
    class Inner {
        func say() {
            print("ğŸ‘‹ Inner class")
        }
    }
}

// ä½¿ç”¨ï¼š
let inner = Outer.Inner()
inner.say()
```

#### 23.2ã€åµŒå¥— <font color=red>struct</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
struct Container {
    struct Item {
        let name: String
    }
}

// ä½¿ç”¨ï¼š
let i = Container.Item(name: "ğŸ Apple")
print(i.name)
```

#### 23.3ã€åµŒå¥— <font color=red>enum</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class DownloadManager {
    enum Status {
        case idle
        case downloading
        case finished
    }
}

// ä½¿ç”¨ï¼š
let s: DownloadManager.Status = .downloading
print("çŠ¶æ€ï¼š\(s)")
```

#### 23.4ã€åµŒå¥— <font color=red>protocol</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class Player {
    protocol Delegate {
        func didScore(points: Int)
    }
}
```

> ```swift
> class Coach: Player.Delegate {
>      func didScore(points: Int) {
>          print("ğŸ‘ Scored \(points)")
>      }
> }
> ```

#### 23.5ã€åµŒå¥— <font color=red>actor</font>ï¼ˆ[**Swift**](https://developer.apple.com/swift/) 5.5+ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
class DataCenter {
    actor Storage {
        private var data: [String: String] = [:]

        func save(key: String, value: String) {
            data[key] = value
        }
    }
}

// ä½¿ç”¨ï¼š
let s = DataCenter.Storage()
Task {
    await s.save(key: "name", value: "Jobs")
}
```

#### 23.6ã€åµŒå¥— <font color=red>func</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func outer() {
    func inner(_ text: String) {
        print("ğŸ’¬", text)
    }

    inner("Hello from inner function")
}

outer()
```

#### 23.7ã€ğŸš«ä¸æ”¯æŒåµŒå¥—çš„ï¼ˆä»…å¤‡æ³¨ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func badExample() {
    // âŒ ä»¥ä¸‹ä¼šæŠ¥é”™ï¼š
    // class Inner {}     // âŒ ä¸èƒ½å®šä¹‰ç±»
    // struct S {}        // âŒ ä¸èƒ½å®šä¹‰ç»“æ„ä½“
    // enum E {}          // âŒ ä¸èƒ½å®šä¹‰æšä¸¾
}
```

### 24ã€<font color=red>typealias</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  func example() {
      typealias IntHandler = (Int) -> Void
  
      func run(handler: IntHandler) {
          handler(42)
      }
  
      run { print("ğŸ¯ \($0)") }
  }
  
  example()
  ```

* ```swift
  struct Network {
      typealias Completion = (Bool) -> Void
  
      func request(done: Completion) {
          done(true)
      }
  }
  
  // ä½¿ç”¨ï¼š
  Network().request { success in
      print("âœ… æˆåŠŸ: \(success)")
  }
  ```

### 25ã€ç¼–è¯‘å™¨ï¼ˆæ–¹æ³•è¿‡æœŸï¼‰è­¦å‘ŠæŠ‘åˆ¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
@available(iOS, introduced: 2.0, obsoleted: 13.0)
@available(*, deprecated, message: "Use UIWindowScene.keyWindow instead on iOS 13+")
public func legacyKeyWindowPreiOS13() -> UIWindow? {
    return UIApplication.shared.keyWindow ?? UIApplication.shared.windows.first
}
```

### 26ã€æŒ‰é’®çš„é…ç½®é¡¹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* åœ¨**Objc**é‡Œé¢ï¼ŒæŒ‰é’®çš„é…ç½®é¡¹`UIButtonConfiguration`æ˜¯ä¸“é—¨ä»¥ç±»çš„å½¢å¼å‡ºç°çš„

  > ```objective-c
  > UIKIT_EXTERN API_AVAILABLE(ios(15.0), tvos(15.0)) API_UNAVAILABLE(watchos) NS_SWIFT_UI_ACTOR
  > @interface UIButtonConfiguration : NSObject <NSCopying, NSSecureCoding>
  > /// TODO
  > @end
  > ```

* è€Œåœ¨[**Swift**](https://developer.apple.com/swift/)é‡Œé¢ï¼ŒæŒ‰é’®çš„é…ç½®é¡¹`UIButton.Configuration`æ˜¯ä»¥ç±»çš„å†…éƒ¨ç»“æ„ä½“çš„å½¢å¼å‡ºç°çš„

  > ```swift
  > @available(iOS 15.0, tvOS 15.0, *)
  > @available(watchOS, unavailable)
  > extension UIButton {
  >     public struct Configuration : Hashable {/*TODO*/}
  > }
  > ```

  ```swift
  UIButton(type: .system).byConfiguration { c in
      c = UIButton.Configuration.filled()
          .byTitle(title)
          .byImage(image)
          .byImagePadding(8)
          .byBaseForeground(.white)
          .byBaseBackground(.systemBlue)
          .byTitleAlignment(.center)
          .byContentInsets(.init(top: 8, leading: 12, bottom: 8, trailing: 12))
  }
  ```

### 27ã€iOSæ¨¡æ‹Ÿå™¨å‰”é™¤ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
#if targetEnvironment(simulator)
/// TODO
#else
/// TODO
#endif
```

### 28ã€<font color=red>**guard**Â ğŸ†š **if**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ `guard` åé¢éœ€è¦çš„æ˜¯**å¸ƒå°”æ¡ä»¶**æˆ–**å¯é€‰ç»‘å®š**ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼›
>
> 2ï¸âƒ£ `guard ... else { ... }` çš„ `else` åˆ†æ”¯é‡Œ**å¿…é¡»æå‰é€€å‡ºå½“å‰ä½œç”¨åŸŸ**ï¼ˆ`return/throw/continue/break`ï¼‰ï¼Œä¸èƒ½åœ¨é‡Œå¤´â€œèµ‹ä¸ªé»˜è®¤å€¼ç„¶åç»§ç»­â€ã€‚

#### 28.1ã€å‚å…¥æ ¡éªŒ + æ—©é€€å‡º <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func pay(_ amount: Decimal?) {
    guard let amount, amount > 0 else {
        showToast("é‡‘é¢éæ³•")
        return
    }
    doPay(amount)
}
```

```objective-c
- (void)pay:(NSDecimalNumber *)amount {
    if (!amount || [amount compare:@0] != NSOrderedDescending) {
        [self showToast:@"é‡‘é¢éæ³•"];
        return;
    }
    [self doPay:amount];
}
```

#### 28.2ã€Optional ç»‘å®š ğŸ†š åˆ¤ç©ºå–å€¼ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
guard let user = user else { return }
print(user.name)
```

```objective-c
if (!user) return;
NSLog(@"%@", user.name);
```

#### 28.3ã€å¤šæ¡ä»¶æ‹å¹³ï¼ˆå‡å°‘åµŒå¥—ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func submit(token: String?, payload: Data?) {
    guard let token, !token.isEmpty else { return }
    guard let payload, !payload.isEmpty else { return }
    send(token: token, payload: payload)
}
```

```objective-c
- (void)submitWithToken:(NSString *)token payload:(NSData *)payload {
    if (!token.length) return;
    if (!payload.length) return;
    [self sendWithToken:token payload:payload];
}
```

#### 28.4ã€å¾ªç¯ä¸­è¿‡æ»¤ï¼ˆcontinue/breakï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
for item in items {
    guard item.isValid else { continue }
    process(item)
}
```

```objective-c
for (Item *item in items) {
    if (!item.isValid) { continue; }
    [self process:item];
}
```

#### 28.5ã€æœ‰åˆ™ç”¨ä¼ å…¥ã€æ— åˆ™é»˜è®¤ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
let request = withdraw ?? JXWalletWithdrawRequest()
```

```objective-c
JXWalletWithdrawRequest *request = withdraw ?: [JXWalletWithdrawRequest new]; // GNU æ‰©å±•
// æˆ–æ ‡å‡†ä¸‰ç›®ï¼šwithdraw ? withdraw : [JXWalletWithdrawRequest new];
```

#### 28.6ã€æŠ›é”™/å¤±è´¥å³é€€å‡º <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func load(path: String?) throws -> Data {
    guard let path, !path.isEmpty else { throw LoadError.missingPath }
    return try Data(contentsOf: URL(fileURLWithPath: path))
}
```

```objective-c
- (NSData *)load:(NSString *)path error:(NSError **)error {
    if (!path.length) {
        if (error) *error = [NSError errorWithDomain:@"Load" code:1 userInfo:nil];
        return nil;
    }
    return [NSData dataWithContentsOfFile:path];
}
```

#### 28.7ã€ åˆå§‹åŒ–æµç¨‹ä¸­çš„â€œå®ˆå«â€ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
init?(config: Config?) {
    guard let c = config, c.isValid else { return nil }
    self.config = c
}
```

```objective-c
- (instancetype)initWithConfig:(Config *)config {
    if (self = [super init]) {
        if (!config || !config.isValid) return nil;
        _config = config;
    }
    return self;
}
```

#### 28.8ã€æ¸…ç†/æ”¶å°¾ï¼ˆ<font color=red>**`defer`**</font> å¯¹æ¯”ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
func work() {
    open()
    defer { close() }              // æ— è®ºä¸­é—´ guard æå‰ return ä¸å¦éƒ½ä¼šæ‰§è¡Œ
    guard ready else { return }
    run()
}
```

```objective-c
- (void)work {
    [self open];
    @try {
        if (!self.ready) return;
        [self run];
    }
    @finally {
        [self close];
    }
}
```

### 29ã€<font color=red>**`as`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 29.1ã€<font color=red>**`as`**</font> ğŸ‘‰ ç¼–è¯‘æœŸ**ä¸Šè½¬å‹/æ¡¥æ¥/å­—é¢é‡å®šå‹** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **ä¸Šè½¬å‹**ï¼ˆå­ â†’ çˆ¶/åè®®ï¼‰ï¼šæ€»æ˜¯å®‰å…¨ã€æ— éœ€è¿è¡Œæ—¶æ£€æŸ¥ã€‚

  ```swift
  let btn: UIButton = UIButton()
  let view: UIView = btn as UIView        // å­ç±»åˆ°çˆ¶ç±»
  let p: UIAppearance = btn as UIAppearance // éµå¾ªçš„åè®®
  ```

* **æ¡¥æ¥åˆ° ObjC/Foundation ç±»å‹**ï¼š

  ```swift
  let s: String = "hi"
  let ns: NSString = s as NSString        // Swift â†”ï¸ ObjC æ¡¥æ¥
  ```

* **æŠŠå­—é¢é‡/æ³›å‹å€¼å®šå‹**ï¼š

  ```swift
  let x = 1 as Double                     // æŒ‡å®šå­—é¢é‡ç±»å‹
  let any: Any = btn as Any
  ```

#### 29.2ã€<font color=red>**`as?`**</font> ğŸ‘‰ **å¯é€‰å‘ä¸‹è½¬å‹**ï¼Œå¤±è´¥è¿”å› `nil` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
let v: UIView = UIButton()
let b1 = v as? UIButton                 // Optional<UIButton>
let b2 = v as? UILabel                  // nil
if let button = b1 { button.setTitle("OK", for: .normal) }
```

#### 29.3ã€<font color=red>**`as!`**</font> ğŸ‘‰ **å¼ºåˆ¶å‘ä¸‹è½¬å‹**ï¼Œå¤±è´¥å´©æºƒ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> åªæœ‰åœ¨ä½ **ç™¾åˆ†ç™¾**ç¡®å®šç±»å‹æ—¶æ‰ç”¨ï¼›å¦åˆ™ç”¨ <font color=red>**`as?`**</font>ï¼š

```swift
let v: UIView = UIButton()
let b = v as! UIButton                  // è‹¥ä¸æ˜¯ UIButton ä¼šå´©æºƒ
```

### 30ã€<font color=red>**`defer`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> <font color=red>**`defer`**</font> ä¸æ˜¯å¿…é¡»å†™åœ¨ `try` é‡Œï¼Œå®ƒæ”¾åœ¨â€œå½“å‰ä½œç”¨åŸŸâ€é‡Œçš„ä»»ä½•ä½ç½®ï¼Œéƒ½ä¼šåœ¨**ç¦»å¼€è¿™ä¸ªä½œç”¨åŸŸæ—¶**å¿…å®šæ‰§è¡Œï¼ˆé™¤éè¿›ç¨‹è¢«æ€/`fatalError` ä¹‹ç±»ï¼‰

* **è§¦å‘æ—¶æœº**ï¼šç¦»å¼€â€œå½“å‰ä½œç”¨åŸŸâ€ï¼ˆå‡½æ•°/`init`/`deinit`/`do` å—/å¾ªç¯ä½“ï¼‰æ—¶æ‰§è¡Œã€‚

* **æ— è®ºè·¯å¾„**ï¼šæ­£å¸¸èµ°åˆ°ç»“å°¾ã€`return`ã€`throw`ã€`break/continue` éƒ½ä¼šæ‰§è¡Œã€‚

* **æ‰§è¡Œé¡ºåº**ï¼š**åæ³¨å†Œå…ˆæ‰§è¡Œ**ï¼ˆLIFOï¼‰

  * <font color=red>**`defer`**</font> ç»‘å®šçš„æ˜¯å®ƒæ‰€åœ¨çš„æœ€å†…å±‚ä½œç”¨åŸŸï¼š

    ```swift
    /// è¾“å‡ºé¡ºåºï¼šB â†’ Aï¼ˆåæ³¨å†Œå…ˆæ‰§è¡Œ + å†…å±‚å…ˆé€€å‡ºï¼‰
    func f() {
        defer { print("A") }       // é€€å‡º f æ—¶æ‰§è¡Œ
    
        do {
            defer { print("B") }   // é€€å‡º do å—æ—¶æ‰§è¡Œï¼ˆæ—©äº Aï¼‰
            if cond { return }     // return å‰ä¼šå…ˆæ‰“å° Bï¼Œå†æ‰“å° A
        }
    }
    ```

    ```swift
    /// defer å¯ä»¥æ”¾åœ¨ async å‡½æ•°é‡Œï¼›å¯ä»¥è°ƒç”¨ await çš„æ”¶å°¾æ–¹æ³•ï¼ˆåªè¦æ‰€åœ¨å‡½æ•°æ˜¯ asyncï¼‰ã€‚
    /// å¸¸è§æ¨¡å¼ï¼šä»»åŠ¡å–æ¶ˆã€å¥æŸ„å…³é—­ã€HUD æ”¶èµ·ã€‚
    /// æ³¨æ„ï¼šdefer æœ¬èº«ä¸èƒ½ async/throwsï¼Œä½†å¯ä»¥åœ¨é‡Œé¢å†™ try? æˆ–è°ƒç”¨è¿”å› Void/Never çš„ APIã€‚
    func work() async {
        let t = Task { await poll() }
        defer { t.cancel() }            // ç¦»å¼€ä½œç”¨åŸŸä¸€å®šå–æ¶ˆå­ä»»åŠ¡
        await use()
    }
    ```

  * æ•è·æ—¶æœº & å¿«ç…§

    ```swift
    /// defer é‡Œè¯»å–å¤–éƒ¨å˜é‡æ˜¯æ‰§è¡Œæ—¶å–å€¼ï¼Œä¸æ˜¯æ³¨å†Œæ—¶ã€‚
    /// éœ€è¦â€œå¿«ç…§â€å°±å…ˆ let ä¸€ä¸‹ï¼š
    var path = "/a"
    let snapshot = path
    defer { print(snapshot) }   // æ‰“å° /aï¼ˆå¿«ç…§ï¼‰
    path = "/b"
    defer { print(path) }       // æ‰“å° /bï¼ˆæ‰§è¡Œæ—¶å€¼ï¼‰
    ```

* <font color=red>**æ³¨æ„äº‹é¡¹**</font>ï¼š

  * <font color=red>**`defer`**</font> æœ¬èº«ä¸èƒ½ `async`/`throws`ï¼Œä½†å¯ä»¥åœ¨é‡Œé¢å†™ `try?` æˆ–è°ƒç”¨è¿”å› `Void`/`Never` çš„ API

  * ä¸è¦æŠŠé‡æ´»æ”¾<font color=red>**`defer`**</font>é‡Œ(å°¾å»¶è¿Ÿ)

  * **çœŸæ­£ä¸ä¼šæ‰§è¡Œ**ï¼šç¨‹åºè¢«æ€ã€`fatalError()`/`preconditionFailure()`/`abort()` è¿™ç±»**ä¸ä¼šè¿”å›**çš„ç»ˆæ­¢ï¼Œ**ä¸ä¼š**å›åˆ°æ ˆæ¸…ç†é˜¶æ®µï¼Œ<font color=red>**`defer`**</font> æ— æ³•æ‰§è¡Œã€‚

    ```swift
    func crash() {
        defer { print("âŒ ä¸ä¼šçœ‹åˆ°è¿™è¡Œ") }
        fatalError("boom")
    }
    ```

  * é—­åŒ…é‡Œä¸ä¼šè‡ªåŠ¨è§¦å‘å¤–å±‚çš„ <font color=red>**`defer`**</font>

    > é€ƒé€¸é—­åŒ…çš„**ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹**äºå¤–å±‚å‡½æ•°ï¼Œ**ä¸ä¼š**è§¦å‘å¤–å±‚çš„ <font color=red>**`defer`**</font>

    * ```swift
      /// é”™è¯¯åšæ³•
      func fetch() {
          let conn = Connection()
          defer { conn.close() }            // å°†åœ¨ fetch() ç»“æŸæ—¶æ‰§è¡Œ
      
          URLSession.shared.dataTask(with: url) { _,_,_ in
              // â›”ï¸ è¿™ä¸ªé—­åŒ…å¯èƒ½åœ¨ fetch() è¿”å›å¾ˆä¹…ä¹‹åæ‰æ‰§è¡Œ
              // å¤–å±‚çš„ defer æ—©å°±è·‘äº†ï¼Œconn æ—©å°± close äº†
              // ä½ ä»¥ä¸º defer ä¼šç­‰è¿™é‡Œï¼Ÿä¸ä¼š
              use(conn)                      // â† å¯èƒ½å·²å…³é—­ï¼Œé£é™©ï¼
          }.resume()
      } // â† é€€å‡ºå‡½æ•°ï¼Œdefer è§¦å‘ï¼Œconn.close() è¢«è°ƒç”¨
      /// æ­£ç¡®åšæ³•ï¼šæŠŠèµ„æºç®¡ç†ç»‘å®šåˆ°é—­åŒ…/å¼‚æ­¥ä»»åŠ¡çš„ä½œç”¨åŸŸé‡Œï¼›
      func fetchBetter() async throws -> Data {
          let conn = Connection()
          defer { conn.close() }            // âœ… ä½œç”¨åŸŸä¸ async å‡½æ•°ç»‘å®š
          return try await conn.request()
      }
      /// æ­£ç¡®åšæ³•ï¼šé—­åŒ…å†…è‡ªå·± deferï¼š
      func fetchWithClosure() {
          URLSession.shared.dataTask(with: url) { _,_,_ in
              let conn = Connection()
              defer { conn.close() }        // âœ… ç»‘å®šåˆ°é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸ
              // ...
          }.resume()
      }
      ```

    * ```swift
      /// é”™è¯¯åšæ³•
      func doWork(_ block: @escaping () -> Void) {
          let lock = NSLock()
          lock.lock()
          defer { lock.unlock() }           // â† åªåœ¨ doWork é€€å‡ºæ—¶è§£é”
      
          DispatchQueue.global().async {
              // â›”ï¸ è¿™é‡Œä¼šåœ¨ doWork è¿”å›åæ‰æ‰§è¡Œ
              // è‹¥æƒ³åœ¨ block æ‰§è¡ŒæœŸé—´æŒæœ‰é”ï¼Œä½ åšä¸åˆ°
              block()
          }
      } // â† æ­¤å¤„å·² unlockï¼Œblock æ‰§è¡Œæ—¶æ²¡æœ‰é”ä¿æŠ¤
      /// æ­£ç¡®åšæ³•ï¼šä¸é€ƒé€¸ï¼ˆ@noescape/é»˜è®¤é—­åŒ…ï¼‰ï¼Œåœ¨å½“å‰ä½œç”¨åŸŸæ‰§è¡Œï¼›
      func doWork(_ block: () -> Void) {           // é»˜è®¤ non-escaping
          lock.lock()
          defer { lock.unlock() }
          block()
      }
      /// æ­£ç¡®åšæ³•ï¼šâœ… æŠŠé”æ”¾åˆ°é—­åŒ…å†…éƒ¨ä½œç”¨åŸŸï¼š
      DispatchQueue.global().async {
          let lock = NSLock()
          lock.lock()
          defer { lock.unlock() }
          block()
      }
      /// æ­£ç¡®åšæ³•ï¼šç”¨ä¸²è¡Œé˜Ÿåˆ—æ›¿ä»£é”ï¼ˆæ›´ç¨³ï¼‰
      final class Worker {
          private let q = DispatchQueue(label: "work.serial")
      
          func doWork(_ block: @escaping () -> Void) {
              q.async { block() }                // åŒä¸€é˜Ÿåˆ—ä¸Šçš„ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œ
          }
      
          // è‹¥è¦â€œæäº¤å¹¶ç­‰å¾…å®Œæˆâ€
          func doWorkSync(_ block: () -> Void) {
              q.sync { block() }                 // åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ° block å®Œæˆ
          }
      }
      /// æ­£ç¡®åšæ³•ï¼šSwift Concurrency çš„ actorï¼ˆä»æ ¹ä¸Šæ¶ˆç­æ•°æ®ç«äº‰ï¼‰
      /// æŠŠå…±äº«çŠ¶æ€æ”¾è¿› actorï¼Œæ‰€æœ‰è®¿é—®éƒ½é€šè¿‡ awaitï¼Œæ— éœ€æ‰‹åŠ¨é”ã€‚
      actor SafeBox {
          private var value = 0
          func mutate(_ f: (inout Int) -> Void) { f(&value) }
          func get() -> Int { value }
      }
      // ç”¨æ³•
      let box = SafeBox()
      await box.mutate { $0 += 1 }
      let v = await box.get()
      /// æ­£ç¡®åšæ³•ï¼šwith é£æ ¼å·¥å…·ï¼Œå¼ºåˆ¶â€œåŒä¸€ä½œç”¨åŸŸæ‰§è¡Œâ€
      @discardableResult
      func withLock<T>(_ lock: NSLock, _ body: () -> T) -> T {
          lock.lock(); defer { lock.unlock() }
          return body()
      }
      
      withLock(lock) {
          // åœ¨é”å†…ï¼Œç¡®ä¿ä½œç”¨åŸŸç»“æŸæ‰é‡Šæ”¾
      }
      ```

  * çƒ­è·¯å¾„é‡Œæ¯æ¬¡éƒ½æ³¨å†Œå¾ˆå¤š <font color=red>**`defer`**</font> â‡’ **å¾®æˆæœ¬å åŠ **

    ```swift
    /// defer æœ¬èº«å¾ˆè½»ï¼Œä½†åœ¨è¶…é«˜é¢‘åœºæ™¯ï¼ˆå°å¾ªç¯ã€å†…å±‚ tight pathï¼‰åå¤è¿›å‡ºä½œç”¨åŸŸï¼Œæ ˆæ“ä½œ/æ•è·å¼€é”€ä¼šç§¯ç´¯ï¼š
    @inline(__always)
    func hot(_ xs: [Int]) -> Int {
        var s = 0
        for x in xs {
            // âŒ æ¯æ¬¡è¿­ä»£éƒ½æ³¨å†Œ 3 ä¸ª deferï¼Œçƒ­åˆ°å‘çƒ«
            defer { _ = 0 }
            defer { _ = 0 }
            defer { _ = 0 }
            s &+= x
        }
        return s
    }
    
    /// æ›¿ä»£ç­–ç•¥ï¼šæŠŠéœ€é…å¯¹çš„é€»è¾‘æ‹‰å‡ºå¾ªç¯ï¼Œæˆ–ç¼©å°ä½œç”¨åŸŸï¼š
    func hotBetter(_ xs: [Int]) -> Int {
        // âœ… ä¸€æ¬¡æ€§èµ„æºï¼Œå¤–å±‚é…å¯¹
        setup()
        defer { teardown() }
    
        var s = 0
        for x in xs {
            // âœ… å¾ªç¯å†…éƒ¨â€œå¯¹ç§°å†™æ³•â€ï¼Œä¸ç”¨ defer
            fastOpen()
            // ... do work ...
            fastClose()
            s &+= x
        }
        return s
    }
    
    /// æ›¿ä»£ç­–ç•¥ï¼šæˆ–ç”¨æ›´ç»†ç²’åº¦ä½œç”¨åŸŸä»£æ›¿å¤šé‡ deferï¼š
    for x in xs {
        do {                  // å°ä½œç”¨åŸŸ + 1 ä¸ª defer
            acquire()
            defer { release() }
            work(x)
        }
    }
    ```


### 31ã€**`UIAlertController`** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `UIAlertController`å†…ç½®è¾“å…¥æ¡†

  ```swift
  @available(iOS 8.0, *)
  @MainActor open class UIAlertController : UIViewController {
      public convenience init(title: String?, message: String?, preferredStyle: UIAlertController.Style)
      open func addAction(_ action: UIAlertAction)
      open var actions: [UIAlertAction] { get }
      @available(iOS 9.0, *)
      open var preferredAction: UIAlertAction?
      open func addTextField(configurationHandler: ((UITextField) -> Void)? = nil) // âœ…
      open var textFields: [UITextField]? { get } // âœ…
      open var title: String?
      open var message: String?
      open var preferredStyle: UIAlertController.Style { get }
      @available(iOS 16.0, *)
      open var severity: UIAlertControllerSeverity
  }
  ```

### 32ã€**`NSProxy`** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**Swift**](https://developer.apple.com/swift/) é‡Œæ²¡æœ‰åŸç”Ÿçš„ `NSProxy`ï¼Œä¹Ÿä¸èƒ½ç”¨çº¯ [**Swift**](https://developer.apple.com/swift/) å»ç»§æ‰¿/å®ç° `NSProxy`

### 33ã€**Foundation**.<font color=red>**`Decimal`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **åè¿›åˆ¶é«˜ç²¾åº¦** çš„æ•°å€¼ç±»å‹ï¼Œç”¨æ¥é¿å… `Double/Float` çš„äºŒè¿›åˆ¶æµ®ç‚¹è¯¯å·®ï¼Œ**éå¸¸é€‚åˆé‡‘é¢/è´¢åŠ¡**ç­‰éœ€è¦ç²¾ç¡®å°æ•°çš„åœºæ™¯ã€‚

#### 33.1ã€ä¸ºå•¥ä¸ç”¨ `Double`ï¼Ÿ<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `Double/Float` æ˜¯äºŒè¿›åˆ¶æµ®ç‚¹ï¼Œåƒ 0.1ã€0.2 åœ¨äºŒè¿›åˆ¶é‡Œæ˜¯æ— é™å°æ•°ï¼Œä¼šæœ‰è¯¯å·®ï¼š

  ```swift
  print(0.1 + 0.2 == 0.3) // false
  ```

* `Decimal` ç”¨åè¿›åˆ¶å­˜å°æ•°ï¼Œ**ä¸æŸç²¾åº¦**ï¼Œèƒ½è¾¾åˆ°é¢„æœŸï¼š

  ```swift
  import Foundation
  
  let a = Decimal(string: "0.1")!
  let b = Decimal(string: "0.2")!
  print(a + b == Decimal(string: "0.3")!) // true
  ```

#### 33.2ã€ä¸ `NSDecimalNumber` çš„å…³ç³» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `NSDecimalNumber` æ˜¯ `Decimal` çš„ `Objc` åŒ…è£…ç±»ï¼ŒåŠŸèƒ½ç›¸è¿‘ï¼›åœ¨éœ€è¦ `NSNumber`/`ObjC` äº’æ“ä½œæ—¶ä¼šç”¨åˆ°ã€‚
* åœ¨çº¯ [**Swift**](https://developer.apple.com/swift/) é‡Œï¼Œä¼˜å…ˆç”¨ `Decimal` + è¿ç®—ç¬¦é‡è½½ï¼Œç®€æ´ã€‚

#### 33.3ã€<font color=red>**å®æˆ˜å»ºè®®**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é‡‘é¢/æ±‡ç‡ã€å‘ç¥¨ç¨ï¼š**ç”¨ `Decimal`**ï¼Œåˆ«ç”¨ `Double`
* ä¸åç«¯äº¤äº’ï¼š**ç”¨å­—ç¬¦ä¸²ä¼ å°æ•°**ï¼ˆå¦‚ `"123.45"`ï¼‰ï¼Œ[**Swift**](https://developer.apple.com/swift/) ç«¯ `Decimal(string:)` è§£æï¼Œé›¶æŸå¤±

### 34ã€[**Swift**](https://developer.apple.com/swift/) éšæœº <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>[**Swift**](https://developer.apple.com/swift/) éšæœºåè®®</font>

  > 1ï¸âƒ£ [**Swift**](https://developer.apple.com/swift/) çš„éšæœºä½“ç³»æ˜¯åŸºäº `RandomNumberGenerator` åè®®
  >
  > 2ï¸âƒ£ [**Swift**](https://developer.apple.com/swift/) æ ‡å‡†åº“é»˜è®¤`SystemRandomNumberGenerator`ã€‚ç³»ç»Ÿçº§ CSPRNGï¼ˆåŠ å¯†å¼ºåº¦è¶³å¤Ÿï¼Œ**å¯¹å¤§å¤šæ•°åœºæ™¯è¶³å¤Ÿå®‰å…¨**ï¼Œä¸€èˆ¬ä¸å¯å¤ç°ï¼‰

  * ```swift
    /// Swift/Misc/SystemRandomNumberGenerator
    @frozen public struct SystemRandomNumberGenerator : RandomNumberGenerator, Sendable {
        @inlinable public init()
        @inlinable public mutating func next() -> UInt64
        @inlinable public mutating func next<T>() -> T where T : FixedWidthInteger, T : UnsignedInteger
        @inlinable public mutating func next<T>(upperBound: T) -> T where T : FixedWidthInteger, T : UnsignedInteger
    }
    ```

  * æ¦‚ç‡éšæœºå¸ƒå°”

    * **è¿”å›å€¼**ï¼š`true` æˆ– `false`ï¼Œæ¦‚ç‡å„ **50%**

      ```swift
      Bool.random()
      ```

    * å¸¦è‡ªå®šä¹‰æ¦‚ç‡çš„éšæœºå¸ƒå°”

      ```swift
      extension Bool {
          static func random(probability p: Double) -> Bool {
              precondition(0...1 ~= p)
              return Double.random(in: 0...1) < p
          }
      }
      
      Bool.random(probability: 0.2)  // çº¦ 20% ä¸º true
      ```

    * æŒ‡å®šéšæœºæº

      ```swift
      var rng = SystemRandomNumberGenerator()
      let v = Bool.random(using: &rng)
      ```

* <font color=red>[**Swift**](https://developer.apple.com/swift/) éšæœºæº</font>

  * C å±‚/ç³»ç»Ÿå‡½æ•°

    * ```c
      arc4random() / arc4random_buf() / arc4random_uniform(_:)
      ```

  * <font id=GameplayKit>**`GameplayKit`**</font>ï¼ˆé€‚åˆæ¸¸æˆ/ä»¿çœŸï¼Œéå®‰å…¨ï¼‰

    * `GKLinearCongruentialRandomSource(seed:)`ï¼ˆè½»é‡ã€å¿«ã€å¯å¤ç°ï¼‰
    * `GKMersenneTwisterRandomSource(seed:)`ï¼ˆè´¨é‡æ›´å¥½ã€å¯å¤ç°ï¼‰
    * `GKARC4RandomSource(seed:)`ï¼ˆå·²ä¸æ¨èåšå®‰å…¨ç”¨é€”ï¼‰

    ```swift
    import GameplayKit
    
    struct GKAdapter: RandomNumberGenerator {
        private let src: GKRandom
        init(_ src: GKRandom) { self.src = src }
        mutating func next() -> UInt64 {
            // ç»„åˆä¸¤ä¸ª 32-bit æ¥å‡‘ 64-bit
            let hi = UInt64(bitPattern: Int64(src.nextInt()))
            let lo = UInt64(bitPattern: Int64(src.nextInt()))
            return (hi << 32) ^ lo
        }
    }
    
    // ç”¨æ³•
    var gk = GKAdapter(GKMersenneTwisterRandomSource(seed: 12345))
    let v = Int.random(in: 0..<1000, using: &gk)
    ```

  * **`CryptoKit`**

    * å¦‚æœæ˜¯**ä¸¥æ ¼çš„å¯†ç å­¦ç”¨é€”**ï¼Œä¼˜å…ˆç”¨ **`CryptoKit`**
    * å¦‚æœæ˜¯**ä¸¥æ ¼çš„å¯†ç å­¦ç”¨é€”**ï¼Œä¼˜å…ˆç”¨ **`CryptoKit`**
    * ä½† **`CryptoKit`** æœ¬èº«ä¸æ˜¯é€šç”¨ RNG

  * `Security` æ¡†æ¶ï¼ˆåº•å±‚ CSPRNGï¼‰ï¼š`SecRandomCopyBytes`ç³»ç»Ÿ CSPRNGï¼Œæ‹¿åŸå§‹å­—èŠ‚

    ```swift
    import Security
    // MARK: - å®‰å…¨éšæœºå­—èŠ‚ï¼ˆå¯†ç å­¦/å¯†é’¥ææ–™ï¼‰
    /// æ¯æ¬¡è°ƒç”¨éƒ½å‘ç³»ç»Ÿçš„ CSPRNGï¼ˆåŠ å¯†å®‰å…¨éšæœºæ•°å‘ç”Ÿå™¨ï¼‰è¦ 8 ä¸ªå­—èŠ‚ï¼Œæ‹¼æˆä¸€ä¸ª UInt64 è¿”å›
    /// è¿™æ¯”ä¼ªéšæœºï¼ˆLCGã€æ¢…æ£®æ—‹è½¬ï¼‰æ›´éš¾é¢„æµ‹ï¼Œé€‚åˆå¯†é’¥ã€nonceã€tokenã€ç›ç­‰å®‰å…¨åœºæ™¯
    struct SecureRNG: RandomNumberGenerator {
        mutating func next() -> UInt64 {
            var x: UInt64 = 0
            let ok = withUnsafeMutableBytes(of: &x) {
                SecRandomCopyBytes(kSecRandomDefault, $0.count, $0.baseAddress!)
            } == errSecSuccess
            precondition(ok, "SecRandomCopyBytes failed")
            return x
        }
    }
    // MARK: - ç”¨æ³•
    var sec = SecureRNG()
    /// ç”¨è¿™ä¸ªå®‰å…¨ RNG ç”Ÿæˆä¸€ä¸ª 64 ä½çš„éšæœºæ•´æ•° tokenã€‚èŒƒå›´æ˜¯æ•´ä¸ª UInt64 å¯è¡¨ç¤ºçš„åŒºé—´ã€‚
    /// ç”Ÿæˆç™»å½•/é‡ç½®é“¾æ¥çš„ä¸€æ¬¡æ€§ token
    /// éšæœºç›å€¼ï¼ˆpassword hashingï¼‰
    /// åè®®é‡Œçš„nonce/IVï¼ˆæ³¨æ„å¾ˆå¤šå¯†ç åº“æœ‰ä¸“é—¨ APIï¼Œæ›´æ¨èç›´æ¥ç”¨å®ƒä»¬ï¼‰
    /// ä»»ä½•éœ€è¦ä¸å¯é¢„æµ‹éšæœºæ€§çš„åœ°æ–¹
    let token = UInt64.random(in: .min... .max, using: &sec)
    ```

### 35ã€Task <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å‡½æ•°æœ¬èº«å°±åªåœ¨ä¸»çº¿ç¨‹ç”¨ï¼ˆæ¨èï¼‰

  ```swift
  @MainActor
  func toastBy(_ string: String) {
      JobsToast.show(
          text: string,
          config: JobsToast.Config()
              .byBgColor(.systemGreen.withAlphaComponent(0.9))
              .byCornerRadius(12)
      )
  }
  ```

* å…è®¸ä»»æ„çº¿ç¨‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•

  ```swift
  func toastBy(_ string: String) {
      Task { @MainActor in
          JobsToast.show(
              text: string,
              config: JobsToast.Config()
                  .byBgColor(.systemGreen.withAlphaComponent(0.9))
                  .byCornerRadius(12)
          )
      }
  }
  ```

### 36ã€æº¢å‡ºè¿ç®—ç¬¦ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* é€šä¿—é‡Šä¹‰ï¼ˆåŠ å‡ä¹˜æ³•åŒæºï¼‰

  ```swift
  let x: UInt8 = 0
  let y = x - 1   // âŒ è¿è¡Œæ—¶ç›´æ¥å´©æºƒï¼šæ•´æ•°æº¢å‡º
  ```

  ```swift
  let x: UInt8 = 0
  let y = x &- 1  // âœ… y == 255
  // UInt8 æ˜¯ 0...255ï¼Œ0 å†å‡ 1 å°±ç»•å›æœ€å¤§å€¼ 255
  ```

* `&+`  æº¢å‡ºåŠ æ³• / `&-`  æº¢å‡ºå‡æ³• / `&*`  æº¢å‡ºä¹˜æ³• <font color=red>**æ²¡æœ‰æº¢å‡ºé™¤æ³•**</font>ã€‚[**Swift**](https://developer.apple.com/swift/) å¾ˆæ—©æœŸï¼ˆ1.xï¼‰çš„æ—¶å€™æ˜¯æœ‰ `&/`ã€`&%` çš„ï¼Œåæ¥åœ¨ [**Swift**](https://developer.apple.com/swift/) 1.2 / Xcode 6.3 è¢«å¹²æ‰äº†ã€‚å®˜æ–¹ç†ç”±å¤§è‡´æ˜¯ï¼š

  - å®ƒä»¬å’Œ `&+` / `&-` / `&*` ä¸ä¸€æ ·ï¼Œ**ä¸èƒ½æä¾›ç»Ÿä¸€çš„â€œäºŒè¿›åˆ¶è¡¥ç åŒ…è£¹ï¼ˆtwoâ€™s complement wrappingï¼‰è¯­ä¹‰**ï¼›
  - é™¤æ³•æœ‰ä¸¤ä¸ªâ€œç‰¹æ®Šæƒ…å†µâ€ï¼š
    - é™¤ 0ï¼›
    - æœ‰ç¬¦å·æ•´æ•°é‡Œçš„ `Int.min / -1`ï¼ˆæ•°å­¦ä¸Šå¯è¡¨ç¤ºï¼Œä½†ç»“æœè¶…å‡ºç±»å‹èŒƒå›´ï¼‰ï¼›
  - è¿™äº›ç‰¹æ®Š case éœ€è¦å•ç‹¬å¤„ç†ï¼Œæ”¾åœ¨ä¸€ä¸ªâ€œçœ‹èµ·æ¥è·Ÿåˆ«çš„æº¢å‡ºè¿ç®—ç¬¦ä¸€æ ·â€çš„ `&/`ã€`&%` é‡Œåè€Œè¯¯å¯¼ï¼Œäºæ˜¯å¹²è„†ä»è¯­è¨€é‡Œåˆ æ‰ï¼Œè®©ä½ **è‡ªå·±å†™æ˜¾å¼åˆ¤æ–­**ã€‚[Stack Overflow+2Swift Forums+2](https://stackoverflow.com/questions/30378591/overflow-division-operator-not-recognized?utm_source=chatgpt.com)

* æº¢å‡ºè¿ç®—ç¬¦å¿…é¡»è¿å†™

  ```swift
  a &- b   // æº¢å‡ºå‡æ³•
  a & -b   // å…ˆå¯¹ b å–è´Ÿå· -bï¼Œå†åšæŒ‰ä½ä¸ &
  ```

### 37ã€<font color=red>**`mutating`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å‘Šè¯‰ç¼–è¯‘å™¨ï¼šè¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹ã€Œå€¼ç±»å‹ã€æœ¬èº«ï¼ˆselfï¼‰ï¼Œæ‰€ä»¥è¯·æŒ‰å¯å˜å¼•ç”¨æ¥å¤„ç†

  ```swift
  struct Counter {
      var value = 0
      // ä¸åŠ  mutatingï¼šâŒ ç¼–è¯‘ä¸è¿‡ã€‚æŠ¥é”™ï¼šCannot assign to property: 'self' is immutable
      mutating func increment() {
          value += 1
      }
  }
  ```

  * `struct` / `enum` æ˜¯ **å€¼ç±»å‹**
  * æ–¹æ³•é‡Œé»˜è®¤æŠŠ `self` å½“æˆ **ä¸å¯å˜çš„å€¼** æ¥çœ‹å¾…
  * æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨æ–¹æ³•é‡Œæƒ³æ”¹ `self` æˆ–è€… `self` çš„å±æ€§ï¼Œå¿…é¡»å…ˆå£°æ˜è¿™ä¸ªæ–¹æ³•æ˜¯ **mutating**ï¼Œç¼–è¯‘å™¨æ‰ä¼šæŠŠ `self` å½“ä½œ `inout` æ¥å¤„ç†

* åªä¼šå‡ºç°åœ¨ **å€¼ç±»å‹** ä¸Šã€‚åœ¨ `class` ä¸Šå®Œå…¨ä¸ä¼šç”¨ <font color=red>**`mutating`**</font>ï¼Œå› ä¸ºå¼•ç”¨ç±»å‹çš„æ–¹æ³•å¯ä»¥éšä¾¿æ”¹ `self` çš„å±æ€§ï¼Œä¸éœ€è¦é¢å¤–æ ‡è®°

  * `struct`
  * `enum`
  * ä»¥åŠå®ƒä»¬åœ¨ **protocol** é‡Œçš„æ–¹æ³•å£°æ˜

## äº”ã€<font color=red>**F**</font><font color=green>**A**</font><font color=blue>**Q**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€[**Swift**](https://developer.apple.com/swift/) çº¯ç±» ğŸ†š `NSObject` å­ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 2ã€[**Swift**](https://developer.apple.com/swift/) `å±æ€§è§‚å¯Ÿå™¨` ğŸ†š **Objc** `KVO` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§     | [**Swift**](https://developer.apple.com/swift/) å±æ€§è§‚å¯Ÿå™¨ | **ObjC** KVO               |
| -------- | ---------------------------------------------------------- | -------------------------- |
| ç›‘å¬èŒƒå›´ | è‡ªèº«å±æ€§                                                   | å…¶ä»–å¯¹è±¡å±æ€§               |
| å®ç°æ–¹å¼ | ç¼–è¯‘å™¨æ³¨å…¥                                                 | Runtime åŠ¨æ€å­ç±»           |
| ç®€æ´åº¦   | ç®€å•ï¼ˆ`willSet` / `didSet`ï¼‰                               | ç¹çï¼ˆadd/removeObserverï¼‰ |
| ä½¿ç”¨åœºæ™¯ | å†…éƒ¨é€»è¾‘ã€çŠ¶æ€æ›´æ–°                                         | è·¨å¯¹è±¡ç›‘å¬ã€æ•°æ®ç»‘å®š       |
| å¯æ›¿ä»£æ€§ | ä¸èƒ½å®Œå…¨æ›¿ä»£ KVO                                           | æ¯”è§‚å¯Ÿå™¨æ›´å¼ºå¤§ï¼Œä½†æ›´å¤æ‚   |

* [**Swift**](https://developer.apple.com/swift/) `å±æ€§è§‚å¯Ÿå™¨`ï¼š`willSet` / `didSet` â†’ **è½»é‡çº§ã€è‡ªç”¨**çš„å±æ€§å˜åŒ–é’©å­ã€‚

  > **ä½œç”¨èŒƒå›´**ï¼šåªèƒ½ç”¨äº **æœ¬ç±»å±æ€§**ã€‚
  >
  > **è§¦å‘æ—¶æœº**ï¼šå±æ€§è¢«ç›´æ¥èµ‹å€¼æ—¶è§¦å‘ã€‚
  >
  > **æ„ŸçŸ¥èƒ½åŠ›**ï¼šåªèƒ½æ„ŸçŸ¥â€œæˆ‘è‡ªå·±çš„å±æ€§å˜åŒ–â€ã€‚
  >
  > **å®ç°æœºåˆ¶**ï¼šç¼–è¯‘å™¨åœ¨ setter åé¢è‡ªåŠ¨æ’å…¥é€»è¾‘ã€‚
  >
  > **é™åˆ¶**ï¼šä¸èƒ½ç”¨åœ¨è®¡ç®—å±æ€§ä¸Šï¼ˆå› ä¸ºè®¡ç®—å±æ€§ä½ å¯ä»¥ç›´æ¥åœ¨ `set` å†™é€»è¾‘ï¼‰ã€‚

  ```swift
  class Person {
      var age: Int = 0 {
          willSet {
              print("å³å°†è®¾ç½® age = \(newValue)")
          }
          didSet {
              print("age ä» \(oldValue) æ”¹ä¸º \(age)")
          }
      }
  }
  ```

* **Objc** `KVO` ï¼š**é€šç”¨ã€è·¨å¯¹è±¡**çš„è§‚å¯Ÿæœºåˆ¶ã€‚

  > **ä½œç”¨èŒƒå›´**ï¼šå¯ä»¥è§‚å¯Ÿ **å…¶ä»–å¯¹è±¡çš„å±æ€§**ã€‚
  >
  > **è§¦å‘æ—¶æœº**ï¼šä¸ä»…ç›´æ¥èµ‹å€¼ä¼šè§¦å‘ï¼ŒKVCï¼ˆ`setValue:forKey:`ï¼‰ã€æœ‰æ—¶ even Core Data è¿™ç§åº•å±‚éƒ½èƒ½ hookã€‚
  >
  > **æ„ŸçŸ¥èƒ½åŠ›**ï¼šè·¨å¯¹è±¡ï¼Œåªè¦å¯¹è±¡æ”¯æŒ KVOï¼Œå°±èƒ½ç›‘å¬ã€‚
  >
  > **å®ç°æœºåˆ¶**ï¼šè¿è¡Œæ—¶åŠ¨æ€æ´¾ç”Ÿå­ç±» + æ–¹æ³•æ›¿æ¢ï¼ˆisa-swizzlingï¼‰ã€‚
  >
  > **é™åˆ¶**ï¼š
  >
  > - API æ¯”è¾ƒç¹çã€‚
  > - çº¿ç¨‹å®‰å…¨å’Œå´©æºƒé£é™©éœ€è¦è‡ªå·±å¤„ç†ã€‚

  ```objective-c
  [self.person addObserver:self
                forKeyPath:@"age"
                   options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld
                   context:nil];
  
  - (void)observeValueForKeyPath:(NSString *)keyPath
                        ofObject:(id)object
                          change:(NSDictionary<NSKeyValueChangeKey,id> *)change
                         context:(void *)context {
      NSLog(@"age å˜åŒ–: %@", change);
  }
  ```

### 3ã€[**Swift**](https://developer.apple.com/swift/) ä¸­ `struct` å’Œ `class` çš„ä¸»è¦åŒºåˆ« <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å€¼ç±»å‹ ğŸ†š å¼•ç”¨ç±»å‹

  > <font color=red>`struct` æ˜¯ **å€¼ç±»å‹**</font>ï¼šèµ‹å€¼/ä¼ å‚æ—¶ä¼šå¤åˆ¶ä¸€ä»½ã€‚
  >
  > <font color=red>`class` æ˜¯ **å¼•ç”¨ç±»å‹**</font>ï¼šèµ‹å€¼/ä¼ å‚æ—¶åªæ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚

  ```swift
  struct S { var x = 0 }
  class C { var x = 0 }
  
  var s1 = S()
  var s2 = s1
  s2.x = 10
  print(s1.x)  // 0   ï¼ˆäº’ä¸å½±å“ï¼‰
  
  var c1 = C()
  var c2 = c1
  c2.x = 10
  print(c1.x)  // 10  ï¼ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼‰
  ```
  
* ç»§æ‰¿

  > `struct` âŒ ä¸æ”¯æŒç»§æ‰¿
  >
  > `class` âœ… å¯ä»¥ç»§æ‰¿

* **ARC** ç®¡ç†

  > `struct`ï¼šå› ä¸ºæ˜¯å€¼ç±»å‹ï¼Œä¸éœ€è¦ **ARC** ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸç®€å•
  >
  > `class`ï¼šç”± **ARC** ç®¡ç†ï¼Œå¯èƒ½æœ‰ **å¾ªç¯å¼•ç”¨** é—®é¢˜ï¼Œéœ€è¦ `weak` / `unowned` 

* å¯å˜æ€§

  > `struct`ï¼šåœ¨ `let` å¸¸é‡ä¸‹æ˜¯å®Œå…¨ä¸å¯å˜çš„ï¼ˆåŒ…æ‹¬å±æ€§ï¼‰
  >
  > `class`ï¼šåœ¨ `let` å¸¸é‡ä¸‹å¯¹è±¡æœ¬èº«ä¸å¯å˜ï¼Œä½†å±æ€§ä»ç„¶å¯æ”¹

  ```swift
  struct S {
      var x = 0
  }
  let s = S()
  // s.x = 10  âŒ ä¸å…è®¸
  
  class C {
      var x = 0
  }
  let c = C()
  c.x = 10  âœ… å¯ä»¥æ”¹å±æ€§
  ```

* ç±»å‹ç‰¹æ€§

  > `struct`ï¼šè‡ªåŠ¨æœ‰ **é€ä¸€æˆå‘˜åˆå§‹åŒ–å™¨ï¼ˆmemberwise initï¼‰**ã€‚
  >
  > `class`ï¼šæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±å†™ `init`

  ```swift
  struct User { var name: String; var age: Int }
  let u = User(name: "Jobs", age: 18)  âœ…
  ```

* è¯­ä¹‰

  * `struct` æ›´åå‘ **æ•°æ®æ¨¡å‹ï¼ˆå°è£…æ•°æ® + å°é€»è¾‘ï¼‰**
  * `class` æ›´åå‘ **å¯¹è±¡ã€èº«ä»½ã€ç»§æ‰¿ã€å¤šæ€**

#### ğŸ”¹ <font color=blue>**ä¸ºä»€ä¹ˆ[Swift](https://developer.apple.com/swift/) æ¨èï¼šå¤šç”¨ `struct`ï¼Œå°‘ç”¨ `class`ï¼Ÿ**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å®‰å…¨æ€§æ›´é«˜ï¼ˆå€¼è¯­ä¹‰é¿å…å…±äº«å‰¯ä½œç”¨ï¼‰**
  * å€¼ç±»å‹åœ¨ä¼ é€’æ—¶å¤åˆ¶ï¼Œé¿å…äº†å¯¹è±¡åœ¨å¤šå¤„è¢«ä¿®æ”¹å¸¦æ¥çš„ bug
  * æ›´å®¹æ˜“æ¨æ–­ä»£ç è¡Œä¸º

* **æ²¡æœ‰å¾ªç¯å¼•ç”¨é—®é¢˜**
  * <font color=red>**`struct` ä¸ä¾èµ– ARCï¼Œä¸ä¼šå› ä¸ºäº’ç›¸æŒæœ‰å¯¼è‡´å†…å­˜æ³„æ¼**</font>

* **æ€§èƒ½æ›´ä¼˜ï¼ˆå¾ˆå¤šæƒ…å†µä¸‹ï¼‰**
  * å°çš„ `struct` ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä¸ºæ ˆä¸Šåˆ†é…ï¼Œè®¿é—®é€Ÿåº¦å¿«
  * é¿å…äº† class çš„ å † åˆ†é…å’Œ ARC å¼•ç”¨è®¡æ•°å¼€é”€

* **è¯­ä¹‰æ›´æ¸…æ™°**
  * `struct` å¼ºè°ƒå€¼çš„ä¸å¯å˜æ€§ï¼Œé€‚åˆå»ºæ¨¡â€œæ•°æ®â€
  * `class` å¼ºè°ƒèº«ä»½å’Œå…±äº«ï¼Œé€‚åˆå»ºæ¨¡â€œå¯¹è±¡â€

* **å’Œ [Swift](https://developer.apple.com/swift/)  æ ‡å‡†åº“ä¸€è‡´**
  * [**Swift**](https://developer.apple.com/swift/) é‡Œå¤§é‡æ ¸å¿ƒç±»å‹éƒ½æ˜¯ `struct`ï¼š`String`, `Array`, `Dictionary`, `Set`
  * Apple å®˜æ–¹é£æ ¼å°±æ˜¯ï¼šèƒ½ç”¨å€¼è¯­ä¹‰çš„åœ°æ–¹ä¼˜å…ˆç”¨ `struct`

#### ğŸ“Œ <font color=blue>**ä»€ä¹ˆæ—¶å€™ä¸€å®šè¦ç”¨ `class`?**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* éœ€è¦ **ç»§æ‰¿**
* éœ€è¦ **å¼•ç”¨è¯­ä¹‰**ï¼ˆæ¯”å¦‚ UI æ§ä»¶ï¼Œå¤šå¤„å…±äº«çŠ¶æ€ï¼‰
* éœ€è¦å’Œ **ObjC æ¡¥æ¥**ï¼ˆ**ObjC** é‡Œåªæœ‰ç±»ï¼‰

### 4ã€[**Swift**](https://developer.apple.com/swift/) å¯ä»¥åƒ**ObjC**é‚£æ ·è®¿é—®å†…å­˜å—ï¼Ÿ<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **å¯ä»¥ï¼Œä½†å—æ›´å¤šé™åˆ¶**ï¼Œå› ä¸º [**Swift**](https://developer.apple.com/swift/)  é»˜è®¤æ˜¯å®‰å…¨çš„
>
> å¦‚æœç¡®å®éœ€è¦ï¼ˆæ¯”å¦‚æ€§èƒ½ä¼˜åŒ–ã€ä¸ **C**/**ObjC** åº“äº¤äº’ï¼‰ï¼Œå¯ä»¥ç”¨ **`UnsafePointer` ç³»åˆ—**ã€‚

#### 4.1ã€[**Swift**](https://developer.apple.com/swift/) å†…å­˜è®¿é—®æ–¹å¼ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* Unsafe æŒ‡é’ˆç³»åˆ—

  > `UnsafePointer<T>`ï¼ˆç›¸å½“äº `const T *`ï¼‰
  >
  > `UnsafeMutablePointer<T>`ï¼ˆç›¸å½“äº `T *`ï¼‰
  >
  > `UnsafeRawPointer` / `UnsafeMutableRawPointer`ï¼ˆæ— ç±»å‹æŒ‡é’ˆï¼Œç±»ä¼¼ `void *`ï¼‰
  >
  > `OpaquePointer`ï¼ˆåªä¿å­˜åœ°å€ï¼Œä¸å¯ç›´æ¥è§£å¼•ç”¨ï¼‰

  ```swift
  var num = 42
  
  // è·å–æŒ‡é’ˆ
  let ptr = withUnsafePointer(to: &num) { $0 }
  print(ptr.pointee)  // 42
  
  // ä¿®æ”¹å€¼
  withUnsafeMutablePointer(to: &num) { p in
      p.pointee = 100
  }
  print(num)  // 100
  ```

* åŸå§‹å†…å­˜æ“ä½œï¼ˆ`malloc`/`free`ï¼‰

  ```swift
  let raw = UnsafeMutableRawPointer.allocate(byteCount: 4, alignment: 4)
  raw.storeBytes(of: 1234, as: Int32.self)
  
  let value = raw.load(as: Int32.self)
  print(value) // 1234
  
  raw.deallocate()
  ```

* å’Œ **C/Objc** äº’æ“ä½œ

  > [**Swift**](https://developer.apple.com/swift/)  çš„ Unsafe æŒ‡é’ˆå’Œ **C** æŒ‡é’ˆå¯ä»¥æ— ç¼æ¡¥æ¥

  ```swift
  let arr: [Int32] = [1, 2, 3]
  /// **ObjC** æ–¹æ³•é‡Œéœ€è¦ int * å‚æ•°ï¼ŒSwift ä¼šè‡ªåŠ¨æ˜ å°„æˆ UnsafePointer<Int32>
  arr.withUnsafeBufferPointer { buffer in
      c_function(buffer.baseAddress, Int32(buffer.count))
  }
  ```

### 5ã€`print` ğŸ†š `debugPrint` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ```swift
> let array = ["A", "B", "C"]
> 
> print(array)       // [A, B, C]     â† ç”¨æˆ·å‹å¥½
> debugPrint(array)  // ["A", "B", "C"] â† åŒ…å«å¼•å·ï¼ŒçœŸå®è¡¨è¾¾
> ```
>
> ```swift
> let str = "Hello\nWorld"
> print(str)       // Hello
>                  // World   â† ç›´æ¥æ¢è¡Œ
> debugPrint(str)  // "Hello\nWorld" â† åŸå§‹å­—ç¬¦è½¬ä¹‰
> ```

* `print`ï¼ˆä¸šåŠ¡æ—¥å¿—ã€ç”¨æˆ·å¯è§çš„æ—¥å¿— ï¼‰

  * **é¢å‘ç”¨æˆ·çš„è¾“å‡º**
  * è¾“å‡ºæ—¶è°ƒç”¨å¯¹è±¡çš„ **`CustomStringConvertible`** åè®®ä¸­çš„ `description`ã€‚
  * å¦‚æœå¯¹è±¡æ²¡å®ç° `description`ï¼Œåˆ™ä¼šç”¨é»˜è®¤çš„ç®€çŸ­æè¿°ã€‚
  * **é€‚åˆ<u>ç»™äººçœ‹</u>çš„æ—¥å¿—**ã€‚

  ```swift
  struct User: CustomStringConvertible {
      let name: String
      var description: String {
          return "ğŸ‘¤ ç”¨æˆ·å: \(name)"
      }
  }
  
  let u = User(name: "Jobs")
  
  print(u)
  // è¾“å‡ºï¼šğŸ‘¤ ç”¨æˆ·å: Jobs
  ```

* `debugPrint`ï¼ˆè°ƒè¯• / æ’æŸ¥é—®é¢˜ã€éœ€è¦çœ‹åˆ°å¯¹è±¡ç»†èŠ‚ï¼‰

  * **é¢å‘å¼€å‘è€…/è°ƒè¯•çš„è¾“å‡º**
  * è¾“å‡ºæ—¶è°ƒç”¨å¯¹è±¡çš„ **`CustomDebugStringConvertible`** åè®®ä¸­çš„ `debugDescription`ã€‚
  * å¦‚æœå¯¹è±¡æ²¡å®ç° `debugDescription`ï¼Œä¼š fallback åˆ° `description`ï¼Œå†ä¸è¡Œå°±è¾“å‡ºç±»å‹ä¿¡æ¯å’Œå†…å­˜åœ°å€ã€‚
  * **é€‚åˆ<u>è°ƒè¯•åœºæ™¯</u>**ï¼Œæ¯”å¦‚è¦çœ‹å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å‹å¥½çš„æè¿°ã€‚

  ```swift
  struct User: CustomStringConvertible, CustomDebugStringConvertible {
      let name: String
      var description: String {
          return "ğŸ‘¤ ç”¨æˆ·å: \(name)"
      }
      var debugDescription: String {
          return "User(name: \(name))"
      }
  }
  
  let u = User(name: "Jobs")
  
  print(u)       // ğŸ‘¤ ç”¨æˆ·å: Jobs
  debugPrint(u)  // User(name: Jobs)
  ```
### 6ã€[**Swift**](https://developer.apple.com/swift/) çº¯ç±» ğŸ†š **`NSObject`** å­ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **ä¸ç»§æ‰¿ `NSObject`**ï¼šç”¨äº **çº¯ [Swift](https://developer.apple.com/swift/)  é€»è¾‘/æ¨¡å‹**ï¼Œè½»é‡ã€æ€§èƒ½å¥½ã€å®‰å…¨
>
> **ç»§æ‰¿ `NSObject`**ï¼šç”¨äº **UI å±‚ / å’Œ Objc äº’æ“ä½œ**ï¼Œéœ€è¦ **KVC/KVO/Selector** æˆ–ä½¿ç”¨ **Foundation/UIKit API** æ—¶å¿…é¡»ç”¨

* [**Swift**](https://developer.apple.com/swift/) çº¯ç±»ï¼ˆä¸ç»§æ‰¿ `NSObject`ï¼‰

  > 1ï¸âƒ£ **å€¼è¯­ä¹‰åªé  Swift**ï¼Œä¸ä¾èµ– ObjC Runtime
  >
  > 2ï¸âƒ£ ä¸èƒ½ç›´æ¥ç”¨ **KVC / KVO**
  >
  > 3ï¸âƒ£ ä¸èƒ½ç›´æ¥ç”¨ **Selector** è°ƒç”¨
  >
  > 4ï¸âƒ£ ä¸èƒ½ç›´æ¥å­˜æ”¾åœ¨éœ€è¦ `AnyObject & NSObjectProtocol` çš„ API ä¸­ï¼ˆå¦‚ `NSDictionary`ï¼‰
  >
  > 5ï¸âƒ£ `isEqual`, `hash`, `description` è¿™äº›éƒ½æ²¡æœ‰ `NSObject` é»˜è®¤å®ç°ï¼Œéœ€è¦è‡ªå·±å†™
  >
  > 6ï¸âƒ£ çº¯ [**Swift**](https://developer.apple.com/swift/)  ç±»å‹ï¼Œ**æ€§èƒ½æ›´å¥½**ï¼Œä¸éœ€è¦åŠ¨æ€æ´¾å‘ï¼ˆé™¤éä½ æ ‡è®° `dynamic` æˆ– `@objc`ï¼‰
  >
  > 7ï¸âƒ£ **æ•°æ®å±‚/é€»è¾‘å±‚** â†’ ç”¨ **çº¯ Swift ç±»** æˆ– `struct`

  ```swift
  class Person {
      var name: String
      init(name: String) { self.name = name }
  }
  ```

* ç»§æ‰¿è‡ª `NSObject`

  > 1ï¸âƒ£ è‡ªåŠ¨è·å¾— **`NSObject` åŸºç¡€åŠŸèƒ½**
  >
  > 2ï¸âƒ£ å¯ä»¥ä½¿ç”¨ **KVC/KVO**
  >
  > 3ï¸âƒ£ å¯ä»¥ä½¿ç”¨ **Selector / perform**
  >
  > 4ï¸âƒ£ ä¸ **Objc API æ— ç¼äº’é€š**ï¼ˆ`UIKit/AppKit` é‡Œç»å¤§å¤šæ•° API è¦æ±‚ `NSObject`ï¼‰
  >
  > 5ï¸âƒ£ éœ€è¦ ARC ç®¡ç†ï¼Œæœ‰ä¸€å®šæ€§èƒ½å¼€é”€
  >
  > 6ï¸âƒ£ **è·Ÿ UIKit/AppKit æ‰“äº¤é“çš„å±‚** â†’ å¿…é¡»ç»§æ‰¿ `NSObject`

  ```swiftÂ 
  class Person: NSObject {
      @objc var name: String
      init(name: String) { self.name = name }
  }
  ```

### 7ã€<font id=æ™®é€šå‚æ•°ä¼ é€’ğŸ†šinoutå‚æ•°ä¼ é€’>**æ™®é€šå‚æ•°ä¼ é€’** ğŸ†š <font color=red>**`inout`**</font> **å‚æ•°ä¼ é€’**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ™®é€šå‚æ•°ä¼ é€’ï¼ˆå€¼ä¼ é€’ï¼‰

  ```swift
  func addTen(_ number: Int) {
      var num = number
      num += 10
  }
  
  var value = 5
  addTen(value)
  print(value)   // 5
  ```

  ```mermaid
  flowchart TD
      A["value = 5 (å¤–éƒ¨å˜é‡)"]
      B["number = 5 (å‡½æ•°å‚æ•°å‰¯æœ¬)"]
  
      A -- "å¤åˆ¶" --> B
      B -- "ä¿®æ”¹å=15" --> B
      A -. "ä¸å—å½±å“" .-> A
  ```

* <font color=red>**`inout`**</font> å‚æ•°ä¼ é€’ï¼ˆå¼•ç”¨ä¼ é€’ï¼‰

  ```	swift
  func addTen(_ number: inout Int) {
      number += 10
  }
  
  var value = 5
  addTen(&value)
  print(value)   // 15
  ```

  ```mermaid
  flowchart TD
      A["value = 5 (å¤–éƒ¨å˜é‡)"]
      B["number å¼•ç”¨ -> value"]
  
      A <--> B
      B -- "ä¿®æ”¹=15" --> A
  ```

### 8ã€`throw`/`do`/`try`/`catch`/`finally` ä¸ºä»€ä¹ˆåœ¨**Objc**é‡Œé¢å‡ ä¹ä¸ç”¨ï¼Œè€Œ[**Swift**](https://developer.apple.com/swift/)é‡Œé¢å´è¢«å¤§é‡ä½¿ç”¨ï¼Ÿ<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§               | Objc                                 | Swift                                       |
| ------------------ | ------------------------------------ | ------------------------------------------- |
| å¼‚å¸¸ (`try/catch`) | æœ‰ï¼Œä½†æ€§èƒ½å·®ï¼ŒARC ä¸‹å±é™©ï¼Œå®˜æ–¹ä¸æ¨è | æœ‰ï¼Œé›¶æˆæœ¬è®¾è®¡ï¼Œæ¨èç”¨äºâ€œå¯é¢„æœŸé”™è¯¯â€        |
| æ¨èæ–¹å¼           | `NSError **` è¾“å‡ºå‚æ•°                | `throws` + `try`ï¼Œæˆ– `Result<T,Error>`      |
| ç¼–è¯‘å™¨æ£€æŸ¥         | âŒ æ²¡æœ‰                               | âœ… è°ƒç”¨ç‚¹å¿…é¡»æ˜¾å¼ `try`                      |
| å…¸å‹åœºæ™¯           | ç³»ç»Ÿ API æŠ¥é”™ï¼šä¼  `NSError**`        | æ–‡ä»¶ IO / JSON è§£æ / ç½‘ç»œè¯·æ±‚ ç­‰å¯æ¢å¤é”™è¯¯ |
| å¼‚å¸¸è¯­ä¹‰           | Fatal bugï¼Œä¸å»ºè®®æ•è·                | ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼Œå¿…é¡»å¤„ç†                      |

* **Objc**

  * Apple å®˜æ–¹æ–‡æ¡£æ˜ç¡®è¯´

    * ğŸ‘‰ **Exceptions ç”¨æ¥è¡¨ç¤ºç¨‹åºå‘˜é”™è¯¯ï¼ˆç¼–ç¨‹ bugï¼‰ï¼Œä¸æ¨èç”¨æ¥åšé”™è¯¯å¤„ç†**

    * æ¯”å¦‚æ•°ç»„è¶Šç•Œã€è®¿é—®é‡æŒ‡é’ˆï¼Œéƒ½æ˜¯ fatal bugï¼Œåº”è¯¥ç›´æ¥ crashï¼Œè€Œä¸æ˜¯ recover

    * æ­£å¸¸çš„é”™è¯¯è¿”å›ï¼ŒApple æ¨å¹¿ **NSError** æ¨¡å¼

      ```objective-c
      - (BOOL)writeToFile:(NSString *)path error:(NSError **)error;
      ```

  * **è¿è¡Œæ—¶æ¨¡å‹åŸå› **

    * **Objc** çš„å¼‚å¸¸å¤„ç†å¼€é”€å¤§ï¼ˆåŸºäº setjmp/longjmpï¼‰ï¼Œæ€§èƒ½å·®
    * ARC ä¸‹å¼‚å¸¸è¿˜å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¯¹è±¡æ²¡æ¥å¾—åŠ releaseï¼‰
    * æ‰€ä»¥è‹¹æœå®˜æ–¹åœ¨ ARC æ–‡æ¡£é‡Œç›´æ¥å†™ï¼š**ä¸è¦ç”¨ @try/@catch æ•æ‰ä¸€èˆ¬é”™è¯¯**

* [**Swift**](https://developer.apple.com/swift/)

  * å®‰å…¨æ€§ & æ˜¾å¼æ€§

    * [**Swift**](https://developer.apple.com/swift/) ä¸å¸Œæœ›é”™è¯¯é€šè¿‡é­”æ³•æ–¹å¼â€œæ‚„æ‚„å‘ç”Ÿâ€ï¼Œè€Œæ˜¯è¦ä½ åœ¨è°ƒç”¨ç‚¹æ˜¾å¼å†™ `try`ã€‚

    * è¿™æ ·ä¸€çœ¼å°±èƒ½çœ‹å‡ºè¿™ä¸ªå‡½æ•°å¯èƒ½å¤±è´¥

      ```swift
      func readFile(_ path: String) throws -> String
      let content = try readFile("foo.txt")
      ```

  * æ€§èƒ½ï¼š[**Swift**](https://developer.apple.com/swift/) çš„ `throw` **ä¸èµ° ObjC çš„ setjmp/longjmp**ï¼Œå®ç°æ–¹å¼æ›´æ¥è¿‘ **C++ ** çš„é›¶æˆæœ¬å¼‚å¸¸æ¨¡å‹

    * ä¸æŠ›é”™æ—¶å‡ ä¹æ²¡æœ‰å¼€é”€ï¼›
    * åªæœ‰çœŸçš„æŠ›å‡ºæ—¶æ‰èµ°å¼€é”€è·¯å¾„ã€‚

  * å’Œç±»å‹ç³»ç»Ÿç»“åˆ

    * [**Swift**](https://developer.apple.com/swift/) çš„ `throws` æ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ä½ å¤„ç†ã€‚
    * **Objc** çš„ **`NSError`** é æ–‡æ¡£å’Œçº¦å®šï¼Œæ²¡äººå¼ºåˆ¶ã€‚

  * å¯é€‰å¤šç§é£æ ¼

    * ä½ å¯ä»¥ç”¨ `try/try? / try!` æ ¹æ®éœ€è¦é€‰æ‹©å®‰å…¨çº§åˆ«ã€‚
    * ä¹Ÿå¯ä»¥æŠŠ `throws` è½¬æ¢æˆ `Result<T, Error>`ï¼Œå’Œ `async/await`ã€`Combine`ã€[**Swift**](https://developer.apple.com/swift/) **Concurrency** é…åˆéå¸¸å¥½ã€‚

### 9ã€<font id=APIğŸ†šABI>**API ğŸ†š ABI**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **API** = ä»£ç å±‚çš„æ¥å£ï¼ˆå‡½æ•°åã€å‚æ•°ã€è¿”å›å€¼ï¼‰

  > <font color=red>**A**</font>pplication <font color=red>**P**</font>rogramming <font color=red>**I**</font>nterface

* **ABI** = ç¼–è¯‘ä¹‹åï¼ŒäºŒè¿›åˆ¶å±‚çš„æ¥å£ï¼ˆå‡½æ•°åœ¨å†…å­˜é‡Œçš„å¸ƒå±€ã€è°ƒç”¨çº¦å®šã€ç»“æ„ä½“çš„å†…å­˜æ’å¸ƒï¼‰

  > <font color=red>**A**</font>pplication <font color=red>**B**</font>inary <font color=red>**I**</font>nterface

### 10ã€[**Swift**](https://developer.apple.com/swift/) ä¸­`NSObject` ğŸ†š `NSObjectProtocol` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ä¸»è¦èµ·åˆ° **æ¡¥æ¥Objcå’Œç›¸å…³çº¦æŸ** çš„ä½œç”¨ï¼Œä¿è¯äº†ç›¸ç­‰æ¯”è¾ƒã€å“ˆå¸Œã€æè¿°ã€åŠ¨æ€è°ƒç”¨ç­‰åŸºç¡€èƒ½åŠ›

#### 10.1ã€ç›¸å…³å®šä¹‰ä¸ç»§æ‰¿å…³ç³» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
@available(iOS 2.0, *)
open class NSObject : NSObjectProtocol {
    deinit
    open class func load()
    open class func initialize()
    public init()
  
    @available(*, deprecated, message: "Objective-C garbage collection is no longer supported")
    open func finalize()

    open func copy() -> Any
    open func mutableCopy() -> Any
    open class func instancesRespond(to aSelector: Selector!) -> Bool
    open class func conforms(to protocol: Protocol) -> Bool
    open func method(for aSelector: Selector!) -> IMP!
    open class func instanceMethod(for aSelector: Selector!) -> IMP!
    open func doesNotRecognizeSelector(_ aSelector: Selector!)
  
    @available(iOS 2.0, *)
    open func forwardingTarget(for aSelector: Selector!) -> Any?

    open class func isSubclass(of aClass: AnyClass) -> Bool

    @available(iOS 2.0, *)
    open class func resolveClassMethod(_ sel: Selector!) -> Bool

    @available(iOS 2.0, *)
    open class func resolveInstanceMethod(_ sel: Selector!) -> Bool

    open class func hash() -> Int
    open class func superclass() -> AnyClass?
    open class func description() -> String
    open class func debugDescription() -> String
}
```

#### 10.2ã€`NSObjectProtocol` æ˜¯ **Objc ä¸–ç•Œæ‰€æœ‰å¯¹è±¡çš„æœ€å°å…¬å…±æ¥å£** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ç”Ÿå‘½å‘¨æœŸç›¸å…³

  * **`deinit`**ï¼šææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯å‰è°ƒç”¨ã€‚[**Swift**](https://developer.apple.com/swift/) è‡ªåŠ¨è°ƒç”¨ï¼Œä¸éœ€è¦ä½ æ‰‹åŠ¨å†™ `dealloc`ã€‚
  * **`init()`**ï¼šæ„é€ å‡½æ•°ï¼Œåˆ›å»ºå®ä¾‹æ—¶è°ƒç”¨ã€‚ 
  * **`finalize()`**ï¼ˆå·²åºŸå¼ƒï¼‰ï¼šä»¥å‰æ˜¯ç»™ **Objc åƒåœ¾å›æ”¶ï¼ˆGCï¼‰** ç”¨çš„ï¼Œç°åœ¨ ARC ä¸æ”¯æŒäº†ï¼Œæ‰€ä»¥åºŸå¼ƒã€‚

* ç±»åŠ è½½ & åˆå§‹åŒ–

  * **`load()`**ï¼š**ç±»ç¬¬ä¸€æ¬¡è¢«åŠ è½½è¿›è¿è¡Œæ—¶æ—¶è°ƒç”¨**ï¼ˆæ¯” `initialize` è¿˜æ—©ï¼‰ã€‚å‡ ä¹ä¸ç”¨åœ¨ [**Swift**](https://developer.apple.com/swift/) é‡Œå†™ï¼Œä½†åœ¨ OC é‡Œå¯ä»¥ç”¨æ¥åš<u>ç±»çº§åˆ«çš„ hook</u>
  * **`initialize()`**ï¼š**ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶æ¶ˆæ¯æ—¶è°ƒç”¨**ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚å¸¸ç”¨äºæ—§æ—¶ä»£çš„ç±»åˆå§‹åŒ–é€»è¾‘ï¼ˆ[**Swift**](https://developer.apple.com/swift/) é‡Œä¸€èˆ¬ç”¨ `static let` æ¥æ›¿ä»£ï¼‰

* æ‹·è´ç›¸å…³

  * **`copy()`**ï¼šè¿”å›ä¸€ä¸ªä¸å¯å˜æ‹·è´ï¼ˆæµ…æ‹·è´/æ·±æ‹·è´å–å†³äºç±»å®ç°ï¼‰ï¼ˆéµå®ˆ `NSCopying` åè®®çš„ç±»ä¼šå®ç°è¿™ä¸ªï¼‰
  * **`mutableCopy()`**ï¼šè¿”å›ä¸€ä¸ªå¯å˜æ‹·è´ï¼ˆéµå®ˆ `NSMutableCopying` åè®®çš„ç±»ä¼šå®ç°è¿™ä¸ªï¼‰

* æ¶ˆæ¯è½¬å‘ & åŠ¨æ€æ–¹æ³•è§£æ

  è¿™äº›æ˜¯ **Objc åŠ¨æ€æ´¾å‘æœºåˆ¶**çš„æ ¸å¿ƒï¼š

  - **`instancesRespond(to:)`**ï¼šåˆ¤æ–­ç±»çš„å®ä¾‹æ˜¯å¦èƒ½å“åº”æŸä¸ª `Selector`

    ```swift
    UIButton.instancesRespond(to: #selector(UIButton.setTitle(_:for:)))
    ```

  - **`conforms(to:)`**ï¼šåˆ¤æ–­ç±»æ˜¯å¦éµå®ˆæŸä¸ªåè®®ã€‚

  - **`method(for:)`**ï¼šè·å–å®ä¾‹æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆï¼ˆ`IMP`ï¼‰ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å®ç°å‡½æ•°ï¼ˆåº•å±‚è°ƒç”¨ï¼‰ã€‚

  - **`instanceMethod(for:)`**ï¼šç±»æ–¹æ³•ï¼Œè·å–å®ä¾‹æ–¹æ³•çš„å®ç°ã€‚

  - **`doesNotRecognizeSelector(_:)`**ï¼šå½“å¯¹è±¡æ”¶åˆ°ä¸€ä¸ª **æœªå®ç°çš„ Selector** æ—¶ä¼šè°ƒç”¨ â†’ é»˜è®¤ç›´æ¥ crashã€‚å¯ä»¥ override åšæ‹¦æˆªï¼ˆä½†ä¸€èˆ¬ç”¨äºè°ƒè¯•ï¼‰ã€‚

  - **`forwardingTarget(for:)`**ï¼šæ¶ˆæ¯è½¬å‘ï¼šå¦‚æœå¯¹è±¡ä¸èƒ½å“åº”æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚

  - **`resolveClassMethod(_:)` / `resolveInstanceMethod(_:)`**ï¼šåŠ¨æ€æ–¹æ³•è§£æï¼šè¿è¡Œæ—¶å°è¯•ç»™ç±»/å®ä¾‹åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚å¸¸ç”¨äº **runtime åŠ¨æ€æ³¨å…¥æ–¹æ³•**ã€‚

* è¿è¡Œæ—¶ç±»å‹ & ç»§æ‰¿

  **`isSubclass(of:)`**ï¼š åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦æ˜¯å¦ä¸€ä¸ªç±»çš„å­ç±»

  ```swift
  UIView.isSubclass(of: UIResponder.self) // true
  ```

  **`superclass()`**ï¼šè·å–çˆ¶ç±»

* æ ‡è¯† & æè¿°

  * **`hash()`**ï¼šè¿”å›å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œç”¨äºé›†åˆï¼ˆ`Set`ã€`Dictionary` çš„ keyï¼‰
     ğŸ‘‰ é»˜è®¤åŸºäºå†…å­˜åœ°å€ï¼Œå¯ä»¥ <font color=red>**`@override`**</font>
  * **`description()`**:è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²æè¿°ï¼Œå¸¸ç”¨äº `print()`
     ğŸ‘‰ é»˜è®¤è¿”å› `<ClassName: memoryAddress>`
  * **`debugDescription()`**:è°ƒè¯•æ—¶çš„æè¿°ï¼Œæ¯” `description` æ›´è¯¦ç»†
     ğŸ‘‰ Xcode è°ƒè¯•å™¨é‡Œ `po å¯¹è±¡` æ‰“å°å‡ºæ¥çš„å°±æ˜¯è¿™ä¸ª

### 11ã€<font id=ABIä¸å…¼å®¹>ä»€ä¹ˆæ˜¯ABIä¸å…¼å®¹ï¼Ÿ</font><a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

å‡è®¾ä½ ç”¨ [**Swift**](https://developer.apple.com/swift/) 5 ç¼–è¯‘äº†ä¸€ä¸ªåŠ¨æ€åº“ï¼š

```swift
public struct Point {
    var x: Int
    var y: Int
}
```

åœ¨ [**Swift**](https://developer.apple.com/swift/) 5 é‡Œï¼Œ`Point` çš„ ABI è§„å®šï¼š

- å†…å­˜å¸ƒå±€ï¼šå…ˆ `x`ï¼Œå† `y`ï¼Œæ¯ä¸ªéƒ½æ˜¯ 8 å­—èŠ‚ â†’ å…± 16 å­—èŠ‚
- è°ƒç”¨æ—¶ï¼Œå‚æ•°æ€ä¹ˆå‹æ ˆï¼Œè¿”å›å€¼æ€ä¹ˆæ”¾å¯„å­˜å™¨

å¦‚æœ [**Swift**](https://developer.apple.com/swift/) 6 çªç„¶å†³å®šæ”¹å¸ƒå±€ï¼Œæ¯”å¦‚ï¼š

```swift
struct Point {
    var y: Int
    var x: Int
}
```

é‚£æ—§ç‰ˆæœ¬ç¼–è¯‘çš„ App åœ¨è¿è¡Œæ—¶å°±ä¼šæŒ‚æ‰ï¼Œå› ä¸ºå®ƒä»¬ä»¥ä¸º `Point` çš„ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ `x`ï¼Œç»“æœæ–°ç‰ˆæœ¬å´æŠŠ `y` æ”¾åœ¨äº†å‰é¢ã€‚

è¿™å°±æ˜¯ **ABI ä¸å…¼å®¹**ã€‚

### 12ã€ğŸ“ƒæ–‡ä»¶ `*.xcuserstate` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> `*.xcworkspace`æ˜¯ç”±`pod install`ç”Ÿæˆ

* å®Œæ•´è·¯å¾„ï¼š`*.xcworkspace`/`xcuserdata`/`mac.xcuserdatad`/<font color=red>`UserInterfaceState.xcuserstate`</font> 

* è®°å½• **Xcode ç•Œé¢çŠ¶æ€**ï¼šæ¯”å¦‚å·¥ç¨‹çª—å£å¤§å°ã€é¢æ¿å¸ƒå±€ã€æ–‡ä»¶å±•å¼€/æŠ˜å çŠ¶æ€ã€å…‰æ ‡ä½ç½®ã€æ–­ç‚¹ä¿¡æ¯ç­‰ã€‚

* å±äº **ç”¨æˆ·æœ¬åœ°ä¸ªæ€§åŒ–é…ç½®**ï¼Œä¸åŒå¼€å‘è€…çš„ `*.xcuserstate` æ–‡ä»¶å†…å®¹ä¸€èˆ¬ä¸åŒã€‚

* ä¸å½±å“ä»£ç é€»è¾‘å’Œå·¥ç¨‹ç¼–è¯‘ï¼Œåªæ˜¯ä¸ºäº†ä¸‹æ¬¡æ‰“å¼€å·¥ç¨‹æ—¶æ¢å¤ä½ ä¸Šæ¬¡çš„ç¼–è¾‘ç¯å¢ƒã€‚

* åŠ å…¥`.gitignore`è¿›è¡Œå¿½ç•¥

  ```
  *.xcuserstate
  ```

* åˆ é™¤`.git`é‡Œé¢å·²ç»å­˜åœ¨çš„`*.xcuserstate`ï¼ˆéœ€è¦æäº¤ï¼‰

  ```shell
  git rm --cached -r *.xcuserstate
  ```

### 13ã€**OC**.`NSString` ğŸ†š [**Swift**](https://developer.apple.com/swift/).`String` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> [**Swift**](https://developer.apple.com/swift/) çš„ `String` å’Œ **OC** çš„ `NSString` æ˜¯ **æ¡¥æ¥ç±»å‹**
>
> ç¼–è¯‘å™¨ä¼šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹è‡ªåŠ¨æ¡¥æ¥ï¼Œä½†ä¸ä¼šåš<u>éšå¼åŒå‘å®Œå…¨è½¬æ¢</u>

#### 13.1ã€**OC**.`NSString` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `NSString` æ˜¯ä¸€ä¸ª **ç±»**ï¼ˆç»§æ‰¿è‡ª `NSObject`ï¼‰
* å±äº **å¼•ç”¨ç±»å‹**ï¼ˆæŒ‡é’ˆè¯­ä¹‰ï¼‰
* `@"abc"` è¿™æ ·çš„å­—ç¬¦ä¸²å­—é¢é‡å…¶å®æ˜¯ä¸€ä¸ª `NSString` å¯¹è±¡
* ä¸å¯å˜ï¼Œä¿®æ”¹ä¼šæ–°å»ºå¯¹è±¡
* æœ‰ `NSMutableString`ï¼Œå¯å˜å­—ç¬¦ä¸²
* å­˜å‚¨æ˜¯ UTF-16 ä¸ºä¸»

#### 13.2ã€[**Swift**](https://developer.apple.com/swift/).`String` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `String` æ˜¯ä¸€ä¸ª **ç»“æ„ä½“**ï¼ˆ`struct`ï¼‰
* å±äº **å€¼ç±»å‹**ï¼ˆæ‹·è´è¯­ä¹‰ï¼Œä½†ç¼–è¯‘å™¨åšäº†å†™æ—¶æ‹·è´ä¼˜åŒ–ï¼‰
* åº•å±‚æ˜¯ `String` + `Substring`ï¼Œå®ç°æ›´ç°ä»£ï¼Œæ”¯æŒ `Unicode Scalar`ã€`Extended Grapheme Cluster`
* æ˜¯å€¼ç±»å‹ï¼Œä½† [**Swift**](https://developer.apple.com/swift/) ä¼˜åŒ–äº† [<font color=red>**C**</font>opy-<font color=red>**O**</font>n-<font color=red>**W**</font>rite](#COW)
* åº•å±‚å­˜å‚¨æ˜¯ UTF-8 ä¼˜å…ˆï¼Œæ›´ç°ä»£ï¼Œæ”¯æŒ Unicode å¤æ‚å­—ç¬¦
* æ¯” `NSString` æ›´é«˜æ•ˆï¼Œå°¤å…¶åœ¨å¤„ç†å¤šè¯­è¨€/**emoji**

#### 13.3ã€äº’è½¬æ–¹æ³• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ```swift
  let ns: NSString = "Hello ObjC"
  let swiftStr: String = ns as String   // æ˜¾å¼è½¬æ¢
  ```

* ```swift
  let swiftStr: String = "Hello Swift"
  let ns: NSString = swiftStr as NSString   // æ˜¾å¼è½¬æ¢
  ```

### 14ã€`A()`å¯èƒ½æ˜¯ï¼š <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å‡½æ•°** â†’ ç›´æ¥æ‰§è¡Œ

  ```swift
  func A() -> String {
      return "xxx"
  }
  ```

* **Class/Struct/Actor** â†’ å®ä¾‹åŒ–ï¼ˆè°ƒç”¨ initï¼‰

  > <font color=red>**Enum**</font> å’Œ <font color=red>**Protocol**</font> **ä¸èƒ½ç›´æ¥ï¼ˆï¼‰**

  * **Class**

    ```swift
    class A {
        init() {
            print("A init")
        }
    }
    ```

  * **Struct**

    ```
    struct A {
        var name: String = "default"
    }
    ```

  * **Actor** ([**Swift**](https://developer.apple.com/swift/) å¹¶å‘é‡Œçš„ç±»å‹)

    ```
    actor A {
        init() {
            print("actor created")
        }
    }
    ```

* **é—­åŒ…å˜é‡** â†’ è°ƒç”¨é—­åŒ…

  ```swift
  let A: () -> String = {
      return "xxx"
  }
  ```

* **æšä¸¾ case** â†’ å·¥å‚æ–¹æ³•

  ```swift
  enum MyEnum {
      case A(Int)
  }
  ```

### 15ã€<font id=ActorğŸ†šClass>[**Swift**](https://developer.apple.com/swift/).**Actor** ğŸ†š [**Swift**](https://developer.apple.com/swift/).**Class**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§     | class            | actor                        |
| -------- | ---------------- | ---------------------------- |
| ç±»å‹     | å¼•ç”¨ç±»å‹         | å¼•ç”¨ç±»å‹                     |
| å†…å­˜å…±äº« | å¤šçº¿ç¨‹å¯åŒæ—¶è®¿é—® | å—ä¿æŠ¤ï¼Œåªèƒ½å•çº¿ç¨‹è®¿é—®       |
| å¹¶å‘å®‰å…¨ | æ‰‹åŠ¨åŠ é”         | ç¼–è¯‘å™¨/è¿è¡Œæ—¶è‡ªåŠ¨ä¿è¯        |
| è°ƒç”¨æ–¹æ³• | ç›´æ¥è°ƒç”¨         | `await` è°ƒç”¨ï¼ˆå¼‚æ­¥å®‰å…¨è¾¹ç•Œï¼‰ |

### 16ã€[**Objc**.`id`](#ID) ğŸ†š [**Swift**](https://developer.apple.com/swift/).[**`AnyObject`**](#AnyObject) ğŸ†š [**Swift**](https://developer.apple.com/swift/).[**`Any`**](#Any) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font id=ID>**Objc**.`id`</font>

  > ```objective-c
  > id obj = @"Hello";   // NSString
  > obj = @123;          // NSNumber
  > obj = [UIView new];  // UIView
  > ```

  * * **å«ä¹‰**ï¼š
      `id` è¡¨ç¤ºã€ŒæŸä¸ª **Objcå¯¹è±¡å®ä¾‹**ã€ï¼Œä¸è¦æ±‚å£°æ˜å…·ä½“ç±»å‹

    * **ç‰¹æ€§**ï¼š

      - åŠ¨æ€ç»‘å®šï¼ˆè¿è¡Œæ—¶å†³å®šçœŸæ­£ç±»å‹ï¼‰
      - ç¼–è¯‘å™¨ä¸åšä¸¥æ ¼æ£€æŸ¥ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ï¼Œæ˜¯å¦èƒ½æ‰§è¡Œå–å†³äºè¿è¡Œæ—¶
      - åªèƒ½å­˜æ”¾ **Objc å¯¹è±¡**ï¼ˆç»§æ‰¿è‡ª `NSObject` çš„ç±»ï¼‰ï¼Œ**ä¸èƒ½å­˜æ”¾å€¼ç±»å‹**ï¼ˆæ¯”å¦‚ `int`ã€`struct`ï¼‰
      - åœ¨ [**Swift**](https://developer.apple.com/swift/) æ··ç¼–æ—¶ä¼šè‡ªåŠ¨æ¡¥æ¥æˆ `AnyObject`

     * **é£é™©**ï¼š

       ```objective-c
       [obj length];  // å¦‚æœ obj æ˜¯ NSString âœ…
                      // å¦‚æœ obj æ˜¯ UIView âŒ -> crash: unrecognized selector 
       ```

* <font id=AnyObject>**[Swift](https://developer.apple.com/swift/).`AnyObject`**</font>

  > ğŸ‘‰ å¯ä»¥ç†è§£ä¸ºï¼š**`AnyObject â‰ˆ Swift é‡Œçš„å®‰å…¨ç‰ˆ id`**
  >
  > ```swift
  > var obj: AnyObject = "Hello" as NSString
  > obj = NSNumber(value: 123)
  > obj = UIView()
  > ```

  * **å«ä¹‰**ï¼š
      `AnyObject` è¡¨ç¤ºã€Œä»»æ„ç±»å¯¹è±¡ã€ï¼Œå®ƒæ˜¯ [**Swift**](https://developer.apple.com/swift/) ä¸–ç•Œé‡Œå¯¹æ ‡ `id` çš„å…³é”®å­—ã€‚

  * **ç‰¹æ€§**ï¼š

     - åªèƒ½è¡¨ç¤º **class ç±»å‹**ï¼Œä¸èƒ½å­˜æ”¾ **struct**/**enum** ç­‰å€¼ç±»å‹ã€‚

     - å±äºé™æ€ç±»å‹ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæ”¯æŒ `is`ã€`as?` ç­‰å®‰å…¨æ£€æŸ¥ï¼š

       ```swift
       if let str = obj as? NSString {
           print(str.length)
       }
       ```

     - éµå¾ª **æ›´å®‰å…¨çš„ç±»å‹æ£€æŸ¥**ï¼Œä¸ä¼šåƒ `id` é‚£æ ·ä»»ä½ ä¹±è°ƒæ–¹æ³•ç›´æ¥å´©ã€‚

* <font id=Any>**[Swift](https://developer.apple.com/swift/).`Any`**</font>

  > ```swift
  > var x: Any = "Hello"   // String
  > x = 123                // Int
  > x = UIView()           // UIView
  > ```

  * **å«ä¹‰**ï¼š
     `Any` è¡¨ç¤ºã€Œä»»ä½•ç±»å‹ã€ï¼Œæ¯” `AnyObject` å’Œ `id` éƒ½æ›´å¹¿ã€‚
  
  * **ç‰¹æ€§**ï¼š
  
    - å¯ä»¥å­˜ **ç±»å¯¹è±¡**ã€**å€¼ç±»å‹**ã€**enum**ã€**struct**ã€ç”šè‡³å‡½æ•°ã€‚
  
    - [**Swift**](https://developer.apple.com/swift/) æŠŠæ‰€æœ‰ç±»å‹éƒ½èƒ½è£…è¿›å»ï¼Œä½†å–å‡ºæ¥æ—¶å¿…é¡»æ‰‹åŠ¨è½¬æ¢ï¼š
  
      ```
      let a: Any = 42
      if let num = a as? Int {
          print(num + 1)  // âœ… 43
      }
      ```
  
    - å¸¸ç”¨äº **æ··åˆæ•°æ®å®¹å™¨**ï¼ˆæ¯”å¦‚ `[String: Any]` çš„ **JSON** å­—å…¸ï¼‰ã€‚

### 17ã€è¿ç»­æ‰“åŒ…ï¼ˆä¸ä¿®æ”¹ä»£ç ï¼‰äº§ç‰©Hashä¸ä¸€æ · <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| åœºæ™¯                                   | æ˜¯å¦å¯èƒ½ hash ç›¸åŒ | è¯´æ˜                    |
| -------------------------------------- | ------------------ | ----------------------- |
| iOS Xcode ä¸¤æ¬¡ Archive                 | âŒ å‡ ä¹ä¸å¯èƒ½       | codesign å«æ—¶é—´æˆ³       |
| Android ä¸¤æ¬¡ Gradle æ„å»º               | âŒ é»˜è®¤ä¸åŒ         | zip entryã€ç­¾åæ—¶é—´ä¸åŒ |
| Flutter build apk/ipa                  | âŒ é»˜è®¤ä¸åŒ         | æ‰“åŒ…åµŒå…¥æ—¶é—´/éšæœº key   |
| å…¨éƒ¨ä½¿ç”¨ reproducible æ„å»ºï¼ˆå†»ç»“æ—¶é’Ÿï¼‰ | âœ… ç†è®ºå¯è¡Œ         | éœ€æç«¯æ§åˆ¶              |

### 18ã€æ¡¥æ¥è§†å›¾ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> UIKit æ¡†æ¶åœ¨ [**Swift**](https://developer.apple.com/swift/) å’Œ**Objc** æ··åˆæ¼”è¿›ä¸­çš„<u>è¯­è¨€æ˜ å°„æœºåˆ¶</u>é—®é¢˜

#### 18.1ã€æ–‡ä»¶è·¯å¾„ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> `arm64.swiftinterface`
> `arm64e.swiftinterface`
> `x86_64.swiftinterface`

```url
Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/System/Library/Frameworks/UIKit.framework/Modules/UIKit.swiftmodule/
```

#### 18.2ã€ä»‹ç» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ˜¯ç”± **Clang importer è‡ªåŠ¨ç”Ÿæˆçš„æ¡¥æ¥è§†å›¾**ï¼Œå¹¶ä¸æ˜¯AppleçœŸæ­£å†™çš„ï¼›
* å¹¶ä¸æ˜¯æ¯ä¸ªç±»éƒ½ç”Ÿæˆå¯¹åº” `.swift` æºç ï¼›åœ¨æŸäº› API ä¸Šä½ ç‚¹è¿›å»æ—¶ï¼ŒXcode ä¼šç›´æ¥è·³è½¬åˆ° `.h`
* å½“ [**Swift**](https://developer.apple.com/swift/) æ¥å£æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼ŒXcode ä¼šè‡ªåŠ¨è·³åˆ°åŸå§‹çš„ **Objc** `*.h` æ–‡ä»¶ã€‚

### 19ã€**`UIButton`**çš„é…ç½®å†²çªé—®é¢˜ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç°è±¡           | åŸå›                                                        | è§£å†³æ–¹æ¡ˆ                                              |
| -------------- | ---------------------------------------------------------- | ----------------------------------------------------- |
| æŒ‰é’®æ–‡å­—æ¶ˆå¤±   | åŒæ—¶ setTitle â• ä½¿ç”¨  **`UIButtonConfiguration`**.title    | æ”¹ä¸ºåªç”¨å…¶ä¸­ä¸€ç§                                      |
| æ ‡é¢˜é¢œè‰²ä¸ç”Ÿæ•ˆ | **`UIButtonConfiguration`** ç®¡ç†é¢œè‰²ï¼ŒsetTitleColor è¢«å¿½ç•¥ | ç”¨ `configurationUpdateHandler` è®¾ç½®                  |
| å­—ä½“å¤±æ•ˆ       | titleLabel?.font æ— æ•ˆ                                      | éœ€æ”¹ä¸º `configuration.titleTextAttributesTransformer` |
| æŒ‰é’®å°ºå¯¸å˜å¤§   | **`UIButtonConfiguration`** è‡ªå¸¦ contentInsets             | æ‰‹åŠ¨è°ƒæ•´ `configuration.contentInsets`                |

* åœ¨ iOS 15+ å¼•å…¥  **`UIButtonConfiguration`** ä½“ç³»åï¼Œä¸€æ—¦æŸä¸ªæŒ‰é’®å¯ç”¨äº†å®ƒï¼ˆä¾‹å¦‚è®¾ç½®äº† `button.configuration = .filled()`ï¼‰ï¼ŒUIKit å†…éƒ¨çš„ç»˜åˆ¶å’ŒçŠ¶æ€ç®¡ç†æœºåˆ¶å°±ä¼š**åˆ‡æ¢åˆ°æ–°çš„æ¸²æŸ“ç®¡çº¿**ã€‚è€Œè€å¼å†™æ³•ï¼ˆç›´æ¥æ“ä½œ `setTitle(_:for:)`ã€`setTitleColor(_:for:)`ã€`setImage(_:for:)`ã€`titleLabel?.font` ç­‰ï¼‰ä¼šå‡ºç°å¼‚å¸¸æˆ–å¤±æ•ˆç°è±¡
*  **`UIButtonConfiguration`**ä¸€æ—¦å¯ç”¨ï¼Œå°±æ¥ç®¡äº†ä¼ ç»Ÿçš„å¤–è§‚ç®¡ç†
* å¦‚æœå°è£…é“¾å¼é€»è¾‘æ²¡æœ‰åŒºåˆ†æ–°æ—§ä½“ç³»ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªæŒ‰é’®å¯ç”¨äº† **`UIButtonConfiguration`**ï¼Œæ—§é€»è¾‘å°±ä¼šå¼‚å¸¸

### 20ã€[**Swift**](https://developer.apple.com/swift/).<font color=red>**`class`**</font> ğŸ†š [**Swift**](https://developer.apple.com/swift/) .<font color=red>**`enum`**</font> ğŸ†š [**Swift**](https://developer.apple.com/swift/) .<font color=red>**`struct`**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ğŸ§© <font color=red>**`enum`**</font> â€”â€” çŠ¶æ€ / å¸¸é‡å‘½åç©ºé—´
>
> ğŸ“¦ <font color=red>**`struct`**</font> â€”â€” æ•°æ®å°è£… / å€¼å®‰å…¨
>
> ğŸ§  <font color=red>**`class`**</font> â€”â€” ç”Ÿå‘½å‘¨æœŸ / ç»§æ‰¿ / åŠ¨æ€ç»‘å®š

#### 20.1ã€æ ¸å¿ƒè¯­ä¹‰å·®å¼‚ï¼ˆå€¼ç±»å‹ ğŸ†š å¼•ç”¨ç±»å‹ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§         | <font color=red>**`enum`**</font> | <font color=red>**`struct`**</font> | <font color=red>**`class`**</font> |
| ------------ | --------------------------------- | ----------------------------------- | ---------------------------------- |
| **ç±»å‹è¯­ä¹‰** | å€¼ç±»å‹                            | å€¼ç±»å‹                              | å¼•ç”¨ç±»å‹                           |
| **å†…å­˜è¯­ä¹‰** | æ‹·è´ï¼ˆcopyï¼‰                      | æ‹·è´ï¼ˆcopyï¼‰                        | å¼•ç”¨ï¼ˆreferenceï¼‰                  |
| **èµ‹å€¼è¡Œä¸º** | å¤åˆ¶ä¸€ä»½                          | å¤åˆ¶ä¸€ä»½                            | æŒ‡é’ˆæŒ‡å‘åŒä¸€å®ä¾‹                   |
| **çº¿ç¨‹å®‰å…¨** | âœ… è¾ƒå®‰å…¨ï¼ˆç‹¬ç«‹å€¼ï¼‰                | âœ… è¾ƒå®‰å…¨                            | âš ï¸ ä¸å®‰å…¨ï¼ˆå…±äº«å¼•ç”¨ï¼‰               |

#### 20.2ã€è¯­è¨€ç‰¹æ€§å¯¹æ¯”è¡¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§                        | <font color=red>**`enum`**</font> | <font color=red>**`struct`**</font>                 | <font color=red>**`class`**</font> |
| --------------------------- | --------------------------------- | --------------------------------------------------- | ---------------------------------- |
| æ˜¯å¦æ”¯æŒç»§æ‰¿                | âŒ                                 | âŒ                                                   | âœ…                                  |
| æ˜¯å¦æ”¯æŒåè®®                | âœ…                                 | âœ…                                                   | âœ…                                  |
| å¯å®šä¹‰æ–¹æ³•                  | âœ…                                 | âœ…                                                   | âœ…                                  |
| å¯å®šä¹‰å±æ€§                  | âœ…ï¼ˆéœ€å…³è”å€¼ï¼‰                     | âœ…                                                   | âœ…                                  |
| æ˜¯å¦æ”¯æŒå­˜å‚¨å±æ€§            | âœ…ï¼ˆä»…åœ¨å…³è”å€¼ä¸­ï¼‰                 | âœ…                                                   | âœ…                                  |
| å¯å®šä¹‰åˆå§‹åŒ–æ–¹æ³•            | âœ…                                 | âœ…                                                   | âœ…                                  |
| è‡ªå®šä¹‰ `init()`             | âœ…                                 | âœ…                                                   | âœ…                                  |
| `mutating` æ–¹æ³•             | âœ…ï¼ˆæ”¹å˜è‡ªèº« case æ—¶ï¼‰             | âœ…                                                   | âŒï¼ˆç›´æ¥æ”¹ï¼‰                        |
| `deinit` ææ„å‡½æ•°           | âŒï¼ˆå€¼ç±»å‹å‡ºä½œç”¨åŸŸç›´æ¥é”€æ¯ï¼‰       | âŒï¼ˆå€¼ç±»å‹å‡ºä½œç”¨åŸŸç›´æ¥é”€æ¯ï¼‰                         | âœ…                                  |
| ARC ç®¡ç†                    | âŒ                                 | âŒ                                                   | âœ…                                  |
| å¯ç”¨ä½œå¸¸é‡ç©ºé—´              | âœ…ï¼ˆé»˜è®¤ä¸å¯å®ä¾‹åŒ–ï¼‰               | âœ…ï¼ˆéœ€ <font color=red>**`private`**</font> `init`ï¼‰ | âš ï¸ å¯ï¼Œä½†è¿‡é‡                       |
| Equatable/Hashable è‡ªåŠ¨åˆæˆ | âœ…                                 | âœ…                                                   | âš ï¸ éœ€è‡ªå†™                           |
| å¯è¢«æ¨¡å¼åŒ¹é…ï¼ˆswitchï¼‰      | âœ…                                 | âš ï¸ é™åˆ¶                                              | âŒ                                  |
| æ˜¯å¦æ”¯æŒæ³›å‹                | âœ…                                 | âœ…                                                   | âœ…                                  |
| æ˜¯å¦æ”¯æŒæ‰©å±•ï¼ˆextensionï¼‰   | âœ…                                 | âœ…                                                   | âœ…                                  |

#### 20.3ã€ç”Ÿå‘½å‘¨æœŸä¸å†…å­˜æ¨¡å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| æ–¹é¢       | å€¼ç±»å‹ï¼ˆ<font color=red>**`enum`**</font>/<font color=red>**`struct`**</font>ï¼‰ | å¼•ç”¨ç±»å‹ï¼ˆ<font color=red>**`class`**</font>ï¼‰ |
| ---------- | ------------------------------------------------------------ | ---------------------------------------------- |
| ç”Ÿå‘½å‘¨æœŸ   | è‡ªåŠ¨å›æ”¶ï¼ˆæ ˆï¼‰                                               | **ARC** å¼•ç”¨è®¡æ•°ï¼ˆå †ï¼‰                         |
| æ‰€åœ¨å†…å­˜   | æ ˆä¸Š                                                         | å †ä¸Š                                           |
| æ‹·è´ä»£ä»·   | ä½ï¼ˆå°å¯¹è±¡å†…è”ï¼‰                                             | ä½ï¼ˆæ‹·æŒ‡é’ˆï¼‰                                   |
| è·¨çº¿ç¨‹å…±äº« | å®‰å…¨ï¼ˆå€¼éš”ç¦»ï¼‰                                               | å±é™©ï¼ˆéœ€åŒæ­¥ï¼‰                                 |

#### 20.4ã€ä½¿ç”¨åœºæ™¯å»ºè®® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| åœºæ™¯                       | æ¨èç±»å‹                              | åŸå›                                            |
| -------------------------- | ------------------------------------- | ---------------------------------------------- |
| åªå®šä¹‰å¸¸é‡ã€å‘½åç©ºé—´       | âœ… <font color=red>**`enum`**</font>   | é»˜è®¤ä¸èƒ½å®ä¾‹åŒ–ï¼Œå®‰å…¨                           |
| ç®€å•æ•°æ®æ¨¡å‹ï¼ˆDTOã€Stateï¼‰ | âœ… <font color=red>**`struct`**</font> | å€¼è¯­ä¹‰ï¼Œçº¿ç¨‹å®‰å…¨                               |
| æ•°æ®å…±äº«ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†     | âœ… <font color=red>**`class`**</font>  | å¼•ç”¨è¯­ä¹‰ï¼Œå¯æŒä¹…åŒ–                             |
| UI æ§åˆ¶å™¨ã€è§†å›¾ã€å“åº”é“¾    | âœ… <font color=red>**`class`**</font>  | å¿…é¡»ç»§æ‰¿ **UIKit** / **AppKit**                |
| æšä¸¾çŠ¶æ€æœºã€åˆ†æ”¯åˆ¤æ–­       | âœ… <font color=red>**`enum`**</font>   | æ¨¡å¼åŒ¹é…æœ€ä¼˜é›…                                 |
| å·¥å…·å‡½æ•°ã€é™æ€å¸¸é‡ç»„       | âœ… <font color=red>**`enum`**</font>   | æ— éœ€ `init()`                                  |
| æ•°æ®å®¹å™¨ï¼ˆå«æ–¹æ³•ï¼‰         | âœ… <font color=red>**`struct`**</font> | é€»è¾‘+æ•°æ®å°è£…                                  |
| å¯¹è±¡å›¾å¤æ‚ã€æœ‰ç»§æ‰¿         | âœ… <font color=red>**`class`**</font>  | éœ€å¤šæ€ã€å¼•ç”¨å…±äº«                               |
| ç”Ÿå‘½å‘¨æœŸéœ€è¦ `deinit`      | âœ… <font color=red>**`class`**</font>  | ä»… <font color=red>**`class`**</font> æ”¯æŒææ„ |

#### 20.5ã€å®æˆ˜è®¾è®¡å»ºè®® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å·¥å…·å¸¸é‡ç±»

  > <font color=red>**`enum` é»˜è®¤ç¦æ­¢å®ä¾‹åŒ–ï¼Œæ¯” `class` æ›´å®‰å…¨**</font>

  ```swift
  enum JobsColors {
      static let main = UIColor(named: "MainColor")!
  }
  ```

* çº¯æ•°æ®æ¨¡å‹

  > å€¼è¯­ä¹‰ï¼Œä¼ é€’å®‰å…¨ï¼Œä¸ä¼šæ„å¤–ä¿®æ”¹ã€‚

  ```swift
  struct User {
      let id: Int
      var name: String
  }
  ```

* æ§åˆ¶å™¨ç±»ã€æœåŠ¡ç±»

  > å¼•ç”¨è¯­ä¹‰ï¼Œä¾¿äºå…¨å±€å…±äº«ã€‚

  ```swift
  class UserManager {
      var currentUser: User?
      func login() {}
  }
  ```

*  æšä¸¾çŠ¶æ€æœº

  > æ¨¡å¼åŒ¹é…æç®€ä¼˜é›…ã€‚

  ```swift
  enum NetworkState {
      case idle
      case loading
      case success(Data)
      case failure(Error)
  }
  ```

#### 20.6ã€ä»å·¥ç¨‹ç»´åº¦æ€»ç»“ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç»´åº¦                             | æ¨èé€‰æ‹©                                                 |
| -------------------------------- | -------------------------------------------------------- |
| **è½»é‡çº§æ•°æ®æ¨¡å‹**               | <font color=red>**`struct`**</font>                      |
| **çŠ¶æ€æœº / åˆ†æ”¯é€»è¾‘**            | <font color=red>**`enum`**</font>                        |
| **å¸¦ç”Ÿå‘½å‘¨æœŸ / ç»§æ‰¿ / åŠ¨æ€è¡Œä¸º** | <font color=red>**`class`**</font>                       |
| **å·¥å…·åº“ / å¸¸é‡å®šä¹‰**            | <font color=red>**`enum`**</font>ï¼ˆ**ç¦æ­¢å®ä¾‹åŒ–**ï¼‰      |
| **å¯å˜å®¹å™¨ä½†å¸Œæœ›æ‹·è´éš”ç¦»**       | <font color=red>**`struct`**</font> + `mutating`         |
| **å…¨å±€å•ä¾‹æˆ–å¼•ç”¨å…±äº«**           | <font color=red>**`class`**</font> + `static let shared` |

### 21ã€**`DispatchQueue.main.async`** ğŸ†š [<font color=red>**`@MainActor`**</font>](#@MainActor) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 21.1ã€æ ¸å¿ƒå¯¹æ¯” <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **`DispatchQueue.main.async`**
  * æœ¬è´¨ï¼š**GCD** æŠŠé—­åŒ…**å¼‚æ­¥å…¥é˜Ÿ**åˆ°ä¸»é˜Ÿåˆ—@[**å›è°ƒä¸»çº¿ç¨‹**](#å›è°ƒä¸»çº¿ç¨‹)
  * ä½œç”¨ï¼šä¿è¯**ç¨å**åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼ˆé€šå¸¸æ˜¯**å½“å‰è°ƒç”¨è¿”å›ä¹‹å**ï¼Œå¤šåŠæ˜¯ä¸‹ä¸€è½® runloopï¼›<font color=red>**ä¸æ˜¯ç«‹åˆ»**</font>ï¼‰
  * ç”¨é€”ï¼šä»åå°åˆ‡å› UI çº¿ç¨‹ï¼›**åˆ»æ„â€œä¸‹ä¸€å¸§å†åšâ€**ï¼›æŠŠé‡æ´»æ‹†å‡ºå»é¿å…é˜»å¡å½“å‰è°ƒç”¨
  * è¯­ä¹‰ï¼š**æ—¶åº**ï¼ˆwhenï¼‰ï¼Œä¸æä¾›ç¼–è¯‘å™¨éš”ç¦»æ£€æŸ¥

*  [<font color=red>**`@MainActor`**</font>](#@MainActor) 

  > ```swift
  > /// è¿™ä¸ªå‡½æ•°å¿…é¡»åœ¨ä¸»çº¿ç¨‹è¿è¡Œ
  > /// ä¸»çº¿ç¨‹éš”ç¦»çš„å£°æ˜
  > @MainActor
  > func updateUI() {
  >     // UI æ›´æ–°
  > }
  > ```

  * æœ¬è´¨ï¼š[**Swift**](https://developer.apple.com/swift/).**Concurrency** çš„**Actor éš”ç¦»**ï¼ŒæŠŠå‡½æ•°/å±æ€§/ç±»å‹ç»‘å®šåˆ°â€œä¸» Actorâ€ï¼ˆ= ä¸»çº¿ç¨‹æ‰§è¡Œå™¨ï¼‰
  * ä½œç”¨ï¼šç¼–è¯‘å™¨/è¿è¡Œæ—¶**å¼ºåˆ¶**åœ¨ä¸»çº¿ç¨‹ä¸Šè®¿é—®ï¼›ä»éä¸» Actor è°ƒç”¨ä¼š**hop**åˆ°ä¸» Actorï¼ˆéœ€è¦ `await` æˆ–å¼‚æ­¥è°ƒåº¦ï¼‰
  * ç”¨é€”ï¼šå£°æ˜â€œè¿™ç©æ„å„¿å¿…é¡»åœ¨ä¸»çº¿ç¨‹ç”¨â€ï¼ˆUI ç±»å‹/æ–¹æ³•ï¼ŒçŠ¶æ€å®¹å™¨ç­‰ï¼‰
  * è¯­ä¹‰ï¼š**å½’å±**ï¼ˆwhere/which executorï¼‰ï¼Œä¸æ‰¿è¯ºâ€œä¸‹ä¸€å¸§â€ï¼Œå¯èƒ½**ç«‹åˆ»**åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
  
* | ç‚¹                          | `@MainActor`                   | `DispatchQueue.main.async` |
  | --------------------------- | ------------------------------ | -------------------------- |
  | æ˜¯å¦é™æ€æ£€æŸ¥                | âœ… æœ‰ï¼Œç¼–è¯‘æœŸå°±æ‹¦               | âŒ å®Œå…¨é ä½ è‡ªè§‰             |
  | æ˜¯å¦è¡¨è¾¾æ•°æ®éš”ç¦»            | âœ… æ˜¯ actor éš”ç¦»åŸŸçš„ä¸€éƒ¨åˆ†      | âŒ åªæ˜¯é˜Ÿåˆ—è°ƒåº¦             |
  | æ˜¯å¦å’Œ async/await æ·±åº¦æ•´åˆ | âœ… æœ‰ï¼Œè‡ªåŠ¨ hopã€éœ€è¦ `await`   | âŒ åªæ˜¯é—­åŒ…å›è°ƒ             |
  | æ˜¯å¦å¯ä»¥æ ‡è®°ç±»å‹ / å±æ€§     | âœ… å¯ä»¥ï¼ˆæ•´ç±»ã€å±æ€§ã€å…¨å±€å˜é‡ï¼‰ | âŒ ä¸è¡Œ                     |

#### 21.2ã€ç»„åˆå…³ç³» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* åœ¨ä¸»çº¿ç¨‹é‡Œè°ƒç”¨ <font color=red>**@MainActor**</font>çš„**åŒæ­¥**å‡½æ•°ï¼š**ç«‹å³**è¿è¡Œï¼ˆæ²¡æœ‰â€œä¸‹ä¸€å¸§â€ä¸€è¯´ï¼‰
* åœ¨ä¸»çº¿ç¨‹é‡Œ **`DispatchQueue.main.async`**ï¼š**æ’é˜Ÿ**åˆ°å½“å‰è°ƒç”¨è¿”å›ä¹‹åå†è·‘ï¼ˆé€šå¸¸ä¸‹ä¸€è½® runloopï¼‰
* æƒ³æ—¢ä¿è¯**åœ¨ä¸»çº¿ç¨‹**ï¼Œåˆæƒ³**ä¸‹ä¸€å¸§å†åš**ï¼š**ç”¨ `DispatchQueue.main.async`ï¼ˆæˆ– `Task { @MainActor in â€¦ }`ï¼‰**ï¼Œä¸¤è€…éƒ½ä¼š**å¼‚æ­¥æ’é˜Ÿ + ä¸»çº¿ç¨‹**

#### 21.3ã€å…¸å‹å†™æ³•å¯¹ç…§ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 22ã€æ™®é€šå­—ç¬¦ä¸²ï¼ˆå¤§é‡è½¬ä¹‰ï¼‰ğŸ†š åŸå§‹å­—ç¬¦ä¸²ï¼ˆä¸€çœ¼çœ‹æ‡‚ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å•è¡Œ

  ```swift
  // æ™®é€šå•è¡Œ
  let a = "line1\nline2"        // æœ‰æ¢è¡Œ
  let b = "He said: \"Hi\""     // å¼•å·è¦è½¬ä¹‰
  
  // åŸå§‹å•è¡Œ
  let r1 = #"C:\Users\name\Desktop"#
  let r2 = #"{"user":"\u5f20\u4e09","ok":true}"#  // \u ä¸ä¼šè¢«è¿˜åŸ
  ```

* å¤šè¡Œ

  ```swift
  // æ™®é€šå¤šè¡Œ
  let c = """
  {
    "k": "v"
  }
  """
  
  // åŸå§‹å¤šè¡Œ
  let r3 = #"""
  {
    "regex": "\\d+",
    "path": "C:\\Users\\name"
  }
  """#
  ```

* åŸå§‹å­—ç¬¦ä¸²é‡Œçš„æ’å€¼ï¼ˆæ³¨æ„ #ï¼‰

  ```swift
  let r4 = #"user id: \#(id)"#   // è¾“å‡º "user id: 42"
  ```

* // å½“å†…å®¹é‡Œå‡ºç° `"#`ï¼Œå°±å¤šåŠ  #

  ```swift
  let tricky = ##"åŒ…å« "# å· ä¸ \#(æ’å€¼) çš„åŸæ–‡"##
  let ok     = ##"çœŸçš„æ’å€¼ï¼š\##(id)"##  // ä¸¤ä¸ª #ï¼Œæ’å€¼ä¹Ÿç”¨ä¸¤ # åŒ¹é…
  ```

### 23ã€â›‘ï¸ <font id=é¿å…å¾ªç¯å¼•ç”¨>`[weak self]` ğŸ†š `[unowned self]`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **é¿å…å¾ªç¯å¼•ç”¨ï¼ˆå¼ºæŒæœ‰ï¼‰**ï¼šåœ¨ [**Swift**](https://developer.apple.com/swift/)  é‡Œï¼Œ<font color=red>**é—­åŒ…ï¼ˆblockï¼‰é»˜è®¤ä¼šå¼ºå¼•ç”¨ `self`**</font>ã€‚å¦‚æœé—­åŒ…è¢« `self` æŒæœ‰ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨

| å†™æ³•             | ç‰¹ç‚¹                                                         |
| ---------------- | ------------------------------------------------------------ |
| `[weak self]`    | å®‰å…¨ï¼Œä¸ä¼šå´©æºƒï¼›éœ€è¦è§£åŒ…ï¼›æ¨èå¸¸ç”¨                           |
| `[unowned self]` | æ›´ç®€æ´ï¼Œä½†ä¸å®‰å…¨ï¼›é€‚ç”¨äºç”Ÿå‘½å‘¨æœŸæœ‰ä¿è¯çš„æƒ…å†µ<br>`unowned` ä¸éœ€è¦å¯é€‰è§£åŒ…ï¼Œæ¯” `weak` å¿«ä¸€ç‚¹ï¼ˆä¸€èˆ¬å¿½ç•¥ä¸è®¡ï¼‰ |

```mermaid
flowchart TD
  A["æ˜¯å¦åœ¨é—­åŒ…ä¸­æ•è· self"] -->|å¦| Z["ä¸ç”¨å¤„ç†"]
  A -->|æ˜¯| B{"é—­åŒ…ä¸ self çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»"}

  B -->|å¯èƒ½æ›´é•¿| C["ç”¨ weak selfå®‰å…¨ï¼Œä¸ä¼šå´©æºƒ"]
  B -->|ä¸æ›´é•¿| D["ç”¨ unowned selféœ€ç¡®ä¿å­˜åœ¨"]

  C --> E{"é—­åŒ…å†…æ˜¯å¦é¢‘ç¹ä½¿ç”¨ self"}
  D --> E

  E -->|éœ€è¦| F["guard let self = self else returnå¼ºå¼•ç”¨åå†ç”¨"]
  E -->|ä¸éœ€è¦| G["self?.method()å¯é€‰é“¾è°ƒç”¨"]

  C --> H["åœºæ™¯: ç½‘ç»œè¯·æ±‚ / GCD / è®¡æ—¶å™¨"]
  D --> I["åœºæ™¯: åˆå§‹åŒ–é—­åŒ… / UIView.animate"]
```

* `self` å¼±å¼•ç”¨

  ğŸ‘‰[**å¼±å¼•ç”¨çš„ç­‰ä»·å†™æ³•**](#å¼±å¼•ç”¨çš„ç­‰ä»·å†™æ³•)

  ```swift
  /// [weak self]ï¼šåœ¨é—­åŒ…ä¸­æ•è· self çš„å¼±å¼•ç”¨ï¼Œä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚
  /// guard let `self` = self else { return }ï¼šè§£åŒ… selfï¼Œå¦‚æœå¯¹è±¡å·²é‡Šæ”¾åˆ™ç›´æ¥é€€å‡ºé—­åŒ…ã€‚
  /// é—­åŒ…å†…éƒ¨å†ç”¨ selfï¼Œå°±æ˜¯è§£åŒ…ä¹‹åçš„å¼ºå¼•ç”¨äº†ï¼Œé¿å…äº† retain cycleã€‚
  someAsyncOperation { [weak self] in
      guard let `self` = self else { return }// å›ºå®šå†™æ³•ï¼ˆæ¨èï¼‰è¯­ä¹‰æ¸…æ™°
      self.doSomething()// æˆ–è€… self?.doSomething()
  }
  ```

* `self` æ— ä¸»å¼•ç”¨ï¼ˆæœ‰æ—¶ `self` çš„ç”Ÿå‘½å‘¨æœŸä¿è¯æ¯”é—­åŒ…é•¿ï¼Œå¯ä»¥ç”¨ `[unowned self]`ï¼‰

  > âŒ ä¸è¦æ»¥ç”¨ `[unowned self]`ï¼Œä¸€æ—¦ç”Ÿå‘½å‘¨æœŸåˆ¤æ–­é”™äº†ï¼Œä¼š **ç›´æ¥å´©æºƒ**ã€‚

  ```swift
  /// unowned ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œä¹Ÿä¸éœ€è¦è§£åŒ…ã€‚
  /// ä½†å¦‚æœ self å·²ç»é‡Šæ”¾ï¼Œå†è°ƒç”¨å°±ä¼š é‡æŒ‡é’ˆå´©æºƒã€‚
  someAsyncOperation { [unowned self] in
      self.doSomething()
  }
  ```

### 24ã€ä¸ºä»€ä¹ˆåœ¨[**Masonry**](https://github.com/SnapKit/Masonry)/[**SnapKit**](https://github.com/SnapKit/SnapKit)é‡Œé¢å¯ä»¥ä¸ç”¨**weak**åŒ–çš„`self`â“<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å› ä¸º [**Masonry**](https://github.com/SnapKit/Masonry)/[**SnapKit**](https://github.com/SnapKit/SnapKit) çš„çº¦æŸé—­åŒ…æ˜¯**åŒæ­¥æ‰§è¡Œã€ä¸ä¼šè¢«ä¿å­˜ï¼ˆéé€ƒé€¸é—­åŒ…ï¼‰**çš„

  > `mas_makeConstraints:` çš„å®ç°æœ¬è´¨ä¸Šå°±æ˜¯ï¼šåˆ›å»ºä¸€ä¸ª `MASConstraintMaker`ï¼Œ**ç«‹åˆ»**è°ƒç”¨ä½ ä¼ è¿›æ¥çš„ **block**ï¼Œç„¶åå®‰è£…çº¦æŸï¼Œæ•´ä¸ªè¿‡ç¨‹å½“åœºç»“æŸï¼Œä¸ä¼šæŠŠ **block** å­˜åˆ°ä»»ä½•è¢« `self` æŒæœ‰çš„åœ°æ–¹ï¼Œè‡ªç„¶ä¹Ÿå°±**ä¸ä¼šå½¢æˆ self â†”ï¸ block çš„å¾ªç¯å¼•ç”¨**ã€‚

* åªæœ‰å½“**é—­åŒ…ä¼šè¢«ä¿å­˜/é€ƒé€¸**æ—¶æ‰éœ€è¦ `weak self`ï¼Œä¾‹å¦‚ï¼š

  - æŠŠ **block** å­˜æˆ `self.someBlock = ^{ ... self ... };`ï¼ˆå…¸å‹å¾ªç¯å¼•ç”¨ï¼‰
  - ä¼ ç»™ä¼šæŠŠ **block** ä¿å­˜åœ¨å±æ€§é‡Œçš„å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡åˆè¢« `self` å¼ºæŒæœ‰

### 25ã€**Objc**.å­—å…¸ ğŸ†š [**Swift**](https://developer.apple.com/swift/).å­—å…¸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Objc**.å­—å…¸`NSDictionary<id<NSCopying>, id> *dict;`

  * Keyï¼šå¯¹è±¡ç±»å‹ã€å®ç°äº† `NSCopying` åè®®ã€**æœ€å¥½æ˜¯ä¸å¯å˜å¯¹è±¡** & å“ˆå¸Œç¨³å®šï¼ˆå”¯ä¸€ï¼‰ã€ä¸å¯ä¸º<font color=red>**nil**</font>ã€‚
    * ğŸ‘‰ å¯ä»¥ç›´æ¥åšOC.**NSDictionary**.Keyçš„ï¼š`NSString *`ã€`NSNumber *`ã€`NSDate *`ã€è‡ªå·±å®ç°äº†`NSCopying`çš„ç±»
  * Valueï¼šå¯ä»¥æ˜¯ä»»æ„å¯¹è±¡ï¼ˆåŸå§‹ç±»å‹è¦è£…ç®±æˆ `NSNumber` / `NSValue`ï¼‰ï¼›ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€ä¸å¯ä¸º<font color=red>**nil**</font>ï¼ˆè¦ç”¨ `NSNull`ï¼‰

* [**Swift**](https://developer.apple.com/swift/).å­—å…¸ï¼ˆå­—å…¸å’Œæ•°ç»„éƒ½æ˜¯ç”¨[]è¿›è¡ŒåŒ…è£¹ï¼‰

  * Keyï¼šå¿…é¡»æ˜¯ `Hashable`ï¼ˆå³ï¼Œå¿…é¡»èƒ½æ¯”è¾ƒç›¸ç­‰ï¼š`Equatable` â• å¿…é¡»èƒ½æä¾›å“ˆå¸Œå€¼ï¼š`func hash(into:)`ï¼‰ã€**æœ€å¥½æ˜¯ä¸å¯å˜å¯¹è±¡** & å“ˆå¸Œç¨³å®šï¼ˆå”¯ä¸€ï¼‰

    * ğŸ‘‰ å¯ä»¥ç›´æ¥åš[**Swift**](https://developer.apple.com/swift/).**Dictionary**.Keyçš„ï¼š`String`/`Int` / `Double` / `Bool`/`UUID`/`enum`ï¼ˆä¸å¸¦å…³è”å€¼çš„è‡ªåŠ¨ Hashableï¼›å¸¦å…³è”å€¼éœ€è®©å®ƒéµå®ˆäº¦å¯ä»¥ï¼‰/è‡ªå®šä¹‰çš„ç»“æ„ä½“/æšä¸¾/ç±»ï¼Œéœ€éµå®ˆ `Hashable`

    * Key å¯ä»¥æ˜¯ Optional

      ```swift
      var dict: [String?: String] = [
          nil: "ç©º key",
          "a": "å€¼ A"
      ]
      ```

  * Valueï¼šæ²¡æœ‰çº¦æŸï¼Œä»»æ„ç±»å‹éƒ½è¡Œï¼ˆ<font color=red>ä½†å­—å…¸é‡Œçš„ Value ç±»å‹å¿…é¡»ç»Ÿä¸€</font>ï¼‰

    ```swift
    // å…¨æ˜¯ Int
    var d1: [String: Int] = [
        "sd": 1,
        "fg": 2
    ]
    // å…¨æ˜¯ String
    var d2: [String: String] = [
        "sd": "1",
        "fg": "2"
    ]
    // ç±»ä¼¼ OC çš„ id
    var d3: [String: Any] = [
        "sd": 1,         // Int
        "fg": "2",       // String
        "arr": [1, 2, 3] // [Int]
    ]
    // ç”¨çš„æ—¶å€™è‡ªå·±è§£ï¼š
    if let n = d3["sd"] as? Int { ... }
    if let s = d3["fg"] as? String { ... }
    ```

### 26ã€æ•°ç»„æ˜¯å¼•ç”¨ç±»å‹è¿˜æ˜¯å€¼ç±»å‹â“<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

*  è¯­è¨€è§†è§’ï¼š**Array** æ˜¯ **struct**ï¼Œå±äºå€¼ç±»å‹

  ```swift
  var a = [1, 2, 3]
  var b = a     // è¿™é‡Œä»è¯­ä¹‰ä¸Šè®²æ˜¯ã€Œå¤åˆ¶äº†ä¸€ä»½ã€
  
  b.append(4)
  
  print(a)  // [1, 2, 3]
  print(b)  // [1, 2, 3, 4]
  ```

* å®ç°è§†è§’ï¼šåº•å±‚ç¡®å®æœ‰â€œå¯¹è±¡â€ï¼Œä½†å¯¹å…¶éšè—äº†

  * è™½ç„¶è¯­ä¹‰æ˜¯å€¼ç±»å‹ï¼Œä½†ä¸ºäº†æ€§èƒ½ï¼Œ[**Swift**](https://developer.apple.com/swift/) **ä¸ä¼šæ¯æ¬¡èµ‹å€¼å°±çœŸçš„ç«‹åˆ»æ‹·è´æ•´å—å†…å­˜**ï¼Œè€Œæ˜¯ï¼šæ•°ç»„æœ¬ä½“ (`Array<T>`) æ˜¯ä¸€ä¸ª `struct`ï¼Œé‡Œé¢æŒæœ‰ä¸€ä¸ªæŒ‡å‘å †ä¸Š bufferï¼ˆä¸€ä¸ª **å¼•ç”¨ç±»å‹çš„å­˜å‚¨å¯¹è±¡**ï¼‰ çš„å¼•ç”¨

    ```swift
    var a = [1, 2, 3]
    var b = a     // æ­¤æ—¶ a å’Œ b å…±äº«åŒä¸€ä¸ªåº•å±‚ bufferï¼ˆRC = 2ï¼‰
    b.append(4)   // å‘ç° buffer è¢«å¤šæ–¹å…±äº« â‡’ è§¦å‘ Copy-on-Write â‡’ ä¸º b æ‹·è´ä¸€ä»½æ–° buffer
    ```

### 27ã€<font color=red id=COW>**C**</font>opy-<font color=red>**O**</font>n-<font color=red>**W**</font>riteï¼ˆ**ç¬¬ä¸€æ¬¡å†™å…¥ä¸”æœ‰å…±äº«æ—¶**ï¼šæ‰çœŸçš„å¤åˆ¶ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> * **å®šä¹‰**ï¼šå½“ä½ å¤åˆ¶ä¸€ä¸ªå€¼ç±»å‹çš„æ—¶å€™ï¼Œ[**Swift**](https://developer.apple.com/swift/) ä¸ä¼šç«‹å³å¤åˆ¶å®ƒçš„åº•å±‚å­˜å‚¨ï¼Œè€Œæ˜¯è®©ä¸¤ä¸ªå˜é‡å…±äº«åŒä¸€å—å†…å­˜
> * **è§¦å‘æ‹·è´çš„æ—¶æœº**ï¼šä¸€æ—¦å…¶ä¸­ä¸€ä¸ªå˜é‡å°è¯• **å†™å…¥ï¼ˆä¿®æ”¹ï¼‰** æ•°æ®ï¼Œ[**Swift**](https://developer.apple.com/swift/) æ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½æ–°çš„å†…å­˜ï¼Œä»¥ä¿è¯<u>å€¼è¯­ä¹‰</u>çš„æ­£ç¡®æ€§
> * ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ
>   * **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œæå‡æ•ˆç‡
>   * **å€¼è¯­ä¹‰å®‰å…¨**ï¼šå¯¹å¤–è¡¨ç°ä¸Š `Array` ä»ç„¶æ˜¯<u>å€¼ç±»å‹</u>ï¼Œäº’ä¸å½±å“
>   * **å†…å­˜å‹å¥½**ï¼šåªæœ‰åœ¨çœŸçš„éœ€è¦ä¿®æ”¹æ—¶ï¼Œæ‰é¢å¤–åˆ†é…å†…å­˜
> * å†…å­˜ç®¡ç†ç»†èŠ‚ï¼ˆ**COW**çš„è¿è¡Œæœºåˆ¶ï¼‰
>   * [**Swift**](https://developer.apple.com/swift/) åº•å±‚ç”¨ä¸€ä¸ª **å¼•ç”¨è®¡æ•°çš„ buffer** æ¥å­˜æ”¾å…ƒç´ 
>   * æ¯æ¬¡èµ‹å€¼ï¼Œå¼•ç”¨è®¡æ•° +1ï¼›
>   * å½“æœ‰äººå†™å…¥æ—¶ï¼Œå‘ç°å¼•ç”¨è®¡æ•° > 1ï¼Œå°±è§¦å‘æ‹·è´ â†’ æ–° buffer

* æ²¡æœ‰ä¿®æ”¹ â†’ ä¸ä¼šæ‹·è´

  ```swift
  var a = [1, 2, 3]
  var b = a   // è¿™é‡Œåªæ˜¯å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå…±äº«å­˜å‚¨
  print(a === b) // Swift ä¸å…è®¸ç›´æ¥ === æ¯”è¾ƒæ•°ç»„ï¼Œä½†å†…éƒ¨ç¡®å®æŒ‡å‘åŒä¸€å—å­˜å‚¨
  ```

* ä¿®æ”¹æ—¶ â†’ æ‰ä¼šæ‹·è´

  ```swift
  var a = [1, 2, 3]
  var b = a   // å…±äº«å­˜å‚¨
  b.append(4) // ğŸš¨ æ­¤åˆ»è§¦å‘ copy-on-writeï¼Œb æ‹·è´ä¸€ä»½æ–°çš„å­˜å‚¨
  print(a)    // [1, 2, 3]
  print(b)    // [1, 2, 3, 4]
  ```

* æ¦‚å¿µå›¾

  * **COW**æ¦‚å¿µå›¾ï¼ˆå…±äº«â†’å†™å…¥â†’åˆ†è£‚ï¼‰

    ```mermaid
    graph LR
        subgraph "èµ‹å€¼åï¼ˆå°šæœªå†™å…¥ï¼‰"
            A["var a"]
            B["var b"]
            Buf1["Buffer #1: [1,2,3]"]
            A --> Buf1
            B --> Buf1
            note1["å¼•ç”¨è®¡æ•° = 2"]
            Buf1 --- note1
        end
    
        subgraph "b å‘ç”Ÿå†™å…¥ï¼ˆappend 4ï¼‰"
            A2["var a"]
            B2["var b"]
            Buf1b["Buffer #1: [1,2,3]"]
            Buf2["Buffer #2: [1,2,3,4]"]
            A2 --> Buf1b
            B2 --> Buf2
            note2["å†™æ—¶æ‹·è´è§¦å‘ â†’ b è·å¾—æ–°ç¼“å†²"]
            Buf2 --- note2
        end
    
        A -.-> A2
        B -.-> B2
    ```
  
  * æ—¶é—´çº¿ï¼ˆè°ä»€ä¹ˆæ—¶å€™å…±äº«/æ‹·è´ï¼‰
  
    ```mermaid
    sequenceDiagram
        participant Dev as ä½ ï¼ˆä»£ç ï¼‰
        participant A as å˜é‡ a
        participant B as å˜é‡ b
        participant Buf1 as Buffer #1([1,2,3])
        participant Buf2 as Buffer #2
    
        Dev->>A: var a = [1,2,3]
        A->>Buf1: ç»‘å®šå­˜å‚¨ï¼ˆRC=1ï¼‰
    
        Dev->>B: var b = a
        B->>Buf1: å…±äº«å­˜å‚¨ï¼ˆRC=2ï¼‰\nï¼ˆå°šæœªæ‹·è´ï¼‰
    
        Dev->>B: b.append(4)
        Note over B,Buf1: å‘ç° RC>1 -> è§¦å‘ COW
        B-->>Buf2: å¤åˆ¶ Bufferï¼ˆæ–°å»ºï¼‰\nå†™å…¥ 4 -> [1,2,3,4]
    
        A-->>Buf1: ä»æŒ‡å‘æ—§ç¼“å†²\nå€¼ä¿æŒ [1,2,3]
        B-->>Buf2: æŒ‡å‘æ–°ç¼“å†²\nå€¼ä¸º [1,2,3,4]
    ```
  
  * çŠ¶æ€æµè½¬ï¼ˆå†³ç­–è§†è§’ï¼‰
  
    ```mermaid
    flowchart TD
        S["å¤åˆ¶èµ‹å€¼: b = a"] --> C{"æ˜¯å¦å†™å…¥?"}
        C -- å¦ --> Share["å…±äº«åŒä¸€ç¼“å†²<br/>(æ— æ‹·è´, RC+=1)"]
        C -- æ˜¯ --> RC{"å¼•ç”¨è®¡æ•° > 1 ?"}
        RC -- å¦ --> InPlace["ç‹¬å ç¼“å†²<br/>åŸåœ°ä¿®æ”¹"]
        RC -- æ˜¯ --> Copy["åˆ†é…æ–°ç¼“å†²<br/>æ‹·è´åå†™å…¥"]
    ```

## å…­ã€ğŸ“ é™„ä»¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€<font id=å…³é—­é¡µé¢@å®ç°é€»è¾‘>å…³é—­é¡µé¢@å®ç°é€»è¾‘</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
/// å› ä¸ºå‘ˆç°é¡µé¢é™¤äº†pushå°±æ˜¯presentï¼Œä½†æ˜¯pushæ˜¯éœ€è¦æœ‰å¯¼èˆªæ§åˆ¶å™¨ä½œæ”¯æ’‘çš„ã€‚
/// é‚£ä¹ˆå°±å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯¼èˆªæ§åˆ¶å™¨pushå‘ˆç°çš„ï¼Œæ²¡æœ‰å°±æ˜¯presentå‘ˆç°çš„
@discardableResult
func closeByResult(_ result: Any?, animated: Bool = true) -> Self {
    if let r = result { sendResult(r) }
    if let nav = navigationController { nav.popViewController(animated: animated) }
    else { dismiss(animated: animated) }
    return self
}
```

### 2ã€<font id=å…¨å±€æ¯”ä¾‹å°º@å®ç°é€»è¾‘>å…¨å±€æ¯”ä¾‹å°º@å®ç°é€»è¾‘</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
import UIKit

// MARK: - æ ¸å¿ƒæ¯”ä¾‹å™¨
public enum JXScale {
    private static var designW: CGFloat = 375
    private static var designH: CGFloat = 812
    private static var useSafeArea: Bool = false
    
    public static func setup(designWidth: CGFloat, designHeight: CGFloat, useSafeArea: Bool = false) {
        self.designW = designWidth
        self.designH = designHeight
        self.useSafeArea = useSafeArea
    }
    
    private static var screenSize: CGSize {
        guard let window = UIApplication.shared.windows.first(where: { $0.isKeyWindow }) else {
            return UIScreen.main.bounds.size
        }
        if useSafeArea {
            let insets = window.safeAreaInsets
            return CGSize(
                width: max(0, window.bounds.width - (insets.left + insets.right)),
                height: max(0, window.bounds.height - (insets.top + insets.bottom))
            )
        } else {
            return window.bounds.size
        }
    }
    
    public static var x: CGFloat { screenSize.width / designW }
    public static var y: CGFloat { screenSize.height / designH }
}

// MARK: - æ‰©å±• Int / CGFloat
public extension BinaryInteger {
    var w: CGFloat { CGFloat(self) * JXScale.x }
    var h: CGFloat { CGFloat(self) * JXScale.y }
    var fz: CGFloat { CGFloat(self) * JXScale.x }   // å­—ä½“ç¼©æ”¾ï¼Œé»˜è®¤è·Ÿéš X
}

public extension BinaryFloatingPoint {
    var w: CGFloat { CGFloat(self) * JXScale.x }
    var h: CGFloat { CGFloat(self) * JXScale.y }
    var fz: CGFloat { CGFloat(self) * JXScale.x }
}
```

### 3ã€<font id=è·å–å±å¹•å°ºå¯¸@å®ç°é€»è¾‘>è·å–å±å¹•å°ºå¯¸@å®ç°é€»è¾‘</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// MARK: - å±å¹•å®½é«˜ï¼ˆå…¼å®¹è®¾å¤‡æ¨ªç«–å±ï¼‰
public enum Screen {
    /// å½“å‰ç•Œé¢æ–¹å‘ï¼ˆiOS 13+ï¼›æ‹¿ä¸åˆ°æ—¶ä¸º .unknownï¼‰
    private static var orientation: UIInterfaceOrientation {
        (UIApplication.shared.connectedScenes.first as? UIWindowScene)?
            .interfaceOrientation ?? .unknown
    }
    /// å±å¹•å°ºå¯¸ï¼ˆä»¥ç‚¹ä¸ºå•ä½ï¼Œå·²æŒ‰å½“å‰æ¨ªç«–å±çº æ­£å®½é«˜ï¼‰
    public static var size: CGSize {
        let s = UIScreen.main.bounds.size   // iOS 8+ å§‹ç»ˆæ˜¯ç«–å±åæ ‡
        let w = s.width, h = s.height
        switch orientation {
        case .landscapeLeft, .landscapeRight:
            return CGSize(width: max(w, h), height: min(w, h))
        case .portrait, .portraitUpsideDown:
            return CGSize(width: min(w, h), height: max(w, h))
        default:
            // æ‹¿ä¸åˆ°æ–¹å‘æ—¶ï¼Œå…œåº•è¿”å›ç³»ç»Ÿç»™çš„
            return s
        }
    }
    /// ä¾¿æ·ï¼šå½“å‰å±å¹•å®½ / é«˜ï¼ˆæŒ‰æ¨ªç«–å±çº æ­£ï¼‰
    public static var width: CGFloat  { size.width }
    public static var height: CGFloat { size.height }
}
```

### 4ã€<font id=ç»™UILabelé‡Œçš„æ–‡å­—åŠ ä¸‹åˆ’çº¿å¹¶ä¸”å¯ä»¥æŒ‡å®šä¸‹åˆ’çº¿çš„é¢œè‰²@å®ç°é€»è¾‘>ç»™ `UILabel` é‡Œçš„æ–‡å­—åŠ ä¸‹åˆ’çº¿å¹¶ä¸”å¯ä»¥æŒ‡å®šä¸‹åˆ’çº¿çš„é¢œè‰²@å®ç°é€»è¾‘</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
extension UILabel {
    func underline(color: UIColor) {
        if let textString = self.text {
            let attributedString = NSMutableAttributedString(string: textString)
            attributedString.addAttribute(NSAttributedString.Key.underlineStyle,
                                          value: NSUnderlineStyle.single.rawValue,
                                          range: NSRange(location: 0, length: attributedString.length))
            attributedString.addAttribute(NSAttributedString.Key.underlineColor,
                                          value: color,
                                          range: NSRange(location: 0, length: attributedString.length))
            self.attributedText = attributedString
        }
    }
}
```

### 5ã€<font size=5>`UIScrollView`</font> çš„å‡é€Ÿå‡½æ•° <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> è‹¹æœè™½ç„¶æ²¡æŠŠ <font size=5>`UIScrollView`</font> çš„å†…éƒ¨æºç å¼€å‡ºæ¥ï¼Œä½† [**WWDC**]() + åæ¨åŸºæœ¬å·²ç»ç¡®å®šï¼š**æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæŒ‰ <font size=5>`decelerationRate`</font> åšæŒ‡æ•°è¡°å‡çš„é€Ÿåº¦å‡½æ•°**ã€‚

* è®¾ï¼š

  - åˆå§‹é€Ÿåº¦ï¼š`vâ‚€`ï¼ˆå•ä½ï¼špt/sï¼Œæ»šåŠ¨ç»“æŸæ—¶ `withVelocity:` ä¼ è¿›æ¥çš„é‚£ä¸ªï¼‰
  - `d = decelerationRate.rawValue`ï¼ˆ`.normal â‰ˆ 0.998`ï¼Œ`.fast â‰ˆ 0.99`ï¼‰[Apple Developer+1](https://developer.apple.com/documentation/uikit/uiscrollview/decelerationrate-swift.property?utm_source=chatgpt.com)
  - æ—¶é—´ `t` å•ä½ï¼šç§’

* é€Ÿåº¦éšæ—¶é—´ï¼š<font size=5>`UIScrollView`</font> çš„çº¦å®šæ˜¯ï¼šã€Œ**æ¯æ¯«ç§’**æŠŠé€Ÿåº¦ä¹˜ä»¥ä¸€æ¬¡ `d`ã€

* æ‰€ä»¥ï¼š

  - æ¯«ç§’è®°ä¸º `k = 1000Â·t`

  - ç¬¬ `k` æ¯«ç§’çš„é€Ÿåº¦ï¼š`v(k) = vâ‚€ Â· dáµ`

  - æ¢æˆä»¥ç§’ä¸ºè‡ªå˜é‡çš„è¿ç»­å½¢å¼ï¼š

    ![image-20251128142449778](./assets/image-20251128142449778.png)
    
  - ä½ç§»ï¼ˆç›¸å¯¹åˆå§‹ä½ç½®ï¼‰ï¼š
  
    > æ³¨æ„ï¼š`0 < d < 1`ï¼Œå› æ­¤ `ln d < 0`ï¼Œå¼å­æ•´ä½“æ˜¯æ­£çš„ï¼ˆå¾€å‰æ»šï¼‰
    
    ![image-20251128142502649](./assets/image-20251128142502649.png)
    
  - æœ€ç»ˆåœæ­¢æ—¶çš„æ€»ä½ç§»ï¼ˆt â†’ âˆï¼‰ï¼š
  
    ![image-20251128142546842](./assets/image-20251128142546842.png)
  
  - WWDC çš„æŠ•å°„å‡½æ•°é‡Œç»™çš„æ˜¯ä¸€ä¸ª**è¿‘ä¼¼**ï¼ˆä¸ºäº†å°‘ç®—ä¸€æ¬¡ logï¼‰ï¼š
  
    > å½“ `d` å¾ˆæ¥è¿‘ 1ï¼ˆ0.99 / 0.998 è¿™ç§ï¼‰æ—¶ï¼Œè¿™ä¸ªè¿‘ä¼¼å’Œä¸Šé¢ç²¾ç¡®å…¬å¼éå¸¸æ¥è¿‘
  
    ![image-20251128142608360](./assets/image-20251128142608360.png)

### 6ã€<font color=red id=å†…ç½®çš„HTMLä»£ç >**å†…ç½®çš„HTMLä»£ç **</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
static let demoHTML = """
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>BaseWebView Usage Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body { margin:0; padding:0; font-family:-apple-system,Helvetica; }
    header { position:sticky; top:0; background:#111; color:#fff; padding:12px 16px; font-weight:600; }
    main { padding:16px; }
    button { padding:10px 14px; margin:6px 6px 6px 0; border-radius:8px; border:1px solid #ccc; background:#fafafa; }
    pre { background:#f6f8fa; padding:10px; border-radius:6px; white-space:pre-wrap; word-break:break-word; max-height:40vh; overflow:auto; }
    .row { display:flex; gap:8px; flex-wrap:wrap; }
    a { color:#0a84ff; }
  </style>
</head>
<body>
  <header>BaseWebView Â· JS â†”ï¸ Native</header>
  <main>
    <div class="row">
      <button id="btnPing">JSâ†’Native ping()</button>
      <button id="btnAlert">JSâ†’Native openAlert()</button>
      <button id="btnDisableSel">ç¦ç”¨é€‰æ‹© ON</button>
      <button id="btnEnableSel">ç¦ç”¨é€‰æ‹© OFF</button>
    </div>

    <p>å¤–é“¾/ä¸‹è½½ï¼š</p>
    <div class="row">
      <a href="mailto:test@example.com">mailto</a>
      <a href="https://example.com" target="_blank">_blank æ‰“å¼€ example.com</a>
      <a href="data:text/plain,hello" download="hello.txt">ä¸‹è½½ data: æ–‡æœ¬</a>
    </div>

    <p>æ—¥å¿—ï¼š</p>
    <pre id="log"></pre>
  </main>

  <script>
    const logEl = document.getElementById('log');
    function log(){ const line=[...arguments].map(a=>typeof a==='string'?a:JSON.stringify(a)).join(' ');
      console.log(line); logEl.textContent=(line+"\\n"+logEl.textContent).slice(0, 10000); }

    document.addEventListener('nativeReady', e => log('[event] nativeReady:', e.detail));

    document.getElementById('btnPing').addEventListener('click', async () => {
      const res = await Native.call('ping', { msg:'hello from JS', rnd: Math.random() });
      log('[reply] ping =>', res);
    });

    document.getElementById('btnAlert').addEventListener('click', async () => {
      const res = await Native.call('openAlert', { message:'JS è¯·æ±‚åŸç”Ÿ Alert' });
      log('[reply] openAlert =>', res);
    });

    document.getElementById('btnDisableSel').addEventListener('click', async () => {
      const res = await Native.call('toggleSelection', { disabled:true });
      log('[reply] toggleSelection =>', res);
    });
    document.getElementById('btnEnableSel').addEventListener('click', async () => {
      const res = await Native.call('toggleSelection', { disabled:false });
      log('[reply] toggleSelection =>', res);
    });
  </script>
</body>
</html>
"""
```

<a id="ğŸ”š" href="#å‰è¨€" style="font-size:17px; color:green; font-weight:bold;">æˆ‘æ˜¯æœ‰åº•çº¿çš„ğŸ‘‰ç‚¹æˆ‘å›åˆ°é¦–é¡µ</a>
