# **iOS**.[**Swift**](https://developer.apple.com/swift/)@<font color=red>é¶åœºé¡¹ç›®</font>è“çš®ä¹¦ğŸ“˜


<p align="left">
  <a><img src="https://img.shields.io/badge/Swift-red" alt="Swift"/></a>
  <a><img src="https://img.shields.io/badge/Xcode-15.4-blue" alt="Xcode"/></a>
  <a><img src="https://img.shields.io/badge/iOS-17.5+-critical" alt="iOS"/></a>
  <a><img src="https://img.shields.io/badge/pod-1.15.2-brightgreen" alt="CocoaPods"/></a>
  <a><img src="https://img.shields.io/github/actions/workflow/status/295060456/JobsSwiftBaseConfigDemo/ci.yml?branch=main" alt="Build Status"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo"><img src="https://img.shields.io/github/license/295060456/JobsSwiftBaseConfigDemo?style=flat&color=success" alt="License"/></a>
  <a><img src="https://img.shields.io/github/languages/top/295060456/JobsSwiftBaseConfigDemo?color=blueviolet" alt="Top Language"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo/stargazers"><img src="https://img.shields.io/github/stars/295060456/JobsSwiftBaseConfigDemo?style=flat-square&color=yellow" alt="Stars"/></a>
  <a href="https://github.com/295060456/JobsSwiftBaseConfigDemo/network"><img src="https://img.shields.io/github/forks/295060456/JobsSwiftBaseConfigDemo?style=flat-square&color=blue" alt="Forks"/></a>
  <a><img src="https://img.shields.io/github/issues/295060456/JobsSwiftBaseConfigDemo?color=important" alt="Issues"/></a>
  <a><img src="https://img.shields.io/github/last-commit/295060456/JobsSwiftBaseConfigDemo?color=ff69b4" alt="Last Commit"/></a>
  <a><img src="https://img.shields.io/github/languages/code-size/295060456/JobsSwiftBaseConfigDemo" alt="Code Size"/></a>
</p>

[toc]

å½“å‰æ€»è¡Œæ•°ï¼š

## ğŸ”¥ <font id=å‰è¨€>å‰è¨€</font>

> æ¸©é¦¨æç¤ºğŸ””ï¼šæœ¬æ–‡è¾ƒé•¿ï¼Œéœ€è¦â¬ä¸‹è½½åˆ°æœ¬åœ°ä»¥åï¼Œæ–¹èƒ½å®Œæ•´é˜…è¯»ã€‚æ¨èé˜…è¯»å™¨ğŸ‘‰[**Typora**](https://typora.io/)

* **å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨**
* **ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæ‰èƒ½çœ‹å¾—æ›´è¿œ**
* **é¢å‘ä¿¡ä»°ç¼–ç¨‹**

## ä¸€ã€ğŸ¯ é¡¹ç›®ç™½çš®ä¹¦ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ç¨‹åºå‘˜æ˜¯ä¸€ä¸ªé«˜æ¶ˆè€—çš„èŒä¸šï¼Œé™¤äº†æ—¥å¸¸åŸºæœ¬çš„ä¸šåŠ¡å¼€å‘ä»¥å¤–ï¼Œæ–°äº‹ç‰©çš„ä¸æ–­æ¶Œç°ä¹Ÿéœ€è¦æŒç»­æ€§çš„å­¦ä¹ ï¼Œæ‰€ä»¥æ˜¯ä¸€ä»¶éå¸¸æ¶ˆè€—ç²¾åŠ›çš„äº‹ï¼›è€Œä¸”ç”±äºé•¿æœŸçš„é«˜å‹ã€é«˜æƒ…ç»ªã€ç†¬å¤œï¼Œ**ä¼šæ‰“ä¹±äººä½“å†…æ­£å¸¸çš„å†…åˆ†æ³ŒèŠ‚å¥**ï¼Œå¤§æ¦‚ç‡ä¹Ÿä¼šé€æ¸çš„å¼•å‘å„ç§èŒä¸šç–¾ç—…ã€‚ä¸šå†…æ™®éè®¤ä¸ºç¨‹åºå‘˜çš„**é»„é‡‘å¹´é¾„åœ¨25ï½35å‘¨å²**ã€‚é‚£ä¹ˆï¼Œè¿˜æ˜¯å¸Œæœ›ï¼Œåœ¨æˆ‘ä»¬ï¼ˆäº¦æˆ–è€…æ˜¯æš‚æ—¶æ€§çš„ï¼‰ç¦»å¼€è¿™ä¸ªè¡Œä¸šçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºè‡ªå·±æˆ–è€…åäººï¼Œç•™ä¸‹ç‚¹ä»€ä¹ˆï¼Œç®—æ˜¯è¿™ä¹ˆå¤šå¹´çš„ä¸€ä¸ªå·¥ä½œæ€»ç»“ã€‚æ­¤å¤–ï¼Œèƒ½æœ€å¤§åŒ–çš„è¾…åŠ©äººï¼Œå¸®åŠ©å…¶åœ¨æçŸ­çš„æ—¶é—´å†…å»ï¼š<u>å›å¿†/ä¸Šæ‰‹/å­¦ä¹ /å®éªŒ</u>è¿™ä¸ªç¼–ç¨‹è¯­è¨€ä¸‹çš„å·¥ç¨‹é¡¹ç›®ã€‚æ‰€ä»¥ï¼Œæ­¤é¡¹ç›®å°±ä¸€å®šæ˜¯è¦ç»“åˆå•†ä¸šéœ€æ±‚å»åŠ¡å®æ‹“å±•ï¼Œè§£å†³å½“å‰ç—›ç‚¹ã€‚

* å“æ§æ ‡å‡†ï¼ˆåªèƒ½ä¸¥æ ¼çš„ä¿è¯ç¼–è¯‘å™¨æ­£å¸¸ï¼Œè€Œä¸èƒ½å®Œå…¨ä¿è¯è¿è¡Œæ—¶çš„ä¸å‡ºé”™ï¼‰
  * ä¸€å®šè¦ä¿è¯è¿™ä¸ªå·¥ç¨‹çš„æˆåŠŸç¼–è¯‘é€šè¿‡ï¼Œæ–¹ä¾¿ä»¥åé¡¹ç›®ç›´æ¥è¿›è¡Œå¼•ç”¨ï¼Œä¹ƒè‡³å¼€æ–°ç‰ˆæœ¬
  * <font color=blue>**ç¤ºä¾‹Demoå¯èƒ½å› ä¸ºç›¸å…³Apiçš„å‡çº§ï¼Œæ²¡æœ‰åŠæ—¶çš„è¦†ç›–å¤„ç†ï¼Œå¯èƒ½ä¼šå‡ºç°é—ªé€€ã€‚ä¿®å¤å³å¯**</font>
* è‡ªæ­¤ä»¥åï¼Œæ‰€æœ‰æ–°å¼€çš„é¡¹ç›®éƒ½å¯ä»¥æ ¹æ®è¿™ä¸ª**æ ¹é¡¹ç›®**æ¥è¿›è¡Œç»Ÿä¸€çš„è°ƒé…å’Œä½¿ç”¨
  * å°†å®ƒä½œä¸ºæ‰€æœ‰é¡¹ç›®çš„æ¯ç‰ˆå’ŒåŸºç±»ï¼Œæœ€å¤§é™åº¦çš„åšåˆ°å…¨å±€çš„ç»Ÿä¸€
  * æ—¥ç§¯æœˆç´¯çš„è®°å½•ä¸€äº›å¹³æ—¶ç”Ÿäº§ç”Ÿæ´»ä¸­èŒå‘çš„ä¸€äº›ä¼˜ç§€çš„æƒ³æ³•ã€çµå…‰ä¸€ç°çš„åˆ›æ„ã€‚åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼š<u>è¯­æ³•ç³–çš„å°è£…</u>ã€<u>æ–¹æ³•çš„è°ƒç”¨</u>ï¼Œ<u>ç¬¬ä¸‰æ–¹çš„é€‰ç”¨</u>ã€ä»¥åŠä¸€äº›å¿ƒå¾—ä½“ä¼š
* ä½œä¸ºæŸäº›ä»£ç **å®è·µé¶åœº**ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„
  * ä¸ºæˆ‘ä»¬å¿«é€Ÿä¸”ç¨³å®šçš„å¤ç°ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œä½œä¸ºä»£ç å®éªŒå®¤ğŸ§ªï¼Œè€Œæ­å»ºçš„ä¸€ä¸ªå¹³å°
* ä½œä¸ºä»£ç ç¬”è®°ï¼Œè®°å½•ä¸€äº›å¸¸ç”¨çš„ä»£ç ï¼Œæ–¹ä¾¿æŸ¥é˜…
  * ä¸»è¦å½¢å¼æ˜¯å¯ä»¥è¿è¡Œçš„ä»£ç  + æ–‡å­—æ€§å™è¿° + å›¾æ–‡æ··ç¼–è®²è§£
  * ä½œä¸ºå­¦ä¹ çš„èµ„æ–™ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£åˆ°ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†ï¼Œå¤§å¹…**é™ä½å­¦ä¹ æˆæœ¬**
  * ä½œä¸ºå…¶ä»–é¡¹ç›®çš„å‚è€ƒï¼Œå¯ä»¥å¿«é€Ÿçš„äº†è§£åˆ°é¡¹ç›®çš„æ¶æ„ï¼Œä»£ç è§„èŒƒï¼Œä»¥åŠä¸€äº›è®¾è®¡æ¨¡å¼
  * è¿™ä¹ˆä¸€äº›ä¼˜ç§€çš„æˆæœï¼Œå…¶æ¥æºä¸ä»…ä»…æ˜¯æ¥è‡ªäºä½œè€…æœ¬èº«çš„æŒç»­ä»˜å‡ºä¸ç§¯ç´¯ã€‚æ›´æ˜¯è¿™ä¸ªé¢†åŸŸå¤§å®¶åº­ä¸­å„è·¯ä¼˜ç§€ä½œè€…çš„æ™ºæ…§ç»“æ™¶

## äºŒã€ğŸ‘¥ é¡¹ç›®é…ç½® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€ç¬¬ä¸‰æ–¹ç®¡ç† <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Mac OS 15** ä»¥åï¼Œè‹¹æœé‡‡å–äº†æ›´åŠ ä¸¥æ ¼çš„æƒé™å†™å…¥æœºåˆ¶ã€‚æ–°**swift**é¡¹ç›®å¦‚æœè¦åˆ©ç”¨[**`Cocoapod`**](https://cocoapods.org/)æ¥é›†æˆç¬¬ä¸‰æ–¹ï¼Œå°±æ¯”å¦‚åœ¨**xcode**é‡Œé¢åšå¦‚ä¸‹è®¾ç½®ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ï¼š`TARGETS`->`Build Settings`->`ENABLE_USER_SCRIPT_SANDBOXING`-><font color=red>`NO`</font>

  ![image-20250616173410872](./assets/image-20250616173410872.png)

  [**è„šæœ¬å¤„ç†**](./ã€MacOSã€‘âš™ï¸åŒå‡»ç¦ç”¨æ²™ç›’ä¿è¯Cocoapodsæ„å»ºæµç¨‹.command)

  ```shell
  #!/bin/zsh
  
  print_green()  { echo "\033[0;32m$1\033[0m"; }
  print_red()    { echo "\033[0;31m$1\033[0m"; }
  print_yellow() { echo "\033[0;33m$1\033[0m"; }
  
  print_green "ğŸ› ï¸ è„šæœ¬åŠŸèƒ½ï¼š"
  echo "1ï¸âƒ£ è‡ªåŠ¨è¯†åˆ« Flutter æˆ–åŸç”Ÿ iOS å·¥ç¨‹"
  echo "2ï¸âƒ£ è‡ªåŠ¨å®šä½ Xcode å·¥ç¨‹ï¼ˆ.xcodeprojï¼‰æ–‡ä»¶"
  echo "3ï¸âƒ£ ä¿®æ”¹ ENABLE_USER_SCRIPT_SANDBOXING = NOï¼Œé˜²æ­¢ CocoaPods æ„å»ºå¤±è´¥"
  echo ""
  
  SCRIPT_DIR=$(cd "$(dirname "$0")"; pwd)
  XCODEPROJ=""
  
  # å°è¯•è‡ªåŠ¨è¯†åˆ« Flutter / iOS å·¥ç¨‹è·¯å¾„
  if [[ -d "$SCRIPT_DIR/ios" && -d "$SCRIPT_DIR/lib" ]]; then
    print_green "ğŸ“¦ æ£€æµ‹åˆ° Flutter å·¥ç¨‹ï¼Œè¿›å…¥ ios å­ç›®å½•æŸ¥æ‰¾ Xcode å·¥ç¨‹..."
    PROJECT_DIR="$SCRIPT_DIR/ios"
  else
    print_green "ğŸ“± å°è¯•åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾åŸç”Ÿ iOS å·¥ç¨‹..."
    PROJECT_DIR="$SCRIPT_DIR"
  fi
  
  # è‡ªåŠ¨å¯»æ‰¾ .xcodeproj
  XCODEPROJ=$(find "$PROJECT_DIR" -maxdepth 1 -name "*.xcodeproj" | head -n 1)
  
  # å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±è®©ç”¨æˆ·æ‰‹åŠ¨æ‹–å…¥
  if [[ -z "$XCODEPROJ" ]]; then
    print_red "âŒ æœªè‡ªåŠ¨æ‰¾åˆ° .xcodeproj æ–‡ä»¶"
    echo ""
    read "?ğŸ‘‰ è¯·æ‰‹åŠ¨æ‹–å…¥ä½ çš„ .xcodeproj å·¥ç¨‹æ–‡ä»¶ï¼Œç„¶åæŒ‰å›è½¦ï¼š" XCODEPROJ
    XCODEPROJ=${XCODEPROJ%\"}
    XCODEPROJ=${XCODEPROJ#\"}
  fi
  
  # æ ¡éªŒè·¯å¾„æœ‰æ•ˆæ€§
  PBXPROJ_PATH="$XCODEPROJ/project.pbxproj"
  if [[ ! -f "$PBXPROJ_PATH" ]]; then
    print_red "âŒ æ‰¾ä¸åˆ° project.pbxproj æ–‡ä»¶ï¼Œè¯·ç¡®è®¤è·¯å¾„æ­£ç¡®"
    exit 1
  fi
  
  print_yellow "ğŸ“‚ ç›®æ ‡å·¥ç¨‹ï¼š$XCODEPROJ"
  print_green  "ğŸ” æ­£åœ¨æŸ¥æ‰¾ ENABLE_USER_SCRIPT_SANDBOXING è®¾ç½®..."
  
  # âœ… è‹¥å·²å­˜åœ¨ï¼Œåˆ™æ›¿æ¢ä¸º NO
  grep -q "ENABLE_USER_SCRIPT_SANDBOXING" "$PBXPROJ_PATH"
  if [[ $? -eq 0 ]]; then
    print_green "âœ… å·²æ‰¾åˆ° ENABLE_USER_SCRIPT_SANDBOXINGï¼Œæ­£åœ¨æ›¿æ¢ä¸º NO..."
    sed -i '' 's/ENABLE_USER_SCRIPT_SANDBOXING = YES;/ENABLE_USER_SCRIPT_SANDBOXING = NO;/g' "$PBXPROJ_PATH"
    sed -i '' 's/ENABLE_USER_SCRIPT_SANDBOXING = YES/ENABLE_USER_SCRIPT_SANDBOXING = NO/g' "$PBXPROJ_PATH"
  else
    print_green "â• æœªæ˜¾å¼è®¾ç½®ï¼Œæ·»åŠ  ENABLE_USER_SCRIPT_SANDBOXING = NO åˆ°æ‰€æœ‰ buildSettings..."
    sed -i '' '/buildSettings = {/a\
  \        ENABLE_USER_SCRIPT_SANDBOXING = NO;
  ' "$PBXPROJ_PATH"
  fi
  
  print_green "ğŸ‰ ä¿®æ”¹å®Œæˆï¼å·²å°† ENABLE_USER_SCRIPT_SANDBOXING è®¾ç½®ä¸º NO"

* <font color=red>**S**</font>wift <font color=red>**P**</font>ackage <font color=red>**M**</font>anager

  <div style="text-align: center;">
    <img src="./assets/image-20250616173604040.png" alt="image-1" style="width:30%; display:inline-block; vertical-align: top;" />
    <img src="./assets/image-20250616174404275.png" alt="image-2" style="width:65%; display:inline-block; vertical-align: top;" />
  </div>

### 2ã€é€‚ç”¨äº[Swift](https://developer.apple.com/swift/) çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 2.1ã€[**DeviceKit**](https://github.com/devicekit/DeviceKit) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 2.2ã€[**HandyJSON**](https://github.com/alibaba/HandyJSON) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ã€é˜¿é‡Œå·´å·´å¼€å‘
>
> 2ã€ **[Swift](https://developer.apple.com/swift/) çš„ JSON ä¸æ¨¡å‹æ˜ å°„åº“**
>
> 3ã€**ç®€åŒ– [Swift](https://developer.apple.com/swift/)  ä¸ JSON æ•°æ®ä¹‹é—´çš„åºåˆ—åŒ– / ååºåˆ—åŒ–è¿‡ç¨‹**ï¼Œé¿å…ä¼ ç»Ÿæ–¹å¼ä¸‹å¤§é‡æ‰‹å†™ `Codable`ã€`init(from:)` æˆ–è€… `Mappable` çš„æ¨¡æ¿åŒ–ä»£ç 
>
> 4ã€[**Swift**](https://developer.apple.com/swift/).[**Codable**](https://developer.apple.com/documentation/swift/codable) ğŸ†š [**HandyJSON**](https://github.com/alibaba/HandyJSON)
>
> â€‹	4.1ã€**Codable** æ˜¯è‹¹æœå®˜æ–¹çš„ï¼Œç±»å‹å®‰å…¨ï¼Œä½†éœ€è¦å†™ `CodingKeys`ï¼Œä»£ç é‡è¾ƒå¤§ã€‚é€‚åˆ **ä¸¥æ ¼çš„æ•°æ®ç»“æ„ã€ç¼–è¯‘æœŸå®‰å…¨** çš„é¡¹ç›®ã€‚
>
> â€‹	4.2ã€**HandyJSON** ååŠ¨æ€æ˜ å°„ï¼Œæ›´â€œè‡ªåŠ¨åŒ–â€ï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œä½†ç±»å‹å®‰å…¨æ€§ç¨å·®ï¼ˆè¿è¡ŒæœŸåšè§£æï¼‰ã€‚é€‚åˆ **å¿«é€Ÿå¼€å‘ / éœ€æ±‚å˜åŠ¨å¤§çš„åœºæ™¯**ã€‚
* åŸºæœ¬ç”¨æ³•

  *  **JSON** â†”ï¸ æ¨¡å‹

    å®šä¹‰æ¨¡å‹

    ```swift
    import HandyJSON
    
    struct User: HandyJSON {
        var id: Int?
        var name: String?
        var age: Int?
    }
    ```

    JSON â†’ æ¨¡å‹

    ```swift
    let json = "{\"id\":123, \"name\":\"Jobs\", \"age\":18}"
    if let user = User.deserialize(from: json) {
        print(user.name ?? "")  // è¾“å‡º "Jobs"
    }
    ```

    æ¨¡å‹ â†’ JSON

    ```swift
    let user = User(id: 123, name: "Jobs", age: 18)
    let jsonString = user.toJSONString()
    print(jsonString ?? "")
    ```
    
  * æšä¸¾ + `HandyJSONEnum`ï¼š [**HandyJSON**](https://github.com/alibaba/HandyJSON) å¯¹ **æšä¸¾åºåˆ—åŒ– / ååºåˆ—åŒ–** çš„æ”¯æŒ

    ```swift
    /**
     è®©æšä¸¾ï¼ˆå¿…é¡»æ˜¯ åŸå§‹å€¼æšä¸¾ï¼Œæ¯”å¦‚ Int æˆ– Stringï¼‰å¯ä»¥ç›´æ¥å’Œ JSON ä¸­çš„åŸå§‹å€¼äº’è½¬ã€‚
     ä¾‹å¦‚ JSON è¿”å› "status": 2ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ° JXLoginStatus.normal_loginã€‚
     åè¿‡æ¥ï¼Œæšä¸¾è½¬ JSON æ—¶ä¼šè‡ªåŠ¨è¾“å‡ºåŸå§‹å€¼ã€‚
     */
    enum JXLoginStatus: Int, HandyJSONEnum {
        case didnot_login = 1
        case normal_login = 2
    }
    ```

#### 2.3ã€[**SnapKit**](https://github.com/SnapKit/SnapKit) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

  * å®‰è£…
  
    * Cocoapods
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'SnapKit'
      ```
    
    * Swift Package Manager
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/SnapKit/SnapKit
      ```
    
  * å¯¼å…¥
  
    ```swift
    import SnapKit
    ```
  
  * è°ƒç”¨
    
    * åˆ›å»ºè§†å›¾å¹¶æ·»åŠ çº¦æŸ
    
      > å…ˆåŠ åç”¨
      >
      > ```swift
      > let box = UIView()
      > box.backgroundColor = .red
      > view.addSubview(box)
      > 
      > box.snp.makeConstraints { make in
      >     make.center.equalToSuperview()    // å±…ä¸­
      >     make.width.height.equalTo(100)    // å®½é«˜ = 100
      > }
      > ```
    
    * å¸¸ç”¨çº¦æŸå†™æ³•
    
      * ç›¸å¯¹çˆ¶è§†å›¾
    
        ```swift
        make.top.equalToSuperview().offset(20)      // è·ç¦»çˆ¶è§†å›¾é¡¶éƒ¨ 20
        make.left.equalToSuperview().offset(15)     // å·¦è¾¹è· 15
        make.right.equalToSuperview().inset(15)     // å³è¾¹è· 15ï¼ˆinset = -offsetï¼‰
        make.bottom.equalToSuperview().offset(-20)  // åº•è¾¹è· 20
        ```
    
      * ç›¸å¯¹å…¶å®ƒè§†å›¾
    
        ```swift
        make.top.equalTo(titleLabel.snp.bottom).offset(10)  // è·ç¦» titleLabel åº•éƒ¨ 10
        make.left.equalTo(icon.snp.right).offset(8)         // è·ç¦» icon å³è¾¹ 8
        ```
    
      * å›ºå®šå¤§å°
    
        ```swift
        make.width.equalTo(120)
        make.height.equalTo(50)
        ```
    
      * å®½é«˜æ¯”
    
        ```swift
        make.width.equalTo(view.snp.height).multipliedBy(0.5) // å®½ = é«˜ * 0.5
        ```
    
      * å±…ä¸­
    
        ```swift
        make.center.equalToSuperview()     // å®Œå…¨å±…ä¸­
        make.centerX.equalToSuperview()    // æ¨ªå‘å±…ä¸­
        make.centerY.equalToSuperview()    // çºµå‘å±…ä¸­
        ```
    
      * æ›´æ–°çº¦æŸï¼ˆ`updateConstraints`ï¼‰

        > é€‚åˆè¦ä¿®æ”¹éƒ¨åˆ†çº¦æŸçš„æƒ…å†µ

        ```swift
        box.snp.updateConstraints { make in
            make.width.equalTo(200)   // åŸæ¥100 â†’ æ›´æ–°ä¸º200
        }
        ```

      * é‡æ–°è®¾ç½®çº¦æŸï¼ˆ`remakeConstraints`ï¼‰

        > ä¼šå…ˆç§»é™¤æ—§çº¦æŸï¼Œå†é‡æ–°æ·»åŠ 

        ```swift
        box.snp.remakeConstraints { make in
            make.center.equalToSuperview()
            make.size.equalTo(CGSize(width: 50, height: 50))
        }
        ```
      
      * é«˜çº§ç”¨æ³•@ä¼˜å…ˆçº§

        ```swift
        make.width.lessThanOrEqualTo(300).priority(.high)
        ```

      * é«˜çº§ç”¨æ³•@SafeArea

        ```swift
        make.top.equalTo(view.safeAreaLayoutGuide.snp.top).offset(10)
        ```

      * é«˜çº§ç”¨æ³•@é“¾å¼å¤šæ¡ä»¶

        ```swift
        make.edges.equalToSuperview().inset(UIEdgeInsets(top: 10, left: 15, bottom: 20, right: 15))
        ```

#### 2.4ã€[**Alamofire**](https://github.com/Alamofire/Alamofire) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **Alamofire** æ˜¯ Swift ç¤¾åŒºæœ€æµè¡Œçš„ **ç½‘ç»œè¯·æ±‚åº“**ï¼ŒåŸºäº **URLSession** å°è£…ï¼Œç®€åŒ–äº† HTTP è¯·æ±‚ã€å“åº”å¤„ç†ã€JSON è§£æã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç­‰æ“ä½œã€‚
>  å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š
>
> - è¯­æ³•ç®€æ´ï¼Œé“¾å¼è°ƒç”¨
> - å†…ç½® JSON/Plist å‚æ•°ç¼–ç ä¸è§£æ
> - æ”¯æŒä¸Šä¼ /ä¸‹è½½ï¼ˆå«è¿›åº¦å›è°ƒï¼‰
> - æ”¯æŒè®¤è¯ï¼ˆBasic Authã€OAuth Bearer Token ç­‰ï¼‰
> - é›†æˆäº†ç½‘ç»œè¯·æ±‚é˜Ÿåˆ—ã€å“åº”åºåˆ—åŒ–ã€é”™è¯¯å¤„ç†ç­‰å¸¸è§åŠŸèƒ½
>
> åœ¨ iOS å¼€å‘ä¸­ï¼Œå®ƒç›¸å½“äº Objective-C æ—¶ä»£çš„ **AFNetworking** çš„ Swift æ›¿ä»£ã€‚

* å®‰è£…
  
    * CocoaPods
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'Alamofire'
      ```
    
    * Swift Package Manager
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/Alamofire/Alamofire.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import Alamofire
  ```
  
* è°ƒç”¨
  
    * GET è¯·æ±‚
    
      ```swift
      import Alamofire
      
      AF.request("https://api.example.com/users").response { response in
          debugPrint(response)
      }
      ```
    
    * GET + JSON è§£æ
    
      ```swift
      AF.request("https://api.example.com/users")
          .responseJSON { response in
              switch response.result {
              case .success(let value):
                  print("è¿”å› JSON: \(value)")
              case .failure(let error):
                  print("è¯·æ±‚å¤±è´¥: \(error)")
              }
          }
      ```
    
    * POST è¯·æ±‚ï¼ˆå¸¦å‚æ•°ï¼‰
    
      ```swift
      let params: [String: Any] = [
          "username": "jobs",
          "password": "123456"
      ]
      
      AF.request("https://api.example.com/login",
                 method: .post,
                 parameters: params,
                 encoding: JSONEncoding.default)
          .responseJSON { response in
              print(response)
          }
      ```
    
    * æ–‡ä»¶ä¸Šä¼ 
    
      ```swift
      AF.upload(multipartFormData: { formData in
          formData.append(Data("jobs".utf8), withName: "username")
          formData.append(URL(fileURLWithPath: "/path/to/file.png"), withName: "file")
      }, to: "https://api.example.com/upload")
      .responseJSON { response in
          print(response)
      }
      ```
    
    * æ–‡ä»¶ä¸‹è½½
    
      ```swift
      let destination: DownloadRequest.Destination = { _, _ in
          let documentsURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)[0]
          let fileURL = documentsURL.appendingPathComponent("file.zip")
      
          return (fileURL, [.removePreviousFile, .createIntermediateDirectories])
      }
      
      AF.download("https://example.com/file.zip", to: destination)
          .downloadProgress { progress in
              print("ä¸‹è½½è¿›åº¦: \(progress.fractionCompleted)")
          }
          .response { response in
              print("ä¸‹è½½å®Œæˆ: \(response.fileURL)")
          }
      
      ```
    
    * å…¨å±€é…ç½®ï¼ˆæ¯”å¦‚ç»Ÿä¸€ Headerã€è¶…æ—¶è®¾ç½®ï¼‰
    
      ```swift
      let configuration = URLSessionConfiguration.default
      configuration.timeoutIntervalForRequest = 30
      
      let session = Session(configuration: configuration)
      
      session.request("https://api.example.com/data").responseJSON { response in
          print(response)
      }
      ```
    
    * é“¾å¼è°ƒç”¨
    
      ```swift
      AF.request("https://api.example.com/user")
          .validate(statusCode: 200..<300)
          .responseDecodable(of: User.self) { response in
              switch response.result {
              case .success(let user):
                  print("ç”¨æˆ·æ•°æ®: \(user)")
              case .failure(let error):
                  print("é”™è¯¯: \(error)")
              }
          }

#### 2.5ã€[**Moya**](https://github.com/Moya/Moya) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> - **å®šä½**ï¼š[**Moya**](https://github.com/Moya/Moya) æ˜¯ä¸€ä¸ª **ç½‘ç»œæŠ½è±¡å±‚**ï¼ˆNetworking Abstraction Layerï¼‰ã€‚
> - **åº•å±‚**ï¼šå®ƒåŸºäº [**Alamofire**](https://github.com/Alamofire/Alamofire) å®ç°è¯·æ±‚å‘é€ï¼Œä½†å¯¹ä¸šåŠ¡å¼€å‘è€…å±è”½äº†ç¹ççš„é…ç½®ã€‚
> - **æ ¸å¿ƒæ€æƒ³**ï¼šç”¨ **æšä¸¾ï¼ˆenumï¼‰+ åè®®ï¼ˆTargetTypeï¼‰** æ¥å®šä¹‰æ¥å£ã€‚
>
> è¿™æ ·åšçš„å¥½å¤„ï¼š
>
> 1. **æ¥å£é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰ API è·¯å¾„ã€å‚æ•°ã€è¯·æ±‚æ–¹å¼å†™åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ¸…æ™°å¯ç»´æŠ¤ã€‚
> 2. **é¿å…é­”æ³•å­—ç¬¦ä¸²**ï¼šä¸éœ€è¦åœ¨ä»£ç é‡Œåˆ°å¤„æ‹¼æ¥ URLã€HTTP æ–¹æ³•ã€‚
> 3. **æ›´é€‚åˆå¤šäººåä½œ**ï¼šè§„èŒƒåŒ– API å±‚ï¼Œé™ä½å‡ºé”™ç‡ã€‚

* å®‰è£…
  
    * CocoaPods
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      pod 'Moya'
      ```
    
    * Swift Package Manager
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/Moya/Moya.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import Moya
  ```

* è°ƒç”¨

  * å®šä¹‰ API æšä¸¾

    ```swift
    enum MyService {
        case getUser(id: Int)
        case createUser(name: String, age: Int)
    }
    
    // éµå¾ª TargetType åè®®
    extension MyService: TargetType {
        var baseURL: URL { URL(string: "https://api.example.com")! }
    
        var path: String {
            switch self {
            case .getUser(let id):
                return "/user/\(id)"
            case .createUser:
                return "/user"
            }
        }
    
        var method: Moya.Method {
            switch self {
            case .getUser:
                return .get
            case .createUser:
                return .post
            }
        }
    
        var task: Task {
            switch self {
            case .getUser:
                return .requestPlain
            case .createUser(let name, let age):
                return .requestParameters(parameters: ["name": name, "age": age],
                                          encoding: JSONEncoding.default)
            }
        }
    
        var headers: [String: String]? {
            ["Content-Type": "application/json"]
        }
    }
    ```

  * åˆ›å»º Provider

    ```swift
    let provider = MoyaProvider<MyService>()
    ```

  * å‘é€è¯·æ±‚

    ```swift
    // GET
    provider.request(.getUser(id: 1)) { result in
        switch result {
        case .success(let response):
            print("è¿”å›: \(response.data)")
        case .failure(let error):
            print("é”™è¯¯: \(error)")
        }
    }
    
    // POST
    provider.request(.createUser(name: "Jobs", age: 18)) { result in
        switch result {
        case .success(let response):
            print("åˆ›å»ºæˆåŠŸ: \(response.data)")
        case .failure(let error):
            print("å¤±è´¥: \(error)")
        }
    }
    ```

  * æ’ä»¶æœºåˆ¶ï¼ˆå¯ä»¥æ‹¦æˆªè¯·æ±‚/å“åº”ï¼Œä¾‹å¦‚ç»Ÿä¸€æ‰“å°æ—¥å¿—ã€æ·»åŠ  tokenï¼‰

    ```swift
    final class NetworkLogger: PluginType {
        func willSend(_ request: RequestType, target: TargetType) {
            print("â¡ï¸ è¯·æ±‚: \(request.request?.url?.absoluteString ?? "")")
        }
    
        func didReceive(_ result: Result<Response, MoyaError>, target: TargetType) {
            print("â¬…ï¸ å“åº”: \(result)")
        }
    }
    
    let provider = MoyaProvider<MyService>(plugins: [NetworkLogger()])
    ```

  * å“åº”æ¨¡å‹è§£æ

    ```swift
    provider.request(.getUser(id: 1)) { result in
        switch result {
        case .success(let response):
            do {
                let user = try JSONDecoder().decode(User.self, from: response.data)
                print("ç”¨æˆ·: \(user)")
            } catch {
                print("è§£æå¤±è´¥: \(error)")
            }
        case .failure(let error):
            print("è¯·æ±‚é”™è¯¯: \(error)")
        }
    }
    ```

  * **Stubï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰**ï¼šé€‚åˆå†™å•å…ƒæµ‹è¯•æˆ–æœ¬åœ°å¼€å‘

    ```swift
    let stubProvider = MoyaProvider<MyService>(stubClosure: MoyaProvider.immediatelyStub)
    stubProvider.request(.getUser(id: 1)) { result in
        print(result)
    }
    ```

#### 2.6ã€[**RxSwift**](https://github.com/ReactiveX/RxSwift) <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **æœ€å°ä¾èµ–**ï¼šåªç”¨ `RxSwift`ã€‚
>
> **MVVM å¼€å‘**ï¼šé€šå¸¸ `RxSwift + RxCocoa + RxRelay` ä¸€èµ·ç”¨ã€‚
>
> âœ… **ä¼˜ç‚¹**
>
> - ç»Ÿä¸€äº‹ä»¶æµï¼ˆUIã€ç½‘ç»œã€é€šçŸ¥ã€å®šæ—¶å™¨ç­‰ï¼‰
> - ä»£ç å£°æ˜å¼ï¼Œå¯è¯»æ€§å¥½
> - å¤©ç„¶é€‚åˆ MVVM æ¶æ„
>
> âš ï¸ **ç¼ºç‚¹**
>
> - å­¦ä¹ æ›²çº¿é™¡å³­ï¼ˆæ“ä½œç¬¦å¤šï¼‰
> - è°ƒè¯•ä¸ç›´è§‚ï¼ˆéœ€è¦ä¹ æƒ¯äº‹ä»¶æµæ€ç»´ï¼‰
> - ä¸æ³¨æ„é‡Šæ”¾å¯èƒ½å¯¼è‡´ **å†…å­˜æ³„æ¼**

* å®‰è£…
  
    * CocoaPods
    
      > åœ¨ `Podfile` ä¸­æ·»åŠ ï¼š
    
      ```ruby
      # æ ¸å¿ƒåº“
      pod 'RxSwift', # æ ¸å¿ƒ
      pod 'RxCocoa', # UI ç»‘å®šï¼šUIKitã€AppKit çš„æ‰©å±•
      pod 'RxRelay', # å®‰å…¨æ›¿ä»£ Variableï¼Œå¸¸ç”¨äº ViewModel
      ```
    
    * Swift Package Manager
    
      > Xcode â†’ File â†’ Add Packages Dependency â†’ è¾“å…¥ï¼š
    
      ```url
      https://github.com/ReactiveX/RxSwift.git
      ```
    
* å¯¼å…¥
  
    ```swift
  import RxSwift    // æ ¸å¿ƒ Observable / Observer / Disposable
  import RxCocoa    // UI æ§ä»¶ç»‘å®šï¼ˆå¦‚ textField.rx.textã€button.rx.tapï¼‰
  import RxRelay    // BehaviorRelay / PublishRelay
  ```
  
* è°ƒç”¨
  
    > **æŒ‰é’®**ï¼š`tap.throttle + withLatestFrom(æœ€æ–°è¾“å…¥)`
  >
  > **è¾“å…¥**ï¼š`debounce + distinctUntilChanged + filter`
  >
  > **UI ç»‘å®š**ï¼šå°½é‡ç”¨ `Driver/Signal`ï¼ˆä¸»çº¿ç¨‹ã€æ—  errorã€å…±äº«ï¼‰
  >
  > **ç›‘å¬**ï¼š`NotificationCenter.default.rx.notification(name[, object])`
  >
  > **è§£æ**ï¼š`compactMap` å®‰å…¨å– `userInfo`
  >
  > **æ€§èƒ½**ï¼š`debounce/throttle/distinctUntilChanged/share(replay:)`
  >
  > **é‡Šæ”¾**ï¼š`disposed(by: bag)` å³å¯ï¼Œæ— éœ€ `removeObserver`
  
  * æŒ‰é’®é˜²è¿ç‚¹ï¼ˆèŠ‚æµï¼‰
  
    ```swift
    loginBtn.rx.tap
        .throttle(.milliseconds(500), scheduler: MainScheduler.instance) // 500ms å†…åªè®¤ç¬¬ä¸€æ¬¡
        .withLatestFrom(Observable.combineLatest(vm.username, vm.password)) // ç‚¹ä¸€ä¸‹å¸¦æœ€æ–°è¾“å…¥
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * è¾“å…¥æ¡†å®æ—¶æ ¡éªŒï¼ˆé•¿åº¦/é‚®ç®±ç­‰ï¼‰
  
    ```swift
    let usernameValid = usernameTF.rx.text.orEmpty
        .map { $0.count >= 3 }
        .distinctUntilChanged()
        .share(replay: 1)
    
    let passwordValid = passwordTF.rx.text.orEmpty
        .map { $0.count >= 6 }
        .distinctUntilChanged()
        .share(replay: 1)
    
    // é‚®ç®±ç¤ºä¾‹ï¼ˆå¯é€‰ï¼‰
    let emailValid = usernameTF.rx.text.orEmpty
        .map { text in
            let pattern = #"^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$"#
            return text.range(of: pattern, options: [.regularExpression, .caseInsensitive]) != nil
        }
        .share(replay: 1)
    ```
  
  * å¯ç”¨æŒ‰é’® + è§†è§‰æ€
  
    ```swift
    Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .bind(to: loginBtn.rx.isEnabled)
        .disposed(by: bag)
    
    Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .map { $0 ? 1.0 : 0.5 }
        .bind(to: loginBtn.rx.alpha)
        .disposed(by: bag)
    ```
  
  * æœç´¢è¾“å…¥ï¼šå»æŠ– + å»é‡ + éç©º
  
    ```swift
    let searchText = searchTF.rx.text.orEmpty
        .debounce(.milliseconds(300), scheduler: MainScheduler.instance) // åœæ­¢è¾“å…¥300mså†å‘
        .distinctUntilChanged()
        .filter { !$0.isEmpty } // è¿‡æ»¤ç©ºä¸²
        .share(replay: 1)
    
    searchText
        .subscribe(onNext: { query in
            // fire search(query)
        })
        .disposed(by: bag)
    ```
  
  * é™åˆ¶æœ€å¤§é•¿åº¦ï¼ˆå›å†™ UIï¼‰
  
    ```swift
    let limitedPwd = passwordTF.rx.text.orEmpty
        .map { String($0.prefix(20)) } // æœ€å¤š 20 ä½
        .share(replay: 1)
    
    limitedPwd
        .bind(to: passwordTF.rx.text)
        .disposed(by: bag)
    ```
  
  * Return é”®è¡Œä¸ºï¼ˆä¸‹ä¸€æ­¥ / æäº¤ï¼‰
  
    ```swift
    // ç”¨æˆ·åå›è½¦ -> ç„¦ç‚¹ç§»åˆ°å¯†ç 
    usernameTF.rx.controlEvent(.editingDidEndOnExit)
        .subscribe(onNext: { [weak self] in self?.passwordTF.becomeFirstResponder() })
        .disposed(by: bag)
    
    // å¯†ç å›è½¦ -> è§¦å‘ç™»å½•ï¼ˆå¸¦æœ€æ–°è¾“å…¥ï¼‰
    passwordTF.rx.controlEvent(.editingDidEndOnExit)
        .withLatestFrom(Observable.combineLatest(vm.username, vm.password))
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * ç”¨ Driver åš UI ç»‘å®šï¼ˆæ¨èï¼‰
  
    ```swift
    let canLogin = Observable.combineLatest(usernameValid, passwordValid) { $0 && $1 }
        .asDriver(onErrorJustReturn: false)
    
    canLogin
        .drive(loginBtn.rx.isEnabled)
        .disposed(by: bag)
    
    canLogin
        .map { $0 ? 1.0 : 0.5 }
        .drive(loginBtn.rx.alpha)
        .disposed(by: bag)
    ```
  
  * å®æˆ˜æœ€å°ç»„åˆï¼ˆæŒ‰é’®ç‚¹å‡» + æœ€æ–°å€¼ + èŠ‚æµï¼‰
  
    ```swift
    let creds = Observable.combineLatest(usernameTF.rx.text.orEmpty,
                                         passwordTF.rx.text.orEmpty) { ($0, $1) }
        .share(replay: 1)
    
    loginBtn.rx.tap
        .throttle(.milliseconds(500), scheduler: MainScheduler.instance)
        .withLatestFrom(creds)
        .subscribe(onNext: { (u, p) in
            // do login(u, p)
        })
        .disposed(by: bag)
    ```
  
  * ç›‘å¬ç³»ç»Ÿé€šçŸ¥ï¼ˆNotificationCenter â†’ Rxï¼‰
  
    ```swift
    import RxSwift
    import RxCocoa
    
    let bag = DisposeBag()
    
    NotificationCenter.default.rx.notification(UIApplication.didBecomeActiveNotification)
        .subscribe(onNext: { _ in
            print("app å›åˆ°å‰å°")
        })
        .disposed(by: bag)
    ```
  
  * ç›‘å¬ + å– `userInfo`ï¼ˆå®‰å…¨è§£åŒ…ï¼‰
  
    ```swift
    extension Notification.Name {
        static let loginStateChanged = Notification.Name("loginStateChanged")
    }
    
    // ç›‘å¬
    NotificationCenter.default.rx.notification(.loginStateChanged)
        .compactMap { $0.userInfo?["isLogin"] as? Bool }
        .distinctUntilChanged()
        .subscribe(onNext: { isLogin in
            print("ç™»å½•æ€ï¼š\(isLogin)")
        })
        .disposed(by: bag)
    
    // å‘é€
    NotificationCenter.default.post(name: .loginStateChanged, object: nil, userInfo: ["isLogin": true])
    ```
  
  * é”®ç›˜é€šçŸ¥ï¼šæ‹¿é«˜åº¦ & åŠ¨ç”»æ—¶é•¿ï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰
  
    ```swift
    let willChange = NotificationCenter.default.rx.notification(UIResponder.keyboardWillChangeFrameNotification)
    
    let keyboardInfo = willChange
        .compactMap { note -> (height: CGFloat, duration: TimeInterval) in
            let endFrame = (note.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] as? NSValue)?.cgRectValue ?? .zero
            let duration = (note.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] as? NSNumber)?.doubleValue ?? 0.25
            return (height: endFrame.height, duration: duration)
        }
        .share(replay: 1)
    
    keyboardInfo
        .subscribe(onNext: { info in
            // è°ƒæ•´åº•éƒ¨çº¦æŸ / contentInset
            // self.bottomConstraint.constant = info.height
            // UIView.animate(withDuration: info.duration) { self.view.layoutIfNeeded() }
        })
        .disposed(by: bag)
    ```
  
  * æ­é… `Driver`ï¼ˆä¸»çº¿ç¨‹ã€æ—  errorï¼Œç”¨äºé©±åŠ¨ UIï¼‰
  
    ```swift
    let becameActiveDriver: Driver<Void> =
        NotificationCenter.default.rx.notification(UIApplication.didBecomeActiveNotification)
            .map { _ in () }
            .asDriver(onErrorDriveWith: .empty())
    
    becameActiveDriver
        .drive(onNext: { print("åˆ·æ–° UI") })
        .disposed(by: bag)
    ```
  
  * è¿‡æ»¤æŒ‡å®šå¯¹è±¡çš„é€šçŸ¥ï¼ˆ`object:`ï¼‰
  
    ```swift
    let object = someObject
    
    NotificationCenter.default.rx.notification(.someName, object: object)
        .subscribe(onNext: { _ in print("åªå“åº”è¿™ä¸ª object çš„é€šçŸ¥") })
        .disposed(by: bag)
    ```
  
  * throttle / debounceï¼ˆé€šçŸ¥é£æš´å»æŠ–ï¼‰
  
    ```swift
    NotificationCenter.default.rx.notification(.NSManagedObjectContextDidSave)
        .debounce(.milliseconds(300), scheduler: MainScheduler.instance)
        .subscribe(onNext: { _ in
            // åˆå¹¶çŸ­æ—¶é—´å†…çš„å¤šæ¬¡å˜æ›´
        })
        .disposed(by: bag)
    ```
  
  * ç”Ÿå‘½å‘¨æœŸé€šçŸ¥ï¼ˆå¸¸ç”¨æ¸…å•ï¼‰
  
    ```swift
    NotificationCenter.default.rx.notification(UIApplication.willEnterForegroundNotification)
    NotificationCenter.default.rx.notification(UIApplication.didEnterBackgroundNotification)
    NotificationCenter.default.rx.notification(UIApplication.didReceiveMemoryWarningNotification)
    ```
  
  * é€šçŸ¥æ›´é€‚åˆ**è·¨æ¨¡å—/ç³»ç»Ÿçº§å¹¿æ’­**ï¼›æ¨¡å—å†…é€šä¿¡ä¼˜å…ˆ `Relay/Subject`ã€‚
  
    > **åŒæ¨¡å—/åŒå±‚å†…**ä¼ æ’­äº‹ä»¶ï¼šç”¨ `PublishRelay` / `BehaviorRelay` æ¯”é€šçŸ¥æ›´ç±»å‹å®‰å…¨ã€å¯æµ‹è¯•ã€‚
  
    ```swift
    let evt = PublishRelay<Void>()
    evt.accept(())          // å‘é€
    evt.asSignal()          // ç»™ UI ç»‘å®š
    ```
  

### 3ã€å…¶ä»– <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* ä¸ªåˆ«åœ°åŒºï¼ˆæ¯”å¦‚ï¼šæŸ¬åŸ”å¯¨ï¼‰ï¼Œéœ€è¦å°†æµè§ˆå™¨è¯­è¨€æ”¹ä¸ºè‹±æ–‡çŠ¶æ€ï¼Œæ–¹å¯è¿›å…¥[**è‹¹æœå¼€å‘è€…ç½‘ç«™**](https://developer.apple.com/)
* [**quicktype**](https://app.quicktype.io/)ï¼šä» **JSON** / **GraphQL** /å…¶å®ƒæ•°æ®æ ¼å¼ è‡ªåŠ¨ç”Ÿæˆå¯¹åº”è¯­è¨€çš„ç±»å‹å®šä¹‰
* **ObjC**å’Œ[**Swift**](https://developer.apple.com/swift/)æ··ç¼–ä»¥åï¼ŒğŸ“¦æ‰“åŒ…çš„ä½“ç§¯ä¼šå˜å¤§
  * [**Swift**](https://developer.apple.com/swift/) æ ‡å‡†åº“è¦éš App æ‰“åŒ…ï¼šiOS ç³»ç»Ÿé‡Œä¸å†…ç½® [**Swift**](https://developer.apple.com/swift/) æ ‡å‡†åº“ï¼ˆè‡³å°‘ä¸èƒ½ä¾èµ–å®ƒä¸€å®šå­˜åœ¨ï¼‰ï¼Œåªè¦é¡¹ç›®é‡Œç”¨äº† [**Swift**](https://developer.apple.com/swift/)ï¼Œå°±å¾—æŠŠ `libswift*.dylib` ä¸€èµ·å¸¦ä¸Šã€‚**ä½“æ„Ÿå¢é‡ï¼š~2â€“7 MB/æ¶æ„ï¼ˆå‹ç¼©åæ›´å°ï¼‰**ï¼Œå–å†³äºç”¨åˆ°çš„æ¨¡å—æ•°é‡
  * æ··ç¼–æœ¬èº«ä¸ä¼šé‡å¤æ‰“åŒ… **ObjC** è¿è¡Œæ—¶ï¼š**ObjC** Runtime å±äºç³»ç»Ÿï¼Œçº¯ **ObjC** å’Œæ··ç¼–åœ¨è¿™æ–¹é¢æ²¡å·®
  * é“¾æ¥å™¨é€‰é¡¹å¯èƒ½æ”¾å¤§ï¼šæ¯”å¦‚ `-ObjC` å¯èƒ½æŠŠé™æ€åº“é‡Œå¾ˆå¤šä¸éœ€è¦çš„å¯¹è±¡ä¸€èµ·æ‹‰è¿›æ¥ï¼Œé€ æˆè†¨èƒ€ï¼ˆå’Œæ˜¯å¦æ··ç¼–æ— å…³ï¼Œä½†æ··ç¼–é¡¹ç›®æ›´å®¹æ˜“â€œå…¨éƒ½è¦â€ï¼‰

## ä¸‰ã€ğŸ’»ä»£ç è®²è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€â›“ï¸é“¾å¼è°ƒç”¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `UILabel`

  ```swift
  let label = UILabel()
     .byFont(.systemFont(ofSize: 16))
     .byTextColor(.black)
     .byText("ç›®å½•".localized())
     .byTextAlignment(.center)
     .makeLabelByShowingType(.oneLineTruncatingTail)
     .bgImage(UIImage(named: "bg_pattern"))
     .byNextText(" â†’ More")
  ```

* `UIBUtton`

* `UITableView`

* `UICollectionView`

* `UIImageView`

* 

### 2ã€ğŸ“å…¨å±€æ¯”ä¾‹å°º <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å®ç°

  ```swift
  import UIKit
  
  // MARK: - æ ¸å¿ƒæ¯”ä¾‹å™¨
  public enum JXScale {
      private static var designW: CGFloat = 375
      private static var designH: CGFloat = 812
      private static var useSafeArea: Bool = false
      
      public static func setup(designWidth: CGFloat, designHeight: CGFloat, useSafeArea: Bool = false) {
          self.designW = designWidth
          self.designH = designHeight
          self.useSafeArea = useSafeArea
      }
      
      private static var screenSize: CGSize {
          guard let window = UIApplication.shared.windows.first(where: { $0.isKeyWindow }) else {
              return UIScreen.main.bounds.size
          }
          if useSafeArea {
              let insets = window.safeAreaInsets
              return CGSize(
                  width: max(0, window.bounds.width - (insets.left + insets.right)),
                  height: max(0, window.bounds.height - (insets.top + insets.bottom))
              )
          } else {
              return window.bounds.size
          }
      }
      
      public static var x: CGFloat { screenSize.width / designW }
      public static var y: CGFloat { screenSize.height / designH }
  }
  
  // MARK: - æ‰©å±• Int / CGFloat
  public extension BinaryInteger {
      var w: CGFloat { CGFloat(self) * JXScale.x }
      var h: CGFloat { CGFloat(self) * JXScale.y }
      var fz: CGFloat { CGFloat(self) * JXScale.x }   // å­—ä½“ç¼©æ”¾ï¼Œé»˜è®¤è·Ÿéš X
  }
  
  public extension BinaryFloatingPoint {
      var w: CGFloat { CGFloat(self) * JXScale.x }
      var h: CGFloat { CGFloat(self) * JXScale.y }
      var fz: CGFloat { CGFloat(self) * JXScale.x }
  }
  ```

* å…¥å£é…ç½®

  ```swift
  import UIKit
  
  @main
  class AppDelegate: UIResponder, UIApplicationDelegate {
  
      func application(
          _ application: UIApplication,
          didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
      ) -> Bool {
          JXScale.setup(designWidth: 375, designHeight: 812, useSafeArea: false)
          return true
      }
  
      // MARK: UISceneSession Lifecycle
      func application(
          _ application: UIApplication,
          configurationForConnecting connectingSceneSession: UISceneSession,
          options: UIScene.ConnectionOptions
      ) -> UISceneConfiguration {
          return UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
      }
  }
  ```

* è°ƒç”¨

  ```swift
  CGRect(x: 20.w, y: 100.h, width: 200.w, height: 40.h)
  ```

### 3ã€ğŸ–¨ï¸ æ—¥å¿—æ‰“å°å·¥å…·çš„å°è£… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> âœ… ç»Ÿä¸€æ ¼å¼ï¼Œè‡ªåŠ¨å¸¦ä¸Šæ–‡ä»¶åã€è¡Œå·ã€å‡½æ•°å
>
> âœ… åŒºåˆ† `print` / `debugPrint` ä½¿ç”¨åœºæ™¯
>
> âœ… å¯ä»¥åŠ å¼€å…³ï¼ˆ`isDebugEnabled` / `#if DEBUG`ï¼‰æ¥æ§åˆ¶æ˜¯å¦è¾“å‡º
>
> âœ… æ—¥å¿—ç­‰çº§æ¸…æ™°ï¼ˆinfo / warning / error / debugï¼‰

```swift
enum LogLevel: String {
    case info = "â„¹ï¸ INFO"
    case warning = "âš ï¸ WARNING"
    case error = "âŒ ERROR"
    case debug = "ğŸ DEBUG"
}

struct JobsLogger {
    // æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼
    static var isDebugEnabled: Bool = true

    /// æ™®é€šæ—¥å¿—ï¼ˆprintï¼‰
    static func log(_ items: Any..., level: LogLevel = .info,
                    file: String = #file, line: Int = #line, function: String = #function) {
        #if DEBUG
        let fileName = (file as NSString).lastPathComponent
        let message = items.map { "\($0)" }.joined(separator: " ")
        Swift.print("[\(level.rawValue)] \(fileName):\(line) \(function) â†’ \(message)")
        #endif
    }

    /// è°ƒè¯•æ—¥å¿—ï¼ˆdebugPrintï¼‰
    static func debug(_ items: Any..., file: String = #file, line: Int = #line, function: String = #function) {
        #if DEBUG
        guard isDebugEnabled else { return }
        let fileName = (file as NSString).lastPathComponent
        Swift.debugPrint("[\(LogLevel.debug.rawValue)] \(fileName):\(line) \(function) â†’", terminator: " ")
        for item in items {
            Swift.debugPrint(item, terminator: " ")
        }
        Swift.debugPrint("") // æ¢è¡Œ
        #endif
    }
}
```

> ```swift
> struct User: CustomStringConvertible, CustomDebugStringConvertible {
>     let name: String
>     var description: String { "ğŸ‘¤ ç”¨æˆ·å: \(name)" }
>     var debugDescription: String { "User(name: \(name))" }
> }
> 
> let u = User(name: "Jobs")
> 
> JobsLogger.log("åº”ç”¨å¯åŠ¨æˆåŠŸ")  
> // [â„¹ï¸ INFO] AppDelegate.swift:23 application(_:didFinishLaunchingWithOptions:) â†’ åº”ç”¨å¯åŠ¨æˆåŠŸ
> 
> JobsLogger.log("ç½‘ç»œè¶…æ—¶", level: .warning)
> // [âš ï¸ WARNING] NetworkManager.swift:87 request() â†’ ç½‘ç»œè¶…æ—¶
> 
> JobsLogger.debug(u)
> // [ğŸ DEBUG] ViewController.swift:45 viewDidLoad() â†’ User(name: Jobs)
> ```

### 4ã€é¿å…ä» `XIB`/`Storyboard` åˆå§‹åŒ– <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
required init?(coder: NSCoder) {
    fatalError()
}
```



## å››ã€[**Swift**](https://developer.apple.com/swift/) è¯­è¨€ç‰¹æ€§ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€æ³¨è§£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

- `@available(...)` / `@unavailable(...)`

  > æ§åˆ¶å¹³å°/ç‰ˆæœ¬å¯ç”¨æ€§ã€å¼ƒç”¨ä¿¡æ¯

  ```swift
  @available(iOS 14, *) 
  func foo() {}
  
  @available(*, deprecated, message: "Use newFoo()")
  func oldFoo() {}
  
  @unavailable(iOS, message: "Not on iOS")
  func macOnly() {}

- `@main` æŒ‡å®šç¨‹åºå…¥å£

  > å–ä»£æ—§çš„ `@UIApplicationMain` / `@NSApplicationMain`

  ```swift
  @main
  struct AppMain {
    static func main() { /* ... */ }
  }
  ```

- `@inlinable` / `@usableFromInline`

  > è·¨æ¨¡å—å†…è”/ç¬¦å·å¯è§æ€§å¾®æ§ï¼ˆå‘å¸ƒåº“æ—¶å¸¸ç”¨ï¼‰

  ```swift
  @inlinable public func add(_ a:Int,_ b:Int)->Int { a+b }
  @usableFromInline internal let cache = ...
  ```
  
- `@frozen`

  > å†»ç»“ `enum` çš„å¸ƒå±€ï¼Œä¿è¯ ABI ç¨³å®šï¼ˆåº“ä½œè€…ç”¨ï¼‰

  ```swift
  @frozen public enum ColorSpace { case srgb, displayP3 }
  ```

- `@discardableResult`

  > å…è®¸ä¸¢å¼ƒè¿”å›å€¼ï¼ˆé“¾å¼ API å¸¸ç”¨ï¼‰

  ```swift
  @discardableResult
  func setTitle(_ s:String) -> Self { /* ... */ return self }
  ```

- `@escaping`

  > æ ‡è®°é€ƒé€¸é—­åŒ…å‚æ•°

  ```swift
  func asyncOp(_ block: @escaping ()->Void) { /* store & call later */ }
  ```

- `@autoclosure`

  > è°ƒç”¨ç«¯å¯çœç•¥ `{}` å»¶è¿Ÿæ±‚å€¼

  ```swift
  func assert(_ cond: @autoclosure ()->Bool) {}
  assert(1 < 2)   // ç­‰ä»·äº { 1 < 2 }
  ```

- `@Sendable`

  > å¹¶å‘å®‰å…¨é—­åŒ…ï¼ˆè·¨ actor/çº¿ç¨‹ï¼‰

  ```swift
  func run(_ job: @Sendable ()->Void) {}
  ```

- `@MainActor` / è‡ªå®šä¹‰ `@globalActor`

  > å°†å‡½æ•°/ç±»å‹é™å®šåœ¨ä¸»çº¿ç¨‹æˆ–æŸä¸ª actor ä¸Š

  ```swift
  @MainActor
  class ViewModel {
    func updateUI() {}
  }
  ```

- `@preconcurrency`

  > ä¸ºæ—§æ¥å£æä¾›å‘åå…¼å®¹çš„å¹¶å‘æ³¨é‡Šï¼ˆè¿ç§»æœŸä¼šè§åˆ°ï¼‰

- `@objc` / `@objcMembers` / `@nonobjc`

  > æš´éœ²/éšè—ç»™ **Objective-C** è¿è¡Œæ—¶ï¼ˆSelectorã€KVC/KVOã€IB éœ€è¦ï¼‰

  ```swift
  @objcMembers class Foo: NSObject {
    func bar() {}          // å…¨éƒ¨é»˜è®¤ @objc
    @nonobjc func swiftOnly() {}
  }
  ```

- `@warn_unqualified_access`

  > æœªåŠ ç±»å‹å‰ç¼€è°ƒç”¨æ—¶äº§ç”Ÿè­¦å‘Šï¼Œé€¼è°ƒç”¨æ–¹åŠ å‰ç¼€ï¼Œé¿å… API åç§°å†²çª

  ```swift
  @warn_unqualified_access
  func ambiguous() {}
  ```

- `@dynamicMemberLookup` & `@dynamicCallable`

  > è®©ç±»å‹æ”¯æŒ `obj.someName` åŠ¨æ€è§£ææˆ–åƒå‡½æ•°ä¸€æ ·è¢«â€œè°ƒç”¨â€

  ```swift
  @dynamicMemberLookup
  struct JSON {
    subscript(dynamicMember key: String) -> JSON { /* ... */ JSON() }
  }
  ```

- `@resultBuilder`

  > SwiftUI ç­‰ DSL èƒŒåçš„æœºåˆ¶ã€‚ä½ ç”¨åˆ°çš„å¤šæ˜¯æ¡†æ¶æä¾›çš„å…·ä½“ builder

  ```swift
  @resultBuilder
  struct HTMLBuilder { /* ... */ }
  ```

- `@testable import ModuleName`

  > å…è®¸æµ‹è¯•è®¿é—®ç›®æ ‡æ¨¡å—çš„ internal æˆå‘˜

- `@IBAction` / `@IBOutlet`

  > è¿æ¥ storyboard/xib

  ```swift
  @IBAction func didTap(_ sender: UIButton) {}
  @IBOutlet weak var titleLabel: UILabel!
  ```

- `@IBInspectable` / `@IBDesignable`

  > åœ¨ IB å¯ç¼–è¾‘/å®æ—¶æ¸²æŸ“è‡ªå®šä¹‰è§†å›¾å±æ€§

  ```swift
  @IBDesignable
  class CardView: UIView {
    @IBInspectable var corner: CGFloat = 8
  }
  ```

- `@NSManaged`

  > Core Data åŠ¨æ€è§£æå±æ€§/æ–¹æ³•ï¼ˆä¸éœ€è¦è‡ªå·±å®ç°å­˜å–å™¨ï¼‰

  ```swift
  class User: NSManagedObject {
    @NSManaged var name: String
  }
  ```

- `@NSCopying`

  > å±æ€§èµ‹å€¼æ—¶è‡ªåŠ¨æ‹·è´ï¼ˆè¦æ±‚å€¼ç±»å‹å®ç° `NSCopying`ï¼‰

  ```swift
  class Foo: NSObject {
    @NSCopying var path: NSString = ""
  }
  ```

- `@State` / `@Binding` / `@StateObject` / `@ObservedObject`/`@Environment` / `@EnvironmentObject`/`@AppStorage` / `@SceneStorage` / `@FocusState`

  ```swift
  struct Counter: View {
    @State private var count = 0
    var body: some View { Text("\(count)") }
  }
  ```

- `@Published`

  ```swift
  class VM: ObservableObject {
    @Published var name = ""
  }
  ```

- `@unchecked`

  > å®ƒæ˜¯ **[Swift](https://developer.apple.com/swift/) çš„ä¸€ä¸ªå±æ€§ä¿®é¥°ç¬¦**ï¼Œç›®å‰ä¸»è¦å’Œ **åè®® `Sendable`** ç»“åˆä½¿ç”¨
  >
  > æœ¬è´¨å°±æ˜¯ [**Swift**](https://developer.apple.com/swift/) æä¾›çš„ä¸€ä¸ª **å®‰å…¨é€ƒç”Ÿå£**

  ```swift
  /// è·³è¿‡ç¼–è¯‘å™¨çš„å¹¶å‘å®‰å…¨æ£€æŸ¥ï¼Œç”±å¼€å‘è€…è‡ªå·±ä¿è¯ã€‚
  @unchecked Sendable
  ```

  * èƒŒæ™¯ï¼šå¹¶å‘å®‰å…¨æ£€æŸ¥

    > ä» [**Swift**](https://developer.apple.com/swift/) 5.5 å¼•å…¥å¹¶å‘ï¼ˆ`async/await`ã€`Task` ç­‰ï¼‰å¼€å§‹ï¼Œè‹¹æœä¸ºäº†é˜²æ­¢ **æ•°æ®ç«äº‰**ï¼Œæå‡ºäº†ä¸€ä¸ªåè®®ï¼š
    >
    > ```swift
    > protocol Sendable { }
    > ```
    >
    > ä¸€ä¸ªç±»å‹å¦‚æœè¦åœ¨ **å¤šçº¿ç¨‹ / å¹¶å‘ä»»åŠ¡** ä¸­å®‰å…¨ä¼ é€’ï¼Œå°±å¿…é¡»æ˜¯ `Sendable`
    >
    > - å€¼ç±»å‹ï¼ˆ`struct`ï¼Œå†…éƒ¨å…¨æ˜¯ `Sendable` æˆå‘˜ï¼‰ â†’ è‡ªåŠ¨ç¬¦åˆ `Sendable`ã€‚
    > - å¼•ç”¨ç±»å‹ï¼ˆ`class`ï¼‰ â†’ é»˜è®¤ **ä¸æ˜¯ `Sendable`**ï¼Œå› ä¸ºå¼•ç”¨å¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œé€ æˆæ•°æ®ç«äº‰ã€‚

- `@resultBuilder`

- `@ViewBuilder`

- `@SceneBuilder`

- `@ToolbarContentBuilder`

- `@CommandsBuilder`

- `@LibraryContentBuilder`

### 2ã€åè®® <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* [**Swift**](https://developer.apple.com/swift/) çš„ç³»ç»Ÿåè®®å¤§æ¦‚åˆ†å‡ å¤§ç±»

  * **å€¼è¯­ä¹‰**ï¼š`RawRepresentable`, `CaseIterable`

    * ç±»å‹ <-> åŸå§‹å€¼ åŒå‘æ˜ å°„ï¼Œå¸¸ç”¨äºæšä¸¾å’Œ ID åŒ…è£…ç±»å‹

      ```swift
      protocol RawRepresentable {
          associatedtype RawValue
          init?(rawValue: RawValue)
          var rawValue: RawValue { get }
      }
      ```

    * è®©æšä¸¾è‡ªåŠ¨ç”Ÿæˆ `allCases`ï¼Œå¯ä»¥éå†æ‰€æœ‰ case

      ```swift
      protocol CaseIterable {
          associatedtype AllCases: Collection where AllCases.Element == Self
          static var allCases: AllCases { get }
      }
      ```

  * **æ¯”è¾ƒ/å“ˆå¸Œ**ï¼š`Equatable`, `Comparable`, `Hashable`

    * å®šä¹‰åˆ¤ç­‰é€»è¾‘ï¼Œ`==` è¿ç®—ç¬¦

      ```swift
      protocol Equatable {
          static func == (lhs: Self, rhs: Self) -> Bool
      }
      ```

    * æä¾› `<` å®ç°ï¼Œç¼–è¯‘å™¨èƒ½æ¨å¯¼å‡º `>`, `<=`, `>=`

      ```swift
      protocol Comparable : Equatable {
          static func < (lhs: Self, rhs: Self) -> Bool
      }
      ```

    * å¯ä½œä¸º `Set` å…ƒç´ æˆ– `Dictionary` keyï¼Œè¦å’Œ `Equatable` ä¿æŒä¸€è‡´æ€§

      ```swift
      protocol Hashable : Equatable {
          func hash(into hasher: inout Hasher)
      }
      ```

  * **é›†åˆ**ï¼š`Sequence`, `Collection`

    * å¯ä»¥è¢« `for-in` éå†

      ```swift
      protocol Sequence {
          associatedtype Iterator: IteratorProtocol
          func makeIterator() -> Iterator
      }
      ```

    * æ”¯æŒä¸‹æ ‡ã€ç´¢å¼•

      ```swift
      /// Arrayã€Dictionaryã€Set éƒ½ç¬¦åˆ
      protocol Collection : Sequence {
          associatedtype Index : Comparable
          var startIndex: Index { get }
          var endIndex: Index { get }
          subscript(position: Index) -> Element { get }
          func index(after i: Index) -> Index
      }
      ```

  * **è¡¨ç¤º/è°ƒè¯•**ï¼š`CustomStringConvertible`

    * è‡ªå®šä¹‰ print() æ˜¾ç¤ºçš„å†…å®¹

      ```swift
      protocol CustomStringConvertible {
          var description: String { get }
      }
      ```

  * **åºåˆ—åŒ–**ï¼š`Codable`

    * è‡ªåŠ¨/æ‰‹åŠ¨ JSON / Plist åºåˆ—åŒ–ä¸ååºåˆ—åŒ–

      ```swift
      typealias Codable = Decodable & Encodable
      
      protocol Encodable {
          func encode(to encoder: Encoder) throws
      }
      protocol Decodable {
          init(from decoder: Decoder) throws
      }
      ```

  * **å¹¶å‘**ï¼š`Sendable`

    * è¡¨ç¤ºç±»å‹åœ¨å¹¶å‘ä¸­å®‰å…¨ä¼ é€’ã€‚Swift Concurrency çš„ä¸€éƒ¨åˆ†

      ```swift
      protocol Sendable { }
      ```

  * **Foundationæ¡¥æ¥**ï¼š`NSCopying`, `NSSecureCoding`

    * ç”¨äºå¯¹è±¡å¤åˆ¶ `copy()`

      ```swift
      @objc protocol NSCopying {
          func copy(with zone: NSZone? = nil) -> Any
      }
      ```

    * ç”¨äºæŒä¹…åŒ–ã€ä¼ è¾“

      ```swift
      /// æ”¯æŒå®‰å…¨å½’æ¡£ / è§£æ¡£ 
      @objc protocol NSSecureCoding : NSCoding {
          static var supportsSecureCoding: Bool { get }
      }
      ```

*  `associatedtype`

  * `associatedtype` è¡¨ç¤º **åè®®é‡Œçš„å ä½ç±»å‹**ã€‚
  * å®ƒä¸æ˜¯å…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯â€œç±»å‹å‚æ•°â€ï¼Œç­‰åˆ°**æŸä¸ªå…·ä½“ç±»å‹å»éµå®ˆåè®®æ—¶å†æŒ‡å®š**ã€‚
  * å¯ä»¥ç†è§£ä¸º **æ³›å‹çš„åè®®ç‰ˆ**ã€‚
  
*  åœ¨ [**Swift**](https://developer.apple.com/swift/) é‡Œï¼Œ**æ²¡å®ç°**åè®®è¦æ±‚ï¼ˆåŒ…æ‹¬å±æ€§çš„ getter/setterï¼‰ä¼š<font color=red>**ç¼–è¯‘æœŸæŠ¥é”™**</font>ï¼Œ**ä¸ä¼š**ç­‰åˆ°è¿è¡ŒæœŸæ‰â€œé‡æŒ‡é’ˆå´©æºƒâ€ã€‚åªæœ‰èµ° **`@objc` å¯é€‰åè®®** çš„è€è·¯ï¼Œä¸”**å¼ºè¡Œè§£åŒ…/ä¸åšåˆ¤æ–­**ï¼Œæ‰å¯èƒ½åœ¨è¿è¡ŒæœŸå´©ã€‚

*  [**Swift**](https://developer.apple.com/swift/)  â†” **Objc** åè®®å¯¹ç…§

  | Swift åè®®                                                   | ä½œç”¨                     | Swift ç”¨æ³•                                                | Objective-C å¯¹åº”                                             |
  | ------------------------------------------------------------ | ------------------------ | --------------------------------------------------------- | ------------------------------------------------------------ |
  | <font color=red>`Equatable`</font>                           | åˆ¤ç­‰                     | `struct A: Equatable { let id:Int }`                      | è¦†å†™ `-isEqual:`                                             |
  | <font color=red>`Comparable`</font>                          | æ’åºæ¯”è¾ƒ                 | `struct A: Comparable { static func < (...) -> Bool }`    | å®ç° `-compare:`ï¼ˆè¿”å› `NSComparisonResult`ï¼‰ï¼Œæˆ–æä¾›æ’åº block |
  | <font color=red>`Hashable`</font>                            | å¯åš `Set`/å­—å…¸é”®        | `struct A: Hashable { var id:Int }`                       | è¦†å†™ `-isEqual:` + `-hash`                                   |
  | <font color=red>`Identifiable`</font>                        | å”¯ä¸€æ ‡è¯†ï¼ˆSwiftUI/Listï¼‰ | `struct Row: Identifiable { let id: UUID }`               | è‡ªå®šä¹‰ `-identifier` æ–¹æ³•ï¼ˆæ— ç»Ÿä¸€åè®®ï¼‰ï¼Œæˆ–ç”¨ä¸»é”®å­—æ®µ        |
  | `RawRepresentable`                                           | åŸå§‹å€¼æ˜ å°„               | `enum T:Int { case a=1 }`ï¼ˆè‡ªåŠ¨ç¬¦åˆï¼‰                     | `NS_ENUM(NSInteger, T){ T_a=1 }` + è‡ªå†™â€œåŸå§‹å€¼ â†” æšä¸¾â€è½¬æ¢å‡½æ•° |
  | `CaseIterable`                                               | æšä¸¾éå†                 | `enum T: CaseIterable { case a,b }`                       | æ— ç­‰ä»·ï¼›æ‰‹å†™ `+allValues` è¿”å›æ•°ç»„                           |
  | <font color=green>`CustomStringConvertible`</font>           | æ‰“å°å‹å¥½æ–‡æ¡ˆ             | `var description:String { ... }`                          | è¦†å†™ `-description`                                          |
  | <font color=green>`CustomDebugStringConvertible`</font>      | è°ƒè¯•æ–‡æ¡ˆ                 | `var debugDescription:String { ... }`                     | è¦†å†™ `-debugDescription`                                     |
  | <font color=purple >`Error`</font>                           | å¯æŠ›å‡ºé”™è¯¯               | `enum E: Error { case bad }`                              | çº¦å®š `NSError`ï¼ˆåŸŸ/ç /ä¿¡æ¯ï¼‰ï¼Œæˆ–è‡ªå®šä¹‰ `NSError` å·¥å‚        |
  | <font color=purple >`LocalizedError`</font>                  | æœ¬åœ°åŒ–é”™è¯¯               | `var errorDescription:String?`                            | ç”¨ `NSError` çš„ `localizedDescription`                       |
  | `Codable` (`Encodable`/`Decodable`)                          | JSON/Plist ç¼–è§£ç         | `struct A: Codable { ... }`                               | `NSSecureCoding`ï¼ˆå½’æ¡£ï¼‰æˆ–ç¬¬ä¸‰æ–¹ JSONï¼ˆYYModel/MJExtensionï¼‰ï¼Œæˆ–æ‰‹å†™ KVC |
  | <font color=blue>`Sequence`</font>                           | å¯ for-in                | `struct S: Sequence { func makeIterator()->I }`           | éµå¾ª `NSFastEnumeration`ï¼ˆå¦‚ `NSArray`ï¼‰                     |
  | <font color=blue>`IteratorProtocol`</font>                   | è¿­ä»£å™¨                   | `struct I: IteratorProtocol { mutating func next()->T? }` | è‡ªå®šä¹‰æšä¸¾å™¨å¯¹è±¡ï¼Œé…åˆ `NSFastEnumeration`                   |
  | <font color=blue>`Collection`</font>/<br>`BidirectionalCollection`/<br>`RandomAccessCollection` | å¯ä¸‹æ ‡/ç´¢å¼•é›†åˆ          | `struct C: Collection { ... }`                            | `NSArray`/`NSDictionary` ç³»åˆ—ï¼›è‡ªå®šä¹‰éœ€å®ç° `NSFastEnumeration` + ä¸‹æ ‡æ–¹æ³• |
  | `ExpressibleBy*Literal` ç³»åˆ—                                 | å­—é¢é‡åˆå§‹åŒ–             | `struct A: ExpressibleByStringLiteral { ... }`            | æ— ç­‰ä»·ï¼›æä¾›å·¥å‚æ–¹æ³•æˆ–åˆ†ç±»åˆå§‹åŒ–                             |
  | `Sendable`                                                   | å¹¶å‘å¯å®‰å…¨ä¼ é€’           | `struct A: Sendable { ... }`                              | æ— ç­‰ä»·ï¼›é çº¿ç¨‹å®‰å…¨çº¦æŸï¼ˆä¸å¯å˜/é”/é˜Ÿåˆ—ï¼‰                     |
  | `NSCopying`                                                  | æ‹·è´                     | `class A: NSCopying { -copyWithZone: }`                   | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSMutableCopying`                                           | å¯å˜æ‹·è´                 | `-mutableCopyWithZone:`                                   | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSSecureCoding`                                             | å®‰å…¨å½’æ¡£                 | `+supportsSecureCoding` / ç¼–è§£ç                           | åŒååè®®ï¼ˆFoundationï¼‰                                       |
  | `NSObjectProtocol`                                           | åŸºç¡€è¡Œä¸º                 | â€”â€”                                                        | åŒååè®®ï¼ˆObjective-C åŸºç¡€ï¼‰                                 |

### 3ã€å±æ€§ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 3.1ã€`å­˜å‚¨å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> çœŸæ­£å­˜æ”¾åœ¨å†…å­˜é‡Œçš„å˜é‡/å¸¸é‡ã€‚å¯ä»¥æ˜¯ `var`ï¼ˆå¯å˜ï¼‰æˆ– `let`ï¼ˆä¸å¯å˜ï¼‰
>
> <font color=red>åªèƒ½å®šä¹‰åœ¨ **ç±»** å’Œ **ç»“æ„ä½“** é‡Œ</font>
>
> `let` çš„å­˜å‚¨å±æ€§åªèƒ½åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼
>
> ç±»é‡Œçš„å­˜å‚¨å±æ€§å¦‚æœä¸æ˜¯å¯é€‰ï¼Œå°±å¿…é¡»åœ¨ `init` å‰å…¨éƒ¨åˆå§‹åŒ–

```swift
struct User {
    var name: String      // å¯å˜å­˜å‚¨å±æ€§
    let id: Int           // ä¸å¯å˜å­˜å‚¨å±æ€§
}
```

#### 3.2ã€`è®¡ç®—å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯é€šè¿‡ **getter/setter** è®¡ç®—å‡ºæ¥ã€‚
>
> <font color=red>å¯ä»¥å®šä¹‰åœ¨ **ç±»ã€ç»“æ„ä½“ã€æšä¸¾**é‡Œ</font>ã€‚

```swift
struct Rectangle {
    var width: Double
    var height: Double
    
    var area: Double {        // åªè¯»è®¡ç®—å±æ€§
        width * height
    }
    
    var halfWidth: Double {   // å¯è¯»å†™è®¡ç®—å±æ€§
        get { width / 2 }
        set { width = newValue * 2 }
    }
}
```

#### 3.3ã€`ç±»å‹å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å±äº **ç±»å‹æœ¬èº«**ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚ç±»ä¼¼äº **ObjC**/Java çš„ `static` æˆå‘˜ã€‚
>
> ç”¨å…³é”®å­—ï¼š `static`ï¼ˆå€¼ä¸å¯è¢«å­ç±»é‡å†™ï¼‰ æˆ– `class` ï¼ˆåªèƒ½ç”¨äºç±»ï¼Œå…è®¸å­ç±»é‡å†™ï¼‰ã€‚

```swift
struct Config {
    static let maxCount = 10   // ç±»å‹å±æ€§
}

print(Config.maxCount)   // ç›´æ¥é€šè¿‡ç±»å‹è®¿é—®
```

#### 3.4ã€`å»¶è¿Ÿå­˜å‚¨å±æ€§` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ç”¨ `lazy` ä¿®é¥°ï¼Œ<font color=red>**åªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰åˆå§‹åŒ–**</font>ã€‚
>
> å¸¸ç”¨äºåˆå§‹åŒ–æˆæœ¬è¾ƒé«˜ï¼Œæˆ–è€…ä¾èµ–å¤–éƒ¨æ•°æ®çš„å±æ€§ã€‚

```swift
class DataManager {
    lazy var data = loadData()   // ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰æ‰§è¡Œ loadData()
    
    func loadData() -> [String] {
        print("Loading data...")
        return ["A", "B", "C"]
    }
}
```

#### 3.5ã€<font id=å±æ€§è§‚å¯Ÿå™¨>`å±æ€§è§‚å¯Ÿå™¨`</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> å¯ä»¥ç»™å­˜å‚¨å±æ€§åŠ  `willSet` / `didSet`ã€‚ç”¨äºç›‘æ§å±æ€§å€¼å˜åŒ–ã€‚
>
> <font color=red>**ä¸èƒ½ç›´æ¥ç”¨åœ¨è®¡ç®—å±æ€§ä¸Š**</font>ï¼ˆè®¡ç®—å±æ€§å¯ä»¥ç›´æ¥åœ¨ `set` é‡Œå†™é€»è¾‘ï¼‰ã€‚
>
> `willSet` é»˜è®¤å‚æ•°å `newValue`ï¼Œ`didSet` é»˜è®¤å‚æ•°å `oldValue`ã€‚

```swift
class Person {
    var age: Int = 0 {
        willSet {
            print("å³å°†è®¾ç½® age = \(newValue)")
        }
        didSet {
            print("å·²è®¾ç½® ageï¼Œä» \(oldValue) å˜ä¸º \(age)")
        }
    }
}
```

### 4ã€[**Swift**](https://developer.apple.com/swift/) é—­åŒ… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 4.1ã€**é—­åŒ…è¡¨è¾¾å¼** <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* `{ (å‚æ•°) -> è¿”å› in è¯­å¥ }`

#### 4.2ã€[**Swift**](https://developer.apple.com/swift/) é‡Œçš„é—­åŒ…åˆ†ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 4.2.1ã€å°¾éšé—­åŒ…ï¼ˆè¯­æ³•ç³–ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> çº¯ç²¹æ˜¯ **è¯­æ³•ç³–**ï¼Œå’Œé—­åŒ…æœ¬è´¨æ²¡åŒºåˆ«ã€‚
> ç”¨åœ¨å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯é—­åŒ…æ—¶ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚

```swift
func doSomething(action: () -> Void) { action() }

// å°¾éšé—­åŒ…å†™æ³•
doSomething {
    print("å°¾éšé—­åŒ…æ‰§è¡Œ")
}
```

##### 4.2.2ã€é€ƒé€¸`@escaping`/éé€ƒé€¸é—­åŒ… <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> é€ƒé€¸é—­åŒ…ç”¨ `@escaping` æ ‡è®°ï¼Œä¼šåœ¨å‡½æ•°è¿”å›åæ‰è°ƒç”¨
>
> å¸¸è§äº **å¼‚æ­¥å›è°ƒ/å­˜å‚¨/è·¨è¶Šç”Ÿå‘½å‘¨æœŸ**ã€ä»»åŠ¡å®Œæˆæ—¶é€šçŸ¥
>
> **é»˜è®¤**ï¼šå‚æ•°é—­åŒ…æ˜¯**éé€ƒé€¸**ï¼ˆå‡½æ•°ä½“å†…è°ƒç”¨å®Œå°±ç»“æŸï¼‰
>
> **åˆ¤æ–­å£è¯€**ï¼šé—­åŒ…è¢«**ä¿å­˜**ï¼ˆå±æ€§/æ•°ç»„ï¼‰æˆ–**å¼‚æ­¥**è°ƒç”¨ â‡’ `@escaping`

```swift
func asyncWork(completion: @escaping (String) -> Void) {
    DispatchQueue.global().async {
        completion("done")
    }
}
```

##### 4.2.3ã€è‡ªåŠ¨é—­åŒ…`@autoclosure`  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ç”¨ `@autoclosure` æ ‡è®°ï¼Œ**æŠŠä¸€ä¸ªè¡¨è¾¾å¼è‡ªåŠ¨åŒ…è£…æˆé—­åŒ…**ã€‚
>
> å¸¸ç”¨äºæ‡’æ‰§è¡Œã€æ–­è¨€ã€æ—¥å¿—ã€‚

```swift
func log(_ msg: @autoclosure () -> String) {
    print(msg())
}

log("Hello")  // è‡ªåŠ¨å˜æˆ { "Hello" }
```

#### 4.3ã€é—­åŒ…ç®€å†™ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

```swift
// å®Œæ•´
let f: (Int, Int) -> Int = { (a: Int, b: Int) -> Int in return a + b }

// çœç±»å‹ + çœ returnï¼ˆå•è¡¨è¾¾å¼è‡ªåŠ¨è¿”å›ï¼‰
let f1 = { a, b in a + b }

// å‚æ•°å ä½ç®€å†™
let f2: (Int, Int) -> Int = { $0 + $1 }

// è¿ç®—ç¬¦å‡½æ•°ï¼ˆæ­¤æ—¶æ¶‰åŠåˆ°è¿ç®—ç¬¦/å‡½æ•°çš„é‡è½½ï¼‰
// Swift é‡Œçš„ + æ‰€æœ‰å®šä¹‰éƒ½æ˜¯äºŒå…ƒå‡½æ•°ï¼š(T, T) -> Tã€‚
let f3 = (+)

// KeyPath è½¬å‡½æ•°ï¼ˆSwift 5.2+ï¼‰
struct User { let name: String }
let names = [User(name:"A"), User(name:"B")].map(\.name)
```

### 5ã€[**Swift**](https://developer.apple.com/swift/) è¿ç®—ç¬¦é‡è½½ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ è¿ç®—ç¬¦é‡è½½æœ¬è´¨å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼Œæ€§èƒ½æ²¡æœ‰ç‰¹åˆ«æŸè€—
>
> 2ï¸âƒ£ è¿‡åº¦æ»¥ç”¨ä¼šé™ä½å¯è¯»æ€§
>
> 3ï¸âƒ£ Apple çš„ API æŒ‡å—å»ºè®®ï¼šåªæœ‰åœ¨â€œè¯­ä¹‰éå¸¸æ˜ç¡®â€çš„æƒ…å†µä¸‹æ‰å®šä¹‰è¿ç®—ç¬¦ã€‚å¤æ‚æ“ä½œå»ºè®®ç”¨å‡½æ•°æ–¹æ³•è€Œä¸æ˜¯è¿ç®—ç¬¦ã€‚

* **æœ¬è´¨**ï¼šè¿ç®—ç¬¦å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªæ˜¯æœ‰ç‰¹æ®Šç¬¦å·å†™æ³•è€Œå·²

* **è¿ç®—ç¬¦é‡è½½**ï¼šç»™å·²æœ‰çš„è¿ç®—ç¬¦ï¼ˆå¦‚ `+`ã€`-`ã€`==`ï¼‰æä¾›æ–°çš„å®ç°ï¼Œæˆ–è€…ä¸ºè‡ªå®šä¹‰ç±»å‹æ·»åŠ æ”¯æŒ

* è‡ªå®šä¹‰è¿ç®—ç¬¦

  > [**Swift**](https://developer.apple.com/swift/)  è¿ç®—ç¬¦åˆ†ç±»ï¼š
  >
  > - `prefix` å‰ç¼€è¿ç®—ç¬¦
  > - `postfix` åç¼€è¿ç®—ç¬¦
  > - `infix` ä¸­ç¼€è¿ç®—ç¬¦ï¼ˆè¦å®šä¹‰ä¼˜å…ˆçº§ç»„ï¼‰

  ```swift
  // å£°æ˜ä¸€ä¸ªä¸­ç¼€è¿ç®—ç¬¦
  infix operator **: MultiplicationPrecedence
  
  // å®šä¹‰å®ç°
  func ** (lhs: Int, rhs: Int) -> Int {
      return Int(pow(Double(lhs), Double(rhs)))
  }
  
  print(2 ** 3) // 8
  ```

* ç¤ºä¾‹

  * é‡è½½ç­‰äºå·

    > [**Swift**](https://developer.apple.com/swift/) æ›´æ¨èè®©ç±»å‹éµå®ˆ `Equatable` / `Comparable` åè®®ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆæˆ `==` å’Œ `<`

    ```swift
    struct User {
        let id: Int
    }
    
    func == (lhs: User, rhs: User) -> Bool {
        lhs.id == rhs.id
    }
    ```

### 6ã€[**Swift**](https://developer.apple.com/swift/) <font color=red>**å•ä¾‹**</font>çš„å†™æ³• <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

#### 6.1ã€çº¿ç¨‹å®‰å…¨æ‡’åŠ è½½å•ä¾‹ï¼ˆæ¨èå†™æ³•ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ <font color=red>**`static let` **</font>**æ‡’åŠ è½½**ï¼š [**Swift**](https://developer.apple.com/swift/) ä¸­ `static let` å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„æ‡’åŠ è½½ã€‚ä¸ä¼šæå‰åˆå§‹åŒ–ï¼Œä¹Ÿä¸ç”¨é¢å¤–åŠ é”ã€‚
>
> 2ï¸âƒ£ <font color=red>**`final` **</font>**ä¿®é¥°ç±»**ï¼šé˜²æ­¢è¢«ç»§æ‰¿ï¼Œé¿å…å­ç±»åŒ–ç ´åå•ä¾‹æ¨¡å¼ã€‚
>
> 3ï¸âƒ£ <font color=red>**`private` **</font>**ç§æœ‰åŒ– init**ï¼šé¿å… `MySingleton()` è¢«å¤–éƒ¨ç›´æ¥è°ƒç”¨ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚

```swift
final class MySingleton {
    // å”¯ä¸€å®ä¾‹ï¼ˆé™æ€å¸¸é‡ï¼Œæ‡’åŠ è½½ + çº¿ç¨‹å®‰å…¨ï¼‰
    static let shared = MySingleton()
    
    // ç§æœ‰åŒ–åˆå§‹åŒ–æ–¹æ³•ï¼Œé¿å…å¤–éƒ¨ new
    private init() {
        print("MySingleton åˆå§‹åŒ–äº†")
    }
    
    // ä½ å¯ä»¥åœ¨è¿™é‡Œå†™å„ç§æ–¹æ³•æˆ–å±æ€§
    func doSomething() {
        print("åšç‚¹äº‹æƒ…")
    }
}

MySingleton.shared.doSomething()
```

#### 6.2ã€å…¶ä»–å†™æ³•ï¼ˆå¯¹æ¯”ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å»¶è¿Ÿå­˜å‚¨å±æ€§ + `static var`**ï¼ˆä¸æ¨èï¼Œä»£ç æ›´å¤æ‚ï¼‰

  ```swiftÂ 
  class MySingleton {
      static var shared: MySingleton = {
          let instance = MySingleton()
          return instance
      }()
      private init() {}
  }
  ```

* ****ObjC** é£æ ¼çš„ `dispatch_once`**ï¼ˆSwift 1/2 æ—¶ä»£ç”¨çš„ï¼Œç°åœ¨å¤šä½™ï¼‰æœ¬è´¨ç­‰ä»·äº `static let`

  ```swiftÂ 
  class MySingleton {
      static let shared: MySingleton = {
          return MySingleton()
      }()
      private init() {}
  }
  ```

### 7ã€[**Swift**](https://developer.apple.com/swift/)æ´¾å‘ï¼ˆDispatchï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ğŸ”¹ æ€§èƒ½å¯¹æ¯” (å¿« â†’ æ…¢)
> * **é™æ€æ´¾å‘**ï¼ˆæœ€ä¼˜åŒ–ï¼Œå¯èƒ½å†…è”ï¼‰
> * **è™šæ‹Ÿæ´¾å‘**ï¼ˆvtable æŸ¥è¡¨ï¼‰
> * **åè®® witness table æ´¾å‘**
> * **åŠ¨æ€æ´¾å‘**ï¼ˆobjc_msgSendï¼‰
>
> ğŸ”¹ å¼€å‘ä¸­å¸¸ç”¨çš„ä¿®é¥°ç¬¦ä¸æ´¾å‘å…³ç³»
> * `final` â†’ å¼ºåˆ¶é™æ€æ´¾å‘ï¼ˆä¸èƒ½è¢« overrideï¼‰
> * `private` / `fileprivate` â†’ é™æ€æ´¾å‘
> * `dynamic` â†’ å¼ºåˆ¶åŠ¨æ€æ´¾å‘ï¼ˆobjc runtimeï¼‰
> * `@objc` â†’ èµ° objc runtime
> * åè®®æ–¹æ³• â†’ witness table
> * å€¼ç±»å‹ (struct/enum) â†’ é™æ€æ´¾å‘


#### 7.1ã€é™æ€æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç¼–è¯‘æœŸå°±ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚
>
> 2ï¸âƒ£ è¿è¡Œæ—¶ä¸éœ€è¦æŸ¥è¡¨ï¼Œæœ€å¿«ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - `struct` / `enum`ï¼ˆå€¼ç±»å‹çš„æ–¹æ³•ï¼‰
> - `final class` æˆ– `final` æ–¹æ³•
> - `private` / `fileprivate` æ–¹æ³•
> - `static` æ–¹æ³•

 ```swift
 struct Foo {
     func bar() { print("bar") }
 }
 
 let foo = Foo()
 foo.bar()   // é™æ€æ´¾å‘ï¼Œç¼–è¯‘å™¨ç›´æ¥å†…è”
 ```

#### 7.2ã€è™šæ‹Ÿæ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç»å…¸çš„ **vtable (è™šå‡½æ•°è¡¨)** æ´¾å‘ã€‚
>
> 2ï¸âƒ£ ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ–¹æ³•è¡¨ï¼Œè¿è¡Œæ—¶æŸ¥è¡¨å†³å®šè°ƒç”¨å“ªä¸ªå®ç°ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - class çš„å®ä¾‹æ–¹æ³•ï¼ˆé»˜è®¤ï¼‰

```swift
class A {
    func foo() { print("A") }
}
class B: A {
    override func foo() { print("B") }
}

let a: A = B()
a.foo()   // è™šæ‹Ÿæ´¾å‘ï¼Œé€šè¿‡ vtable æŸ¥æ‰¾ -> "B"
```

#### 7.3ã€åŠ¨æ€æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ é€šè¿‡ **Objective-C runtime çš„æ¶ˆæ¯å‘é€æœºåˆ¶ (`objc_msgSend`)**ã€‚
>
> 2ï¸âƒ£ æ€§èƒ½æ¯” vtable æ…¢ï¼Œä½†æ›´çµæ´»ã€‚
>
> 3ï¸âƒ£ é€‚ç”¨åœºæ™¯ï¼š
>
> - `@objc` æ–¹æ³•
> - `dynamic` ä¿®é¥°çš„æ–¹æ³•

```swift
class C: NSObject {
    @objc dynamic func foo() { print("C") }
}
let c = C()
c.foo()   // objc_msgSend åŠ¨æ€æ´¾å‘
```

#### 7.4ã€ç›´æ¥æ´¾å‘ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ ç”¨åœ¨ **åè®®çš„é»˜è®¤å®ç°**ï¼Œé€šè¿‡ **witness table (è§è¯è¡¨)** æ¥è°ƒç”¨ã€‚
>
> 2ï¸âƒ£ ç¼–è¯‘æ—¶ä¸èƒ½ç¡®å®šå®ç°ï¼Œè¿è¡Œæ—¶æŸ¥è¡¨å†³å®šã€‚

```swift
protocol P {
    func foo()
}

extension P {
    func foo() { print("default") }
}

struct S: P {}
let p: P = S()
p.foo()   // witness table æ´¾å‘
```

### 8ã€`joined()` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* æ­£å¸¸æ‹¼æ¥

  ```Swift
  let words = ["Hello", "World", "Swift"]
  
  let sentence = words.joined()
  print(sentence)   // HelloWorldSwift
  ```

* æŒ‡å®šæ‹¼æ¥æ—¶çš„åˆ†éš”ç¬¦

  ```Swift
  let words = ["Hello", "World", "Swift"]
  
  let sentence = words.joined(separator: " ")
  print(sentence)   // Hello World Swift
  ```

### 9ã€[**Swift**](https://developer.apple.com/swift/) æ²¡æœ‰ç›´æ¥çš„<font color=red>**KVO**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**KVO**</font>çš„ç‰¹ç‚¹
  * ä¾èµ– **runtime åŠ¨æ€ç”Ÿæˆå­ç±»ï¼ˆisa-swizzlingï¼‰** æ¥æ‹¦æˆªå±æ€§ setter
  * èƒ½ç›‘å¬å‡ ä¹ä»»æ„å±æ€§ï¼ˆåªè¦ç¬¦åˆ<font color=red>**KVO**</font>è§„åˆ™ï¼‰
  * å†™æ³•ç¹çï¼ˆ`addObserver/removeObserver`ï¼‰
  * å´©æºƒé£é™©å¤§ï¼ˆæ²¡ç§»é™¤ã€å±æ€§æ²¡æ ‡<font color=red>**KVO**</font>ï¼‰
  * ä¸é€æ˜ï¼ˆè°ƒè¯•æ—¶å¾ˆéš¾çœ‹å‡ºèƒŒåå‘ç”Ÿäº†å•¥ï¼‰
* [**Swift**](https://developer.apple.com/swift/) ä¸ºä»€ä¹ˆä¸ç›´æ¥ç»™å‡º<font color=red>**KVO**</font>ï¼Ÿ
  * [**Swift**](https://developer.apple.com/swift/) çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ **ç±»å‹å®‰å…¨ + å¯é¢„æµ‹æ€§**
  * å› æ­¤ [**Swift**](https://developer.apple.com/swift/) å¹¶æ²¡æœ‰æŠŠ **ObjC** é‚£å¥— runtime hack çº§çš„ä¸œè¥¿æ¬è¿‡æ¥ï¼Œè€Œæ˜¯æä¾›äº† **æ›´å®‰å…¨çš„é€‰æ‹©**ã€‚
* ğŸ”‘[**Swift**](https://developer.apple.com/swift/) ä¸­æ›¿ä»£ <font color=red>**KVO**</font> çš„æ–¹å¼
  *  <a href="#å±æ€§è§‚å¯Ÿå™¨" style="font-size:17px; color:green;"><b>å±æ€§è§‚å¯Ÿå™¨</b></a>
  * `ObservableObject` + `@Published`ï¼ˆSwiftUI / Combineï¼‰
  * æ¡¥æ¥**ObjC**åä½¿ç”¨<font color=red>**KVO**</font>
  * å¼€æºåº“æ”¯æŒï¼š[**Bond**](https://github.com/DeclarativeHub/Bond)ã€[**RxSwift**](https://github.com/ReactiveX/RxSwift)ã€[**ReactiveSwift**](https://github.com/ReactiveCocoa/ReactiveSwift)

### 10ã€`try`/`throw`/`catch`/`finally` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* <font color=red>**`throw`**</font>

  > æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆå¿…é¡»æ˜¯ `Error` åè®®ç±»å‹ï¼‰

  ```swift
  enum MyError: Error { case bad }
  func work() throws {
      throw MyError.bad
  }
  ```

* <font color=red>**`try`**</font>

  * `try` â†’ æ­£å¸¸æŠ›é”™ï¼Œå¿…é¡»åœ¨ `do-catch` é‡Œ
  * `try?` â†’ é”™è¯¯è½¬æˆ `nil`
  * `try!` â†’ é”™è¯¯ä¼šç›´æ¥å´©æºƒ

* <font color=red>**`catch`**</font>

  ```swift
  do {
      try work()
  } catch MyError.bad {
      print("æ•è·åˆ° bad é”™è¯¯")
  } catch {
      print("æœªçŸ¥é”™è¯¯: \(error)")
  }
  ```

* **`finally`**ï¼ˆ[**Swift**](https://developer.apple.com/swift/) ç”¨ <font color=red>**`defer`**</font> å®ç°ï¼‰

  > **[Swift](https://developer.apple.com/swift/) æ²¡æœ‰ `finally`å…³é”®å­—**

  ```swift
  // è¿›å…¥ test â†’ æ³¨å†Œ defer
  // æ‰§è¡Œ do/tryï¼Œå¦‚æœæŠ›é”™è·³åˆ° catch
  // åœ¨ä½œç”¨åŸŸé€€å‡ºæ—¶ï¼Œdefer ä¸€å®šä¼šæ‰§è¡Œï¼ˆä¸ç®¡æœ‰æ²¡æœ‰æŠ›é”™ï¼‰
  func test() {
      defer {
          print("ä¸€å®šä¼šæ‰§è¡Œï¼ˆç±»ä¼¼ finallyï¼‰")
      }
  
      do {
          try work()
          print("è¿™é‡Œå¯èƒ½æŠ›é”™")
      } catch {
          print("æ•è·é”™è¯¯: \(error)")
      }
  }
  ```

### 11ã€â° å®šæ—¶å™¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ UI å±‚ã€ç®€å•é‡å¤ â†’ `Timer`ï¼ˆé…åˆ `.common` æ¨¡å¼ & `tolerance`ï¼‰
>
> 2ï¸âƒ£ å¯¹ç²¾åº¦ç¨³å®šæ€§æ›´æ•æ„Ÿã€è·‘åœ¨åå°é˜Ÿåˆ— â†’ `DispatchSourceTimer`
>
> 3ï¸âƒ£ åŠ¨ç”»æˆ–é€å¸§é€»è¾‘ â†’ `CADisplayLink`ï¼ˆæˆ– Core Animationï¼‰
>
> 4ï¸âƒ£ SwiftUI/å£°æ˜å¼ â†’ Combine çš„ `Timer.publish(...).autoconnect()` æˆ– `Task` å¾ªç¯
>
> 5ï¸âƒ£ çº¯å¼‚æ­¥ä»»åŠ¡ã€æ˜“å–æ¶ˆ â†’ `Task.sleep` å¾ªç¯ï¼Œæˆ–ï¼ˆæ›´ç°ä»£ï¼‰åŸºäº `Clock`

#### 11.1ã€å®šæ—¶å™¨åˆ†ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

##### 11.1.1ã€Foundation.Timerï¼ˆ`NSTimer`ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **RunLoop ä¾èµ–**ï¼š`Timer` åªä¼šåœ¨å…¶æ‰€é™„çš„ RunLoop è¿è¡Œæ—¶è§¦å‘ã€‚
>
> - æ”¾ä¸»çº¿ç¨‹ï¼šé»˜è®¤ OKã€‚
> - æ”¾å­çº¿ç¨‹ï¼šä½ å¾—è‡ªå·±è®©è¯¥çº¿ç¨‹æœ‰ RunLoop ä¸”åœ¨è·‘ï¼ˆ`RunLoop.current.run()` æˆ–æœ‰åˆ«çš„äº‹ä»¶æºï¼‰ã€‚
>
> 2ï¸âƒ£ **RunLoop æ¨¡å¼**ï¼š
>
> - `.default`ï¼šæ»šåŠ¨ UIScrollView ç­‰ UI è¿½è¸ªæ—¶ä¼šæš‚åœã€‚
> - `.common`ï¼šæŠŠå®šæ—¶å™¨åŠ å…¥ Common Modesï¼Œæ»šåŠ¨æ—¶ä¹Ÿä¼šè·‘ã€‚**é€šå¸¸ä¸šåŠ¡æ¨è `.common`**ã€‚
>
> 3ï¸âƒ£ **å¼ºå¼•ç”¨å¾ªç¯**ï¼šé—­åŒ…é‡Œè¦ç”¨ `[weak self]`ï¼›selector é£æ ¼ä¸­ Timer ä¼šå¼ºæŒæœ‰ targetã€‚
>
> 4ï¸âƒ£ **é”€æ¯/åœæ­¢**ï¼šè°ƒç”¨ `invalidate()`ï¼›å¦åˆ™é‡å¤å®šæ—¶å™¨ä¼šä¸€ç›´å ç€ RunLoop & å†…å­˜ã€‚
>
> 5ï¸âƒ£ **å®¹å¿åº¦ `tolerance`**ï¼šè®©ç³»ç»Ÿåˆå¹¶å”¤é†’ï¼Œçœç”µï¼›ä¸€èˆ¬è®¾ä¸º `â‰¤ timeInterval * 0.1`ã€‚
>
> 6ï¸âƒ£ **ç²¾åº¦ä¸æ¼‚ç§»**ï¼šä¸»çº¿ç¨‹å¡é¡¿/RunLoop è¢«å ç”¨ â†’ è§¦å‘ä¼šå»¶åï¼›Timer ä¼šæŒ‰æ—¶é—´æ¨è¿›è€Œéè¿½å¸§è¡¥å‘ã€‚
>
> 7ï¸âƒ£ **åå°é™åˆ¶**ï¼šApp è¿›åå°åï¼Œæ™®é€š `Timer` è§¦å‘ä¼šè¢«ç³»ç»ŸæŒ‚èµ·ï¼ˆé™¤éç‰¹å®šåå°æ¨¡å¼ï¼‰ã€‚ä¸è¦æŒ‡æœ›åå°é•¿æœŸèµ°æ—¶é’Ÿï¼Œæ”¹ç”¨æ¨é€ã€`BGTaskScheduler`ã€VoIPã€å®šä½ç­‰ç³»ç»Ÿèƒ½åŠ›ã€‚

* é—­åŒ…é£æ ¼ï¼ˆæ¨èï¼‰

  ```swift
  class Foo {
      private var timer: Timer?
  
      func start() {
          timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { [weak self] t in
              guard let self else { return }
              // ä½ çš„é€»è¾‘
              print("tick: \(Date())")
          }
          // æ³¨æ„ RunLoop æ¨¡å¼ï¼ˆè§ä¸‹æ–¹ï¼‰
          RunLoop.current.add(timer!, forMode: .common)
          // å¯é€‰ï¼šå®¹å¿åº¦ï¼Œçœç”µ
          timer?.tolerance = 0.1
      }
  
      func stop() {
          timer?.invalidate()
          timer = nil
      }
  }
  ```

* `selector` é£æ ¼ï¼ˆ**ObjC** å…¼å®¹ï¼‰

  * åˆ›å»º/å®šä¹‰ å®šæ—¶å™¨

    ```swift
    timer = Timer.scheduledTimer(timeInterval: 1.0,
                                 target: self,
                                 selector: #selector(tick),
                                 userInfo: nil,
                                 repeats: true)
    ```

  * æ‰‹åŠ¨æ·»åŠ åˆ° RunLoop

    ```swift
    RunLoop.current.add(timer!, forMode: .common)
    ```

  * å®šæ—¶å™¨æ–¹æ³•å®ç°

    ```swift
    @objc private func tick() {
        // ...
    }
    ```

##### 11.1.2ã€`DispatchSourceTimer`ï¼ˆGCD è®¡æ—¶å™¨ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **ä¸ä¾èµ– RunLoop**ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½èƒ½å‡†ç‚¹è§¦å‘ï¼›æ›´é€‚åˆâ€œæœåŠ¡å‹â€ä»»åŠ¡ã€‚
>
> 2ï¸âƒ£ **å¿…é¡» `resume()` ä¸€æ¬¡**ï¼ˆæ–°å»ºæ—¶æ˜¯ suspendedï¼‰ã€‚
>
> 3ï¸âƒ£ **`leeway` éå¸¸é‡è¦**ï¼šåˆé€‚çš„ leeway èƒ½æ˜¾è‘—çœç”µã€‚
>
> 4ï¸âƒ£ **çº¿ç¨‹å®‰å…¨**ï¼šå›è°ƒåœ¨ä½ æŒ‡å®šçš„é˜Ÿåˆ—ä¸Šï¼Œä¸è¦åœ¨é‡Œå¤´åšé‡ UIï¼›è¦å›ä¸»çº¿ç¨‹å°± `DispatchQueue.main.async {}`ã€‚
>
> 5ï¸âƒ£ **å–æ¶ˆåä¸å¯å¤ç”¨**ï¼šå–æ¶ˆå³åºŸï¼Œéœ€é‡å»ºã€‚

```swift
final class Ticker {
    private var timer: DispatchSourceTimer?

    func start() {
        let queue = DispatchQueue(label: "com.example.ticker")
        let t = DispatchSource.makeTimerSource(queue: queue)
        t.schedule(deadline: .now() + 1.0,        // é¦–æ¬¡å»¶è¿Ÿ
                   repeating: 1.0,                 // å‘¨æœŸ
                   leeway: .milliseconds(100))     // å®¹å¿åº¦ï¼ˆçœç”µï¼‰
        t.setEventHandler { [weak self] in
            // åå°é˜Ÿåˆ—æ‰§è¡Œ
            self?.doWork()
        }
        t.resume()     // âš ï¸ å¿…é¡» resume ä¸€æ¬¡
        timer = t
    }

    func stop() {
        timer?.cancel()  // ç»ˆæ­¢äº‹ä»¶æº
        timer = nil
    }

    private func doWork() { /* ... */ }
}
```

##### 11.1.3ã€`CADisplayLink`ï¼ˆé€å¸§å®šæ—¶ï¼‰<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> 1ï¸âƒ£ **ç”¨é€”**ï¼šè‡ªç»˜åŠ¨ç”»ã€æ¸¸æˆå¾ªç¯ã€è¿›åº¦æ¡å¹³æ»‘æ›´æ–°ã€‚
> 2ï¸âƒ£ **ä¸è¦ç”¨å®ƒ** åšâ€œæ¯ 1s ä¸€æ¬¡â€çš„ä¸šåŠ¡å®šæ—¶ï¼Œæµªè´¹ç”µã€‚

```swift
class DisplayDriver {
    private var link: CADisplayLink?

    func start() {
        link = CADisplayLink(target: self, selector: #selector(step))
        // è·Ÿéš UI äº¤äº’ï¼Œç”¨ common æ¨¡å¼
        link?.add(to: .main, forMode: .common)
        // iOS 15+ï¼ˆå¯é€‰ï¼‰æ›´ç»†çš„å¸§ç‡èŒƒå›´
        // link?.preferredFrameRateRange = CAFrameRateRange(minimum: 30, maximum: 120, preferred: 60)
    }

    func stop() {
        link?.invalidate()
        link = nil
    }

    @objc private func step() {
        // æ¯å¸§è°ƒç”¨ï¼›å—å±å¹•åˆ·æ–°ç‡å½±å“
    }
}
```

##### 11.1.4ã€`Combine` çš„ `Timer.TimerPublisher`  <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **UIKit**

  ```swift
  import Combine
  
  final class VM {
      private var bag = Set<AnyCancellable>()
  
      func start() {
          Timer.publish(every: 1.0, on: .main, in: .common)
              .autoconnect()
              .sink { _ in
                  // æ¯ç§’è§¦å‘
              }
              .store(in: &bag)
      }
  
      func stop() {
          bag.removeAll()
      }
  }
  ```

* **SwiftUI**

  > **ç‰¹ç‚¹**ï¼šå“åº”å¼ã€æ˜“ç»„åˆã€å’Œ SwiftUI å¤©ç„¶å¥‘åˆã€‚
  > **æœ¬è´¨**ï¼šä»å— RunLoop/é˜Ÿåˆ—ä¸å‰å°çŠ¶æ€å½±å“ï¼Œç²¾åº¦ â‰ˆ `Timer`ã€‚

  ```swift
  struct ContentView: View {
      @State private var tick = 0
      private let timer = Timer.publish(every: 1, on: .main, in: .common).autoconnect()
  
      var body: some View {
          Text("tick: \(tick)")
              .onReceive(timer) { _ in
                  tick += 1
              }
      }
  }
  ```

##### 11.1.5ã€[**Swift**](https://developer.apple.com/swift/)  å¹¶å‘çš„<u>è½¯å®šæ—¶å™¨</u>ï¼ˆ`Task.sleep` / `Clock`ï¼‰ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **ä¼˜ç‚¹**ï¼šæ—  RunLoop ä¾èµ–ï¼›å¤©ç„¶æ”¯æŒå–æ¶ˆï¼›å†™æ³•ç›´è§‚ã€‚
> **æ³¨æ„**ï¼šè¿™ä¸æ˜¯ç³»ç»Ÿçº§â€œå®šæ—¶å™¨äº‹ä»¶æºâ€ï¼Œè€Œæ˜¯åç¨‹é‡Œâ€œç¡çœ  + å¾ªç¯â€çš„æ¨¡å¼ã€‚ä¸è¦åœ¨é‡Œå¤´åšé˜»å¡å·¥ä½œï¼›éœ€è¦ UI æ›´æ–°å°±å›ä¸»çº¿ç¨‹ã€‚

* æœ€é€šç”¨å†™æ³•ï¼ˆæ‰€æœ‰ç³»ç»Ÿç‰ˆæœ¬å¯ç”¨ï¼‰

  ```swift
  final class Worker {
      private var task: Task<Void, Never>?
  
      func start() {
          task = Task {
              while !Task.isCancelled {
                  // ä½ çš„é€»è¾‘
                  try? await Task.sleep(nanoseconds: 1_000_000_000) // 1s
              }
          }
      }
  
      func stop() {
          task?.cancel()
          task = nil
      }
  }
  ```

* ä½¿ç”¨ Clockï¼ˆè¾ƒæ–°çš„ã€æ›´è¯­ä¹‰åŒ–çš„ APIï¼›å¦‚æœä½ çš„ Swift/OS æ”¯æŒï¼‰

  ```swift
  import Foundation
  
  let clock = ContinuousClock()   // ä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“çš„å•è°ƒæ—¶é’Ÿ
  
  task = Task {
      var next = clock.now
      while !Task.isCancelled {
          next += .seconds(1)
          // do work
          try? await clock.sleep(until: next)
      }
  }
  ```

#### 11.2ã€ç²¾åº¦ã€è€—ç”µä¸åå°çš„ç¡¬çº¦æŸ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **ç²¾åº¦ç°å®**ï¼šç§»åŠ¨ç«¯ä¸è¿½æ±‚çº³ç§’çº§ã€‚ä¸»çº¿ç¨‹å¡é¡¿ã€CPU è´Ÿè½½ã€ç³»ç»Ÿçœç”µåˆå¹¶éƒ½ä¼šè®©ä½ **å»¶å**ã€‚

* **çœç”µç­–ç•¥**ï¼š

  - è®¾å®š `tolerance`ï¼ˆTimerï¼‰æˆ–åˆç† `leeway`ï¼ˆGCDï¼‰ã€‚
  - ä¸è¦æŠŠå‘¨æœŸè®¾å¾—è¿‡å°ï¼ˆ<16ms è¿™ç±»é™¤éåšéŸ³è§†é¢‘/åŠ¨ç”»ï¼‰ã€‚
  - ä¸šåŠ¡ä¸Šåˆå¹¶ä»»åŠ¡ï¼ˆæ‰¹å¤„ç†ï¼‰æ›¿ä»£é«˜é¢‘å”¤é†’ã€‚

* **åå°é™åˆ¶ï¼ˆiOSï¼‰**ï¼šåº”ç”¨è¿›å…¥åå°ï¼Œæ™®é€š Timer/GCD äº‹ä»¶å¤§æ¦‚ç‡è¢«ç³»ç»ŸæŒ‚èµ·ã€‚éœ€è¦çœŸæ­£åå°æ‰§è¡Œï¼Œç”¨**ç³»ç»Ÿæ”¯æŒçš„åå°èƒ½åŠ›**ï¼š

  - `BGTaskScheduler`ï¼ˆåå°å¤„ç†/åˆ·æ–°ï¼‰ã€
  - åå°éŸ³é¢‘ã€VoIPã€å®šä½ã€è“ç‰™ç­‰**ç‰¹å®š**åå°æ¨¡å¼ã€
  - Push/é™é»˜æ¨é€ï¼ˆAPNs + Background Fetchï¼‰ã€‚**ä¸è¦**è¯•å›¾ç”¨å®šæ—¶å™¨â€œå·è·‘â€åå°â€”â€”ä¼šè¢«ç³»ç»Ÿæ€/é™ã€‚

#### 11.3ã€RunLoop æ¨¡å¼ä¸çº¿ç¨‹æ¨¡å‹ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **æ¨¡å¼**ï¼š

  - `.default`ï¼šæ™®é€šäº‹ä»¶ã€‚
  - `.tracking`ï¼šæ»šåŠ¨è·Ÿè¸ªç­‰äº¤äº’é˜¶æ®µã€‚
  - `.common`ï¼šä¸€ä¸ªâ€œæ ‡ç­¾é›†åˆâ€ï¼ŒæŠŠå®šæ—¶å™¨åŠ å…¥ `.common` â‡’ åœ¨å¤šä¸ªæ¨¡å¼ä¸‹éƒ½æœ‰æ•ˆï¼ˆå¦‚è¾¹æ»šè¾¹è§¦å‘ï¼‰ã€‚
  - UI å±‚é€šç”¨å»ºè®®ï¼šæŠŠå®šæ—¶å™¨åŠ å…¥ `.common`ã€‚

* **çº¿ç¨‹**ï¼š

  - `Timer` ç»‘å®šåˆ›å»ºå®ƒçš„çº¿ç¨‹çš„ RunLoopã€‚å­çº¿ç¨‹éœ€è¦æ‰‹åŠ¨è·‘ RunLoopã€‚
  - `DispatchSourceTimer` ç»‘å®š `DispatchQueue`ï¼Œä¸éœ€è¦ RunLoopã€‚

#### 11.4ã€å…¸å‹åœºæ™¯ä»£ç ç‰‡æ®µ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å€’è®¡æ—¶ï¼ˆUI å®‰å…¨ã€ä¸å¡é¡¿ï¼‰

  ```swift
  final class Countdown {
      private var remain: Int
      private var timer: DispatchSourceTimer?
  
      init(seconds: Int) { self.remain = seconds }
  
      func start(tick: @escaping (Int) -> Void, done: @escaping () -> Void) {
          let q = DispatchQueue(label: "countdown")
          let t = DispatchSource.makeTimerSource(queue: q)
          t.schedule(deadline: .now(), repeating: 1, leeway: .milliseconds(50))
          t.setEventHandler { [weak self] in
              guard let self else { return }
              if self.remain <= 0 {
                  t.cancel()
                  DispatchQueue.main.async { done() }
                  return
              }
              self.remain -= 1
              DispatchQueue.main.async { tick(self.remain) }
          }
          t.resume()
          timer = t
      }
  
      func stop() {
          timer?.cancel()
          timer = nil
      }
  }
  ```

* é˜²æŠ–/èŠ‚æµï¼ˆä¸»çº¿ç¨‹ï¼‰

  ```swift
  /// é˜²æŠ–ï¼ˆdebounceï¼‰ï¼šåªåœ¨â€œåœæ­¢è§¦å‘åä¸€æ®µæ—¶é—´â€æ‰§è¡Œ
  final class Debouncer {
      private var workItem: DispatchWorkItem?
  
      func schedule(after delay: TimeInterval, _ block: @escaping () -> Void) {
          workItem?.cancel()
          let item = DispatchWorkItem(block: block)
          workItem = item
          DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: item)
      }
  }
  ```

  ```swift
  /// èŠ‚æµï¼ˆthrottleï¼‰ï¼šå›ºå®šçª—å£å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡
  final class Throttler {
      private var lastFire: DispatchTime = .now()
      private var scheduled = false
  
      func call(interval: TimeInterval, _ block: @escaping () -> Void) {
          let now = DispatchTime.now()
          let delta = now.uptimeNanoseconds - lastFire.uptimeNanoseconds
          if delta >= UInt64(interval * 1_000_000_000) {
              lastFire = now
              block()
          } else if !scheduled {
              scheduled = true
              let delay = Double(UInt64(interval * 1_000_000_000) - delta) / 1_000_000_000
              DispatchQueue.main.asyncAfter(deadline: .now() + delay) { [weak self] in
                  guard let self else { return }
                  self.lastFire = .now()
                  self.scheduled = false
                  block()
              }
          }
      }
  }
  ```

#### 11.5ã€`SwiftUI`@å®šæ—¶å™¨ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **Timer + onReceive**ï¼šç®€å•åˆ—è¡¨/å€’è®¡æ—¶ UI ç”¨è¿™ä¸ªå¤Ÿäº†
* **`Task` + `sleep`**ï¼šåœ¨ `task { }` é‡Œå†™å¾ªç¯ï¼Œæ”¯æŒå–æ¶ˆï¼Œé€»è¾‘æ›´ç›´
* **TimelineView**ï¼ˆåšæ—¶é—´é©±åŠ¨çš„è§†å›¾åˆ·æ–°ï¼Œå¦‚è¡¨ç›˜/ç§’é’ˆï¼‰æ¯”ç”Ÿ Timer æ›´è¯­ä¹‰åŒ–
* **ä¸è¦åœ¨ View é‡Œç›´æ¥æŒæœ‰ GCD timer**ï¼›æŠŠå®ƒæ”¾åˆ° **ViewModel**/**ObservableObject** ç®¡ç†

#### 11.6ã€æ—¶é—´æ¥æºä¸æ ¡æ­£ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **ç³»ç»Ÿæ—¶é—´ ğŸ†š å•è°ƒæ—¶é’Ÿ**ï¼šç”¨æˆ·æ”¹ç³»ç»Ÿæ—¶é’Ÿå¯èƒ½å½±å“åŸºäº<u>**æŒ‚é’Ÿæ—¶é—´**</u>çš„è°ƒåº¦
  - å¯¹æŠ—ï¼šä½¿ç”¨å•è°ƒæ—¶é—´ï¼ˆGCD/Clockï¼‰ï¼Œæˆ–åŸºäºç›¸å¯¹æ—¶é—´æ¨è¿›
  
* **é•¿ä»»åŠ¡æ¼‚ç§»**ï¼šå¦‚æœæ¯è½®å¤„ç†æ—¶é—´æ¥è¿‘å‘¨æœŸï¼Œæ¼‚ç§»ä¸å¯é¿å…ï¼›æ§åˆ¶å›è°ƒé‡Œå·¥ä½œé‡ï¼Œå¿…è¦æ—¶å¼‚æ­¥åŒ–

* **çº åç­–ç•¥**ï¼šè®°å½•åŸºå‡† `Date/Instant`ï¼Œæ¯æ¬¡è®¡ç®—â€œåº”è¯¥çš„ä¸‹ä¸€æ¬¡â€è€Œé<u>**å½“å‰æ—¶é—´ + å›ºå®šå‘¨æœŸ**</u>

## äº”ã€<font color=red>**F**</font><font color=green>**A**</font><font color=blue>**Q**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 1ã€[**Swift**](https://developer.apple.com/swift/) çº¯ç±» ğŸ†š `NSObject` å­ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

### 2ã€[**Swift**](https://developer.apple.com/swift/) `å±æ€§è§‚å¯Ÿå™¨` ğŸ†š **Objc** `KVO` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§     | Swift å±æ€§è§‚å¯Ÿå™¨             | **ObjC** KVO               |
| -------- | ---------------------------- | -------------------------- |
| ç›‘å¬èŒƒå›´ | è‡ªèº«å±æ€§                     | å…¶ä»–å¯¹è±¡å±æ€§               |
| å®ç°æ–¹å¼ | ç¼–è¯‘å™¨æ³¨å…¥                   | Runtime åŠ¨æ€å­ç±»           |
| ç®€æ´åº¦   | ç®€å•ï¼ˆ`willSet` / `didSet`ï¼‰ | ç¹çï¼ˆadd/removeObserverï¼‰ |
| ä½¿ç”¨åœºæ™¯ | å†…éƒ¨é€»è¾‘ã€çŠ¶æ€æ›´æ–°           | è·¨å¯¹è±¡ç›‘å¬ã€æ•°æ®ç»‘å®š       |
| å¯æ›¿ä»£æ€§ | ä¸èƒ½å®Œå…¨æ›¿ä»£ KVO             | æ¯”è§‚å¯Ÿå™¨æ›´å¼ºå¤§ï¼Œä½†æ›´å¤æ‚   |

* [**Swift**](https://developer.apple.com/swift/) `å±æ€§è§‚å¯Ÿå™¨`ï¼š`willSet` / `didSet` â†’ **è½»é‡çº§ã€è‡ªç”¨**çš„å±æ€§å˜åŒ–é’©å­ã€‚

  > **ä½œç”¨èŒƒå›´**ï¼šåªèƒ½ç”¨äº **æœ¬ç±»å±æ€§**ã€‚
  >
  > **è§¦å‘æ—¶æœº**ï¼šå±æ€§è¢«ç›´æ¥èµ‹å€¼æ—¶è§¦å‘ã€‚
  >
  > **æ„ŸçŸ¥èƒ½åŠ›**ï¼šåªèƒ½æ„ŸçŸ¥â€œæˆ‘è‡ªå·±çš„å±æ€§å˜åŒ–â€ã€‚
  >
  > **å®ç°æœºåˆ¶**ï¼šç¼–è¯‘å™¨åœ¨ setter åé¢è‡ªåŠ¨æ’å…¥é€»è¾‘ã€‚
  >
  > **é™åˆ¶**ï¼šä¸èƒ½ç”¨åœ¨è®¡ç®—å±æ€§ä¸Šï¼ˆå› ä¸ºè®¡ç®—å±æ€§ä½ å¯ä»¥ç›´æ¥åœ¨ `set` å†™é€»è¾‘ï¼‰ã€‚

  ```swift
  class Person {
      var age: Int = 0 {
          willSet {
              print("å³å°†è®¾ç½® age = \(newValue)")
          }
          didSet {
              print("age ä» \(oldValue) æ”¹ä¸º \(age)")
          }
      }
  }
  ```

* **Objective-C** `KVO` ï¼š**é€šç”¨ã€è·¨å¯¹è±¡**çš„è§‚å¯Ÿæœºåˆ¶ã€‚

  > **ä½œç”¨èŒƒå›´**ï¼šå¯ä»¥è§‚å¯Ÿ **å…¶ä»–å¯¹è±¡çš„å±æ€§**ã€‚
  >
  > **è§¦å‘æ—¶æœº**ï¼šä¸ä»…ç›´æ¥èµ‹å€¼ä¼šè§¦å‘ï¼ŒKVCï¼ˆ`setValue:forKey:`ï¼‰ã€æœ‰æ—¶ even Core Data è¿™ç§åº•å±‚éƒ½èƒ½ hookã€‚
  >
  > **æ„ŸçŸ¥èƒ½åŠ›**ï¼šè·¨å¯¹è±¡ï¼Œåªè¦å¯¹è±¡æ”¯æŒ KVOï¼Œå°±èƒ½ç›‘å¬ã€‚
  >
  > **å®ç°æœºåˆ¶**ï¼šè¿è¡Œæ—¶åŠ¨æ€æ´¾ç”Ÿå­ç±» + æ–¹æ³•æ›¿æ¢ï¼ˆisa-swizzlingï¼‰ã€‚
  >
  > **é™åˆ¶**ï¼š
  >
  > - API æ¯”è¾ƒç¹çã€‚
  > - çº¿ç¨‹å®‰å…¨å’Œå´©æºƒé£é™©éœ€è¦è‡ªå·±å¤„ç†ã€‚

  ```objective-c
  [self.person addObserver:self
                forKeyPath:@"age"
                   options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld
                   context:nil];
  
  - (void)observeValueForKeyPath:(NSString *)keyPath
                        ofObject:(id)object
                          change:(NSDictionary<NSKeyValueChangeKey,id> *)change
                         context:(void *)context {
      NSLog(@"age å˜åŒ–: %@", change);
  }
  ```

### 3ã€[**Swift**](https://developer.apple.com/swift/) ä¸­ `struct` å’Œ `class` çš„ä¸»è¦åŒºåˆ« <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹

  > `struct` æ˜¯ **å€¼ç±»å‹**ï¼šèµ‹å€¼/ä¼ å‚æ—¶ä¼šå¤åˆ¶ä¸€ä»½ã€‚
  >
  > `class` æ˜¯ **å¼•ç”¨ç±»å‹**ï¼šèµ‹å€¼/ä¼ å‚æ—¶åªæ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚

  ```
  struct S { var x = 0 }
  class C { var x = 0 }
  
  var s1 = S()
  var s2 = s1
  s2.x = 10
  print(s1.x)  // 0   ï¼ˆäº’ä¸å½±å“ï¼‰
  
  var c1 = C()
  var c2 = c1
  c2.x = 10
  print(c1.x)  // 10  ï¼ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼‰
  
  ```

* ç»§æ‰¿

  > `struct` âŒ ä¸æ”¯æŒç»§æ‰¿
  >
  > `class` âœ… å¯ä»¥ç»§æ‰¿

* ARC ç®¡ç†

  > `struct`ï¼šå› ä¸ºæ˜¯å€¼ç±»å‹ï¼Œä¸éœ€è¦ ARC ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸç®€å•ã€‚
  >
  > `class`ï¼šç”± ARC ç®¡ç†ï¼Œå¯èƒ½æœ‰ **å¾ªç¯å¼•ç”¨** é—®é¢˜ï¼Œéœ€è¦ `weak` / `unowned`ã€‚

* å¯å˜æ€§

  > `struct`ï¼šåœ¨ `let` å¸¸é‡ä¸‹æ˜¯å®Œå…¨ä¸å¯å˜çš„ï¼ˆåŒ…æ‹¬å±æ€§ï¼‰ã€‚
  >
  > `class`ï¼šåœ¨ `let` å¸¸é‡ä¸‹å¯¹è±¡æœ¬èº«ä¸å¯å˜ï¼Œä½†å±æ€§ä»ç„¶å¯æ”¹ã€‚

  ```
  struct S {
      var x = 0
  }
  let s = S()
  // s.x = 10  âŒ ä¸å…è®¸
  
  class C {
      var x = 0
  }
  let c = C()
  c.x = 10  âœ… å¯ä»¥æ”¹å±æ€§
  ```

* ç±»å‹ç‰¹æ€§

  > `struct`ï¼šè‡ªåŠ¨æœ‰ **é€ä¸€æˆå‘˜åˆå§‹åŒ–å™¨ï¼ˆmemberwise initï¼‰**ã€‚
  >
  > `class`ï¼šæ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±å†™ `init`

  ```
  struct User { var name: String; var age: Int }
  let u = User(name: "Jobs", age: 18)  âœ…
  ```

* è¯­ä¹‰

  * `struct` æ›´åå‘ **æ•°æ®æ¨¡å‹ï¼ˆå°è£…æ•°æ® + å°é€»è¾‘ï¼‰**
  * `class` æ›´åå‘ **å¯¹è±¡ã€èº«ä»½ã€ç»§æ‰¿ã€å¤šæ€**

#### ğŸ”¹ <font color=blue>**ä¸ºä»€ä¹ˆSwiftæ¨èï¼šå¤šç”¨ `struct`ï¼Œå°‘ç”¨ `class`ï¼Ÿ**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* **å®‰å…¨æ€§æ›´é«˜ï¼ˆå€¼è¯­ä¹‰é¿å…å…±äº«å‰¯ä½œç”¨ï¼‰**
  * å€¼ç±»å‹åœ¨ä¼ é€’æ—¶å¤åˆ¶ï¼Œé¿å…äº†å¯¹è±¡åœ¨å¤šå¤„è¢«ä¿®æ”¹å¸¦æ¥çš„ bug
  * æ›´å®¹æ˜“æ¨æ–­ä»£ç è¡Œä¸º

* **æ²¡æœ‰å¾ªç¯å¼•ç”¨é—®é¢˜**
  * <font color=red>**`struct` ä¸ä¾èµ– ARCï¼Œä¸ä¼šå› ä¸ºäº’ç›¸æŒæœ‰å¯¼è‡´å†…å­˜æ³„æ¼**</font>

* **æ€§èƒ½æ›´ä¼˜ï¼ˆå¾ˆå¤šæƒ…å†µä¸‹ï¼‰**
  * å°çš„ `struct` ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä¸ºæ ˆä¸Šåˆ†é…ï¼Œè®¿é—®é€Ÿåº¦å¿«
  * é¿å…äº† class çš„ å † åˆ†é…å’Œ ARC å¼•ç”¨è®¡æ•°å¼€é”€

* **è¯­ä¹‰æ›´æ¸…æ™°**
  * `struct` å¼ºè°ƒå€¼çš„ä¸å¯å˜æ€§ï¼Œé€‚åˆå»ºæ¨¡â€œæ•°æ®â€ã€‚
  * `class` å¼ºè°ƒèº«ä»½å’Œå…±äº«ï¼Œé€‚åˆå»ºæ¨¡â€œå¯¹è±¡â€ã€‚

* **å’Œ Swift æ ‡å‡†åº“ä¸€è‡´**
  * [**Swift**](https://developer.apple.com/swift/) é‡Œå¤§é‡æ ¸å¿ƒç±»å‹éƒ½æ˜¯ `struct`ï¼š`String`, `Array`, `Dictionary`, `Set`
  * Apple å®˜æ–¹é£æ ¼å°±æ˜¯ï¼šèƒ½ç”¨å€¼è¯­ä¹‰çš„åœ°æ–¹ä¼˜å…ˆç”¨ `struct`

#### ğŸ“Œ <font color=blue>**ä»€ä¹ˆæ—¶å€™ä¸€å®šè¦ç”¨ `class`?**</font> <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* éœ€è¦ **ç»§æ‰¿**
* éœ€è¦ **å¼•ç”¨è¯­ä¹‰**ï¼ˆæ¯”å¦‚ UI æ§ä»¶ï¼Œå¤šå¤„å…±äº«çŠ¶æ€ï¼‰
* éœ€è¦å’Œ **Objective-C æ¡¥æ¥**ï¼ˆ**ObjC** é‡Œåªæœ‰ç±»ï¼‰

### 4ã€[**Swift**](https://developer.apple.com/swift/) å¯ä»¥åƒ**ObjC**é‚£æ ·è®¿é—®å†…å­˜å—ï¼Ÿ<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **å¯ä»¥ï¼Œä½†å—æ›´å¤šé™åˆ¶**ï¼Œå› ä¸º Swift é»˜è®¤æ˜¯å®‰å…¨çš„
>
> å¦‚æœç¡®å®éœ€è¦ï¼ˆæ¯”å¦‚æ€§èƒ½ä¼˜åŒ–ã€ä¸ C/**ObjC** åº“äº¤äº’ï¼‰ï¼Œå¯ä»¥ç”¨ **`UnsafePointer` ç³»åˆ—**ã€‚

#### 4.1ã€[**Swift**](https://developer.apple.com/swift/) å†…å­˜è®¿é—®æ–¹å¼ <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

* Unsafe æŒ‡é’ˆç³»åˆ—

  > `UnsafePointer<T>`ï¼ˆç›¸å½“äº `const T *`ï¼‰
  >
  > `UnsafeMutablePointer<T>`ï¼ˆç›¸å½“äº `T *`ï¼‰
  >
  > `UnsafeRawPointer` / `UnsafeMutableRawPointer`ï¼ˆæ— ç±»å‹æŒ‡é’ˆï¼Œç±»ä¼¼ `void *`ï¼‰
  >
  > `OpaquePointer`ï¼ˆåªä¿å­˜åœ°å€ï¼Œä¸å¯ç›´æ¥è§£å¼•ç”¨ï¼‰

  ```swift
  var num = 42
  
  // è·å–æŒ‡é’ˆ
  let ptr = withUnsafePointer(to: &num) { $0 }
  print(ptr.pointee)  // 42
  
  // ä¿®æ”¹å€¼
  withUnsafeMutablePointer(to: &num) { p in
      p.pointee = 100
  }
  print(num)  // 100
  ```

* åŸå§‹å†…å­˜æ“ä½œï¼ˆ`malloc`/`free`ï¼‰

  ```swift
  let raw = UnsafeMutableRawPointer.allocate(byteCount: 4, alignment: 4)
  raw.storeBytes(of: 1234, as: Int32.self)
  
  let value = raw.load(as: Int32.self)
  print(value) // 1234
  
  raw.deallocate()
  ```

* å’Œ **C/Objective-C** äº’æ“ä½œ

  > [**Swift**](https://developer.apple.com/swift/)  çš„ Unsafe æŒ‡é’ˆå’Œ C æŒ‡é’ˆå¯ä»¥æ— ç¼æ¡¥æ¥

  ```swift
  let arr: [Int32] = [1, 2, 3]
  /// **ObjC** æ–¹æ³•é‡Œéœ€è¦ int * å‚æ•°ï¼ŒSwift ä¼šè‡ªåŠ¨æ˜ å°„æˆ UnsafePointer<Int32>
  arr.withUnsafeBufferPointer { buffer in
      c_function(buffer.baseAddress, Int32(buffer.count))
  }
  ```

### 5ã€`print` ğŸ†š `debugPrint` <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> ```swift
> let array = ["A", "B", "C"]
> 
> print(array)       // [A, B, C]     â† ç”¨æˆ·å‹å¥½
> debugPrint(array)  // ["A", "B", "C"] â† åŒ…å«å¼•å·ï¼ŒçœŸå®è¡¨è¾¾
> ```
>
> ```swift
> let str = "Hello\nWorld"
> print(str)       // Hello
>                  // World   â† ç›´æ¥æ¢è¡Œ
> debugPrint(str)  // "Hello\nWorld" â† åŸå§‹å­—ç¬¦è½¬ä¹‰
> ```

* `print`ï¼ˆä¸šåŠ¡æ—¥å¿—ã€ç”¨æˆ·å¯è§çš„æ—¥å¿— ï¼‰

  * **é¢å‘ç”¨æˆ·çš„è¾“å‡º**
  * è¾“å‡ºæ—¶è°ƒç”¨å¯¹è±¡çš„ **`CustomStringConvertible`** åè®®ä¸­çš„ `description`ã€‚
  * å¦‚æœå¯¹è±¡æ²¡å®ç° `description`ï¼Œåˆ™ä¼šç”¨é»˜è®¤çš„ç®€çŸ­æè¿°ã€‚
  * **é€‚åˆâ€œç»™äººçœ‹â€çš„æ—¥å¿—**ã€‚

  ```swift
  struct User: CustomStringConvertible {
      let name: String
      var description: String {
          return "ğŸ‘¤ ç”¨æˆ·å: \(name)"
      }
  }
  
  let u = User(name: "Jobs")
  
  print(u)
  // è¾“å‡ºï¼šğŸ‘¤ ç”¨æˆ·å: Jobs
  ```

* `debugPrint`ï¼ˆè°ƒè¯• / æ’æŸ¥é—®é¢˜ã€éœ€è¦çœ‹åˆ°å¯¹è±¡ç»†èŠ‚ï¼‰

  * **é¢å‘å¼€å‘è€…/è°ƒè¯•çš„è¾“å‡º**
  * è¾“å‡ºæ—¶è°ƒç”¨å¯¹è±¡çš„ **`CustomDebugStringConvertible`** åè®®ä¸­çš„ `debugDescription`ã€‚
  * å¦‚æœå¯¹è±¡æ²¡å®ç° `debugDescription`ï¼Œä¼š fallback åˆ° `description`ï¼Œå†ä¸è¡Œå°±è¾“å‡ºç±»å‹ä¿¡æ¯å’Œå†…å­˜åœ°å€ã€‚
  * **é€‚åˆâ€œè°ƒè¯•åœºæ™¯â€**ï¼Œæ¯”å¦‚è¦çœ‹å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å‹å¥½çš„æè¿°ã€‚

  ```swift
  struct User: CustomStringConvertible, CustomDebugStringConvertible {
      let name: String
      var description: String {
          return "ğŸ‘¤ ç”¨æˆ·å: \(name)"
      }
      var debugDescription: String {
          return "User(name: \(name))"
      }
  }
  
  let u = User(name: "Jobs")
  
  print(u)       // ğŸ‘¤ ç”¨æˆ·å: Jobs
  debugPrint(u)  // User(name: Jobs)
  ```
### 6ã€[**Swift**](https://developer.apple.com/swift/) çº¯ç±» ğŸ†š **`NSObject`** å­ç±» <a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

> **ä¸ç»§æ‰¿ `NSObject`**ï¼šç”¨äº **çº¯ [Swift](https://developer.apple.com/swift/)  é€»è¾‘/æ¨¡å‹**ï¼Œè½»é‡ã€æ€§èƒ½å¥½ã€å®‰å…¨
>
> **ç»§æ‰¿ `NSObject`**ï¼šç”¨äº **UI å±‚ / å’Œ Objective-C äº’æ“ä½œ**ï¼Œéœ€è¦ **KVC/KVO/Selector** æˆ–ä½¿ç”¨ Foundation/UIKit API æ—¶å¿…é¡»ç”¨

* [**Swift**](https://developer.apple.com/swift/) çº¯ç±»ï¼ˆä¸ç»§æ‰¿ `NSObject`ï¼‰

  > 1ï¸âƒ£ **å€¼è¯­ä¹‰åªé  Swift**ï¼Œä¸ä¾èµ– ObjC Runtime
  >
  > 2ï¸âƒ£ ä¸èƒ½ç›´æ¥ç”¨ **KVC / KVO**
  >
  > 3ï¸âƒ£ ä¸èƒ½ç›´æ¥ç”¨ **Selector** è°ƒç”¨
  >
  > 4ï¸âƒ£ ä¸èƒ½ç›´æ¥å­˜æ”¾åœ¨éœ€è¦ `AnyObject & NSObjectProtocol` çš„ API ä¸­ï¼ˆå¦‚ `NSDictionary`ï¼‰
  >
  > 5ï¸âƒ£ `isEqual`, `hash`, `description` è¿™äº›éƒ½æ²¡æœ‰ `NSObject` é»˜è®¤å®ç°ï¼Œéœ€è¦è‡ªå·±å†™
  >
  > 6ï¸âƒ£ çº¯ [**Swift**](https://developer.apple.com/swift/)  ç±»å‹ï¼Œ**æ€§èƒ½æ›´å¥½**ï¼Œä¸éœ€è¦åŠ¨æ€æ´¾å‘ï¼ˆé™¤éä½ æ ‡è®° `dynamic` æˆ– `@objc`ï¼‰
  >
  > 7ï¸âƒ£ **æ•°æ®å±‚/é€»è¾‘å±‚** â†’ ç”¨ **çº¯ Swift ç±»** æˆ– `struct`

  ```swift
  class Person {
      var name: String
      init(name: String) { self.name = name }
  }
  ```

* ç»§æ‰¿è‡ª `NSObject`

  > 1ï¸âƒ£ è‡ªåŠ¨è·å¾— **`NSObject` åŸºç¡€åŠŸèƒ½**
  >
  > 2ï¸âƒ£ å¯ä»¥ä½¿ç”¨ **KVC/KVO**
  >
  > 3ï¸âƒ£ å¯ä»¥ä½¿ç”¨ **Selector / perform**
  >
  > 4ï¸âƒ£ ä¸ **Objective-C API æ— ç¼äº’é€š**ï¼ˆ`UIKit/AppKit` é‡Œç»å¤§å¤šæ•° API è¦æ±‚ `NSObject`ï¼‰
  >
  > 5ï¸âƒ£ éœ€è¦ ARC ç®¡ç†ï¼Œæœ‰ä¸€å®šæ€§èƒ½å¼€é”€
  >
  > 6ï¸âƒ£ **è·Ÿ UIKit/AppKit æ‰“äº¤é“çš„å±‚** â†’ å¿…é¡»ç»§æ‰¿ `NSObject`

  ```swiftÂ 
  class Person: NSObject {
      @objc var name: String
      init(name: String) { self.name = name }
  }
  ```


### 7ã€`try/throw/catch/finally` ä¸ºä»€ä¹ˆåœ¨**Objc**é‡Œé¢å‡ ä¹ä¸ç”¨ï¼Œè€Œ[**Swift**](https://developer.apple.com/swift/)é‡Œé¢å´è¢«å¤§é‡ä½¿ç”¨ï¼Ÿ<a href="#å‰è¨€" style="font-size:17px; color:green;"><b>ğŸ”¼</b></a> <a href="#ğŸ”š" style="font-size:17px; color:green;"><b>ğŸ”½</b></a>

| ç‰¹æ€§               | Objective-C                          | Swift                                       |
| ------------------ | ------------------------------------ | ------------------------------------------- |
| å¼‚å¸¸ (`try/catch`) | æœ‰ï¼Œä½†æ€§èƒ½å·®ï¼ŒARC ä¸‹å±é™©ï¼Œå®˜æ–¹ä¸æ¨è | æœ‰ï¼Œé›¶æˆæœ¬è®¾è®¡ï¼Œæ¨èç”¨äºâ€œå¯é¢„æœŸé”™è¯¯â€        |
| æ¨èæ–¹å¼           | `NSError **` è¾“å‡ºå‚æ•°                | `throws` + `try`ï¼Œæˆ– `Result<T,Error>`      |
| ç¼–è¯‘å™¨æ£€æŸ¥         | âŒ æ²¡æœ‰                               | âœ… è°ƒç”¨ç‚¹å¿…é¡»æ˜¾å¼ `try`                      |
| å…¸å‹åœºæ™¯           | ç³»ç»Ÿ API æŠ¥é”™ï¼šä¼  `NSError**`        | æ–‡ä»¶ IO / JSON è§£æ / ç½‘ç»œè¯·æ±‚ ç­‰å¯æ¢å¤é”™è¯¯ |
| å¼‚å¸¸è¯­ä¹‰           | Fatal bugï¼Œä¸å»ºè®®æ•è·                | ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼Œå¿…é¡»å¤„ç†                      |

* **Objc**

  * Apple å®˜æ–¹æ–‡æ¡£æ˜ç¡®è¯´

    * ğŸ‘‰ **Exceptions ç”¨æ¥è¡¨ç¤ºç¨‹åºå‘˜é”™è¯¯ï¼ˆç¼–ç¨‹ bugï¼‰ï¼Œä¸æ¨èç”¨æ¥åšé”™è¯¯å¤„ç†**

    * æ¯”å¦‚æ•°ç»„è¶Šç•Œã€è®¿é—®é‡æŒ‡é’ˆï¼Œéƒ½æ˜¯ fatal bugï¼Œåº”è¯¥ç›´æ¥ crashï¼Œè€Œä¸æ˜¯ recover

    * æ­£å¸¸çš„é”™è¯¯è¿”å›ï¼ŒApple æ¨å¹¿ **NSError** æ¨¡å¼

      ```objective-c
      - (BOOL)writeToFile:(NSString *)path error:(NSError **)error;
      ```

  * **è¿è¡Œæ—¶æ¨¡å‹åŸå› **

    * **Objc** çš„å¼‚å¸¸å¤„ç†å¼€é”€å¤§ï¼ˆåŸºäº setjmp/longjmpï¼‰ï¼Œæ€§èƒ½å·®
    * ARC ä¸‹å¼‚å¸¸è¿˜å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¯¹è±¡æ²¡æ¥å¾—åŠ releaseï¼‰
    * æ‰€ä»¥è‹¹æœå®˜æ–¹åœ¨ ARC æ–‡æ¡£é‡Œç›´æ¥å†™ï¼š**ä¸è¦ç”¨ @try/@catch æ•æ‰ä¸€èˆ¬é”™è¯¯**

* [**Swift**](https://developer.apple.com/swift/)

  * å®‰å…¨æ€§ & æ˜¾å¼æ€§

    * [**Swift**](https://developer.apple.com/swift/) ä¸å¸Œæœ›é”™è¯¯é€šè¿‡é­”æ³•æ–¹å¼â€œæ‚„æ‚„å‘ç”Ÿâ€ï¼Œè€Œæ˜¯è¦ä½ åœ¨è°ƒç”¨ç‚¹æ˜¾å¼å†™ `try`ã€‚

    * è¿™æ ·ä¸€çœ¼å°±èƒ½çœ‹å‡ºè¿™ä¸ªå‡½æ•°å¯èƒ½å¤±è´¥

      ```swift
      func readFile(_ path: String) throws -> String
      let content = try readFile("foo.txt")
      ```

  * æ€§èƒ½ï¼š[**Swift**](https://developer.apple.com/swift/) çš„ `throw` **ä¸èµ° ObjC çš„ setjmp/longjmp**ï¼Œå®ç°æ–¹å¼æ›´æ¥è¿‘ **C++ ** çš„é›¶æˆæœ¬å¼‚å¸¸æ¨¡å‹

    * ä¸æŠ›é”™æ—¶å‡ ä¹æ²¡æœ‰å¼€é”€ï¼›
    * åªæœ‰çœŸçš„æŠ›å‡ºæ—¶æ‰èµ°å¼€é”€è·¯å¾„ã€‚

  * å’Œç±»å‹ç³»ç»Ÿç»“åˆ

    * [**Swift**](https://developer.apple.com/swift/) çš„ `throws` æ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ä½ å¤„ç†ã€‚
    * **Objc** çš„ **`NSError`** é æ–‡æ¡£å’Œçº¦å®šï¼Œæ²¡äººå¼ºåˆ¶ã€‚

  * å¯é€‰å¤šç§é£æ ¼

    * ä½ å¯ä»¥ç”¨ `try/try? / try!` æ ¹æ®éœ€è¦é€‰æ‹©å®‰å…¨çº§åˆ«ã€‚
    * ä¹Ÿå¯ä»¥æŠŠ `throws` è½¬æ¢æˆ `Result<T, Error>`ï¼Œå’Œ `async/await`ã€`Combine`ã€[**Swift**](https://developer.apple.com/swift/) **Concurrency** é…åˆéå¸¸å¥½ã€‚











<a id="ğŸ”š" href="#å‰è¨€" style="font-size:17px; color:green; font-weight:bold;">æˆ‘æ˜¯æœ‰åº•çº¿çš„ğŸ‘‰ç‚¹æˆ‘å›åˆ°é¦–é¡µ</a>
